## LightChaser-V3

### Generated for: SizeV2

### Generated on: 2024-03-19

## Total findings: 180

### Total HIGH findings: 0

### Total Medium findings: 0

### Total Low findings: 21

### Total Gas findings: 62

### Total Refactoring findings: 0

### Total NonCritical findings: 97

### Total Disputed findings: 0

## Disclaimer

Please read this disclaimer carefully before using the LightChaser-V3 Report provided. By accessing and using this Report, you acknowledge and agree to the terms outlined below: The Report is not a confirmation of security; it is designed to identify potential vulnerabilities based on automated algorithms and does not cover all issues within your codebase. The presence or absence of issues identified does not guarantee security. Recommendations and resolutions are generated automatically and should not be implemented without expert review. This Report is one aspect of a holistic security approach; we recommend incorporating manual reviews, third-party audits, competitive audit platforms, and bug bounties. We are not responsible for any losses or damages arising from the use of this Report; it is provided "as is" without warranty. Reliance on this Report is at your own risk.

# Summary for Low findings

| Number | Details | Instances |
|----------|----------|----------|
| [Low-1] | Avoid making withdraw/unstake functions Pausable  | 1 |
| [Low-2] | Contracts deployed by factory can have their initialisation front run | 1 |
| [Low-3] | Token burning is centralized | 1 |
| [Low-4] | Token minting is centralized | 1 |
| [Low-5] | Empty receive functions can cause gas issues | 1 |
| [Low-6] | Ownable2Step should be used in place of Ownable | 2 |
| [Low-7] | Upgradable contracts should have a __gap variable | 2 |
| [Low-8] | Contracts are vulnerable to fee-on-transfer accounting-related issues | 5 |
| [Low-9] | Initializer function can be front run | 2 |
| [Low-10] | The function decimals() is not part of the ERC20 standard | 5 |
| [Low-11] | Loss of precision | 1 |
| [Low-12] | Missing zero address check in constructor | 2 |
| [Low-13] | External call recipient may consume all transaction gas | 1 |
| [Low-14] | Missing zero address check in initializer | 2 |
| [Low-15] | Consider implementing two-step procedure for updating protocol addresses | 3 |
| [Low-16] | Missing contract-existence checks before low-level calls | 3 |
| [Low-17] | No license selected for project | 1 |
| [Low-18] | State variables not capped at reasonable values | 2 |
| [Low-19] | Pure function accesses storage | 1 |
| [Low-20] | Unsafe use of transfer()/transferFrom() with IERC20 | 6 |
| [Low-21] | Functions calling contracts/addresses with transfer hooks are missing reentrancy guards | 2 |
# Summary for NonCritical findings

| Number | Details | Instances |
|----------|----------|----------|
| [NonCritical-1] | Some if-statement can be converted to a ternary  | 12 |
| [NonCritical-2] | Unnecessary struct attribute prefix  | 2 |
| [NonCritical-3] | Function calls within for loops | 1 |
| [NonCritical-4] | For loops in public or external functions should be avoided due to high gas costs and possible DOS | 1 |
| [NonCritical-5] | Use of onlyOwner functions can be lost | 3 |
| [NonCritical-6] | Constant decimal values | 1 |
| [NonCritical-7] | Calling internal _grantRole bypasses role access checks | 1 |
| [NonCritical-8] | Critical functions should have a timelock | 2 |
| [NonCritical-9] | Consider the case where `totalSupply` is zero | 4 |
| [NonCritical-10] | Use assembly to write address/contract storage values | 9 |
| [NonCritical-11] | In functions which accept an address as a parameter, there should be a zero address check to prevent bugs | 32 |
| [NonCritical-12] | Enum values should be used in place of constant array indexes | 17 |
| [NonCritical-13] | Revert statements within external and public functions can be used to perform DOS attacks | 40 |
| [NonCritical-14] | Functions which are either private or internal should have a preceding _ in their name | 37 |
| [NonCritical-15] | Private and internal state variables should have a preceding _ in their name unless they are constants | 72 |
| [NonCritical-16] | Contract lines should not be longer than 120 characters for readability | 54 |
| [NonCritical-17] | Avoid updating storage when the value hasn't changed | 3 |
| [NonCritical-18] | Not all event definitions are utilizing indexed variables. | 2 |
| [NonCritical-19] | Function names should differ to make the code more readable | 44 |
| [NonCritical-20] | Functions within contracts are not ordered according to the solidity style guide | 2 |
| [NonCritical-21] | Emits without msg.sender parameter | 8 |
| [NonCritical-22] | Interface imports should be declared first | 11 |
| [NonCritical-23] | Upgradable contract constructor should have the initialize modifier | 2 |
| [NonCritical-24] | A function which defines named returns in it's declaration doesn't need to use return | 4 |
| [NonCritical-25] | Constants should be on the left side of the comparison | 20 |
| [NonCritical-26] | Defined named returns not used within function  | 3 |
| [NonCritical-27] | Initialize functions do not emit an event | 2 |
| [NonCritical-28] | Both immutable and constant state variables should be CONSTANT_CASE | 7 |
| [NonCritical-29] | Overly complicated arithmetic | 2 |
| [NonCritical-30] | Use a single file for system wide constants | 1 |
| [NonCritical-31] | Return values of transfer()/transferFrom() not checked | 6 |
| [NonCritical-32] | Consider using modifiers for address control | 5 |
| [NonCritical-33] | Off-by-one timestamp error | 1 |
| [NonCritical-34] | Address from parameter can cause issues | 8 |
| [NonCritical-35] | Use of non-named numeric constants | 12 |
| [NonCritical-36] | Redundant else statement | 10 |
| [NonCritical-37] | Consider adding emergency-stop functionality | 4 |
| [NonCritical-38] | Overridden function has no body | 1 |
| [NonCritical-39] | Empty bytes check is missing | 2 |
| [NonCritical-40] | No equate comparison checks between to and from address parameters | 8 |
| [NonCritical-41] | Consider using uint48 for time-related variables | 1 |
| [NonCritical-42] | Return bool not explicit | 2 |
| [NonCritical-43] | Remove unnecessary solhint-disable | 3 |
| [NonCritical-44] | Consider using SMTChecker | 41 |
| [NonCritical-45] | Top level declarations should be separated by two blank lines | 42 |
| [NonCritical-46] | The function symbol() is not part of the ERC20 standard | 1 |
| [NonCritical-47] | Contracts should have full test coverage | 5 |
| [NonCritical-48] | Consider using named function calls | 27 |
| [NonCritical-49] | Using XOR (^) and AND (&) bitwise equivalents | 1 |
| [NonCritical-50] | Lack Of Brace Spacing | 95 |
| [NonCritical-51] | .call bypasses function existence check, type checking and argument packing | 3 |
| [NonCritical-52] | Using while for unbounded loops isnâ€™t recommended | 1 |
| [NonCritical-53] | Use of override is unnecessary | 7 |
| [NonCritical-54] | No access control on receive/payable fallback | 1 |
| [NonCritical-55] | If statement control structures do not comply with best practices | 1 |
| [NonCritical-56] | Cyclomatic complexity in functions | 20 |
| [NonCritical-57] | Incorrect withdraw declaration | 1 |
| [NonCritical-58] | Consider adding formal verification proofs | 5 |
| [NonCritical-59] | Consider bounding input array length | 1 |
| [NonCritical-60] | Missing events in sensitive functions | 2 |
| [NonCritical-61] | Consider disallowing transfers to "address(this)" | 1 |
| [NonCritical-62] | Add inline comments for unnamed variables in function declarations | 1 |
| [NonCritical-63] | The function name() is not part of the ERC20 standard | 1 |
| [NonCritical-64] | Don't only depend on Solidity's arithmetic ordering. | 1 |
| [NonCritical-65] | View function is not defined as such in interface | 1 |
| [NonCritical-66] | It is best practice to use linear inheritance | 4 |
| [NonCritical-67] | A event should be emitted if a non immutable state variable is set in a constructor | 1 |
| [NonCritical-68] | Create methods are suspicious of the reorg attack | 1 |
| [NonCritical-69] | Numbers downcast to addresses may result in collisions | 3 |
| [NonCritical-70] | Public variable declarations should have NatSpec descriptions | 3 |
| [NonCritical-71] | Use the Modern Upgradeable Contract Paradigm | 3 |
| [NonCritical-72] | Upgrade openzeppelin to the Latest Version - 5.0.0 | 15 |
| [NonCritical-73] | Use a struct to encapsulate multiple function parameters | 6 |
| [NonCritical-74] | Empty function body without natspec comments | 2 |
| [NonCritical-75] | Consider using ERC20Capped | 1 |
| [NonCritical-76] | Consider using a format prettier or forge fmt | 1 |
| [NonCritical-77] | Use 'using' keyword when using specific imports rather than calling the specific import directly | 173 |
| [NonCritical-78] | package.json name variable should only consist of lowercase letters and underscores | 1 |
| [NonCritical-79] | Try catch statement without human readable error | 1 |
| [NonCritical-80] | Avoid declaring variables with the names of defined functions within the project | 10 |
| [NonCritical-81] | Avoid caching global vars used once within the function | 1 |
| [NonCritical-82] | Complicated functions should have explicit comments | 18 |
| [NonCritical-83] | Consider using the Upgradeable version of the OpenZeppelin libraries/contracts | 10 |
| [NonCritical-84] | All verbatim blocks are considered identical by deduplicator and can incorrectly be unified | 1 |
| [NonCritical-85] | Constructors should emit an event | 5 |
| [NonCritical-86] | Consider using 'using-for' syntax when using libraries | 225 |
| [NonCritical-87] | Consider validating all user inputs | 87 |
| [NonCritical-88] | Constructor with array parameters has no empty array checks | 1 |
| [NonCritical-89] | Consider using AccessControlDefaultAdminRules rather than AccessControl | 1 |
| [NonCritical-90] | Consider using named returns | 28 |
| [NonCritical-91] | Errors should have parameters | 10 |
| [NonCritical-92] | Avoid using 'owner' or '_owner' as a parameter name | 4 |
| [NonCritical-93] | Catch return of decimals as uint8 | 1 |
| [NonCritical-94] | Consider migrating from Ownable to AccessControl | 3 |
| [NonCritical-95] | Avoid arithmetic directly within array indices | 2 |
| [NonCritical-96] | Function control structures do not follow the Solidity Style Guide | 23 |
| [NonCritical-97] | ERC777 tokens can introduce reentrancy risks | 8 |
# Summary for Gas findings

| Number | Details | Instances | Gas |
|----------|----------|----------|----------|
| [Gas-1] | Public functions not used internally can be marked as external to save gas | 1 | 0.0 |
| [Gas-2] | Usage of smaller uint/int types causes overhead | 15 | 12375 |
| [Gas-3] | Use != 0 instead of > 0 | 4 | 48 |
| [Gas-4] | Integer increments by one can be unchecked to save on gas fees | 5 | 3000 |
| [Gas-5] | Default int values are manually reset | 6 | 0.0 |
| [Gas-6] | Use assembly to check for the zero address | 13 | 0.0 |
| [Gas-7] | Divisions which do not divide by -X cannot overflow or underflow so such operations can be unchecked to save gas | 3 | 0.0 |
| [Gas-8] | State variables which are not modified within functions should be set as constants or immutable for values set at deployment | 56 | 0.0 |
| [Gas-9] | Divisions of powers of 2 can be replaced by a right shift operation to save gas | 2 | 0.0 |
| [Gas-10] | Structs can be packed into fewer storage slots | 15 | 562500 |
| [Gas-11] | Private functions used once can be inlined | 1 | 0.0 |
| [Gas-12] | Use bitmap to save gas | 1 | 70 |
| [Gas-13] | Use assembly to emit events | 29 | 31958 |
| [Gas-14] | Shorten the array rather than copying to a new one | 2 | 0.0 |
| [Gas-15] | Use solady library where possible to save gas | 7 | 49000 |
| [Gas-16] | Counting down in for statements is more gas efficient | 1 | 0.0 |
| [Gas-17] | Struct variables can be packed into fewer storage slots by truncating timestamp bytes | 4 | 40000 |
| [Gas-18] | Using private rather than public for constants and immutables, saves gas | 2 | 0.0 |
| [Gas-19] | Mark Functions That Revert For Normal Users As payable | 14 | 4900 |
| [Gas-20] | Function names can be optimized | 5 | 3200 |
| [Gas-21] | Lack of unchecked in loops | 1 | 240 |
| [Gas-22] | Consider not using libraries when implementing simple functionality. | 31 | 961000 |
| [Gas-23] | Using bools for storage incurs overhead | 4 | 1120 |
| [Gas-24] | Where a value is casted more than once, consider caching the result to save gas | 1 | 0.0 |
| [Gas-25] | Use assembly to validate msg.sender | 8 | 0.0 |
| [Gas-26] | Unnecessary casting as variable is already of the same type | 2 | 88 |
| [Gas-27] | Consider Using Solady's Gas Optimized Lib for Math | 1 | 0.0 |
| [Gas-28] | Using nested if to save gas | 13 | 1014 |
| [Gas-29] | Optimize Deployment Size by Fine-tuning IPFS Hash | 5 | 265000 |
| [Gas-30] | Avoid Unnecessary Public Variables | 8 | 1408000 |
| [Gas-31] | Consider splitting complex if statements into multiple steps | 11 | 0.0 |
| [Gas-32] | Caching global variables is more expensive than using the actual variable | 1 | 12 |
| [Gas-33] | Low level call can be optimized with assembly | 6 | 8928 |
| [Gas-34] | Use s.x = s.x + y instead of s.x += y for memory structs (same for -= etc) | 2 | 400 |
| [Gas-35] | Time state variables can be truncated to uint32 | 1 | 20000 |
| [Gas-36] | Constants are cheaper than Enums | 1 | 20000 |
| [Gas-37] | ++X costs slightly less gas than X++ (same with --) | 4 | 80 |
| [Gas-38] | Variables that can be set to immutable | 4 | 0.0 |
| [Gas-39] | Variable declared within iteration | 2 | 0.0 |
| [Gas-40] | Calling .length in a for loop wastes gas | 4 | 1552 |
| [Gas-41] | Internal functions only used once can be inlined to save gas | 12 | 4320 |
| [Gas-42] | Constructors can be marked as payable to save deployment gas | 5 | 0.0 |
| [Gas-43] | Merge events to save gas | 2 | 1500 |
| [Gas-44] | Use assembly scratch space to build calldata for external calls | 2 | 880 |
| [Gas-45] | Use assembly scratch space to build calldata for event emits | 16 | 56320 |
| [Gas-46] | Consider using solady's "FixedPointMathLib" | 10 | 0.0 |
| [Gas-47] | Same cast is done multiple times | 9 | 0.0 |
| [Gas-48] | Assigning to structs can be more efficient | 9 | 10530 |
| [Gas-49] | Cache address(this) when used more than once | 3 | 0.0 |
| [Gas-50] | Internal functions never used once can be removed | 2 | 0.0 |
| [Gas-51] | Empty functions should be removed to save gas | 1 | 0.0 |
| [Gas-52] | Only emit event in setter function if the state variable was changed | 2 | 0.0 |
| [Gas-53] | It is a waste of GAS to emit variable literals | 2 | 32 |
| [Gas-54] | Use OZ Array.unsafeAccess() to avoid repeated array length checks | 4 | 33600 |
| [Gas-55] | State variable read in a loop | 1 | 23176 |
| [Gas-56] | Use uint256(1)/uint256(2) instead of true/false to save gas for changes | 16 | 4352000 |
| [Gas-57] | Enable IR-based code generation | 5 | 0.0 |
| [Gas-58] | Consider pre-calculating the address of address(this) to save gas | 14 | 0.0 |
| [Gas-59] | Public functions not called internally | 1 | 0.0 |
| [Gas-60] | do-while is cheaper than for-loops when the initial check can be skipped | 1 | 700 |
| [Gas-61] | Empty blocks should be removed or emit something | 2 | 0.0 |
| [Gas-62] | Use constants instead of type(uint<n>).max | 6 | 0.0 |
## [Low-1] Avoid making withdraw/unstake functions Pausable 

### Resolution 
Making withdraw or unstake functions pausable can create a risk by potentially locking users' funds indefinitely, especially in scenarios where the contract is paused for a prolonged period. This design could undermine trust and may not align with the decentralization principles of blockchain. It's advisable to design these functions with user security and accessibility in mind, ensuring that pausing capabilities are used judiciously and transparently, with clear conditions for resuming normal operations.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[140](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L140-L140)']
```solidity
140:     function withdraw(WithdrawParams calldata params) external override(ISize) whenNotPaused  // <= FOUND

```


</details>

## [Low-2] Contracts deployed by factory can have their initialisation front run

### Resolution 
The contract being deployed here is upgradeable and thus needs to be initialised. However in this factory function which deploys the contract the initializer is not called and thus initialisation can be triggered by a third party contract.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[217](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L217-L239)']
```solidity
217:     function executeInitializeData(State storage state, InitializeDataParams memory d) internal {
218:         state.data.nextDebtPositionId = DEBT_POSITION_ID_START;
219:         state.data.nextCreditPositionId = CREDIT_POSITION_ID_START;
220: 
221:         state.data.underlyingCollateralToken = IERC20Metadata(d.underlyingCollateralToken);
222:         state.data.underlyingBorrowToken = IERC20Metadata(d.underlyingBorrowToken);
223:         state.data.variablePool = IPool(d.variablePool);
224: 
225:         state.data.collateralToken = new NonTransferrableToken(
226:             address(this),
227:             string.concat("Size Fixed ", IERC20Metadata(state.data.underlyingCollateralToken).name()),
228:             string.concat("sz", IERC20Metadata(state.data.underlyingCollateralToken).symbol()),
229:             IERC20Metadata(state.data.underlyingCollateralToken).decimals()
230:         );
231:         state.data.borrowAToken =
232:             IAToken(state.data.variablePool.getReserveData(address(state.data.underlyingBorrowToken)).aTokenAddress);
233:         state.data.collateralAToken =
234:             IAToken(state.data.variablePool.getReserveData(address(state.data.underlyingCollateralToken)).aTokenAddress);
235:         state.data.debtToken = new NonTransferrableToken(
236:             address(this), "Size Fixed Debt", "szDebt", IERC20Metadata(state.data.underlyingBorrowToken).decimals()
237:         );
238: 
239:         state.data.vaultImplementation = new Vault(); // <= FOUND
240:     }

```


</details>

## [Low-3] Token burning is centralized

### Resolution 
Centralized ERC20 token burning, where only a select few addresses have control over the burn function, can be viewed negatively. It introduces risks of manipulation, as the power to alter token supply is concentrated in the hands of a small group, potentially affecting token value unfairly. Such centralization can also introduce risks if the admin account(s) is compromised. Consider implementing a timelock feature so users can decide to opt out of the protocol if they do not agree with actions taken.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L27-L27)']
```solidity
27:     function burn(address from, uint256 amount) external virtual onlyOwner { // <= FOUND
28:         _burn(from, amount);
29:     }

```


</details>

## [Low-4] Token minting is centralized

### Resolution 
Centralized ERC20 token minting, where only a select few addresses have control over the mint function, can be viewed negatively. It introduces risks of manipulation, as the power to alter token supply is concentrated in the hands of a small group, potentially affecting token value unfairly. Such centralization can also introduce risks if the admin account(s) is compromised. Consider implementing a timelock feature so users can decide to opt out of the protocol if they do not agree with actions taken.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L23-L23)']
```solidity
23:     function mint(address to, uint256 amount) external virtual onlyOwner { // <= FOUND
24:         _mint(to, amount);
25:     }

```


</details>

## [Low-5] Empty receive functions can cause gas issues

### Resolution 
In Solidity, functions that receive Ether without corresponding functionality to utilize or withdraw these funds can inadvertently lead to a permanent loss of value. This is because if someone sends Ether to the contract, they may be unable to retrieve it. To avoid this, functions receiving Ether should be accompanied by additional methods that process or allow the withdrawal of these funds. If the intent is to use the received Ether, it should trigger a separate function; if not, it should revert the transaction (for instance, via `require(msg.sender == address(weth))`). Access control checks can also prevent unintended Ether transfers, despite the slight gas cost they entail. If concerns over gas costs persist, at minimum, include a rescue function to recover unused Ether. Missteps in handling Ether in smart contracts can lead to irreversible financial losses, hence these precautions are crucial.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[67](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L67-L67)']
```solidity
67:     receive() external payable {}

```


</details>

## [Low-6] Ownable2Step should be used in place of Ownable

### Resolution 
Ownable2Step further prevents risks posed by centralised privileges as there is a smaller likelihood of the owner being wrongfully changed

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20  // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable  // <= FOUND

```


</details>

## [Low-7] Upgradable contracts should have a __gap variable

### Resolution 
This is to ensure the team can add new state variables without compromising compatability.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L56-L56)']
```solidity
56: contract Size is
57:     ISize,
58:     SizeView,
59:     Initializable,
60:     AccessControlUpgradeable,
61:     PausableUpgradeable,
62:     MulticallUpgradeable,
63:     UUPSUpgradeable
64: 

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable 

```


</details>

## [Low-8] Contracts are vulnerable to fee-on-transfer accounting-related issues

### Resolution 
The below-listed functions use `transferFrom()` to move funds from the sender to the recipient but fail to verify if the received token amount matches the transferred amount. This could pose an issue with fee-on-transfer tokens, where the post-transfer balance might be less than anticipated, leading to balance inconsistencies. There might be subsequent checks for a second transfer, but an attacker might exploit leftover funds (such as those accidentally sent by another user) to gain unjustified credit. A practical solution is to gauge the balance prior and post-transfer, and consider the differential as the transferred amount, instead of the predefined amount.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L48-L64)']
```solidity
48:     function chargeRepayFeeInCollateral(
49:         State storage state,
50:         DebtPosition storage debtPosition,
51:         uint256 repayAmount,
52:         bool isEarlyRepay
53:     ) public returns (uint256 repayFee) {
54:         repayFee = Math.mulDivDown(debtPosition.repayFee, repayAmount, debtPosition.faceValue);
55:         uint256 repayFeeCollateral;
56: 
57:         if (isEarlyRepay) {
58:             uint256 earlyRepayFee = debtPosition.earlyRepayFee();
59:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, earlyRepayFee);
60:         } else {
61:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, repayFee);
62:         }
63: 
64:         state.data.collateralToken.transferFrom(debtPosition.borrower, state.feeConfig.feeRecipient, repayFeeCollateral); // <= FOUND
65: 
66:         state.data.debtToken.burn(debtPosition.borrower, repayFee);
67:     }

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L15-L17)']
```solidity
15:     function depositUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) external {
16:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
17:         underlyingCollateralToken.transferFrom(from, address(this), amount); // <= FOUND
18:         state.data.collateralToken.mint(to, amount);
19:     }

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L62-L95)']
```solidity
62:     function _executeLiquidateTakeCollateral(
63:         State storage state,
64:         DebtPosition memory debtPositionCopy,
65:         bool splitCollateralRemainder
66:     ) private returns (uint256 liquidatorProfitCollateralToken) {
67:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
68:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPositionCopy.faceValue);
69: 
70:         
71:         if (assignedCollateral > debtInCollateralToken) {
72:             liquidatorProfitCollateralToken = debtInCollateralToken;
73: 
74:             if (splitCollateralRemainder) {
75:                 
76:                 uint256 collateralRemainder = assignedCollateral - debtInCollateralToken;
77: 
78:                 uint256 collateralRemainderToLiquidator =
79:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitLiquidatorPercent, PERCENT);
80:                 uint256 collateralRemainderToProtocol =
81:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitProtocolPercent, PERCENT);
82: 
83:                 liquidatorProfitCollateralToken += collateralRemainderToLiquidator;
84:                 state.data.collateralToken.transferFrom( // <= FOUND
85:                     debtPositionCopy.borrower, state.feeConfig.feeRecipient, collateralRemainderToProtocol
86:                 );
87:             }
88:             
89:         } else {
90:             
91:             liquidatorProfitCollateralToken = assignedCollateral;
92:         }
93: 
94:         state.transferBorrowATokenFixed(msg.sender, address(this), debtPositionCopy.faceValue);
95:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken); // <= FOUND
96:     }

```
['[262](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L262-L270)']
```solidity
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken)
265:     {
266:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
267: 
268:         
269:         liquidatorProfitCollateralToken = state.feeConfig.collateralOverdueTransferFee;
270:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken); // <= FOUND
271: 
272:         address from = debtPositionCopy.borrower;
273:         address to = address(this);
274:         uint256 collateralBalance = assignedCollateral - liquidatorProfitCollateralToken;
275:         uint256 borrowATokenBalance = debtPositionCopy.faceValue;
276: 
277:         
278:         Vault vaultFrom = state.getVaultVariable(from);
279:         Vault vaultTo = state.getVaultFixed(to);
280: 
281:         
282:         state.withdrawUnderlyingCollateralToken(from, address(this), collateralBalance);
283: 
284:         
285:         state.data.underlyingCollateralToken.forceApprove(address(state.data.variablePool), collateralBalance);
286:         state.data.variablePool.supply(
287:             address(state.data.underlyingCollateralToken), collateralBalance, address(vaultFrom), 0
288:         );
289: 
290:         address[] memory targets = new address[](3);
291:         bytes[] memory data = new bytes[](3);
292: 
293:         
294:         targets[0] = address(state.data.variablePool);
295:         data[0] =
296:             abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(state.data.underlyingCollateralToken), true));
297: 
298:         
299:         targets[1] = address(state.data.variablePool);
300:         data[1] = abi.encodeCall(
301:             IPool.borrow,
302:             (
303:                 address(state.data.underlyingBorrowToken),
304:                 borrowATokenBalance,
305:                 uint256(DataTypes.InterestRateMode.VARIABLE),
306:                 0,
307:                 address(vaultFrom)
308:             )
309:         );
310: 
311:         

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L44-L53)']
```solidity
44:     function depositUnderlyingTokenToVariablePool(
45:         State storage state,
46:         IERC20Metadata underlyingToken,
47:         address from,
48:         address to,
49:         uint256 amount,
50:         bool variable,
51:         bool setUseReserveAsCollateral
52:     ) external {
53:         underlyingToken.safeTransferFrom(from, address(this), amount); // <= FOUND
54: 
55:         Vault vaultTo = variable ? state.getVaultVariable(to) : state.getVaultFixed(to);
56: 
57:         underlyingToken.forceApprove(address(state.data.variablePool), amount);
58:         state.data.variablePool.supply(address(underlyingToken), amount, address(vaultTo), 0);
59: 
60:         
61:         if (setUseReserveAsCollateral) {
62:             
63:             vaultTo.proxy(
64:                 address(state.data.variablePool),
65:                 abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(underlyingToken), true))
66:             );
67:         }
68:     }

```


</details>

## [Low-9] Initializer function can be front run

### Resolution 
In Solidity contract deployment, not making the initialize() function call atomic with the contract creation can leave a vulnerability window. A malicious actor could exploit this time gap and call initialize() before the intended initialization. This action could disrupt the contract's setup, potentially necessitating a full contract re-deployment to ensure proper initialization. To mitigate such risks, it's advised to use a factory contract. This factory contract can be programmed to deploy and initialize a new contract in a single atomic transaction, closing the window of vulnerability and ensuring correct and secure contract initialization.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L101-L101)']
```solidity
95:     function initialize(
96:         address owner,
97:         InitializeFeeConfigParams calldata f,
98:         InitializeRiskConfigParams calldata r,
99:         InitializeOracleParams calldata o,
100:         InitializeDataParams calldata d
101:     ) external initializer  // <= FOUND

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L20-L20)']
```solidity
20:     function initialize(address owner) external initializer  // <= FOUND

```


</details>

## [Low-10] The function decimals() is not part of the ERC20 standard

### Resolution 
The `decimals()` function in an ERC20 token contract is used to specify how many decimal places the token can be divided into. However, it should be used with caution because not all ERC20 token contracts implement `decimals()`, and the function isn't required by the ERC20 standard. Calling `decimals()` on a contract that doesn't implement it will result in a runtime error. Moreover, even when implemented, the returned value can be manipulated or artificially set, which may cause unexpected behavior. Therefore, always verify the decimal count independently if precision is crucial for your contract logic. When interacting with other ERC20 tokens, consider implementing safeguards or checks to handle potential errors from calling `decimals()`.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[225](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L225-L229)']
```solidity
225:         state.data.collateralToken = new NonTransferrableToken(
226:             address(this),
227:             string.concat("Size Fixed ", IERC20Metadata(state.data.underlyingCollateralToken).name()), // <= FOUND
228:             string.concat("sz", IERC20Metadata(state.data.underlyingCollateralToken).symbol()), // <= FOUND
229:             IERC20Metadata(state.data.underlyingCollateralToken).decimals() // <= FOUND
230:         );

```
['[235](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L235-L236)']
```solidity
235:         state.data.debtToken = new NonTransferrableToken(
236:             address(this), "Size Fixed Debt", "szDebt", IERC20Metadata(state.data.underlyingBorrowToken).decimals() // <= FOUND
237:         );

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L33-L34)']
```solidity
33:         uint256 debtTokenAmountWad =
34:             ConversionLibrary.amountToWad(debtTokenAmount, state.data.underlyingBorrowToken.decimals()); // <= FOUND

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L35-L36)']
```solidity
35:         collateralTokenAmount = Math.mulDivUp(
36:             debtTokenAmountWad, 10 ** state.oracle.priceFeed.decimals(), state.oracle.priceFeed.getPrice() // <= FOUND
37:         );

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L33-L33)']
```solidity
33:         uint256 debtWad = ConversionLibrary.amountToWad(debt, state.data.underlyingBorrowToken.decimals()); // <= FOUND

```


</details>

## [Low-11] Loss of precision

### Resolution 
Dividing by large numbers in Solidity can cause a loss of precision due to the language's inherent integer division behavior. Solidity does not support floating-point arithmetic, and as a result, division between integers yields an integer result, truncating any fractional part. When dividing by a large number, the resulting value may become significantly smaller, leading to a loss of precision, as the fractional part is discarded.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L65-L69)']
```solidity
65:     function _scalePrice(uint256 _price, uint8 _priceDecimals, uint8 _decimals) internal pure returns (uint256) { // <= FOUND
66:         if (_priceDecimals < _decimals) {
67:             return _price * (10 ** uint256(_decimals - _priceDecimals));
68:         } else if (_priceDecimals > _decimals) {
69:             return _price / (10 ** uint256(_priceDecimals - _decimals)); // <= FOUND
70:         } else {
71:             return _price;
72:         }
73:     }

```


</details>

## [Low-12] Missing zero address check in constructor

### Resolution 
In Solidity, constructors often take address parameters to initialize important components of a contract, such as owner or linked contracts. However, without a check, there's a risk that an address parameter could be mistakenly set to the zero address (0x0). This could occur due to a mistake or oversight during contract deployment. A zero address in a crucial role can cause serious issues, as it cannot perform actions like a normal address, and any funds sent to it are irretrievable. Therefore, it's crucial to include a zero address check in constructors to prevent such potential problems. If a zero address is detected, the constructor should revert the transaction.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L20-L20)']
```solidity
20:     constructor(address _owner, uint64 _staleRateInterval) Ownable(_owner) { // <= FOUND
21:         if (_staleRateInterval == 0) {
22:             revert Errors.NULL_STALE_RATE();
23:         }
24: 
25:         staleRateInterval = _staleRateInterval;
26:     }

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L16-L16)']
```solidity
16:     constructor(address owner_, string memory name_, string memory symbol_, uint8 decimals_) // <= FOUND
17:         Ownable(owner_)
18:         ERC20(name_, symbol_)
19:     {
20:         _decimals = decimals_;
21:     }

```


</details>

## [Low-13] External call recipient may consume all transaction gas

### Resolution 
When making external calls, the called contract can intentionally or unintentionally consume all provided gas, leading to unintended transaction reversion. To mitigate this risk, it's crucial to specify a gas limit when making the call. By using `addr.call{gas: <amount>}("")`, you allocate a specific amount of gas to the external call, ensuring the parent transaction has gas left for post-call operations. This approach safeguards against malevolent contracts aiming to exhaust gas and provides greater control over transaction execution.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L42-L42)']
```solidity
42:         (success, returnData) = address(target).call{value: value}(data); // <= FOUND

```


</details>

## [Low-14] Missing zero address check in initializer

### Resolution 
Initializer functions in contracts often set important parameters or addresses. Failing to check for the zero address (0x0000000000000000000000000000000000000000) in initializers can lead to unintended behavior, as this address typically signifies an unset or default value. Transfers to or interactions with the zero address can result in permanent loss of assets or broken functionality. It's crucial to add checks using `require(targetAddress != address(0), "Address cannot be zero")` in initializers to prevent accidentally setting important state variables or parameters to this address, ensuring the system's integrity and user asset safety.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L95-L95)']
```solidity
95:     function initialize(
96:         address owner,
97:         InitializeFeeConfigParams calldata f,
98:         InitializeRiskConfigParams calldata r,
99:         InitializeOracleParams calldata o,
100:         InitializeDataParams calldata d
101:     ) external initializer {
102:         state.validateInitialize(owner, f, r, o, d);
103: 
104:         __AccessControl_init();
105:         __Pausable_init();
106:         __Multicall_init();
107:         __UUPSUpgradeable_init();
108: 
109:         state.executeInitialize(f, r, o, d);
110:         _grantRole(DEFAULT_ADMIN_ROLE, owner);
111:         _grantRole(PAUSER_ROLE, owner);
112:         _grantRole(KEEPER_ROLE, owner);
113:     }

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L20-L20)']
```solidity
20:     function initialize(address owner) external initializer {
21:         __Ownable_init(owner);
22:     }

```


</details>

## [Low-15] Consider implementing two-step procedure for updating protocol addresses

### Resolution 
Implementing a two-step procedure for updating protocol addresses adds an extra layer of security. In such a system, the first step initiates the change, and the second step, after a predefined delay, confirms and finalizes it. This delay allows stakeholders or monitoring tools to observe and react to unintended or malicious changes. If an unauthorized change is detected, corrective actions can be taken before the change is finalized. To achieve this, introduce a "proposed address" state variable and a "delay period". Upon an update request, set the "proposed address". After the delay, if not contested, the main protocol address can be updated.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L28-L28)']
```solidity
28:     function setStaleRateInterval(uint64 _staleRateInterval) external onlyOwner  // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L34-L34)']
```solidity
34:     function setMarketBorrowRate(uint128 _marketBorrowRate) external onlyOwner  // <= FOUND

```
['[118](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L118-L118)']
```solidity
118:     function updateConfig(UpdateConfigParams calldata params) external onlyRole(DEFAULT_ADMIN_ROLE)  // <= FOUND

```


</details>

## [Low-16] Missing contract-existence checks before low-level calls

### Resolution 
Low-level calls in Solidity, when made to addresses without contract code, don't fail but return a successful status. This behavior can be misleading, leading to unintended consequences in dApps. Ignoring this can potentially mean acting on false positive results. To address this, apart from the conventional zero-address check, developers should verify the existence of contract code at the target address by ensuring that the code length at the specified address (`<address>.code.length`) is greater than zero. By doing so, it provides a more robust validation before executing low-level calls, safeguarding against unintentional interactions with empty addresses.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L24-L29)']
```solidity
24:     function proxy(address target, bytes memory data) public onlyOwner returns (bytes memory returnData) {
25:         if (target == address(0)) {
26:             revert Errors.NULL_ADDRESS();
27:         }
28:         bool success;
29:         (success, returnData) = address(target).call(data); // <= FOUND
30:         Address.verifyCallResult(success, returnData);
31:     }

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L46-L62)']
```solidity
46:     function proxy(address[] memory targets, bytes[] memory datas)
47:         public
48:         onlyOwner
49:         returns (bytes[] memory returnDatas)
50:     {
51:         if (targets.length != datas.length) {
52:             revert Errors.ARRAY_LENGTHS_MISMATCH();
53:         }
54: 
55:         returnDatas = new bytes[](datas.length);
56:         bool success;
57:         for (uint256 i = 0; i < targets.length; i++) {
58:             if (targets[i] == address(0)) {
59:                 revert Errors.NULL_ADDRESS();
60:             }
61:             
62:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]); // <= FOUND
63:             Address.verifyCallResult(success, returnDatas[i]);
64:         }
65:     }

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L33-L42)']
```solidity
33:     function proxy(address target, bytes memory data, uint256 value)
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData)
37:     {
38:         if (target == address(0)) {
39:             revert Errors.NULL_ADDRESS();
40:         }
41:         bool success;
42:         (success, returnData) = address(target).call{value: value}(data); // <= FOUND
43:         Address.verifyCallResult(success, returnData);
44:     }

```


</details>

## [Low-17] No license selected for project

### Resolution 
Not selecting a license for a software project, particularly in the context of blockchain and smart contracts, poses significant risks and uncertainties. A license explicitly defines how others can use, modify, distribute, and contribute to your code. Without it, the legal status of a project remains unclear, potentially deterring usage and contributions, and raising concerns about intellectual property rights. To mitigate these risks, it is advisable to choose an appropriate open-source license. This fosters a clear understanding of how your project can be utilized and encourages collaboration and adoption within the community, aligning with the open and collaborative nature of blockchain technology.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED // <= FOUND

```


</details>

## [Low-18] State variables not capped at reasonable values

### Resolution 
Setting boundaries on state variables in smart contracts is essential for maintaining system integrity and user protection. Without caps on values, variables could reach extremes that exploit or disrupt contract functionality, leading to potential loss or unintended consequences for users. Implementing checks for minimum and maximum permissible values can prevent such issues, ensuring variables remain within a safe and reasonable range. This practice guards against attacks aimed at destabilizing the contract, such as griefing, where attackers intentionally cause distress by exploiting vulnerabilities. Proper validation promotes contract reliability, user trust, and a healthier ecosystem by mitigating risks associated with unbounded state changes.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L36-L36)']
```solidity
34:     function setMarketBorrowRate(uint128 _marketBorrowRate) external onlyOwner {
35:         uint128 oldMarketBorrowRate = marketBorrowRate;
36:         marketBorrowRate = _marketBorrowRate; // <= FOUND
37:         marketBorrowRateUpdatedAt = uint64(block.timestamp);
38:         emit MarketBorrowRateUpdated(oldMarketBorrowRate, _marketBorrowRate);
39:     }

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L30-L30)']
```solidity
28:     function setStaleRateInterval(uint64 _staleRateInterval) external onlyOwner {
29:         uint64 oldStaleRateInterval = staleRateInterval;
30:         staleRateInterval = _staleRateInterval; // <= FOUND
31:         emit StaleRateIntervalUpdated(oldStaleRateInterval, _staleRateInterval);
32:     }

```


</details>

## [Low-19] Pure function accesses storage

### Resolution 
Pure functions by definition should not read or write to storage (state variables), however due to a bug with storage pointers this can slip past the compiler and thus a pure function can at times read storage whilst being declared as pure. Below are such instances

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L26-L45)']
```solidity
26:     function validateYieldCurve(YieldCurve memory self, uint256 minimumMaturity) internal pure { // <= FOUND
27:         if (self.maturities.length == 0 || self.aprs.length == 0 || self.marketRateMultipliers.length == 0) {
28:             revert Errors.NULL_ARRAY();
29:         }
30:         if (self.maturities.length != self.aprs.length || self.maturities.length != self.marketRateMultipliers.length) {
31:             revert Errors.ARRAY_LENGTHS_MISMATCH();
32:         }
33: 
34:         
35:         
36: 
37:         
38:         uint256 lastMaturity = type(uint256).max;
39:         for (uint256 i = self.maturities.length; i > 0; i--) {
40:             if (self.maturities[i - 1] > lastMaturity) {
41:                 revert Errors.MATURITIES_NOT_STRICTLY_INCREASING();
42:             }
43:             lastMaturity = self.maturities[i - 1];
44:         }
45:         if (self.maturities[0] < minimumMaturity) { // <= FOUND
46:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(self.maturities[0], minimumMaturity);
47:         }
48: 
49:         
50:         
51:     }

```


</details>

## [Low-20] Unsafe use of transfer()/transferFrom() with IERC20

### Resolution 
SafeTransfer should be used in place of Transfer for Solidity contracts to ensure robust security and error handling. Unlike the basic Transfer function, SafeTransfer incorporates safeguards against potential smart contract vulnerabilities, such as reentrancy attacks and unexpected token loss. By automatically validating the recipient's ability to receive tokens and reverting transactions in case of failures, 

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L48-L64)']
```solidity
48:     function chargeRepayFeeInCollateral(
49:         State storage state,
50:         DebtPosition storage debtPosition,
51:         uint256 repayAmount,
52:         bool isEarlyRepay
53:     ) public returns (uint256 repayFee) {
54:         repayFee = Math.mulDivDown(debtPosition.repayFee, repayAmount, debtPosition.faceValue);
55:         uint256 repayFeeCollateral;
56: 
57:         if (isEarlyRepay) {
58:             uint256 earlyRepayFee = debtPosition.earlyRepayFee();
59:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, earlyRepayFee);
60:         } else {
61:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, repayFee);
62:         }
63: 
64:         state.data.collateralToken.transferFrom(debtPosition.borrower, state.feeConfig.feeRecipient, repayFeeCollateral); // <= FOUND
65: 
66:         state.data.debtToken.burn(debtPosition.borrower, repayFee);
67:     }

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L15-L17)']
```solidity
15:     function depositUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) external { // <= FOUND
16:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
17:         underlyingCollateralToken.transferFrom(from, address(this), amount); // <= FOUND
18:         state.data.collateralToken.mint(to, amount);
19:     }

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L62-L95)']
```solidity
62:     function _executeLiquidateTakeCollateral(
63:         State storage state,
64:         DebtPosition memory debtPositionCopy,
65:         bool splitCollateralRemainder
66:     ) private returns (uint256 liquidatorProfitCollateralToken) {
67:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
68:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPositionCopy.faceValue);
69: 
70:         
71:         if (assignedCollateral > debtInCollateralToken) {
72:             liquidatorProfitCollateralToken = debtInCollateralToken;
73: 
74:             if (splitCollateralRemainder) {
75:                 
76:                 uint256 collateralRemainder = assignedCollateral - debtInCollateralToken;
77: 
78:                 uint256 collateralRemainderToLiquidator =
79:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitLiquidatorPercent, PERCENT);
80:                 uint256 collateralRemainderToProtocol =
81:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitProtocolPercent, PERCENT);
82: 
83:                 liquidatorProfitCollateralToken += collateralRemainderToLiquidator;
84:                 state.data.collateralToken.transferFrom( // <= FOUND
85:                     debtPositionCopy.borrower, state.feeConfig.feeRecipient, collateralRemainderToProtocol
86:                 );
87:             }
88:             
89:         } else {
90:             
91:             liquidatorProfitCollateralToken = assignedCollateral;
92:         }
93: 
94:         state.transferBorrowATokenFixed(msg.sender, address(this), debtPositionCopy.faceValue);
95:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken); // <= FOUND
96:     }

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L98-L112)']
```solidity
98:     function _executeLiquidateOverdue(
99:         State storage state,
100:         LiquidateParams calldata params,
101:         DebtPosition memory debtPositionCopy
102:     ) private returns (uint256 liquidatorProfitCollateralToken) {
103:         
104:         try state.moveDebtPositionToVariablePool(debtPositionCopy) returns (uint256 _liquidatorProfitCollateralToken) {
105:             emit Events.LiquidateOverdueMoveToVariablePool(params.debtPositionId);
106:             liquidatorProfitCollateralToken = _liquidatorProfitCollateralToken;
107:             
108:         } catch {
109:             emit Events.LiquidateOverdueNoSplitRemainder(params.debtPositionId);
110:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, false)
111:                 + state.feeConfig.collateralOverdueTransferFee;
112:             state.data.collateralToken.transferFrom( // <= FOUND
113:                 debtPositionCopy.borrower, msg.sender, state.feeConfig.collateralOverdueTransferFee
114:             );
115:         }
116:     }

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L52-L65)']
```solidity
52:     function executeSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external { // <= FOUND
53:         emit Events.SelfLiquidate(params.creditPositionId);
54: 
55:         CreditPosition storage creditPosition = state.data.creditPositions[params.creditPositionId];
56:         DebtPosition storage debtPosition = state.getDebtPositionByCreditPositionId(params.creditPositionId);
57: 
58:         uint256 credit = creditPosition.credit;
59:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, credit);
60:         uint256 assignedCollateral = state.getCreditPositionProRataAssignedCollateral(creditPosition);
61:         debtPosition.updateRepayFee(credit, repayFee);
62:         creditPosition.credit = 0;
63: 
64:         state.data.debtToken.burn(debtPosition.borrower, credit);
65:         state.data.collateralToken.transferFrom(debtPosition.borrower, msg.sender, assignedCollateral); // <= FOUND
66:     }

```
['[262](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L262-L270)']
```solidity
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken)
265:     {
266:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
267: 
268:         
269:         liquidatorProfitCollateralToken = state.feeConfig.collateralOverdueTransferFee;
270:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken); // <= FOUND
271: 
272:         address from = debtPositionCopy.borrower;
273:         address to = address(this);
274:         uint256 collateralBalance = assignedCollateral - liquidatorProfitCollateralToken;
275:         uint256 borrowATokenBalance = debtPositionCopy.faceValue;
276: 
277:         
278:         Vault vaultFrom = state.getVaultVariable(from);
279:         Vault vaultTo = state.getVaultFixed(to);
280: 
281:         
282:         state.withdrawUnderlyingCollateralToken(from, address(this), collateralBalance);
283: 
284:         
285:         state.data.underlyingCollateralToken.forceApprove(address(state.data.variablePool), collateralBalance);
286:         state.data.variablePool.supply(
287:             address(state.data.underlyingCollateralToken), collateralBalance, address(vaultFrom), 0
288:         );
289: 
290:         address[] memory targets = new address[](3);
291:         bytes[] memory data = new bytes[](3);
292: 
293:         
294:         targets[0] = address(state.data.variablePool);
295:         data[0] =
296:             abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(state.data.underlyingCollateralToken), true));
297: 
298:         
299:         targets[1] = address(state.data.variablePool);
300:         data[1] = abi.encodeCall(
301:             IPool.borrow,
302:             (
303:                 address(state.data.underlyingBorrowToken),
304:                 borrowATokenBalance,
305:                 uint256(DataTypes.InterestRateMode.VARIABLE),
306:                 0,
307:                 address(vaultFrom)
308:             )
309:         );
310: 
311:         
312:         targets[2] = address(state.data.underlyingBorrowToken);
313:         data[2] = abi.encodeCall(IERC20.transfer, (address(this), borrowATokenBalance));
314: 
315:         
316:         vaultFrom.proxy(targets, data);
317: 
318:         
319:         state.data.underlyingBorrowToken.forceApprove(address(state.data.variablePool), borrowATokenBalance);

```


</details>

## [Low-21] Functions calling contracts/addresses with transfer hooks are missing reentrancy guards

### Resolution 
While adherence to the check-effects-interaction pattern is commendable, the absence of a reentrancy guard in functions, especially where transfer hooks might be present, can expose the protocol users to risks of read-only reentrancies. Such reentrancy vulnerabilities can be exploited to execute malicious actions even without altering the contract state. Without a reentrancy guard, the only potential mitigation would be to blocklist the entire protocol - an extreme and disruptive measure. Therefore, incorporating a reentrancy guard into these functions is vital to bolster security, as it helps protect against both traditional reentrancy attacks and read-only reentrancies, ensuring robust and safe protocol operations.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L21-L26)']
```solidity
21:     function withdrawUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount)
22:         external
23:     {
24:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
25:         state.data.collateralToken.burn(from, amount); // <= FOUND
26:         underlyingCollateralToken.safeTransfer(to, amount); // <= FOUND
27:     }

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L21-L26)']
```solidity
21:     function withdrawUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount)
22:         external
23:     {
24:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
25:         state.data.collateralToken.burn(from, amount);
26:         underlyingCollateralToken.safeTransfer(to, amount); // <= FOUND
27:     }

```


</details>

## [NonCritical-1] Some if-statement can be converted to a ternary 

### Resolution 
Improving code readability and compactness is an integral part of optimal programming practices. The use of ternary operators in place of if-else conditions is one such measure. Ternary operators allow us to write conditional statements in a more concise manner, thereby enhancing readability and simplicity. They follow the syntax `condition ? exprIfTrue : exprIfFalse`, which interprets as "if the condition is true, evaluate to `exprIfTrue`, else evaluate to `exprIfFalse`". By adopting this approach, we make our code more streamlined and intuitive, which could potentially aid in better understanding and maintenance of the codebase.

Num of instances: 12

### Findings 


<details><summary>Click to show findings</summary>

['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L57-L58)']
```solidity
57:         if (params.exactAmountIn) {
58:             amountIn = params.amount; // <= FOUND
59:         }

```
['[97](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L97-L98)']
```solidity
97:         if (params.exactAmountIn) {
98:             issuanceValue = params.amount; // <= FOUND
99:         }

```
['[77](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L77-L78)']
```solidity
77:        if (params.key == "crOpening") {
78:             state.riskConfig.crOpening = params.value; // <= FOUND
79:         }

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L49-L50)']
```solidity
49:         if (loanOffer.isNull()) { // <= FOUND
50:             revert Errors.INVALID_LOAN_OFFER(params.lender); // <= FOUND
51:         }

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L40-L41)']
```solidity
40:         if (params.amount == 0) { // <= FOUND
41:             revert Errors.NULL_AMOUNT(); // <= FOUND
42:         }

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L40-L41)']
```solidity
40:         if (params.amount == 0) { // <= FOUND
41:             revert Errors.NULL_AMOUNT(); // <= FOUND
42:         }

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L40-L41)']
```solidity
40:         if (params.amount == 0) { // <= FOUND
41:             revert Errors.NULL_AMOUNT(); // <= FOUND
42:         }

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L49-L50)']
```solidity
49:         if (params.dueDate < block.timestamp) { // <= FOUND
50:             revert Errors.PAST_DUE_DATE(params.dueDate); // <= FOUND
51:         }

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L49-L50)']
```solidity
49:         if (params.dueDate < block.timestamp) { // <= FOUND
50:             revert Errors.PAST_DUE_DATE(params.dueDate); // <= FOUND
51:         }

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L62-L63)']
```solidity
62:         if (params.dueDate > loanOffer.maxDueDate) { // <= FOUND
63:             revert Errors.DUE_DATE_GREATER_THAN_MAX_DUE_DATE(params.dueDate, loanOffer.maxDueDate); // <= FOUND
64:         }

```
['[73](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L73-L74)']
```solidity
73:         if (params.deadline < block.timestamp) { // <= FOUND
74:             revert Errors.PAST_DEADLINE(params.deadline); // <= FOUND
75:         }

```
['[73](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L73-L74)']
```solidity
73:         if (params.deadline < block.timestamp) { // <= FOUND
74:             revert Errors.PAST_DEADLINE(params.deadline); // <= FOUND
75:         }

```


</details>

## [NonCritical-2] Unnecessary struct attribute prefix 

### Resolution 
In struct definitions, using redundant prefixes for attributes is unnecessary. For instance, in a struct named Employee, attributes like employeeName, employeeID, and employeeEmail can be simplified to name, ID, and email respectively, since they are already inherently associated with Employee. By removing these repetitive prefixes, the code becomes more concise and easier to read, maintaining its contextual clarity.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L20-L22)']
```solidity
20: struct BorrowerExitParams {
21:     uint256 debtPositionId;
22:     address borrowerToExitTo; // <= FOUND
23:     uint256 deadline;
24:     uint256 minAPR;
25: }

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L17-L22)']
```solidity
17: struct FeeConfig {
18:     uint256 repayFeeAPR; 
19:     uint256 earlyLenderExitFee; 
20:     uint256 earlyBorrowerExitFee; 
21:     uint256 collateralOverdueTransferFee; 
22:     address feeRecipient;  // <= FOUND
23: }

```


</details>

## [NonCritical-3] Function calls within for loops

### Resolution 
Making function calls or external calls within loops in Solidity can lead to inefficient gas usage, potential bottlenecks, and increased vulnerability to attacks. Each function call or external call consumes gas, and when executed within a loop, the gas cost multiplies, potentially causing the transaction to run out of gas or exceed block gas limits. This can result in transaction failure or unpredictable behavior.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L128-L149)']
```solidity
128:        for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) {
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) {
135:                 deltaAmountIn = creditPosition.credit;
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity);
137:             }
138: 
139:             
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) {
141:                 continue;
142:             }
143:             
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             
149:             state.createCreditPosition({ // <= FOUND
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee
157:             );
158:             amountOutLeft -= deltaAmountOut;
159:         }

```


</details>

## [NonCritical-4] For loops in public or external functions should be avoided due to high gas costs and possible DOS

### Resolution 
In Solidity, for loops can potentially cause Denial of Service (DoS) attacks if not handled carefully. DoS attacks can occur when an attacker intentionally exploits the gas cost of a function, causing it to run out of gas or making it too expensive for other users to call. Below are some scenarios where for loops can lead to DoS attacks: Nested for loops can become exceptionally gas expensive and should be used sparingly

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L57-L57)']
```solidity
46:     function proxy(address[] memory targets, bytes[] memory datas)
47:         public
48:         onlyOwner
49:         returns (bytes[] memory returnDatas)
50:     {
51:         if (targets.length != datas.length) {
52:             revert Errors.ARRAY_LENGTHS_MISMATCH();
53:         }
54: 
55:         returnDatas = new bytes[](datas.length);
56:         bool success;
57:         for (uint256 i = 0; i < targets.length; i++) { // <= FOUND
58:             if (targets[i] == address(0)) {
59:                 revert Errors.NULL_ADDRESS();
60:             }
61:             
62:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]);
63:             Address.verifyCallResult(success, returnDatas[i]);
64:         }
65:     }

```


</details>

## [NonCritical-5] Use of onlyOwner functions can be lost

### Resolution 
In Solidity, renouncing ownership of a contract essentially transfers ownership to the zero address. This is an irreversible operation and has considerable security implications. If the renounceOwnership function is used, the contract will lose the ability to perform any operations that are limited to the owner. This can be problematic if there are any bugs, flaws, or unexpected events that require owner intervention to resolve. Therefore, in some instances, it is better to disable or omit the renounceOwnership function, and instead implement a secure transferOwnership function. This way, if necessary, ownership can be transferred to a new, trusted party without losing the potential for administrative intervention.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20  // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L12-L12)']
```solidity
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step  // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable  // <= FOUND

```


</details>

## [NonCritical-6] Constant decimal values

### Resolution 
The use of fixed decimal values such as 1e18 or 1e8 in Solidity contracts can lead to inaccuracies, bugs, and vulnerabilities, particularly when interacting with tokens having different decimal configurations. Not all ERC20 tokens follow the standard 18 decimal places, and assumptions about decimal places can lead to miscalculations.

Resolution: Always retrieve and use the `decimals()` function from the token contract itself when performing calculations involving token amounts. This ensures that your contract correctly handles tokens with any number of decimal places, mitigating the risk of numerical errors or under/overflows that could jeopardize contract integrity and user funds.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L7-L7)']
```solidity
7: uint256 constant PERCENT = 1e18; // <= FOUND

```


</details>

## [NonCritical-7] Calling internal _grantRole bypasses role access checks

### Resolution 
OpenZeppelin's `AccessControl` library is designed with security in mind, encapsulating common access control patterns. Within this library, the `grantRole` function is public and ensures proper access checks before the role is granted. However, by calling the internal `_grantRole` function directly, developers bypass these pre-defined access controls. While this may be intentional, allowing for custom access controls, it risks introducing vulnerabilities if not handled with caution. Bypassing the native checks goes against the library's design philosophy, which emphasizes secure defaults. To uphold security, developers should consistently use public functions provided by OpenZeppelin, or, if choosing to call internal functions, ensure they implement and rigorously test their own access controls.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L95-L112)']
```solidity
95:     function initialize(
96:         address owner,
97:         InitializeFeeConfigParams calldata f,
98:         InitializeRiskConfigParams calldata r,
99:         InitializeOracleParams calldata o,
100:         InitializeDataParams calldata d
101:     ) external initializer {
102:         state.validateInitialize(owner, f, r, o, d);
103: 
104:         __AccessControl_init();
105:         __Pausable_init();
106:         __Multicall_init();
107:         __UUPSUpgradeable_init();
108: 
109:         state.executeInitialize(f, r, o, d);
110:         _grantRole(DEFAULT_ADMIN_ROLE, owner); // <= FOUND
111:         _grantRole(PAUSER_ROLE, owner); // <= FOUND
112:         _grantRole(KEEPER_ROLE, owner); // <= FOUND
113:     }

```


</details>

## [NonCritical-8] Critical functions should have a timelock

### Resolution 
Critical functions, especially those affecting protocol parameters or user funds, are potential points of failure or exploitation. To mitigate risks, incorporating a timelock on such functions can be beneficial. A timelock requires a waiting period between the time an action is initiated and when it's executed, giving stakeholders time to react, potentially vetoing malicious or erroneous changes. To implement, integrate a smart contract like OpenZeppelin's `TimelockController` or build a custom mechanism. This ensures governance decisions or administrative changes are transparent and allows for community or multi-signature interventions, enhancing protocol security and trustworthiness.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L28-L28)']
```solidity
28:     function setStaleRateInterval(uint64 _staleRateInterval) external onlyOwner  // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L34-L34)']
```solidity
34:     function setMarketBorrowRate(uint128 _marketBorrowRate) external onlyOwner  // <= FOUND

```


</details>

## [NonCritical-9] Consider the case where `totalSupply` is zero

### Resolution 
In smart contracts, especially those dealing with tokens or financial calculations, functions that perform operations based on `totalSupply` must account for the scenario where `totalSupply` is zero. Neglecting this edge case can lead to division by zero errors, causing transactions to revert and potentially disrupting contract functionality. This is critical in functions calculating percentages, rewards, or distributions. Proper checks should be implemented to ensure `totalSupply` is greater than zero before performing division or similar operations. Handling this case ensures the contract remains robust, preventing logical errors and maintaining the integrity of its operations.

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L11-L13)']
```solidity
10:     function validateCollateralTokenCap(State storage state) external view {
11:         if (state.data.collateralToken.totalSupply() > state.riskConfig.collateralTokenCap) { // <= FOUND
12:             revert Errors.COLLATERAL_TOKEN_CAP_EXCEEDED(
13:                 state.riskConfig.collateralTokenCap, state.data.collateralToken.totalSupply() // <= FOUND
14:             );
15:         }
16:     }

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L19-L21)']
```solidity
18:     function validateBorrowATokenCap(State storage state) external view {
19:         if (state.data.borrowAToken.totalSupply() > state.riskConfig.borrowATokenCap) { // <= FOUND
20:             revert Errors.BORROW_ATOKEN_CAP_EXCEEDED(
21:                 state.riskConfig.borrowATokenCap, state.data.borrowAToken.totalSupply() // <= FOUND
22:             );
23:         }
24:     }

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L27-L28)']
```solidity
26:     function validateDebtTokenCap(State storage state) external view {
27:         if (state.data.debtToken.totalSupply() > state.riskConfig.debtTokenCap) { // <= FOUND
28:             revert Errors.DEBT_TOKEN_CAP_EXCEEDED(state.riskConfig.debtTokenCap, state.data.debtToken.totalSupply()); // <= FOUND
29:         }
30:     }

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L33-L33)']
```solidity
32:     function validateVariablePoolHasEnoughLiquidity(State storage state) public view {
33:         uint256 redeemable = state.data.borrowAToken.totalSupply(); // <= FOUND
34:         uint256 liquidity = state.data.underlyingBorrowToken.balanceOf(address(state.data.variablePool));
35:         if (liquidity < redeemable) {
36:             revert Errors.NOT_ENOUGH_BORROW_ATOKEN_LIQUIDITY(liquidity, redeemable);
37:         }
38:     }

```


</details>

## [NonCritical-10] Use assembly to write address/contract storage values

Num of instances: 9

### Findings 


<details><summary>Click to show findings</summary>

['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L25-L25)']
```solidity
25:         staleRateInterval = _staleRateInterval; // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L36-L36)']
```solidity
36:         marketBorrowRate = _marketBorrowRate; // <= FOUND

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L20-L20)']
```solidity
20:         _decimals = decimals_; // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L47-L47)']
```solidity
47:         aaveOracle = IAaveOracle(_aaveOracle); // <= FOUND

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L48-L48)']
```solidity
48:         base = _base; // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L49-L49)']
```solidity
49:         baseDecimals = _baseDecimals; // <= FOUND

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L50-L50)']
```solidity
50:         quote = _quote; // <= FOUND

```
['[51](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L51-L51)']
```solidity
51:         quoteDecimals = _quoteDecimals; // <= FOUND

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L52-L52)']
```solidity
52:         decimals = _decimals; // <= FOUND

```


</details>

## [NonCritical-11] In functions which accept an address as a parameter, there should be a zero address check to prevent bugs

### Resolution 
In smart contract development, especially with Solidity, it's crucial to validate inputs to functions. When a function accepts an Ethereum address as a parameter, implementing a zero address check (i.e., ensuring the address is not `0x0`) is a best practice to prevent potential bugs and vulnerabilities. The zero address (`0x0`) is a default value and generally indicates an uninitialized or invalid state. Passing the zero address to certain functions can lead to unintended behaviors, like funds getting locked permanently or transactions failing silently. By checking for and rejecting the zero address, developers can ensure that the function operates as intended and interacts only with valid Ethereum addresses. This check enhances the contract's robustness and security.

Num of instances: 32

### Findings 


<details><summary>Click to show findings</summary>

['[83](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L83-L83)']
```solidity
83:     function createDebtAndCreditPositions(
84:         State storage state,
85:         address lender,
86:         address borrower,
87:         uint256 issuanceValue,
88:         uint256 faceValue,
89:         uint256 dueDate
90:     ) external returns (DebtPosition memory debtPosition, CreditPosition memory creditPosition) 

```
['[117](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L117-L117)']
```solidity
117:     function createCreditPosition(State storage state, uint256 exitCreditPositionId, address lender, uint256 credit)
118:         external
119:         returns (CreditPosition memory creditPosition)
120:     

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L15-L15)']
```solidity
15:     function depositUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) external 

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L21-L21)']
```solidity
21:     function withdrawUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount)
22:         external
23:     

```
['[169](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L169-L169)']
```solidity
169:     function validateInitialize(
170:         State storage,
171:         address owner,
172:         InitializeFeeConfigParams memory f,
173:         InitializeRiskConfigParams memory r,
174:         InitializeOracleParams memory o,
175:         InitializeDataParams memory d
176:     ) external view 

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L23-L23)']
```solidity
23:     function mint(address to, uint256 amount) external virtual onlyOwner 

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L27-L27)']
```solidity
27:     function burn(address from, uint256 amount) external virtual onlyOwner 

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L31-L31)']
```solidity
31:     function transferFrom(address from, address to, uint256 value) public virtual override onlyOwner returns (bool) 

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L36-L36)']
```solidity
36:     function transfer(address to, uint256 value) public virtual override onlyOwner returns (bool) 

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L41-L41)']
```solidity
41:     function allowance(address, address spender) public view virtual override returns (uint256) 

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L45-L45)']
```solidity
45:     function approve(address, uint256) public virtual override returns (bool) 

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L30-L30)']
```solidity
30:     function collateralRatio(State storage state, address account) public view returns (uint256) 

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L69-L69)']
```solidity
69:     function isUserLiquidatable(State storage state, address account) public view returns (bool) 

```
['[73](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L73-L73)']
```solidity
73:     function validateUserIsNotLiquidatable(State storage state, address account) external view 

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L79-L79)']
```solidity
79:     function validateUserIsNotBelowopeningLimitBorrowCR(State storage state, address account) external view 

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L95-L95)']
```solidity
95:     function initialize(
96:         address owner,
97:         InitializeFeeConfigParams calldata f,
98:         InitializeRiskConfigParams calldata r,
99:         InitializeOracleParams calldata o,
100:         InitializeDataParams calldata d
101:     ) external initializer 

```
['[116](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L116-L116)']
```solidity
116:     function _authorizeUpgrade(address newImplementation) internal override onlyRole(DEFAULT_ADMIN_ROLE) 

```
['[237](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L237-L237)']
```solidity
237:     function variablePoolAllowlisted(address account) external view override(ISize) whenNotPaused returns (bool) 

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L72-L72)']
```solidity
72:     function collateralRatio(address user) external view returns (uint256) 

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L76-L76)']
```solidity
76:     function isUserLiquidatable(address user) external view returns (bool) 

```
['[125](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L125-L125)']
```solidity
125:     function getUserView(address user) external view returns (UserView memory) 

```
['[173](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L173-L173)']
```solidity
173:     function getBorrowOfferAPR(address borrower, uint256 dueDate) external view returns (uint256) 

```
['[186](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L186-L186)']
```solidity
186:     function getLoanOfferAPR(address lender, uint256 dueDate) external view returns (uint256) 

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L44-L44)']
```solidity
44:     function depositUnderlyingTokenToVariablePool(
45:         State storage state,
46:         IERC20Metadata underlyingToken,
47:         address from,
48:         address to,
49:         uint256 amount,
50:         bool variable,
51:         bool setUseReserveAsCollateral
52:     ) external 

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L79-L79)']
```solidity
79:     function withdrawUnderlyingTokenFromVariablePool(
80:         State storage state,
81:         IAToken aToken,
82:         address from,
83:         address to,
84:         uint256 amount,
85:         bool variable
86:     ) external 

```
['[106](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L106-L106)']
```solidity
106:     function borrowVariableLoan(State storage state, address from, address to, uint256 amount) external 

```
['[144](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L144-L144)']
```solidity
144:     function repayVariableLoan(State storage state, address from, uint256 amount) external 

```
['[164](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L164-L164)']
```solidity
164:     function liquidateVariableLoan(State storage state, address from, address borrower, uint256 amount) external 

```
['[205](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L205-L205)']
```solidity
205:     function transferBorrowATokenFixed(State storage state, address from, address to, uint256 amount) public 

```
['[225](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L225-L225)']
```solidity
225:     function aTokenBalanceOf(State storage state, IAToken aToken, address account, bool variable)
226:         public
227:         view
228:         returns (uint256)
229:     

```
['[237](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L237-L237)']
```solidity
237:     function variableDebtTokenBalanceOf(State storage state, address account) public view returns (uint256) 

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L20-L20)']
```solidity
20:     function initialize(address owner) external initializer 

```


</details>

## [NonCritical-12] Enum values should be used in place of constant array indexes

### Resolution 
Create a commented enum value to use in place of constant array indexes, this makes the code far easier to understand

Num of instances: 17

### Findings 


<details><summary>Click to show findings</summary>

['[116](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L116-L117)']
```solidity
116:         
117:         targets[0] = address(state.data.variablePool); // <= FOUND

```
['[117](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L117-L117)']
```solidity
117:         data[0] = abi.encodeCall( // <= FOUND
118:             IPool.borrow,
119:             (
120:                 address(underlyingBorrowToken),
121:                 amount,
122:                 uint256(DataTypes.InterestRateMode.VARIABLE),
123:                 0,
124:                 address(vaultFrom)
125:             )
126:         );

```
['[174](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L174-L174)']
```solidity
174:         data[0] = // <= FOUND
175:             abi.encodeCall(IPool.withdraw, (address(state.data.underlyingBorrowToken), amount, address(vaultFrom)));

```
['[295](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L295-L295)']
```solidity
295:         data[0] = // <= FOUND
296:             abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(state.data.underlyingCollateralToken), true));

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L45-L45)']
```solidity
45:         if (self.maturities[0] < minimumMaturity) { // <= FOUND

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L46-L46)']
```solidity
46:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(self.maturities[0], minimumMaturity); // <= FOUND

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L98-L98)']
```solidity
98:         if (maturity < curveRelativeTime.maturities[0] || maturity > curveRelativeTime.maturities[length - 1]) { // <= FOUND

```
['[99](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L99-L100)']
```solidity
99:             revert Errors.MATURITY_OUT_OF_RANGE(
100:                 maturity, curveRelativeTime.maturities[0], curveRelativeTime.maturities[length - 1] // <= FOUND
101:             );

```
['[129](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L129-L130)']
```solidity
129:         
130:         targets[1] = address(state.data.underlyingBorrowToken); // <= FOUND

```
['[130](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L130-L130)']
```solidity
130:         data[1] = abi.encodeCall(IERC20.transfer, (address(this), amount)); // <= FOUND

```
['[179](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L179-L179)']
```solidity
179:         data[1] = abi.encodeCall(IERC20.approve, (address(state.data.variablePool), amount)); // <= FOUND

```
['[299](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L299-L300)']
```solidity
299:         
300:         targets[1] = address(state.data.variablePool); // <= FOUND

```
['[300](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L300-L300)']
```solidity
300:         data[1] = abi.encodeCall( // <= FOUND
301:             IPool.borrow,
302:             (
303:                 address(state.data.underlyingBorrowToken),
304:                 borrowATokenBalance,
305:                 uint256(DataTypes.InterestRateMode.VARIABLE),
306:                 0,
307:                 address(vaultFrom)
308:             )
309:         );

```
['[182](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L182-L183)']
```solidity
182:         
183:         targets[2] = address(state.data.variablePool); // <= FOUND

```
['[183](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L183-L183)']
```solidity
183:         data[2] = abi.encodeCall( // <= FOUND
184:             IPool.liquidationCall,
185:             (
186:                 address(state.data.underlyingCollateralToken),
187:                 address(state.data.underlyingBorrowToken),
188:                 address(vaultTo),
189:                 amount,
190:                 true
191:             )
192:         );

```
['[312](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L312-L313)']
```solidity
312:         
313:         targets[2] = address(state.data.underlyingBorrowToken); // <= FOUND

```
['[313](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L313-L313)']
```solidity
313:         data[2] = abi.encodeCall(IERC20.transfer, (address(this), borrowATokenBalance)); // <= FOUND

```


</details>

## [NonCritical-13] Revert statements within external and public functions can be used to perform DOS attacks

### Resolution 
In Solidity, 'revert' statements are used to undo changes and throw an exception when certain conditions are not met. However, in public and external functions, improper use of `revert` can be exploited for Denial of Service (DoS) attacks. An attacker can intentionally trigger these 'revert' conditions, causing legitimate transactions to consistently fail. For example, if a function relies on specific conditions from user input or contract state, an attacker could manipulate these to continually force reverts, blocking the function's execution. Therefore, it's crucial to design contract logic to handle exceptions properly and avoid scenarios where `revert` can be predictably triggered by malicious actors. This includes careful input validation and considering alternative design patterns that are less susceptible to such abuses.

Num of instances: 40

### Findings 


<details><summary>Click to show findings</summary>

['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L50-L95)']
```solidity
41:     function validateBorrowAsMarketOrder(State storage state, BorrowAsMarketOrderParams memory params) external view {
42:         User memory lenderUser = state.data.users[params.lender];
43:         LoanOffer memory loanOffer = lenderUser.loanOffer;
44: 
45:         
46:         
47: 
48:         
49:         if (loanOffer.isNull()) {
50:             revert Errors.INVALID_LOAN_OFFER(params.lender); // <= FOUND
51:         }
52: 
53:         
54:         if (params.amount == 0) {
55:             revert Errors.NULL_AMOUNT(); // <= FOUND
56:         }
57: 
58:         
59:         if (params.dueDate < block.timestamp) {
60:             revert Errors.PAST_DUE_DATE(params.dueDate); // <= FOUND
61:         }
62:         if (params.dueDate > loanOffer.maxDueDate) {
63:             revert Errors.DUE_DATE_GREATER_THAN_MAX_DUE_DATE(params.dueDate, loanOffer.maxDueDate); // <= FOUND
64:         }
65: 
66:         
67:         if (params.deadline < block.timestamp) {
68:             revert Errors.PAST_DEADLINE(params.deadline); // <= FOUND
69:         }
70: 
71:         
72:         uint256 ratePerMaturity =
73:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
74:         uint256 maturity = params.dueDate - block.timestamp;
75:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) > params.maxAPR) {
76:             revert Errors.APR_GREATER_THAN_MAX_APR( // <= FOUND
77:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.maxAPR
78:             );
79:         }
80: 
81:         
82:         
83: 
84:         
85:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) {
86:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
87: 
88:             CreditPosition memory creditPosition = state.getCreditPosition(creditPositionId);
89:             DebtPosition memory debtPosition = state.getDebtPositionByCreditPositionId(creditPositionId);
90: 
91:             if (msg.sender != creditPosition.lender) {
92:                 revert Errors.BORROWER_IS_NOT_LENDER(msg.sender, creditPosition.lender); // <= FOUND
93:             }
94:             if (params.dueDate < debtPosition.dueDate) {
95:                 revert Errors.DUE_DATE_LOWER_THAN_DEBT_POSITION_DUE_DATE(params.dueDate, debtPosition.dueDate); // <= FOUND
96:             }
97:         }
98:     }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L25-L30)']
```solidity
19:     function validateBorrowVariable(State storage, BorrowVariableParams calldata params) external pure {
20:         
21:         
22: 
23:         
24:         if (params.to == address(0)) {
25:             revert Errors.NULL_ADDRESS(); // <= FOUND
26:         }
27: 
28:         
29:         if (params.amount == 0) {
30:             revert Errors.NULL_AMOUNT(); // <= FOUND
31:         }
32:     }

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L41-L75)']
```solidity
34:     function validateBorrowerExit(State storage state, BorrowerExitParams calldata params) external view {
35:         BorrowOffer memory borrowOffer = state.data.users[params.borrowerToExitTo].borrowOffer;
36:         DebtPosition memory debtPosition = state.getDebtPosition(params.debtPositionId);
37: 
38:         
39:         uint256 dueDate = debtPosition.dueDate;
40:         if (dueDate < block.timestamp) {
41:             revert Errors.PAST_DUE_DATE(debtPosition.dueDate); // <= FOUND
42:         }
43:         uint256 maturity = dueDate - block.timestamp;
44:         if (maturity < state.riskConfig.minimumMaturity) {
45:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity); // <= FOUND
46:         }
47: 
48:         uint256 ratePerMaturity = borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, dueDate);
49:         uint256 issuanceValue = Math.mulDivUp(debtPosition.faceValue, PERCENT, PERCENT + ratePerMaturity);
50: 
51:         
52:         if (msg.sender != debtPosition.borrower) {
53:             revert Errors.EXITER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower); // <= FOUND
54:         }
55:         if (
56:             state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false)
57:                 < issuanceValue + state.feeConfig.earlyBorrowerExitFee
58:         ) {
59:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
60:                 address(state.data.borrowAToken),
61:                 msg.sender,
62:                 false,
63:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
64:                 issuanceValue + state.feeConfig.earlyBorrowerExitFee
65:             );
66:         }
67: 
68:         
69:         if (params.deadline < block.timestamp) {
70:             revert Errors.PAST_DEADLINE(params.deadline); // <= FOUND
71:         }
72: 
73:         
74:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
75:             revert Errors.APR_LOWER_THAN_MIN_APR( // <= FOUND
76:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
77:             );
78:         }
79: 
80:         
81:         
82:     }

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L12-L12)']
```solidity
10:     function validateCollateralTokenCap(State storage state) external view {
11:         if (state.data.collateralToken.totalSupply() > state.riskConfig.collateralTokenCap) {
12:             revert Errors.COLLATERAL_TOKEN_CAP_EXCEEDED( // <= FOUND
13:                 state.riskConfig.collateralTokenCap, state.data.collateralToken.totalSupply()
14:             );
15:         }
16:     }

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L20-L20)']
```solidity
18:     function validateBorrowATokenCap(State storage state) external view {
19:         if (state.data.borrowAToken.totalSupply() > state.riskConfig.borrowATokenCap) {
20:             revert Errors.BORROW_ATOKEN_CAP_EXCEEDED( // <= FOUND
21:                 state.riskConfig.borrowATokenCap, state.data.borrowAToken.totalSupply()
22:             );
23:         }
24:     }

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L28-L28)']
```solidity
26:     function validateDebtTokenCap(State storage state) external view {
27:         if (state.data.debtToken.totalSupply() > state.riskConfig.debtTokenCap) {
28:             revert Errors.DEBT_TOKEN_CAP_EXCEEDED(state.riskConfig.debtTokenCap, state.data.debtToken.totalSupply()); // <= FOUND
29:         }
30:     }

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L32-L35)']
```solidity
25:     function validateClaim(State storage state, ClaimParams calldata params) external view {
26:         CreditPosition storage creditPosition = state.getCreditPosition(params.creditPositionId);
27:         
28:         
29: 
30:         
31:         if (state.getLoanStatus(params.creditPositionId) != LoanStatus.REPAID) {
32:             revert Errors.LOAN_NOT_REPAID(params.creditPositionId); // <= FOUND
33:         }
34:         if (creditPosition.credit == 0) {
35:             revert Errors.CREDIT_POSITION_ALREADY_CLAIMED(params.creditPositionId); // <= FOUND
36:         }
37:     }

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L43-L74)']
```solidity
31:     function validateCompensate(State storage state, CompensateParams calldata params) external view {
32:         CreditPosition storage creditPositionWithDebtToRepay =
33:             state.getCreditPosition(params.creditPositionWithDebtToRepayId);
34:         DebtPosition storage debtPositionToRepay =
35:             state.getDebtPositionByCreditPositionId(params.creditPositionWithDebtToRepayId);
36:         CreditPosition storage creditPositionToCompensate = state.getCreditPosition(params.creditPositionToCompensateId);
37: 
38:         uint256 amountToCompensate =
39:             Math.min(params.amount, creditPositionToCompensate.credit, debtPositionToRepay.faceValue);
40: 
41:         
42:         if (state.getLoanStatus(params.creditPositionWithDebtToRepayId) == LoanStatus.REPAID) {
43:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionWithDebtToRepayId); // <= FOUND
44:         }
45:         if (creditPositionWithDebtToRepay.credit < amountToCompensate) {
46:             revert Errors.CREDIT_LOWER_THAN_AMOUNT_TO_COMPENSATE( // <= FOUND
47:                 creditPositionWithDebtToRepay.credit, amountToCompensate
48:             );
49:         }
50: 
51:         
52:         if (state.getLoanStatus(params.creditPositionToCompensateId) == LoanStatus.REPAID) {
53:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionToCompensateId); // <= FOUND
54:         }
55:         if (
56:             debtPositionToRepay.dueDate
57:                 < state.getDebtPositionByCreditPositionId(params.creditPositionToCompensateId).dueDate
58:         ) {
59:             revert Errors.DUE_DATE_NOT_COMPATIBLE( // <= FOUND
60:                 params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId
61:             );
62:         }
63:         if (creditPositionToCompensate.lender != debtPositionToRepay.borrower) {
64:             revert Errors.INVALID_LENDER(creditPositionToCompensate.lender); // <= FOUND
65:         }
66: 
67:         
68:         if (msg.sender != debtPositionToRepay.borrower) {
69:             revert Errors.COMPENSATOR_IS_NOT_BORROWER(msg.sender, debtPositionToRepay.borrower); // <= FOUND
70:         }
71: 
72:         
73:         if (params.amount == 0) {
74:             revert Errors.NULL_AMOUNT(); // <= FOUND
75:         }
76:     }

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L36-L46)']
```solidity
27:     function validateDeposit(State storage state, DepositParams calldata params) external view {
28:         
29:         
30: 
31:         
32:         if (
33:             params.token != address(state.data.underlyingCollateralToken)
34:                 && params.token != address(state.data.underlyingBorrowToken)
35:         ) {
36:             revert Errors.INVALID_TOKEN(params.token); // <= FOUND
37:         }
38: 
39:         
40:         if (params.amount == 0) {
41:             revert Errors.NULL_AMOUNT(); // <= FOUND
42:         }
43: 
44:         
45:         if (params.to == address(0)) {
46:             revert Errors.NULL_ADDRESS(); // <= FOUND
47:         }
48: 
49:         
50:         
51:     }

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L33-L36)']
```solidity
22:     function validateLendAsLimitOrder(State storage state, LendAsLimitOrderParams calldata params) external view {
23:         LoanOffer memory loanOffer =
24:             LoanOffer({maxDueDate: params.maxDueDate, curveRelativeTime: params.curveRelativeTime});
25: 
26:         
27:         if (!loanOffer.isNull()) {
28:             
29:             
30: 
31:             
32:             if (params.maxDueDate == 0) {
33:                 revert Errors.NULL_MAX_DUE_DATE(); // <= FOUND
34:             }
35:             if (params.maxDueDate < block.timestamp) {
36:                 revert Errors.PAST_MAX_DUE_DATE(params.maxDueDate); // <= FOUND
37:             }
38: 
39:             
40:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity);
41:         }
42:     }

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L45-L80)']
```solidity
37:     function validateLendAsMarketOrder(State storage state, LendAsMarketOrderParams calldata params) external view {
38:         BorrowOffer memory borrowOffer = state.data.users[params.borrower].borrowOffer;
39: 
40:         
41:         
42: 
43:         
44:         if (borrowOffer.isNull()) {
45:             revert Errors.INVALID_BORROW_OFFER(params.borrower); // <= FOUND
46:         }
47: 
48:         
49:         if (params.dueDate < block.timestamp) {
50:             revert Errors.PAST_DUE_DATE(params.dueDate); // <= FOUND
51:         }
52: 
53:         
54:         uint256 ratePerMaturity =
55:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
56:         uint256 amountIn;
57:         if (params.exactAmountIn) {
58:             amountIn = params.amount;
59:         } else {
60:             amountIn = Math.mulDivUp(params.amount, PERCENT, PERCENT + ratePerMaturity);
61:         }
62:         if (state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false) < amountIn) {
63:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
64:                 address(state.data.borrowAToken),
65:                 msg.sender,
66:                 false,
67:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
68:                 amountIn
69:             );
70:         }
71: 
72:         
73:         if (params.deadline < block.timestamp) {
74:             revert Errors.PAST_DEADLINE(params.deadline); // <= FOUND
75:         }
76: 
77:         
78:         uint256 maturity = params.dueDate - block.timestamp;
79:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
80:             revert Errors.APR_LOWER_THAN_MIN_APR( // <= FOUND
81:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
82:             );
83:         }
84: 
85:         
86:         
87:     }

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L39-L39)']
```solidity
31:     function validateLiquidate(State storage state, LiquidateParams calldata params) external view {
32:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
33: 
34:         
35:         
36: 
37:         
38:         if (!state.isDebtPositionLiquidatable(params.debtPositionId)) {
39:             revert Errors.LOAN_NOT_LIQUIDATABLE( // <= FOUND
40:                 params.debtPositionId,
41:                 state.collateralRatio(debtPosition.borrower),
42:                 state.getLoanStatus(params.debtPositionId)
43:             );
44:         }
45: 
46:         
47:         
48:     }

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L56-L56)']
```solidity
50:     function validateMinimumCollateralProfit(
51:         State storage,
52:         LiquidateParams calldata params,
53:         uint256 liquidatorProfitCollateralToken
54:     ) external pure {
55:         if (liquidatorProfitCollateralToken < params.minimumCollateralProfit) {
56:             revert Errors.LIQUIDATE_PROFIT_BELOW_MINIMUM_COLLATERAL_PROFIT( // <= FOUND
57:                 liquidatorProfitCollateralToken, params.minimumCollateralProfit
58:             );
59:         }
60:     }

```
['[150](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L150-L150)']
```solidity
119:     function executeLiquidate(State storage state, LiquidateParams calldata params)
120:         external
121:         returns (uint256 liquidatorProfitCollateralToken)
122:     {
123:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
124:         DebtPosition memory debtPositionCopy = debtPosition;
125:         LoanStatus loanStatus = state.getLoanStatus(params.debtPositionId);
126:         uint256 collateralRatio = state.collateralRatio(debtPosition.borrower);
127: 
128:         emit Events.Liquidate(params.debtPositionId, params.minimumCollateralProfit, collateralRatio, loanStatus);
129: 
130:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, debtPosition.faceValue);
131:         debtPosition.updateRepayFee(debtPosition.faceValue, repayFee);
132: 
133:         
134:         if (PERCENT <= collateralRatio && collateralRatio < state.riskConfig.crLiquidation) {
135:             emit Events.LiquidateUserLiquidatableProfitably(params.debtPositionId);
136:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, true);
137:             
138:         } else if (collateralRatio < PERCENT) {
139:             emit Events.LiquidateUserLiquidatableUnprofitably(params.debtPositionId);
140:             liquidatorProfitCollateralToken =
141:                 _executeLiquidateTakeCollateral(state, debtPositionCopy, false  );
142:             
143:         } else {
144:             
145:             if (loanStatus == LoanStatus.OVERDUE) {
146:                 liquidatorProfitCollateralToken = _executeLiquidateOverdue(state, params, debtPositionCopy);
147:                 
148:             } else {
149:                 
150:                 revert Errors.LOAN_NOT_LIQUIDATABLE(params.debtPositionId, collateralRatio, loanStatus); // <= FOUND
151:             }
152:         }
153: 
154:         state.data.debtToken.burn(debtPosition.borrower, debtPositionCopy.faceValue);
155:         debtPosition.liquidityIndexAtRepayment = state.borrowATokenLiquidityIndex();
156:     }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L25-L30)']
```solidity
19:     function validateLiquidateVariable(State storage, LiquidateVariableParams calldata params) external pure {
20:         
21:         
22: 
23:         
24:         if (params.borrower == address(0)) {
25:             revert Errors.NULL_ADDRESS(); // <= FOUND
26:         }
27: 
28:         
29:         if (params.amount == 0) {
30:             revert Errors.NULL_AMOUNT(); // <= FOUND
31:         }
32:     }

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L54-L73)']
```solidity
35:     function validateLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params)
36:         external
37:         view
38:     {
39:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
40:         BorrowOffer storage borrowOffer = state.data.users[params.borrower].borrowOffer;
41:         uint256 ratePerMaturity =
42:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, debtPosition.dueDate);
43: 
44:         
45:         state.validateLiquidate(
46:             LiquidateParams({
47:                 debtPositionId: params.debtPositionId,
48:                 minimumCollateralProfit: params.minimumCollateralProfit
49:             })
50:         );
51: 
52:         
53:         if (state.getLoanStatus(params.debtPositionId) != LoanStatus.ACTIVE) {
54:             revert Errors.LOAN_NOT_ACTIVE(params.debtPositionId); // <= FOUND
55:         }
56:         uint256 maturity = debtPosition.dueDate - block.timestamp;
57:         if (maturity < state.riskConfig.minimumMaturity) {
58:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity); // <= FOUND
59:         }
60: 
61:         
62:         if (borrowOffer.isNull()) {
63:             revert Errors.INVALID_BORROW_OFFER(params.borrower); // <= FOUND
64:         }
65: 
66:         
67:         if (params.deadline < block.timestamp) {
68:             revert Errors.PAST_DEADLINE(params.deadline); // <= FOUND
69:         }
70: 
71:         
72:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
73:             revert Errors.APR_LOWER_THAN_MIN_APR( // <= FOUND
74:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
75:             );
76:         }
77:     }

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L43-L43)']
```solidity
41:     function getMarketBorrowRate() external view override returns (uint128) {
42:         if (block.timestamp - marketBorrowRateUpdatedAt > staleRateInterval) {
43:             revert Errors.STALE_RATE(marketBorrowRateUpdatedAt); // <= FOUND
44:         }
45:         return marketBorrowRate;
46:     }

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L30-L38)']
```solidity
25:     function validateRepay(State storage state, RepayParams calldata params) external view {
26:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
27: 
28:         
29:         if (state.getLoanStatus(params.debtPositionId) == LoanStatus.REPAID) {
30:             revert Errors.LOAN_ALREADY_REPAID(params.debtPositionId); // <= FOUND
31:         }
32: 
33:         
34:         if (msg.sender != debtPosition.borrower) {
35:             revert Errors.REPAYER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower); // <= FOUND
36:         }
37:         if (state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false) < debtPosition.faceValue) {
38:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
39:                 address(state.data.borrowAToken),
40:                 msg.sender,
41:                 false,
42:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
43:                 debtPosition.faceValue
44:             );
45:         }
46:     }

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L24-L24)']
```solidity
18:     function validateRepayVariable(State storage, RepayVariableParams calldata params) external pure {
19:         
20:         
21: 
22:         
23:         if (params.amount == 0) {
24:             revert Errors.NULL_AMOUNT(); // <= FOUND
25:         }
26:     }

```
['[75](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L75-L75)']
```solidity
73:     function validateUserIsNotLiquidatable(State storage state, address account) external view {
74:         if (isUserLiquidatable(state, account)) {
75:             revert Errors.USER_IS_LIQUIDATABLE(account, collateralRatio(state, account)); // <= FOUND
76:         }
77:     }

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L85-L85)']
```solidity
79:     function validateUserIsNotBelowopeningLimitBorrowCR(State storage state, address account) external view {
80:         uint256 openingLimitBorrowCR = Math.max(
81:             state.riskConfig.crOpening,
82:             state.data.users[account].borrowOffer.openingLimitBorrowCR 
83:         );
84:         if (collateralRatio(state, account) < openingLimitBorrowCR) {
85:             revert Errors.CR_BELOW_OPENING_LIMIT_BORROW_CR( // <= FOUND
86:                 account, collateralRatio(state, account), openingLimitBorrowCR
87:             );
88:         }
89:     }

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L36-L48)']
```solidity
27:     function validateSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external view {
28:         CreditPosition storage creditPosition = state.getCreditPosition(params.creditPositionId);
29:         DebtPosition storage debtPosition = state.getDebtPositionByCreditPositionId(params.creditPositionId);
30: 
31:         uint256 assignedCollateral = state.getCreditPositionProRataAssignedCollateral(creditPosition);
32:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPosition.faceValue);
33: 
34:         
35:         if (!state.isCreditPositionSelfLiquidatable(params.creditPositionId)) {
36:             revert Errors.LOAN_NOT_SELF_LIQUIDATABLE( // <= FOUND
37:                 params.creditPositionId,
38:                 state.collateralRatio(debtPosition.borrower),
39:                 state.getLoanStatus(params.creditPositionId)
40:             );
41:         }
42:         if (!(assignedCollateral < debtInCollateralToken)) {
43:             revert Errors.LIQUIDATION_NOT_AT_LOSS(params.creditPositionId, assignedCollateral, debtInCollateralToken); // <= FOUND
44:         }
45: 
46:         
47:         if (msg.sender != creditPosition.lender) {
48:             revert Errors.LIQUIDATOR_IS_NOT_LENDER(msg.sender, creditPosition.lender); // <= FOUND
49:         }
50:     }

```
['[176](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L176-L179)']
```solidity
173:     function getBorrowOfferAPR(address borrower, uint256 dueDate) external view returns (uint256) {
174:         BorrowOffer memory offer = state.data.users[borrower].borrowOffer;
175:         if (offer.isNull()) {
176:             revert Errors.NULL_OFFER(); // <= FOUND
177:         }
178:         if (dueDate < block.timestamp) {
179:             revert Errors.PAST_DUE_DATE(dueDate); // <= FOUND
180:         }
181:         uint256 ratePerMaturity = offer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, dueDate);
182:         uint256 maturity = dueDate - block.timestamp;
183:         return Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity);
184:     }

```
['[189](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L189-L192)']
```solidity
186:     function getLoanOfferAPR(address lender, uint256 dueDate) external view returns (uint256) {
187:         LoanOffer memory offer = state.data.users[lender].loanOffer;
188:         if (offer.isNull()) {
189:             revert Errors.NULL_OFFER(); // <= FOUND
190:         }
191:         if (dueDate < block.timestamp) {
192:             revert Errors.PAST_DUE_DATE(dueDate); // <= FOUND
193:         }
194:         uint256 ratePerMaturity = offer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, dueDate);
195:         uint256 maturity = dueDate - block.timestamp;
196:         return Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity);
197:     }

```
['[112](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L112-L112)']
```solidity
76:     function executeUpdateConfig(State storage state, UpdateConfigParams calldata params) external {
77:         if (params.key == "crOpening") {
78:             state.riskConfig.crOpening = params.value;
79:         } else if (params.key == "crLiquidation") {
80:             state.riskConfig.crLiquidation = params.value;
81:         } else if (params.key == "minimumCreditBorrowAToken") {
82:             state.riskConfig.minimumCreditBorrowAToken = params.value;
83:         } else if (params.key == "collateralSplitLiquidatorPercent") {
84:             state.riskConfig.collateralSplitLiquidatorPercent = params.value;
85:         } else if (params.key == "collateralSplitProtocolPercent") {
86:             state.riskConfig.collateralSplitProtocolPercent = params.value;
87:         } else if (params.key == "collateralTokenCap") {
88:             state.riskConfig.collateralTokenCap = params.value;
89:         } else if (params.key == "borrowATokenCap") {
90:             state.riskConfig.borrowATokenCap = params.value;
91:         } else if (params.key == "debtTokenCap") {
92:             state.riskConfig.debtTokenCap = params.value;
93:         } else if (params.key == "moveToVariablePoolHFThreshold") {
94:             state.riskConfig.moveToVariablePoolHFThreshold = params.value;
95:         } else if (params.key == "minimumMaturity") {
96:             state.riskConfig.minimumMaturity = params.value;
97:         } else if (params.key == "repayFeeAPR") {
98:             state.feeConfig.repayFeeAPR = params.value;
99:         } else if (params.key == "earlyLenderExitFee") {
100:             state.feeConfig.earlyLenderExitFee = params.value;
101:         } else if (params.key == "earlyBorrowerExitFee") {
102:             state.feeConfig.earlyBorrowerExitFee = params.value;
103:         } else if (params.key == "collateralOverdueTransferFee") {
104:             state.feeConfig.collateralOverdueTransferFee = params.value;
105:         } else if (params.key == "feeRecipient") {
106:             state.feeConfig.feeRecipient = address(uint160(params.value));
107:         } else if (params.key == "priceFeed") {
108:             state.oracle.priceFeed = IPriceFeed(address(uint160(params.value)));
109:         } else if (params.key == "marketBorrowRateFeed") {
110:             state.oracle.marketBorrowRateFeed = IMarketBorrowRateFeed(address(uint160(params.value)));
111:         } else {
112:             revert Errors.INVALID_KEY(params.key); // <= FOUND
113:         }
114: 
115:         Initialize.validateInitializeFeeConfigParams(feeConfigParams(state));
116:         Initialize.validateInitializeRiskConfigParams(riskConfigParams(state));
117:         Initialize.validateInitializeOracleParams(oracleParams(state));
118: 
119:         emit Events.UpdateConfig(params.key, params.value);
120:     }

```
['[88](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L88-L88)']
```solidity
79:     function withdrawUnderlyingTokenFromVariablePool(
80:         State storage state,
81:         IAToken aToken,
82:         address from,
83:         address to,
84:         uint256 amount,
85:         bool variable
86:     ) external {
87:         if (aTokenBalanceOf(state, aToken, from, variable) < amount) {
88:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
89:                 address(aToken), from, variable, aTokenBalanceOf(state, aToken, from, variable), amount
90:             );
91:         }
92: 
93:         address underlyingToken = aToken.UNDERLYING_ASSET_ADDRESS();
94: 
95:         Vault vaultFrom = variable ? state.getVaultVariable(from) : state.getVaultFixed(from);
96: 
97:         
98:         vaultFrom.proxy(address(state.data.variablePool), abi.encodeCall(IPool.withdraw, (underlyingToken, amount, to)));
99:     }

```
['[327](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L327-L327)']
```solidity
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken)
265:     {
266:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
267: 
268:         
269:         liquidatorProfitCollateralToken = state.feeConfig.collateralOverdueTransferFee;
270:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken);
271: 
272:         address from = debtPositionCopy.borrower;
273:         address to = address(this);
274:         uint256 collateralBalance = assignedCollateral - liquidatorProfitCollateralToken;
275:         uint256 borrowATokenBalance = debtPositionCopy.faceValue;
276: 
277:         
278:         Vault vaultFrom = state.getVaultVariable(from);
279:         Vault vaultTo = state.getVaultFixed(to);
280: 
281:         
282:         state.withdrawUnderlyingCollateralToken(from, address(this), collateralBalance);
283: 
284:         
285:         state.data.underlyingCollateralToken.forceApprove(address(state.data.variablePool), collateralBalance);
286:         state.data.variablePool.supply(
287:             address(state.data.underlyingCollateralToken), collateralBalance, address(vaultFrom), 0
288:         );
289: 
290:         address[] memory targets = new address[](3);
291:         bytes[] memory data = new bytes[](3);
292: 
293:         
294:         targets[0] = address(state.data.variablePool);
295:         data[0] =
296:             abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(state.data.underlyingCollateralToken), true));
297: 
298:         
299:         targets[1] = address(state.data.variablePool);
300:         data[1] = abi.encodeCall(
301:             IPool.borrow,
302:             (
303:                 address(state.data.underlyingBorrowToken),
304:                 borrowATokenBalance,
305:                 uint256(DataTypes.InterestRateMode.VARIABLE),
306:                 0,
307:                 address(vaultFrom)
308:             )
309:         );
310: 
311:         
312:         targets[2] = address(state.data.underlyingBorrowToken);
313:         data[2] = abi.encodeCall(IERC20.transfer, (address(this), borrowATokenBalance));
314: 
315:         
316:         vaultFrom.proxy(targets, data);
317: 
318:         
319:         state.data.underlyingBorrowToken.forceApprove(address(state.data.variablePool), borrowATokenBalance);
320:         state.data.variablePool.supply(
321:             address(state.data.underlyingBorrowToken), borrowATokenBalance, address(vaultTo), 0
322:         );
323: 
324:         
325:         (,,,,, uint256 healthFactor) = state.data.variablePool.getUserAccountData(address(vaultFrom));
326:         if (healthFactor < state.riskConfig.moveToVariablePoolHFThreshold) {
327:             revert Errors.HEALTH_FACTOR_BELOW_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD( // <= FOUND
328:                 address(vaultFrom), healthFactor, state.riskConfig.moveToVariablePoolHFThreshold
329:             );
330:         }
331:     }

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L34-L44)']
```solidity
25:     function validateWithdraw(State storage state, WithdrawParams calldata params) external view {
26:         
27:         
28: 
29:         
30:         if (
31:             params.token != address(state.data.underlyingCollateralToken)
32:                 && params.token != address(state.data.underlyingBorrowToken)
33:         ) {
34:             revert Errors.INVALID_TOKEN(params.token); // <= FOUND
35:         }
36: 
37:         
38:         if (params.amount == 0) {
39:             revert Errors.NULL_AMOUNT(); // <= FOUND
40:         }
41: 
42:         
43:         if (params.to == address(0)) {
44:             revert Errors.NULL_ADDRESS(); // <= FOUND
45:         }
46: 
47:         
48:         
49:     }

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L95-L99)']
```solidity
89:     function getRatePerMaturityByDueDate(
90:         YieldCurve memory curveRelativeTime,
91:         IMarketBorrowRateFeed marketBorrowRateFeed,
92:         uint256 dueDate
93:     ) external view returns (uint256) {
94:         
95:         if (dueDate < block.timestamp) revert Errors.PAST_DUE_DATE(dueDate); // <= FOUND
96:         uint256 maturity = dueDate - block.timestamp;
97:         uint256 length = curveRelativeTime.maturities.length;
98:         if (maturity < curveRelativeTime.maturities[0] || maturity > curveRelativeTime.maturities[length - 1]) {
99:             revert Errors.MATURITY_OUT_OF_RANGE( // <= FOUND
100:                 maturity, curveRelativeTime.maturities[0], curveRelativeTime.maturities[length - 1]
101:             );
102:         } else {
103:             (uint256 low, uint256 high) = Math.binarySearch(curveRelativeTime.maturities, maturity);
104:             uint256 x0 = curveRelativeTime.maturities[low];
105:             uint256 y0 = getRatePerMaturityByDueDate(
106:                 curveRelativeTime.maturities[low],
107:                 curveRelativeTime.aprs[low],
108:                 curveRelativeTime.marketRateMultipliers[low],
109:                 marketBorrowRateFeed
110:             );
111:             uint256 x1 = curveRelativeTime.maturities[high];
112:             uint256 y1 = getRatePerMaturityByDueDate(
113:                 curveRelativeTime.maturities[high],
114:                 curveRelativeTime.aprs[high],
115:                 curveRelativeTime.marketRateMultipliers[high],
116:                 marketBorrowRateFeed
117:             );
118: 
119:             
120:             if (x1 != x0) {
121:                 if (y1 >= y0) {
122:                     return y0 + Math.mulDivDown(y1 - y0, maturity - x0, x1 - x0);
123:                 } else {
124:                     return y0 - Math.mulDivDown(y0 - y1, maturity - x0, x1 - x0);
125:                 }
126:             } else {
127:                 return y0;
128:             }
129:         }
130:     }

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L36-L36)']
```solidity
32:     function validateVariablePoolHasEnoughLiquidity(State storage state) public view {
33:         uint256 redeemable = state.data.borrowAToken.totalSupply();
34:         uint256 liquidity = state.data.underlyingBorrowToken.balanceOf(address(state.data.variablePool));
35:         if (liquidity < redeemable) {
36:             revert Errors.NOT_ENOUGH_BORROW_ATOKEN_LIQUIDITY(liquidity, redeemable); // <= FOUND
37:         }
38:     }

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L72-L72)']
```solidity
68:     function getDebtPosition(State storage state, uint256 debtPositionId) public view returns (DebtPosition storage) {
69:         if (isDebtPositionId(state, debtPositionId)) {
70:             return state.data.debtPositions[debtPositionId];
71:         } else {
72:             revert Errors.INVALID_DEBT_POSITION_ID(debtPositionId); // <= FOUND
73:         }
74:     }

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L84-L84)']
```solidity
76:     function getCreditPosition(State storage state, uint256 creditPositionId)
77:         public
78:         view
79:         returns (CreditPosition storage)
80:     {
81:         if (isCreditPositionId(state, creditPositionId)) {
82:             return state.data.creditPositions[creditPositionId];
83:         } else {
84:             revert Errors.INVALID_CREDIT_POSITION_ID(creditPositionId); // <= FOUND
85:         }
86:     }

```
['[109](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L109-L109)']
```solidity
101:     function getLoanStatus(State storage state, uint256 positionId) public view returns (LoanStatus) {
102:         
103:         DebtPosition memory debtPosition = state.data.debtPositions[positionId];
104:         if (isCreditPositionId(state, positionId)) {
105:             
106:             debtPosition = getDebtPositionByCreditPositionId(state, positionId);
107:         } else if (!isDebtPositionId(state, positionId)) {
108:             
109:             revert Errors.INVALID_POSITION_ID(positionId); // <= FOUND
110:         }
111: 
112:         
113:         if (getDebt(debtPosition) == 0) {
114:             return LoanStatus.REPAID;
115:         } else if (block.timestamp >= debtPosition.dueDate) {
116:             return LoanStatus.OVERDUE;
117:         } else {
118:             return LoanStatus.ACTIVE;
119:         }
120:     }

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L46-L46)']
```solidity
45:     function approve(address, uint256) public virtual override returns (bool) {
46:         revert Errors.NOT_SUPPORTED(); // <= FOUND
47:     }

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L20-L20)']
```solidity
18:     function validateMinimumCredit(State storage state, uint256 credit) public view {
19:         if (0 < credit && credit < state.riskConfig.minimumCreditBorrowAToken) {
20:             revert Errors.CREDIT_LOWER_THAN_MINIMUM_CREDIT(credit, state.riskConfig.minimumCreditBorrowAToken); // <= FOUND
21:         }
22:     }

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L26-L26)']
```solidity
24:     function validateMinimumCreditOpening(State storage state, uint256 credit) public view {
25:         if (credit < state.riskConfig.minimumCreditBorrowAToken) {
26:             revert Errors.CREDIT_LOWER_THAN_MINIMUM_CREDIT_OPENING(credit, state.riskConfig.minimumCreditBorrowAToken); // <= FOUND
27:         }
28:     }

```
['[208](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L208-L208)']
```solidity
205:     function transferBorrowATokenFixed(State storage state, address from, address to, uint256 amount) public {
206:         IAToken borrowAToken = state.data.borrowAToken;
207:         if (aTokenBalanceOf(state, borrowAToken, from, false) < amount) {
208:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
209:                 address(borrowAToken), from, false, aTokenBalanceOf(state, borrowAToken, from, false), amount
210:             );
211:         }
212: 
213:         Vault vaultFrom = state.getVaultFixed(from);
214:         Vault vaultTo = state.getVaultFixed(to);
215: 
216:         
217:         vaultFrom.proxy(address(borrowAToken), abi.encodeCall(IERC20.transfer, (address(vaultTo), amount)));
218:     }

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L26-L26)']
```solidity
24:     function proxy(address target, bytes memory data) public onlyOwner returns (bytes memory returnData) {
25:         if (target == address(0)) {
26:             revert Errors.NULL_ADDRESS(); // <= FOUND
27:         }
28:         bool success;
29:         (success, returnData) = address(target).call(data);
30:         Address.verifyCallResult(success, returnData);
31:     }

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L39-L39)']
```solidity
33:     function proxy(address target, bytes memory data, uint256 value)
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData)
37:     {
38:         if (target == address(0)) {
39:             revert Errors.NULL_ADDRESS(); // <= FOUND
40:         }
41:         bool success;
42:         (success, returnData) = address(target).call{value: value}(data);
43:         Address.verifyCallResult(success, returnData);
44:     }

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L52-L59)']
```solidity
46:     function proxy(address[] memory targets, bytes[] memory datas)
47:         public
48:         onlyOwner
49:         returns (bytes[] memory returnDatas)
50:     {
51:         if (targets.length != datas.length) {
52:             revert Errors.ARRAY_LENGTHS_MISMATCH(); // <= FOUND
53:         }
54: 
55:         returnDatas = new bytes[](datas.length);
56:         bool success;
57:         for (uint256 i = 0; i < targets.length; i++) {
58:             if (targets[i] == address(0)) {
59:                 revert Errors.NULL_ADDRESS(); // <= FOUND
60:             }
61:             
62:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]);
63:             Address.verifyCallResult(success, returnDatas[i]);
64:         }
65:     }

```


</details>

## [NonCritical-14] Functions which are either private or internal should have a preceding _ in their name

### Resolution 
Add a preceding underscore to the function name, take care to refactor where there functions are called

Num of instances: 37

### Findings 


<details><summary>Click to show findings</summary>

['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L28-L28)']
```solidity
28:     function debtTokenAmountToCollateralTokenAmount(State storage state, uint256 debtTokenAmount)
29:         internal
30:         view
31:         returns (uint256 collateralTokenAmount)
32:     

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L8-L8)']
```solidity
8:     function amountToWad(uint256 amount, uint8 decimals) internal pure returns (uint256) 

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L12-L12)']
```solidity
12:     function wadToAmountDown(uint256 wad, uint8 decimals) internal pure returns (uint256) 

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L17-L17)']
```solidity
17:     function rayToWadDown(uint256 ray) internal pure returns (uint256) 

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L59-L59)']
```solidity
59:     function validateOwner(address owner) internal pure 

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L65-L65)']
```solidity
65:     function validateInitializeFeeConfigParams(InitializeFeeConfigParams memory f) internal pure 

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L84-L84)']
```solidity
84:     function validateInitializeRiskConfigParams(InitializeRiskConfigParams memory r) internal pure 

```
['[138](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L138-L138)']
```solidity
138:     function validateInitializeOracleParams(InitializeOracleParams memory o) internal view 

```
['[152](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L152-L152)']
```solidity
152:     function validateInitializeDataParams(InitializeDataParams memory d) internal pure 

```
['[184](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L184-L184)']
```solidity
184:     function executeInitializeFeeConfig(State storage state, InitializeFeeConfigParams memory f) internal 

```
['[195](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L195-L195)']
```solidity
195:     function executeInitializeRiskConfig(State storage state, InitializeRiskConfigParams memory r) internal 

```
['[212](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L212-L212)']
```solidity
212:     function executeInitializeOracle(State storage state, InitializeOracleParams memory o) internal 

```
['[217](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L217-L217)']
```solidity
217:     function executeInitializeData(State storage state, InitializeDataParams memory d) internal 

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L48-L48)']
```solidity
48:     function isDebtPositionId(State storage state, uint256 positionId) internal view returns (bool) 

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L52-L52)']
```solidity
52:     function isCreditPositionId(State storage state, uint256 positionId) internal view returns (bool) 

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L56-L56)']
```solidity
56:     function getDebt(DebtPosition memory self) internal pure returns (uint256) 

```
['[174](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L174-L174)']
```solidity
174:     function repayFee(uint256 issuanceValue, uint256 startDate, uint256 dueDate, uint256 repayFeeAPR)
175:         internal
176:         pure
177:         returns (uint256)
178:     

```
['[185](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L185-L185)']
```solidity
185:     function earlyRepayFee(DebtPosition memory self) internal view returns (uint256) 

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L13-L13)']
```solidity
13:     function min(uint256 a, uint256 b) internal pure returns (uint256) 

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L17-L17)']
```solidity
17:     function max(uint256 a, uint256 b) internal pure returns (uint256) 

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L21-L21)']
```solidity
21:     function min(uint256 a, uint256 b, uint256 c) internal pure returns (uint256) 

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L25-L25)']
```solidity
25:     function mulDivUp(uint256 x, uint256 y, uint256 z) internal pure returns (uint256) 

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L29-L29)']
```solidity
29:     function mulDivDown(uint256 x, uint256 y, uint256 z) internal pure returns (uint256) 

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L33-L33)']
```solidity
33:     function mulDiv(int256 x, int256 y, int256 z) internal pure returns (int256) 

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L37-L37)']
```solidity
37:     function powWadWad(uint256 wad1, uint256 wad2) internal pure returns (uint256) 

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L41-L41)']
```solidity
41:     function ratePerMaturityToLinearAPR(int256 rate, uint256 maturity) internal pure returns (int256) 

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L45-L45)']
```solidity
45:     function ratePerMaturityToLinearAPR(uint256 rate, uint256 maturity) internal pure returns (uint256) 

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L49-L49)']
```solidity
49:     function linearAPRToRatePerMaturity(int256 rate, uint256 maturity) internal pure returns (int256) 

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L53-L53)']
```solidity
53:     function compoundAPRToRatePerMaturity(uint256 rate, uint256 maturity) internal pure returns (uint256) 

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L57-L57)']
```solidity
57:     function binarySearch(uint256[] memory array, uint256 value) internal pure returns (uint256 low, uint256 high) 

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L21-L21)']
```solidity
21:     function isNull(LoanOffer memory self) internal pure returns (bool) 

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L25-L25)']
```solidity
25:     function isNull(BorrowOffer memory self) internal pure returns (bool) 

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L29-L29)']
```solidity
29:     function getRatePerMaturityByDueDate(
30:         LoanOffer memory self,
31:         IMarketBorrowRateFeed marketBorrowRateFeed,
32:         uint256 dueDate
33:     ) internal view returns (uint256) 

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L37-L37)']
```solidity
37:     function getRatePerMaturityByDueDate(
38:         BorrowOffer memory self,
39:         IMarketBorrowRateFeed marketBorrowRateFeed,
40:         uint256 dueDate
41:     ) internal view returns (uint256) 

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L22-L22)']
```solidity
22:     function isNull(YieldCurve memory self) internal pure returns (bool) 

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L26-L26)']
```solidity
26:     function validateYieldCurve(YieldCurve memory self, uint256 minimumMaturity) internal pure 

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L62-L62)']
```solidity
62:     function getRatePerMaturityByDueDate(
63:         uint256 maturity,
64:         int256 apr,
65:         uint256 marketRateMultiplier,
66:         IMarketBorrowRateFeed marketBorrowRateFeed
67:     ) internal view returns (uint256) 

```


</details>

## [NonCritical-15] Private and internal state variables should have a preceding _ in their name unless they are constants

### Resolution 
Add a preceding underscore to the state variable name, take care to refactor where there variables are read/wrote

Num of instances: 72

### Findings 


<details><summary>Click to show findings</summary>

['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L13-L13)']
```solidity
13: uint128 internal marketBorrowRate; // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L14-L14)']
```solidity
14: uint64 internal marketBorrowRateUpdatedAt; // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L15-L15)']
```solidity
15: uint64 internal staleRateInterval; // <= FOUND

```
['[71](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L71-L71)']
```solidity
71: State internal state; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L8-L8)']
```solidity
8: error USER_IS_LIQUIDATABLE(address account, uint256 cr);

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L9-L9)']
```solidity
9: error NULL_ADDRESS();

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L10-L10)']
```solidity
10: error NULL_AMOUNT();

```
['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L11-L11)']
```solidity
11: error NULL_MAX_DUE_DATE();

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L12-L12)']
```solidity
12: error NULL_ARRAY();

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L13-L13)']
```solidity
13: error NULL_OFFER();

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L14-L14)']
```solidity
14: error MATURITIES_NOT_STRICTLY_INCREASING();

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L15-L15)']
```solidity
15: error MATURITY_BELOW_MINIMUM_MATURITY(uint256 maturity, uint256 minimumMaturity);

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L16-L16)']
```solidity
16: error ARRAY_LENGTHS_MISMATCH();

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L17-L17)']
```solidity
17: error INVALID_TOKEN(address token);

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L18-L18)']
```solidity
18: error INVALID_KEY(bytes32 key);

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L19-L19)']
```solidity
19: error INVALID_COLLATERAL_RATIO(uint256 cr);

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L20-L20)']
```solidity
20: error INVALID_COLLATERAL_PERCENTAGE_PREMIUM(uint256 percentage);

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L21-L21)']
```solidity
21: error INVALID_COLLATERAL_PERCENTAGE_PREMIUM_SUM(uint256 sum);

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L22-L22)']
```solidity
22: error INVALID_LIQUIDATION_COLLATERAL_RATIO(uint256 crOpening, uint256 crLiquidation);

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L23-L23)']
```solidity
23: error PAST_DUE_DATE(uint256 dueDate);

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L24-L24)']
```solidity
24: error PAST_DEADLINE(uint256 deadline);

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L25-L25)']
```solidity
25: error PAST_MAX_DUE_DATE(uint256 maxDueDate);

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L26-L26)']
```solidity
26: error APR_LOWER_THAN_MIN_APR(uint256 apr, uint256 minAPR);

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L27-L27)']
```solidity
27: error APR_GREATER_THAN_MAX_APR(uint256 apr, uint256 maxAPR);

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L28-L28)']
```solidity
28: error DUE_DATE_LOWER_THAN_DEBT_POSITION_DUE_DATE(uint256 dueDate, uint256 debtPositionDueDate);

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L29-L29)']
```solidity
29: error DUE_DATE_NOT_COMPATIBLE(uint256 debtPositionIdToRepay, uint256 creditPositionIdToCompensate);

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L30-L30)']
```solidity
30: error DUE_DATE_GREATER_THAN_MAX_DUE_DATE(uint256 dueDate, uint256 maxDueDate);

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L31-L31)']
```solidity
31: error MATURITY_OUT_OF_RANGE(uint256 maturity, uint256 minMaturity, uint256 maxMaturity);

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L32-L32)']
```solidity
32: error INVALID_POSITION_ID(uint256 positionId);

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L33-L33)']
```solidity
33: error INVALID_DEBT_POSITION_ID(uint256 debtPositionId);

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L34-L34)']
```solidity
34: error INVALID_CREDIT_POSITION_ID(uint256 creditPositionId);

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L35-L35)']
```solidity
35: error INVALID_LENDER(address account);

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L36-L36)']
```solidity
36: error INVALID_LOAN_OFFER(address lender);

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L37-L37)']
```solidity
37: error INVALID_BORROW_OFFER(address borrower);

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L39-L39)']
```solidity
39: error BORROWER_IS_NOT_LENDER(address borrower, address lender);

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L40-L40)']
```solidity
40: error COMPENSATOR_IS_NOT_BORROWER(address compensator, address borrower);

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L41-L41)']
```solidity
41: error LIQUIDATOR_IS_NOT_LENDER(address liquidator, address lender);

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L42-L42)']
```solidity
42: error EXITER_IS_NOT_BORROWER(address exiter, address borrower);

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L43-L43)']
```solidity
43: error REPAYER_IS_NOT_BORROWER(address repayer, address borrower);

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L45-L45)']
```solidity
45: error NOT_ENOUGH_ATOKEN_BALANCE(address token, address account, bool variable, uint256 balance, uint256 required);

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L46-L46)']
```solidity
46: error NOT_ENOUGH_BORROW_ATOKEN_LIQUIDITY(uint256 liquidity, uint256 required);

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L47-L47)']
```solidity
47: error CREDIT_LOWER_THAN_MINIMUM_CREDIT(uint256 faceValue, uint256 minimumCreditBorrowAToken);

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L48-L48)']
```solidity
48: error CREDIT_LOWER_THAN_MINIMUM_CREDIT_OPENING(uint256 faceValue, uint256 minimumCreditBorrowAToken);

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L49-L49)']
```solidity
49: error CREDIT_LOWER_THAN_AMOUNT_TO_COMPENSATE(uint256 credit, uint256 amountToCompensate);

```
['[51](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L51-L51)']
```solidity
51: error ONLY_DEBT_POSITION_CAN_BE_REPAID(uint256 positionId);

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L52-L52)']
```solidity
52: error ONLY_DEBT_POSITION_CAN_BE_EXITED(uint256 positionId);

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L53-L53)']
```solidity
53: error ONLY_DEBT_POSITION_CAN_BE_LIQUIDATED(uint256 positionId);

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L54-L54)']
```solidity
54: error ONLY_CREDIT_POSITION_CAN_BE_CLAIMED(uint256 positionId);

```
['[55](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L55-L55)']
```solidity
55: error ONLY_CREDIT_POSITION_CAN_BE_COMPENSATED(uint256 positionId);

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L56-L56)']
```solidity
56: error ONLY_CREDIT_POSITION_CAN_BE_SELF_LIQUIDATED(uint256 positionId);

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L58-L58)']
```solidity
58: error CREDIT_POSITION_ALREADY_CLAIMED(uint256 positionId);

```
['[60](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L60-L60)']
```solidity
60: error LOAN_ALREADY_REPAID(uint256 positionId);

```
['[61](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L61-L61)']
```solidity
61: error LOAN_NOT_REPAID(uint256 positionId);

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L62-L62)']
```solidity
62: error LOAN_NOT_ACTIVE(uint256 positionId);

```
['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L64-L64)']
```solidity
64: error NOT_LIQUIDATABLE(address account);

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L65-L65)']
```solidity
65: error LOAN_NOT_LIQUIDATABLE(uint256 debtPositionId, uint256 cr, LoanStatus status);

```
['[66](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L66-L66)']
```solidity
66: error LOAN_NOT_SELF_LIQUIDATABLE(uint256 creditPositionId, uint256 cr, LoanStatus status);

```
[]
```solidity
error LIQUIDATE_PROFIT_BELOW_MINIMUM_COLLATERAL_PROFIT(         uint256 liquidatorProfitCollateralToken, uint256 minimumCollateralProfit     );

```
['[70](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L70-L70)']
```solidity
70: error CR_BELOW_OPENING_LIMIT_BORROW_CR(address account, uint256 collateralRatio, uint256 riskCollateralRatio);

```
['[71](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L71-L71)']
```solidity
71: error LIQUIDATION_NOT_AT_LOSS(uint256 positionId, uint256 assignedCollateral, uint256 debtCollateral);

```
['[73](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L73-L73)']
```solidity
73: error INVALID_DECIMALS(uint8 decimals);

```
['[74](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L74-L74)']
```solidity
74: error INVALID_PRICE(address aggregator, int256 price);

```
['[75](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L75-L75)']
```solidity
75: error STALE_PRICE(address aggregator, uint256 updatedAt);

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L76-L76)']
```solidity
76: error NULL_STALE_PRICE();

```
['[77](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L77-L77)']
```solidity
77: error NULL_STALE_RATE();

```
['[78](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L78-L78)']
```solidity
78: error STALE_RATE(uint128 updatedAt);

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L80-L80)']
```solidity
80: error INVALID_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(uint256 moveToVariablePoolHFThreshold);

```
[]
```solidity
error HEALTH_FACTOR_BELOW_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(         address account, uint256 healthFactor, uint256 moveToVariablePoolHFThreshold     );

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L85-L85)']
```solidity
85: error COLLATERAL_TOKEN_CAP_EXCEEDED(uint256 cap, uint256 amount);

```
['[86](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L86-L86)']
```solidity
86: error BORROW_ATOKEN_CAP_EXCEEDED(uint256 cap, uint256 amount);

```
['[87](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L87-L87)']
```solidity
87: error DEBT_TOKEN_CAP_EXCEEDED(uint256 cap, uint256 amount);

```
['[89](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L89-L89)']
```solidity
89: error NOT_SUPPORTED();

```


</details>

## [NonCritical-16] Contract lines should not be longer than 120 characters for readability

### Resolution 
Consider spreading these lines over multiple lines to aid in readability and the support of VIM users everywhere.

Num of instances: 54

### Findings 


<details><summary>Click to show findings</summary>

['[82](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L82-L82)']
```solidity
82:             state.data.users[account].borrowOffer.openingLimitBorrowCR // 0 by default, or user-defined if BorrowAsLimitOrder has been placed // <= FOUND

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L29-L29)']
```solidity
29:     uint256 collateralSplitLiquidatorPercent; // percent of collateral remainder to be split with liquidator on profitable liquidations // <= FOUND

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L30-L30)']
```solidity
30:     uint256 collateralSplitProtocolPercent; // percent of collateral to be split with protocol on profitable liquidations // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L45-L45)']
```solidity
45:     mapping(address => bool) variablePoolAllowlisted; // mapping of addresses allowlisted to interact with the Variable Pool // <= FOUND

```
['[124](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L124-L124)']
```solidity
124:     ///      When used to calculate the amount of collateral on liquidations, the repayment fee must be excluded first from the user debt // <= FOUND

```
['[145](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L145-L145)']
```solidity
145:     ///      When used to calculate the amount of collateral on self liquidation, the repayment fee must be excluded first from the user debt // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L36-L36)']
```solidity
36:         CreditPosition storage creditPositionToCompensate = state.getCreditPosition(params.creditPositionToCompensateId); // <= FOUND

```
['[110](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L110-L110)']
```solidity
110:     /// @dev The `amount` is initialized to `amountOutLeft`, which is decreased as more and more CreditPositions are created // <= FOUND

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L98-L98)']
```solidity
98:         vaultFrom.proxy(address(state.data.variablePool), abi.encodeCall(IPool.withdraw, (underlyingToken, amount, to))); // <= FOUND

```
['[252](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L252-L252)']
```solidity
252:     /// @notice Move a fixed-rate DebtPosition to the variable pool by supplying the assigned collateral and paying the liquidator with the move fee // <= FOUND

```
['[254](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L254-L254)']
```solidity
254:     ///        The borrow is made on behalf of the variable-rate vault of the `from` user and the supply is made to the fixed-rate vault of the `to` user, so that it later can be claimed // <= FOUND

```
['[255](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L255-L255)']
```solidity
255:     ///        After moving the loan to the Variable Pool, we check the vault's health factor and revert if it is below the liquidation threshold. See https://docs.aave.com/risk/asset-risk/risk-parameters#health-factor // <= FOUND

```
['[257](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L257-L257)']
```solidity
257:     ///      We use a memory copy of the DebtPosition as it might have already changed in storage as a result of the liquidation process // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L12-L12)']
```solidity
12: /// @dev This contract is deployed behind minimal proxy contracts, also known as "clones", using OpenZeppelin's Clones library. // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L43-L43)']
```solidity
43:     ///      During early repayment, the full repayFee is deducted from the borrower debt, as it had been provisioned during the loan creation // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L47-L47)']
```solidity
47:     /// @param isEarlyRepay Whether the repayment is early. In this case, the fee is charged pro-rata to the time elapsed // <= FOUND

```
['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L64-L64)']
```solidity
64:         state.data.collateralToken.transferFrom(debtPosition.borrower, state.feeConfig.feeRecipient, repayFeeCollateral); // <= FOUND

```
['[234](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L234-L234)']
```solidity
234:             IAToken(state.data.variablePool.getReserveData(address(state.data.underlyingCollateralToken)).aTokenAddress); // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L58-L58)']
```solidity
58:     ///     - uint256 amount: The amount of tokens to withdraw (in decimals, e.g. 1_000e6 for 1000 USDC or 10e18 for 10 WETH) // <= FOUND

```
['[66](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L66-L66)']
```solidity
66:     ///      Order "takers" are the ones who pay the rounding, since "makers" are the ones passively waiting for an order to be matched // <= FOUND

```
['[71](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L71-L71)']
```solidity
71:     ///     - bool exactAmountIn: When passing an array of receivable credit position ids, this flag indicates if the amount is value to be returned at due date // <= FOUND

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L72-L72)']
```solidity
72:     ///     - uint256[] receivableCreditPositionIds: The ids of receivable credit positions that can be used as credit to borrow without assigining new collateral // <= FOUND

```
['[77](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L77-L77)']
```solidity
77:     ///     - uint256 openingLimitBorrowCR: The opening limit borrow collateral ratio, which indicates the maximum CR the borrower is willing to accept after their offer is picked by a lender // <= FOUND

```
['[78](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L78-L78)']
```solidity
78:     ///     - YieldCurve curveRelativeTime: The yield curve for the borrow offer, a struct containing the following fields: // <= FOUND

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L79-L79)']
```solidity
79:     ///         - uint256[] maturities: The relative timestamps of the yield curve (for example, [30 days, 60 days, 90 days]) // <= FOUND

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L80-L80)']
```solidity
80:     ///         - uint256[] aprs: The aprs of the yield curve (for example, [0.05e18, 0.07e18, 0.08e18] to represent 5% APR, 7% APR, and 8% APR, linear interest, respectively) // <= FOUND

```
['[81](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L81-L81)']
```solidity
81:     ///         - int256[] marketRateMultipliers: The market rate multipliers of the yield curve (for example, [0.99e18, 1e18, 1.1e18] to represent 99%, 100%, and 110% of the market borrow rate, respectively) // <= FOUND

```
['[89](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L89-L89)']
```solidity
89:     ///     - bool exactAmountIn: This flag indicates if the amount is the value to be transferred to the borrower or if it should be used to calculate the amount to be transferred // <= FOUND

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L94-L94)']
```solidity
94:     ///     - uint256 maxDueDate: The maximum timestamp the limit order can be picked by a borrower (e.g., 1712188800 for April 4th, 2024) // <= FOUND

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L95-L95)']
```solidity
95:     ///     - YieldCurve curveRelativeTime: The yield curve for the lend offer, a struct containing the following fields: // <= FOUND

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L98-L98)']
```solidity
98:     ///         - int256[] marketRateMultipliers: The market rate multipliers of the yield curve (for example, [1e18, 1.2e18, 1.3e18] to represent 100%, 120%, and 130% of the market borrow rate, respectively) // <= FOUND

```
['[102](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L102-L102)']
```solidity
102:     ///         When exiting a debt position to a new borrower, the early exit borrower fee is applied to the current borrower // <= FOUND

```
['[104](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L104-L104)']
```solidity
104:     ///         1. Previous borrower pays an "early" protocol repay fee pro rata to the block.timestamp, and their debt is reduced by the full protocol repay fee amount // <= FOUND

```
['[106](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L106-L106)']
```solidity
106:     ///         3. previous borrower transfers to the new borrower FV/(1+r), which is the present value of faceValue adjusted by the rate the new borrower has specified // <= FOUND

```
['[110](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L110-L110)']
```solidity
110:     /// @dev The current borrower debt is transferred to the new borrower, together with the borrow tokens according to the new borrower yield curve // <= FOUND

```
['[116](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L116-L116)']
```solidity
116:     /// @notice Repay a debt position by transferring the amount due of borrow tokens to the protocol, which are deposited to the Variable Pool for the lenders to claim // <= FOUND

```
['[119](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L119-L119)']
```solidity
119:     /// @dev The Variable Pool liquidity index is snapshotted at the time of the repayment in order to calculate the accrued interest for lenders to claim // <= FOUND

```
['[126](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L126-L126)']
```solidity
126:     ///      CLAIMED loans can't be claimed either because its credit has already been consumed entirely either by a previous claim or by exiting before // <= FOUND

```
['[132](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L132-L132)']
```solidity
132:     ///         In case of protifable liquiadtion, part of the collateral remainder is split between the protocol and the liquidator // <= FOUND

```
['[146](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L146-L146)']
```solidity
146:     ///                         liquidate loan, do not split the collateral remainder, charge move transfer fee in collateral from the borrower // <= FOUND

```
['[151](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L151-L151)']
```solidity
151:     ///     - uint256 minimumCollateralProfit: The minimum collateral profit that the liquidator is willing to accept from the borrower (keepers might choose to pass a value below 100% of the cash they bring and take the risk of liquidating unprofitably) // <= FOUND

```
['[156](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L156-L156)']
```solidity
156:     /// @dev Due to always rounding fees up, it is possible that fees become greater than the debt balance after a partial repayment // <= FOUND

```
['[157](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L157-L157)']
```solidity
157:     ///      This can be mitigated by either rounding fees down, which is not ideal, or by capping the burned/transferred amount to the user balance // <= FOUND

```
['[160](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L160-L160)']
```solidity
160:     ///               The first lender exits to another lender, and now there are two credit positions, $94.999999 and $5.000001. // <= FOUND

```
['[161](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L161-L161)']
```solidity
161:     ///               If the first lender self liquidates, the pro-rata repay fee will be $0.475, and the borrower's debt will be updated to $5.025001. // <= FOUND

```
['[162](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L162-L162)']
```solidity
162:     ///               Then, on the second lender self liquidation, the pro-rata repay fee will be $0.025001 due to rounding up, and the borrower's debt would underflow due to the reduction of $5.000001 + $0.025001 = $5.025002. // <= FOUND

```
['[169](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L169-L169)']
```solidity
169:     ///         When liquidating with replacement, nothing changes from the lender's perspective, but a spread is created between the previous borrower rate and the new borrower rate. // <= FOUND

```
['[170](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L170-L170)']
```solidity
170:     ///         As a result of the spread of these borrow aprs, the protocol is able to profit from the liquidation. Since the choice of the borrower impacts on the protocol's profit, this method is permissioned // <= FOUND

```
['[180](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L180-L180)']
```solidity
180:     ///         The compensation can not exceed both 1) the credit the lender of `debtPositionToRepayId` to the borrower and 2) the credit the lender of `creditPositionToCompensateId` // <= FOUND

```
['[204](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L204-L204)']
```solidity
204:     /// @notice Liquidate a variable loan by forwarding a call from the user proxy to the Variable Pool `liquidationCall` // <= FOUND

```
['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L11-L11)']
```solidity
11: /// @notice A contract that provides the price of an asset in terms of another asset by interacting with the Variable Pool Price Feed // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L27-L27)']
```solidity
27: ///      A `key` bytes32 string is used to identify the configuration parameter to update and a `value` uint256 is used to set the new value // <= FOUND

```
['[91](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L91-L91)']
```solidity
91:         uint256 ratePerMaturity = Math.mulDivDown(debtPosition.faceValue, PERCENT, debtPosition.issuanceValue) - PERCENT; // <= FOUND

```
['[149](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L149-L149)']
```solidity
149:                 // @audit unreachable code, check if the validation function is correct and not making this branch possible // <= FOUND

```


</details>

## [NonCritical-17] Avoid updating storage when the value hasn't changed

### Resolution 
In Solidity, manipulating contract storage comes with significant gas costs. One can optimize gas usage by preventing unnecessary storage updates when the new value is the same as the existing one. If an existing value is the same as the new one, not reassigning it to the storage could potentially save substantial amounts of gas, notably 2900 gas for a 'Gsreset'. This saving may come at the expense of a cold storage load operation ('Gcoldsload'), which costs 2100 gas, or a warm storage access operation ('Gwarmaccess'), which costs 100 gas. Therefore, the gas efficiency of your contract can be significantly improved by adding a check that compares the new value with the current one before any storage update operation. If the values are the same, you can bypass the storage operation, thereby saving gas.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L28-L28)']
```solidity
28:     function setStaleRateInterval(uint64 _staleRateInterval) external onlyOwner {
29:         uint64 oldStaleRateInterval = staleRateInterval;
30:         staleRateInterval = _staleRateInterval;
31:         emit StaleRateIntervalUpdated(oldStaleRateInterval, _staleRateInterval);
32:     }

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L34-L34)']
```solidity
34:     function setMarketBorrowRate(uint128 _marketBorrowRate) external onlyOwner {
35:         uint128 oldMarketBorrowRate = marketBorrowRate;
36:         marketBorrowRate = _marketBorrowRate;
37:         marketBorrowRateUpdatedAt = uint64(block.timestamp);
38:         emit MarketBorrowRateUpdated(oldMarketBorrowRate, _marketBorrowRate);
39:     }

```
['[118](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L118-L118)']
```solidity
118:     function updateConfig(UpdateConfigParams calldata params) external onlyRole(DEFAULT_ADMIN_ROLE) {
119:         state.validateUpdateConfig(params);
120:         state.executeUpdateConfig(params);
121:     }

```


</details>

## [NonCritical-18] Not all event definitions are utilizing indexed variables.

### Resolution 
Try to index as much as three variables in event declarations as this is more gas efficient when done on value type variables (uint, address etc) however not for bytes and string variables 

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L17-L17)']
```solidity
17: event MarketBorrowRateUpdated(uint128 oldMarketBorrowRate, uint128 newMarketBorrowRate); // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L18-L18)']
```solidity
18: event StaleRateIntervalUpdated(uint64 oldStaleRateInterval, uint64 newStaleRateInterval); // <= FOUND

```


</details>

## [NonCritical-19] Function names should differ to make the code more readable

### Resolution 
In Solidity, while function overriding allows for functions with the same name to coexist, it is advisable to avoid this practice to enhance code readability and maintainability. Having multiple functions with the same name, even with different parameters or in inherited contracts, can cause confusion and increase the likelihood of errors during development, testing, and debugging. Using distinct and descriptive function names not only clarifies the purpose and behavior of each function, but also helps prevent unintended function calls or incorrect overriding. By adopting a clear and consistent naming convention, developers can create more comprehensible and maintainable smart contracts.

Num of instances: 44

### Findings 


<details><summary>Click to show findings</summary>

['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L48-L48)']
```solidity
48:     function chargeRepayFeeInCollateral( // <= FOUND
49:         State storage state,
50:         DebtPosition storage debtPosition,
51:         uint256 repayAmount,
52:         bool isEarlyRepay
53:     ) public returns (uint256 repayFee) 

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L76-L76)']
```solidity
76:     function chargeRepayFeeInCollateral(State storage state, DebtPosition storage debtPosition, uint256 repayAmount) // <= FOUND
77:         external
78:         returns (uint256)
79:     

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L50-L50)']
```solidity
50:     function validateMinimumCollateralProfit( // <= FOUND
51:         State storage,
52:         LiquidateParams calldata params,
53:         uint256 liquidatorProfitCollateralToken
54:     ) external pure 

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L79-L79)']
```solidity
79:     function validateMinimumCollateralProfit( // <= FOUND
80:         State storage state,
81:         LiquidateWithReplacementParams calldata params,
82:         uint256 liquidatorProfitCollateralToken
83:     ) external pure 

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L13-L13)']
```solidity
13:     function min(uint256 a, uint256 b) internal pure returns (uint256)  // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L21-L21)']
```solidity
21:     function min(uint256 a, uint256 b, uint256 c) internal pure returns (uint256)  // <= FOUND

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L41-L41)']
```solidity
41:     function ratePerMaturityToLinearAPR(int256 rate, uint256 maturity) internal pure returns (int256)  // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L45-L45)']
```solidity
45:     function ratePerMaturityToLinearAPR(uint256 rate, uint256 maturity) internal pure returns (uint256)  // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L21-L21)']
```solidity
21:     function isNull(LoanOffer memory self) internal pure returns (bool)  // <= FOUND

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L25-L25)']
```solidity
25:     function isNull(BorrowOffer memory self) internal pure returns (bool)  // <= FOUND

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L22-L22)']
```solidity
22:     function isNull(YieldCurve memory self) internal pure returns (bool)  // <= FOUND

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L29-L29)']
```solidity
29:     function getRatePerMaturityByDueDate( // <= FOUND
30:         LoanOffer memory self,
31:         IMarketBorrowRateFeed marketBorrowRateFeed,
32:         uint256 dueDate
33:     ) internal view returns (uint256) 

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L37-L37)']
```solidity
37:     function getRatePerMaturityByDueDate( // <= FOUND
38:         BorrowOffer memory self,
39:         IMarketBorrowRateFeed marketBorrowRateFeed,
40:         uint256 dueDate
41:     ) internal view returns (uint256) 

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L62-L62)']
```solidity
62:     function getRatePerMaturityByDueDate( // <= FOUND
63:         uint256 maturity,
64:         int256 apr,
65:         uint256 marketRateMultiplier,
66:         IMarketBorrowRateFeed marketBorrowRateFeed
67:     ) internal view returns (uint256) 

```
['[89](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L89-L89)']
```solidity
89:     function getRatePerMaturityByDueDate( // <= FOUND
90:         YieldCurve memory curveRelativeTime,
91:         IMarketBorrowRateFeed marketBorrowRateFeed,
92:         uint256 dueDate
93:     ) external view returns (uint256) 

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L30-L30)']
```solidity
30:     function collateralRatio(State storage state, address account) public view returns (uint256)  // <= FOUND

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L72-L72)']
```solidity
72:     function collateralRatio(address user) external view returns (uint256)  // <= FOUND

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L69-L69)']
```solidity
69:     function isUserLiquidatable(State storage state, address account) public view returns (bool)  // <= FOUND

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L76-L76)']
```solidity
76:     function isUserLiquidatable(address user) external view returns (bool)  // <= FOUND

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L56-L56)']
```solidity
56:     function isDebtPositionLiquidatable(State storage state, uint256 debtPositionId) public view returns (bool)  // <= FOUND

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L80-L80)']
```solidity
80:     function isDebtPositionLiquidatable(uint256 debtPositionId) external view returns (bool)  // <= FOUND

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L56-L56)']
```solidity
56:     function getDebt(DebtPosition memory self) internal pure returns (uint256)  // <= FOUND

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L84-L84)']
```solidity
84:     function getDebt(uint256 debtPositionId) external view returns (uint256)  // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L28-L28)']
```solidity
28:     function debtTokenAmountToCollateralTokenAmount(State storage state, uint256 debtTokenAmount) // <= FOUND
29:         internal
30:         view
31:         returns (uint256 collateralTokenAmount)
32:     

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L95-L95)']
```solidity
95:     function debtTokenAmountToCollateralTokenAmount(uint256 borrowATokenAmount) external view returns (uint256)  // <= FOUND

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L48-L48)']
```solidity
48:     function isDebtPositionId(State storage state, uint256 positionId) internal view returns (bool)  // <= FOUND

```
['[138](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L138-L138)']
```solidity
138:     function isDebtPositionId(uint256 debtPositionId) external view returns (bool)  // <= FOUND

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L52-L52)']
```solidity
52:     function isCreditPositionId(State storage state, uint256 positionId) internal view returns (bool)  // <= FOUND

```
['[142](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L142-L142)']
```solidity
142:     function isCreditPositionId(uint256 creditPositionId) external view returns (bool)  // <= FOUND

```
['[68](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L68-L68)']
```solidity
68:     function getDebtPosition(State storage state, uint256 debtPositionId) public view returns (DebtPosition storage)  // <= FOUND

```
['[146](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L146-L146)']
```solidity
146:     function getDebtPosition(uint256 debtPositionId) external view returns (DebtPosition memory)  // <= FOUND

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L76-L76)']
```solidity
76:     function getCreditPosition(State storage state, uint256 creditPositionId) // <= FOUND
77:         public
78:         view
79:         returns (CreditPosition storage)
80:     

```
['[150](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L150-L150)']
```solidity
150:     function getCreditPosition(uint256 creditPositionId) external view returns (CreditPosition memory)  // <= FOUND

```
['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L101-L101)']
```solidity
101:     function getLoanStatus(State storage state, uint256 positionId) public view returns (LoanStatus)  // <= FOUND

```
['[154](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L154-L154)']
```solidity
154:     function getLoanStatus(uint256 positionId) external view returns (LoanStatus)  // <= FOUND

```
['[174](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L174-L174)']
```solidity
174:     function repayFee(uint256 issuanceValue, uint256 startDate, uint256 dueDate, uint256 repayFeeAPR) // <= FOUND
175:         internal
176:         pure
177:         returns (uint256)
178:     

```
['[158](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L158-L158)']
```solidity
158:     function repayFee(uint256 issuanceValue, uint256 startDate, uint256 dueDate, uint256 repayFeeAPR) // <= FOUND
159:         external
160:         pure
161:         returns (uint256)
162:     

```
['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L128-L128)']
```solidity
128:     function getDebtPositionAssignedCollateral(State storage state, DebtPosition memory debtPosition) // <= FOUND
129:         public
130:         view
131:         returns (uint256)
132:     

```
['[199](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L199-L199)']
```solidity
199:     function getDebtPositionAssignedCollateral(uint256 debtPositionId) external view returns (uint256)  // <= FOUND

```
['[149](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L149-L149)']
```solidity
149:     function getCreditPositionProRataAssignedCollateral(State storage state, CreditPosition memory creditPosition) // <= FOUND
150:         public
151:         view
152:         returns (uint256)
153:     

```
['[204](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L204-L204)']
```solidity
204:     function getCreditPositionProRataAssignedCollateral(uint256 creditPositionId) external view returns (uint256)  // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L24-L24)']
```solidity
24:     function proxy(address target, bytes memory data) public onlyOwner returns (bytes memory returnData)  // <= FOUND

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L33-L33)']
```solidity
33:     function proxy(address target, bytes memory data, uint256 value) // <= FOUND
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData)
37:     

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L46-L46)']
```solidity
46:     function proxy(address[] memory targets, bytes[] memory datas) // <= FOUND
47:         public
48:         onlyOwner
49:         returns (bytes[] memory returnDatas)
50:     

```


</details>

## [NonCritical-20] Functions within contracts are not ordered according to the solidity style guide

### Resolution 
The following order should be used within contracts

constructor

receive function (if exists)

fallback function (if exists)

external

public

internal

private

Rearrange the contract functions and contructors to fit this ordering

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

[]
```solidity
56: contract Size is
57:     ISize,
58:     SizeView,
59:     Initializable,
60:     AccessControlUpgradeable,
61:     PausableUpgradeable,
62:     MulticallUpgradeable,
63:     UUPSUpgradeable
64: 

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable  // <= FOUND

```


</details>

## [NonCritical-21] Emits without msg.sender parameter

### Resolution 
In Solidity, when `msg.sender` plays a crucial role in a function's logic, it's important for transparency and auditability that any events emitted by this function include `msg.sender` as a parameter. This practice enhances the traceability and accountability of transactions, allowing users and external observers to easily track who initiated a particular action. Including `msg.sender` in event logs helps in creating a clear and verifiable record of interactions with the contract, thereby increasing user trust and facilitating easier debugging and analysis of contract behavior. It's a key aspect of writing clear, transparent, and user-friendly smart contracts.

Num of instances: 8

### Findings 


<details><summary>Click to show findings</summary>

['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L38-L38)']
```solidity
37:     function executeBorrowAsLimitOrder(State storage state, BorrowAsLimitOrderParams calldata params) external {
38:         state.data.users[msg.sender].borrowOffer = BorrowOffer({ // <= FOUND
39:             openingLimitBorrowCR: params.openingLimitBorrowCR,
40:             curveRelativeTime: params.curveRelativeTime
41:         });
42:         emit Events.BorrowAsLimitOrder(params.curveRelativeTime);
43:     }

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L35-L35)']
```solidity
34:     function executeBorrowVariable(State storage state, BorrowVariableParams calldata params) public {
35:         state.borrowVariableLoan(msg.sender, params.to, params.amount); // <= FOUND
36:         emit Events.BorrowVariable(params.to, params.amount);
37:     }

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L59-L66)']
```solidity
53:     function executeDeposit(State storage state, DepositParams calldata params) public {
54:         if (params.variable || params.token == address(state.data.underlyingBorrowToken)) {
55:             bool setUseReserveAsCollateral = params.token == address(state.data.underlyingCollateralToken);
56: 
57:             state.depositUnderlyingTokenToVariablePool(
58:                 IERC20Metadata(params.token),
59:                 msg.sender, // <= FOUND
60:                 params.to,
61:                 params.amount,
62:                 params.variable,
63:                 setUseReserveAsCollateral
64:             );
65:         } else {
66:             state.depositUnderlyingCollateralToken(msg.sender, params.to, params.amount); // <= FOUND
67:         }
68: 
69:         emit Events.Deposit(params.token, params.to, params.variable, params.amount);
70:     }

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L45-L45)']
```solidity
44:     function executeLendAsLimitOrder(State storage state, LendAsLimitOrderParams calldata params) external {
45:         state.data.users[msg.sender].loanOffer = // <= FOUND
46:             LoanOffer({maxDueDate: params.maxDueDate, curveRelativeTime: params.curveRelativeTime});
47:         emit Events.LendAsLimitOrder(params.maxDueDate, params.curveRelativeTime);
48:     }

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L35-L35)']
```solidity
34:     function executeLiquidateVariable(State storage state, LiquidateVariableParams calldata params) public {
35:         state.liquidateVariableLoan(msg.sender, params.borrower, params.amount); // <= FOUND
36:         emit Events.LiquidateVariable(params.borrower, params.amount);
37:     }

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L52-L52)']
```solidity
48:     function executeRepay(State storage state, RepayParams calldata params) external {
49:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
50:         uint256 faceValue = debtPosition.faceValue;
51: 
52:         state.transferBorrowATokenFixed(msg.sender, address(this), faceValue); // <= FOUND
53:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, faceValue);
54:         debtPosition.updateRepayFee(faceValue, repayFee);
55:         state.data.debtToken.burn(debtPosition.borrower, faceValue);
56:         debtPosition.liquidityIndexAtRepayment = state.borrowATokenLiquidityIndex();
57: 
58:         emit Events.Repay(params.debtPositionId);
59:     }

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L29-L29)']
```solidity
28:     function executeRepayVariable(State storage state, RepayVariableParams calldata params) public {
29:         state.repayVariableLoan(msg.sender, params.amount); // <= FOUND
30:         emit Events.RepayVariable(params.amount);
31:     }

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L58-L65)']
```solidity
51:     function executeWithdraw(State storage state, WithdrawParams calldata params) public {
52:         uint256 amount;
53:         if (params.variable || params.token == address(state.data.underlyingBorrowToken)) {
54:             IAToken aToken = params.token == address(state.data.underlyingBorrowToken)
55:                 ? state.data.borrowAToken
56:                 : state.data.collateralAToken;
57: 
58:             amount = Math.min(params.amount, state.aTokenBalanceOf(aToken, msg.sender, params.variable)); // <= FOUND
59:             if (amount > 0) {
60:                 state.withdrawUnderlyingTokenFromVariablePool(aToken, msg.sender, params.to, amount, params.variable); // <= FOUND
61:             }
62:         } else {
63:             amount = Math.min(params.amount, state.data.collateralToken.balanceOf(msg.sender)); // <= FOUND
64:             if (amount > 0) {
65:                 state.withdrawUnderlyingCollateralToken(msg.sender, params.to, amount); // <= FOUND
66:             }
67:         }
68: 
69:         emit Events.Withdraw(params.token, params.to, params.variable, amount);
70:     }

```


</details>

## [NonCritical-22] Interface imports should be declared first

### Resolution 
Amend the ordering of imports to import interfaces first followed by other imports

Num of instances: 11

### Findings 


<details><summary>Click to show findings</summary>

['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L5-L16)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {IAToken} from "@aave/interfaces/IAToken.sol"; // <= FOUND
6: import {IPool} from "@aave/interfaces/IPool.sol"; // <= FOUND
7: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol"; // <= FOUND
8: 
9: import {CreditPosition, DebtPosition} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND
10: 
11: import {User} from "@src/libraries/fixed/UserLibrary.sol"; // <= FOUND
12: import {Vault} from "@src/proxy/Vault.sol"; // <= FOUND
13: 
14: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol"; // <= FOUND
15: import {IPriceFeed} from "@src/oracle/IPriceFeed.sol"; // <= FOUND
16: import {NonTransferrableToken} from "@src/token/NonTransferrableToken.sol"; // <= FOUND
17: 
18: struct FeeConfig {
19:     uint256 repayFeeAPR; 
20:     uint256 earlyLenderExitFee; 
21:     uint256 earlyBorrowerExitFee; 
22:     uint256 collateralOverdueTransferFee; 
23:     address feeRecipient; 
24: }
25: 
26: struct RiskConfig {
27:     uint256 crOpening; 
28:     uint256 crLiquidation; 
29:     uint256 minimumCreditBorrowAToken; 
30:     uint256 collateralSplitLiquidatorPercent; 
31:     uint256 collateralSplitProtocolPercent; 
32:     uint256 collateralTokenCap; 
33:     uint256 borrowATokenCap; 
34:     uint256 debtTokenCap; 
35:     uint256 moveToVariablePoolHFThreshold; 
36:     uint256 minimumMaturity; 
37: }
38: 
39: struct Oracle {
40:     IPriceFeed priceFeed; 
41:     IMarketBorrowRateFeed marketBorrowRateFeed; 
42: }
43: 
44: struct Data {
45:     mapping(address => User) users; 
46:     mapping(address => bool) variablePoolAllowlisted; 
47:     mapping(uint256 => DebtPosition) debtPositions; 
48:     mapping(uint256 => CreditPosition) creditPositions; 
49:     uint256 nextDebtPositionId; 
50:     uint256 nextCreditPositionId; 
51:     IERC20Metadata underlyingCollateralToken; 
52:     IERC20Metadata underlyingBorrowToken; 
53:     NonTransferrableToken collateralToken; 
54:     IAToken borrowAToken; 
55:     IAToken collateralAToken; 
56:     NonTransferrableToken debtToken; 
57:     IPool variablePool; 
58:     Vault vaultImplementation; 
59: }
60: 
61: struct State {
62:     FeeConfig feeConfig;
63:     RiskConfig riskConfig;
64:     Oracle oracle;
65:     Data data;

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L5-L21)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {IAToken} from "@aave/interfaces/IAToken.sol"; // <= FOUND
6: import {IPool} from "@aave/interfaces/IPool.sol"; // <= FOUND
7: import {VariableDebtToken} from "@aave/protocol/tokenization/VariableDebtToken.sol"; // <= FOUND
8: 
9: import {DataTypes} from "@aave/protocol/libraries/types/DataTypes.sol"; // <= FOUND
10: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol"; // <= FOUND
11: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol"; // <= FOUND
12: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"; // <= FOUND
13: 
14: import {State} from "@src/SizeStorage.sol"; // <= FOUND
15: import {Errors} from "@src/libraries/Errors.sol"; // <= FOUND
16: import {CollateralLibrary} from "@src/libraries/fixed/CollateralLibrary.sol"; // <= FOUND
17: 
18: import {CreditPosition, DebtPosition, LoanLibrary} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND
19: 
20: import {UserLibrary} from "@src/libraries/fixed/UserLibrary.sol"; // <= FOUND
21: import {Vault} from "@src/proxy/Vault.sol"; // <= FOUND
22: 
25: library VariableLibrary {
26:     using SafeERC20 for IERC20Metadata;
27:     using CollateralLibrary for State;
28:     using LoanLibrary for State;
29:     using LoanLibrary for DebtPosition;
30:     using LoanLibrary for CreditPosition;
31:     using UserLibrary for State;
32: 
45:     function depositUnderlyingTokenToVariablePool(
46:         State storage state,
47:         IERC20Metadata underlyingToken,
48:         address from,
49:         address to,
50:         uint256 amount,
51:         bool variable,
52:         bool setUseReserveAsCollateral
53:     ) external {
54:         underlyingToken.safeTransferFrom(from, address(this), amount);
55: 
56:         Vault vaultTo = variable ? state.getVaultVariable(to) : state.getVaultFixed(to);
57: 
58:         underlyingToken.forceApprove(address(state.data.variablePool), amount);
59:         state.data.variablePool.supply(address(underlyingToken), amount, address(vaultTo), 0);
60: 
61:         
62:         if (setUseReserveAsCollateral) {
63:             
64:             vaultTo.proxy(
65:                 address(state.data.variablePool),
66:                 abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(underlyingToken), true))
67:             );
68:         }
69:     }
70: 
80:     function withdrawUnderlyingTokenFromVariablePool(
81:         State storage state,
82:         IAToken aToken,
83:         address from,
84:         address to,
85:         uint256 amount,
86:         bool variable
87:     ) external {
88:         if (aTokenBalanceOf(state, aToken, from, variable) < amount) {
89:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
90:                 address(aToken), from, variable, aTokenBalanceOf(state, aToken, from, variable), amount
91:             );
92:         }
93: 

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L5-L9)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {OwnableUpgradeable} from "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol"; // <= FOUND
6: import {Initializable} from "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol"; // <= FOUND
7: import {Address} from "@openzeppelin/contracts/utils/Address.sol"; // <= FOUND
8: 
9: import {Errors} from "@src/libraries/Errors.sol"; // <= FOUND
10: 
15: contract Vault is Initializable, OwnableUpgradeable {
16:     
17:     constructor() {
18:         _disableInitializers();
19:     }
20: 
21:     function initialize(address owner) external initializer {
22:         __Ownable_init(owner);
23:     }
24: 
25:     function proxy(address target, bytes memory data) public onlyOwner returns (bytes memory returnData) {
26:         if (target == address(0)) {
27:             revert Errors.NULL_ADDRESS();
28:         }
29:         bool success;
30:         (success, returnData) = address(target).call(data);
31:         Address.verifyCallResult(success, returnData);
32:     }
33: 
34:     function proxy(address target, bytes memory data, uint256 value)
35:         public
36:         onlyOwner
37:         returns (bytes memory returnData)
38:     {
39:         if (target == address(0)) {
40:             revert Errors.NULL_ADDRESS();
41:         }
42:         bool success;
43:         (success, returnData) = address(target).call{value: value}(data);
44:         Address.verifyCallResult(success, returnData);
45:     }
46: 
47:     function proxy(address[] memory targets, bytes[] memory datas)
48:         public
49:         onlyOwner
50:         returns (bytes[] memory returnDatas)
51:     {
52:         if (targets.length != datas.length) {
53:             revert Errors.ARRAY_LENGTHS_MISMATCH();
54:         }
55: 
56:         returnDatas = new bytes[](datas.length);
57:         bool success;
58:         for (uint256 i = 0; i < targets.length; i++) {
59:             if (targets[i] == address(0)) {
60:                 revert Errors.NULL_ADDRESS();
61:             }
62:             

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L5-L8)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {SafeCast} from "@openzeppelin/contracts/utils/math/SafeCast.sol"; // <= FOUND
6: import {Errors} from "@src/libraries/Errors.sol"; // <= FOUND
7: import {Math, PERCENT} from "@src/libraries/Math.sol"; // <= FOUND
8: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol"; // <= FOUND
9: 
10: struct YieldCurve {
11:     uint256[] maturities;
12:     int256[] aprs;
13:     uint256[] marketRateMultipliers;
14: }
15: 
22: library YieldCurveLibrary {
23:     function isNull(YieldCurve memory self) internal pure returns (bool) {
24:         return self.maturities.length == 0 && self.aprs.length == 0 && self.marketRateMultipliers.length == 0;
25:     }
26: 
27:     function validateYieldCurve(YieldCurve memory self, uint256 minimumMaturity) internal pure {
28:         if (self.maturities.length == 0 || self.aprs.length == 0 || self.marketRateMultipliers.length == 0) {
29:             revert Errors.NULL_ARRAY();
30:         }
31:         if (self.maturities.length != self.aprs.length || self.maturities.length != self.marketRateMultipliers.length) {
32:             revert Errors.ARRAY_LENGTHS_MISMATCH();
33:         }
34: 
35:         
36:         
37: 
38:         
39:         uint256 lastMaturity = type(uint256).max;
40:         for (uint256 i = self.maturities.length; i > 0; i--) {
41:             if (self.maturities[i - 1] > lastMaturity) {
42:                 revert Errors.MATURITIES_NOT_STRICTLY_INCREASING();
43:             }
44:             lastMaturity = self.maturities[i - 1];
45:         }
46:         if (self.maturities[0] < minimumMaturity) {
47:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(self.maturities[0], minimumMaturity);
48:         }
49: 
50:         
51:         
52:     }
53: 
63:     function getRatePerMaturityByDueDate(
64:         uint256 maturity,
65:         int256 apr,
66:         uint256 marketRateMultiplier,
67:         IMarketBorrowRateFeed marketBorrowRateFeed
68:     ) internal view returns (uint256) {
69:         
70: 
71:         int256 ratePerMaturity = Math.linearAPRToRatePerMaturity(apr, maturity);
72: 

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L5-L21)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {IAToken} from "@aave/interfaces/IAToken.sol"; // <= FOUND
6: import {IPool} from "@aave/interfaces/IPool.sol"; // <= FOUND
7: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol"; // <= FOUND
8: 
9: import {PERCENT} from "@src/libraries/Math.sol"; // <= FOUND
10: import {CREDIT_POSITION_ID_START, DEBT_POSITION_ID_START} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND
11: 
12: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol"; // <= FOUND
13: import {IPriceFeed} from "@src/oracle/IPriceFeed.sol"; // <= FOUND
14: import {NonTransferrableToken} from "@src/token/NonTransferrableToken.sol"; // <= FOUND
15: 
16: import {Vault} from "@src/proxy/Vault.sol"; // <= FOUND
17: 
18: import {State} from "@src/SizeStorage.sol"; // <= FOUND
19: 
20: import {Errors} from "@src/libraries/Errors.sol"; // <= FOUND
21: import {Events} from "@src/libraries/Events.sol"; // <= FOUND
22: 
23: struct InitializeFeeConfigParams {
24:     uint256 repayFeeAPR;
25:     uint256 earlyLenderExitFee;
26:     uint256 earlyBorrowerExitFee;
27:     uint256 collateralOverdueTransferFee;
28:     address feeRecipient;
29: }
30: 
31: struct InitializeRiskConfigParams {
32:     uint256 crOpening;
33:     uint256 crLiquidation;
34:     uint256 minimumCreditBorrowAToken;
35:     uint256 collateralSplitLiquidatorPercent;
36:     uint256 collateralSplitProtocolPercent;
37:     uint256 collateralTokenCap;
38:     uint256 borrowATokenCap;
39:     uint256 debtTokenCap;
40:     uint256 moveToVariablePoolHFThreshold;
41:     uint256 minimumMaturity;
42: }
43: 
44: struct InitializeOracleParams {
45:     address priceFeed;
46:     address marketBorrowRateFeed;
47: }
48: 
49: struct InitializeDataParams {
50:     address underlyingCollateralToken;
51:     address underlyingBorrowToken;
52:     address variablePool;
53: }
54: 
59: library Initialize {
60:     function validateOwner(address owner) internal pure {
61:         if (owner == address(0)) {
62:             revert Errors.NULL_ADDRESS();
63:         }
64:     }
65: 
66:     function validateInitializeFeeConfigParams(InitializeFeeConfigParams memory f) internal pure {
67:         
68:         
69: 
70:         
71:         
72: 
73:         
74:         

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L5-L9)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {IAaveOracle} from "@aave/interfaces/IAaveOracle.sol"; // <= FOUND
6: import {Math} from "@src/libraries/Math.sol"; // <= FOUND
7: 
8: import {IPriceFeed} from "./IPriceFeed.sol"; // <= FOUND
9: import {Errors} from "@src/libraries/Errors.sol"; // <= FOUND
10: 
18: contract VariablePoolPriceFeed is IPriceFeed {
19:     
20:     IAaveOracle public immutable aaveOracle;
21:     address public immutable base;
22:     uint8 public immutable baseDecimals;
23:     address public immutable quote;
24:     uint8 public immutable quoteDecimals;
25:     uint8 public immutable decimals;
26:     
28:     constructor(
29:         address _aaveOracle,
30:         address _base,
31:         uint8 _baseDecimals,
32:         address _quote,
33:         uint8 _quoteDecimals,
34:         uint8 _decimals
35:     ) {
36:         if (_aaveOracle == address(0) || _base == address(0) || _quote == address(0)) {
37:             revert Errors.NULL_ADDRESS();
38:         }
39: 
40:         if (_decimals == 0 || _decimals > 18) {
41:             revert Errors.INVALID_DECIMALS(_decimals);
42:         }
43: 
44:         if (_baseDecimals == 0 || _baseDecimals > 18 || _quoteDecimals == 0 || _quoteDecimals > 18) {
45:             revert Errors.INVALID_DECIMALS(_baseDecimals);
46:         }
47: 
48:         aaveOracle = IAaveOracle(_aaveOracle);
49:         base = _base;
50:         baseDecimals = _baseDecimals;
51:         quote = _quote;
52:         quoteDecimals = _quoteDecimals;
53:         decimals = _decimals;
54:     }
55: 
56:     function getPrice() external view returns (uint256) {
57:         uint256 basePrice = aaveOracle.getAssetPrice(base);
58:         uint256 quotePrice = aaveOracle.getAssetPrice(quote);
59:         return Math.mulDivDown(
60:             _scalePrice(basePrice, baseDecimals, decimals),
61:             10 ** decimals,
62:             _scalePrice(quotePrice, quoteDecimals, decimals)
63:         );
64:     }
65: 
66:     function _scalePrice(uint256 _price, uint8 _priceDecimals, uint8 _decimals) internal pure returns (uint256) {

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L5-L13)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {State} from "@src/SizeStorage.sol"; // <= FOUND
6: import {Errors} from "@src/libraries/Errors.sol"; // <= FOUND
7: import {Events} from "@src/libraries/Events.sol"; // <= FOUND
8: import {Initialize} from "@src/libraries/general/actions/Initialize.sol"; // <= FOUND
9: 
10: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol"; // <= FOUND
11: import {IPriceFeed} from "@src/oracle/IPriceFeed.sol"; // <= FOUND
12: 
13: import { // <= FOUND
14:     InitializeDataParams,
15:     InitializeFeeConfigParams,
16:     InitializeOracleParams,
17:     InitializeRiskConfigParams
18: } from "@src/libraries/general/actions/Initialize.sol";
19: 
20: struct UpdateConfigParams {
21:     bytes32 key;
22:     uint256 value;
23: }
24: 
30: library UpdateConfig {
31:     using Initialize for State;
32: 
33:     function feeConfigParams(State storage state) public view returns (InitializeFeeConfigParams memory) {
34:         return InitializeFeeConfigParams({
35:             repayFeeAPR: state.feeConfig.repayFeeAPR,
36:             earlyLenderExitFee: state.feeConfig.earlyLenderExitFee,
37:             earlyBorrowerExitFee: state.feeConfig.earlyBorrowerExitFee,
38:             collateralOverdueTransferFee: state.feeConfig.collateralOverdueTransferFee,
39:             feeRecipient: state.feeConfig.feeRecipient
40:         });
41:     }
42: 
43:     function riskConfigParams(State storage state) public view returns (InitializeRiskConfigParams memory) {
44:         return InitializeRiskConfigParams({
45:             crOpening: state.riskConfig.crOpening,
46:             crLiquidation: state.riskConfig.crLiquidation,
47:             minimumCreditBorrowAToken: state.riskConfig.minimumCreditBorrowAToken,
48:             collateralSplitLiquidatorPercent: state.riskConfig.collateralSplitLiquidatorPercent,
49:             collateralSplitProtocolPercent: state.riskConfig.collateralSplitProtocolPercent,
50:             collateralTokenCap: state.riskConfig.collateralTokenCap,
51:             borrowATokenCap: state.riskConfig.borrowATokenCap,
52:             debtTokenCap: state.riskConfig.debtTokenCap,
53:             moveToVariablePoolHFThreshold: state.riskConfig.moveToVariablePoolHFThreshold,
54:             minimumMaturity: state.riskConfig.minimumMaturity
55:         });
56:     }
57: 
58:     function oracleParams(State storage state) public view returns (InitializeOracleParams memory) {
59:         return InitializeOracleParams({
60:             priceFeed: address(state.oracle.priceFeed),
61:             marketBorrowRateFeed: address(state.oracle.marketBorrowRateFeed)
62:         });
63:     }
64: 
65:     function dataParams(State storage state) public view returns (InitializeDataParams memory) {
66:         return InitializeDataParams({
67:             underlyingCollateralToken: address(state.data.underlyingCollateralToken),

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L5-L53)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {AccessControlUpgradeable} from "@openzeppelin/contracts-upgradeable/access/AccessControlUpgradeable.sol"; // <= FOUND
6: 
7: import {Initializable} from "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol"; // <= FOUND
8: import {UUPSUpgradeable} from "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol"; // <= FOUND
9: import {MulticallUpgradeable} from "@openzeppelin/contracts-upgradeable/utils/MulticallUpgradeable.sol"; // <= FOUND
10: import {PausableUpgradeable} from "@openzeppelin/contracts-upgradeable/utils/PausableUpgradeable.sol"; // <= FOUND
11: 
12: import { // <= FOUND
13:     Initialize,
14:     InitializeDataParams,
15:     InitializeFeeConfigParams,
16:     InitializeOracleParams,
17:     InitializeRiskConfigParams
18: } from "@src/libraries/general/actions/Initialize.sol";
19: import {UpdateConfig, UpdateConfigParams} from "@src/libraries/general/actions/UpdateConfig.sol"; // <= FOUND
20: 
21: import {BorrowAsLimitOrder, BorrowAsLimitOrderParams} from "@src/libraries/fixed/actions/BorrowAsLimitOrder.sol"; // <= FOUND
22: import {BorrowAsMarketOrder, BorrowAsMarketOrderParams} from "@src/libraries/fixed/actions/BorrowAsMarketOrder.sol"; // <= FOUND
23: 
24: import {BorrowerExit, BorrowerExitParams} from "@src/libraries/fixed/actions/BorrowerExit.sol"; // <= FOUND
25: import {Claim, ClaimParams} from "@src/libraries/fixed/actions/Claim.sol"; // <= FOUND
26: import {Deposit, DepositParams} from "@src/libraries/general/actions/Deposit.sol"; // <= FOUND
27: 
28: import {LendAsLimitOrder, LendAsLimitOrderParams} from "@src/libraries/fixed/actions/LendAsLimitOrder.sol"; // <= FOUND
29: import {LendAsMarketOrder, LendAsMarketOrderParams} from "@src/libraries/fixed/actions/LendAsMarketOrder.sol"; // <= FOUND
30: import {Liquidate, LiquidateParams} from "@src/libraries/fixed/actions/Liquidate.sol"; // <= FOUND
31: 
32: import {Compensate, CompensateParams} from "@src/libraries/fixed/actions/Compensate.sol"; // <= FOUND
33: import { // <= FOUND
34:     LiquidateWithReplacement,
35:     LiquidateWithReplacementParams
36: } from "@src/libraries/fixed/actions/LiquidateWithReplacement.sol";
37: import {Repay, RepayParams} from "@src/libraries/fixed/actions/Repay.sol"; // <= FOUND
38: import {SelfLiquidate, SelfLiquidateParams} from "@src/libraries/fixed/actions/SelfLiquidate.sol"; // <= FOUND
39: import {Withdraw, WithdrawParams} from "@src/libraries/general/actions/Withdraw.sol"; // <= FOUND
40: 
41: import {State} from "@src/SizeStorage.sol"; // <= FOUND
42: 
43: import {CapsLibrary} from "@src/libraries/fixed/CapsLibrary.sol"; // <= FOUND
44: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol"; // <= FOUND
45: 
46: import {BorrowVariable, BorrowVariableParams} from "@src/libraries/variable/actions/BorrowVariable.sol"; // <= FOUND
47: 
48: import {LiquidateVariable, LiquidateVariableParams} from "@src/libraries/variable/actions/LiquidateVariable.sol"; // <= FOUND
49: import {RepayVariable, RepayVariableParams} from "@src/libraries/variable/actions/RepayVariable.sol"; // <= FOUND
50: 
51: import {SizeView} from "@src/SizeView.sol"; // <= FOUND
52: 
53: import {ISize} from "@src/interfaces/ISize.sol"; // <= FOUND
54: 
57: contract Size is
58:     ISize,
59:     SizeView,
60:     Initializable,
61:     AccessControlUpgradeable,
62:     PausableUpgradeable,
63:     MulticallUpgradeable,
64:     UUPSUpgradeable
65: {
66:     
67:     using Initialize for State;
68:     using UpdateConfig for State;
69:     using Deposit for State;
70:     using Withdraw for State;
71:     using BorrowAsMarketOrder for State;
72:     using BorrowAsLimitOrder for State;
73:     using LendAsMarketOrder for State;
74:     using LendAsLimitOrder for State;
75:     using BorrowerExit for State;
76:     using Repay for State;
77:     using Claim for State;
78:     using Liquidate for State;
79:     using SelfLiquidate for State;
80:     using LiquidateWithReplacement for State;
81:     using Compensate for State;
82:     using RiskLibrary for State;
83:     using CapsLibrary for State;
84:     using BorrowVariable for State;
85:     using RepayVariable for State;
86:     using LiquidateVariable for State;
87: 
88:     bytes32 public constant KEEPER_ROLE = "KEEPER_ROLE";
89:     bytes32 public constant PAUSER_ROLE = "PAUSER_ROLE";
90: 
92:     constructor() {
93:         _disableInitializers();
94:     }
95: 
96:     function initialize(
97:         address owner,
98:         InitializeFeeConfigParams calldata f,
99:         InitializeRiskConfigParams calldata r,
100:         InitializeOracleParams calldata o,
101:         InitializeDataParams calldata d
102:     ) external initializer {
103:         state.validateInitialize(owner, f, r, o, d);
104: 
105:         __AccessControl_init();

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L5-L13)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {State} from "@src/SizeStorage.sol"; // <= FOUND
6: 
7: import {IAToken} from "@aave/interfaces/IAToken.sol"; // <= FOUND
8: import {Math} from "@src/libraries/Math.sol"; // <= FOUND
9: import {CollateralLibrary} from "@src/libraries/fixed/CollateralLibrary.sol"; // <= FOUND
10: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol"; // <= FOUND
11: 
12: import {Errors} from "@src/libraries/Errors.sol"; // <= FOUND
13: import {Events} from "@src/libraries/Events.sol"; // <= FOUND
14: 
15: struct WithdrawParams {
16:     address token;
17:     uint256 amount;
18:     bool variable;
19:     address to;
20: }
21: 
22: library Withdraw {
23:     using VariableLibrary for State;
24:     using CollateralLibrary for State;
25: 
26:     function validateWithdraw(State storage state, WithdrawParams calldata params) external view {
27:         
28:         
29: 
30:         
31:         if (
32:             params.token != address(state.data.underlyingCollateralToken)
33:                 && params.token != address(state.data.underlyingBorrowToken)
34:         ) {
35:             revert Errors.INVALID_TOKEN(params.token);
36:         }
37: 
38:         
39:         if (params.amount == 0) {
40:             revert Errors.NULL_AMOUNT();
41:         }
42: 
43:         
44:         if (params.to == address(0)) {
45:             revert Errors.NULL_ADDRESS();
46:         }
47: 
48:         
49:         
50:     }
51: 
52:     function executeWithdraw(State storage state, WithdrawParams calldata params) public {
53:         uint256 amount;
54:         if (params.variable || params.token == address(state.data.underlyingBorrowToken)) {
55:             IAToken aToken = params.token == address(state.data.underlyingBorrowToken)
56:                 ? state.data.borrowAToken
57:                 : state.data.collateralAToken;
58: 
59:             amount = Math.min(params.amount, state.aTokenBalanceOf(aToken, msg.sender, params.variable));
60:             if (amount > 0) {
61:                 state.withdrawUnderlyingTokenFromVariablePool(aToken, msg.sender, params.to, amount, params.variable);
62:             }

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L5-L6)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {YieldCurve, YieldCurveLibrary} from "@src/libraries/fixed/YieldCurveLibrary.sol"; // <= FOUND
6: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol"; // <= FOUND
7: 
8: struct LoanOffer {
9:     uint256 maxDueDate;
10:     YieldCurve curveRelativeTime;
11: }
12: 
13: struct BorrowOffer {
14:     uint256 openingLimitBorrowCR;
15:     YieldCurve curveRelativeTime;
16: }
17: 
19: library OfferLibrary {
20:     using YieldCurveLibrary for YieldCurve;
21: 
22:     function isNull(LoanOffer memory self) internal pure returns (bool) {
23:         return self.maxDueDate == 0 && self.curveRelativeTime.isNull();
24:     }
25: 
26:     function isNull(BorrowOffer memory self) internal pure returns (bool) {
27:         return self.openingLimitBorrowCR == 0 && self.curveRelativeTime.isNull();
28:     }
29: 
30:     function getRatePerMaturityByDueDate(
31:         LoanOffer memory self,
32:         IMarketBorrowRateFeed marketBorrowRateFeed,
33:         uint256 dueDate
34:     ) internal view returns (uint256) {
35:         return YieldCurveLibrary.getRatePerMaturityByDueDate(self.curveRelativeTime, marketBorrowRateFeed, dueDate);
36:     }
37: 
38:     function getRatePerMaturityByDueDate(
39:         BorrowOffer memory self,
40:         IMarketBorrowRateFeed marketBorrowRateFeed,
41:         uint256 dueDate
42:     ) internal view returns (uint256) {
43:         return YieldCurveLibrary.getRatePerMaturityByDueDate(self.curveRelativeTime, marketBorrowRateFeed, dueDate);
44:     }
45: }
46: 

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L5-L35)']
```solidity
2: 
3: pragma solidity 0.8.23;
4: 
5: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol"; // <= FOUND
6: import {SizeStorage, State} from "@src/SizeStorage.sol"; // <= FOUND
7: import {Math, PERCENT} from "@src/libraries/Math.sol"; // <= FOUND
8: 
9: import { // <= FOUND
10:     CREDIT_POSITION_ID_START,
11:     CreditPosition,
12:     DEBT_POSITION_ID_START,
13:     DebtPosition,
14:     LoanLibrary,
15:     LoanStatus
16: } from "@src/libraries/fixed/LoanLibrary.sol";
17: import {UpdateConfig} from "@src/libraries/general/actions/UpdateConfig.sol"; // <= FOUND
18: 
19: import {IAToken} from "@aave/interfaces/IAToken.sol"; // <= FOUND
20: import {IPool} from "@aave/interfaces/IPool.sol"; // <= FOUND
21: import {NonTransferrableToken} from "@src/token/NonTransferrableToken.sol"; // <= FOUND
22: 
23: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol"; // <= FOUND
24: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol"; // <= FOUND
25: 
26: import {Errors} from "@src/libraries/Errors.sol"; // <= FOUND
27: import {BorrowOffer, LoanOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol"; // <= FOUND
28: import {User} from "@src/libraries/fixed/UserLibrary.sol"; // <= FOUND
29: import { // <= FOUND
30:     InitializeDataParams,
31:     InitializeFeeConfigParams,
32:     InitializeOracleParams,
33:     InitializeRiskConfigParams
34: } from "@src/libraries/general/actions/Initialize.sol";
35: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol"; // <= FOUND
36: 
37: struct UserView {
38:     User user;
39:     address account;
40:     uint256 collateralTokenBalanceFixed;
41:     uint256 collateralATokenBalanceVariable;
42:     uint256 borrowATokenBalanceFixed;
43:     uint256 borrowATokenBalanceVariable;
44:     uint256 debtBalanceFixed;
45:     uint256 debtBalanceVariable;
46: }
47: 
48: struct DataView {
49:     uint256 nextDebtPositionId;
50:     uint256 nextCreditPositionId;
51:     IERC20Metadata underlyingCollateralToken;
52:     IERC20Metadata underlyingBorrowToken;
53:     IPool variablePool;
54:     NonTransferrableToken collateralToken;
55:     IAToken collateralAToken;
56:     IAToken borrowAToken;
57:     NonTransferrableToken debtToken;
58: }
59: 
62: abstract contract SizeView is SizeStorage {
63:     using OfferLibrary for LoanOffer;
64:     using OfferLibrary for BorrowOffer;
65:     using LoanLibrary for DebtPosition;
66:     using LoanLibrary for CreditPosition;
67:     using LoanLibrary for State;
68:     using RiskLibrary for State;
69:     using VariableLibrary for State;
70:     using AccountingLibrary for State;
71:     using UpdateConfig for State;
72: 
73:     function collateralRatio(address user) external view returns (uint256) {
74:         return state.collateralRatio(user);
75:     }
76: 
77:     function isUserLiquidatable(address user) external view returns (bool) {
78:         return state.isUserLiquidatable(user);
79:     }
80: 
81:     function isDebtPositionLiquidatable(uint256 debtPositionId) external view returns (bool) {
82:         return state.isDebtPositionLiquidatable(debtPositionId);
83:     }
84: 
85:     function getDebt(uint256 debtPositionId) external view returns (uint256) {
86:         return state.getDebtPosition(debtPositionId).getDebt();

```


</details>

## [NonCritical-23] Upgradable contract constructor should have the initialize modifier

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L56-L101)']
```solidity
56: contract Size is
57:     ISize,
58:     SizeView,
91:     constructor() { // <= FOUND

101:     ) external initializer { // <= FOUND


```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L20)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable {
15:     
16:     constructor() { // <= FOUND
20:     function initialize(address owner) external initializer { // <= FOUND


```


</details>

## [NonCritical-24] A function which defines named returns in it's declaration doesn't need to use return

### Resolution 
Remove the return statement once ensuring it is safe to do so

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[70](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L70-L70)']
```solidity
68:     function getDebtPosition(State storage state, uint256 debtPositionId) public view returns (DebtPosition storage) {
69:         if (isDebtPositionId(state, debtPositionId)) {
70:             return state.data.debtPositions[debtPositionId]; // <= FOUND
71:         } else {
72:             revert Errors.INVALID_DEBT_POSITION_ID(debtPositionId);
73:         }
74:     }

```
['[82](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L82-L82)']
```solidity
76:     function getCreditPosition(State storage state, uint256 creditPositionId)
77:         public
78:         view
79:         returns (CreditPosition storage)
80:     {
81:         if (isCreditPositionId(state, creditPositionId)) {
82:             return state.data.creditPositions[creditPositionId]; // <= FOUND
83:         } else {
84:             revert Errors.INVALID_CREDIT_POSITION_ID(creditPositionId);
85:         }
86:     }

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L94-L94)']
```solidity
88:     function getDebtPositionByCreditPositionId(State storage state, uint256 creditPositionId)
89:         public
90:         view
91:         returns (DebtPosition storage)
92:     {
93:         CreditPosition memory creditPosition = getCreditPosition(state, creditPositionId);
94:         return getDebtPosition(state, creditPosition.debtPositionId); // <= FOUND
95:     }

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L62-L74)']
```solidity
57:     function binarySearch(uint256[] memory array, uint256 value) internal pure returns (uint256 low, uint256 high) {
58:         low = 0;
59:         high = array.length - 1;
60:         if (value < array[low] || value > array[high]) {
61:             
62:             return (type(uint256).max, type(uint256).max); // <= FOUND
63:         }
64:         while (low <= high) {
65:             uint256 mid = (low + high) / 2;
66:             if (array[mid] == value) {
67:                 return (mid, mid); // <= FOUND
68:             } else if (array[mid] < value) {
69:                 low = mid + 1;
70:             } else {
71:                 high = mid - 1;
72:             }
73:         }
74:         return (high, low); // <= FOUND
75:     }

```


</details>

## [NonCritical-25] Constants should be on the left side of the comparison

### Resolution 
Putting constants on the left side of a comparison operator like `==` or `<` is a best practice known as "Yoda conditions", which can help prevent accidental assignment instead of comparison. In some programming languages, if a variable is mistakenly put on the left with a single `=` instead of `==`, it assigns the constant's value to the variable without any compiler error. However, doing this with the constant on the left would generate an error, as constants cannot be assigned values. Although Solidity's static typing system prevents accidental assignments within conditionals, adopting this practice enhances code readability and consistency, especially when developers are working across multiple languages that support this convention.

Num of instances: 20

### Findings 


<details><summary>Click to show findings</summary>

['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L40-L40)']
```solidity
40:         if (params.amount == 0)  // <= FOUND

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L40-L40)']
```solidity
40:        if (params.amount == 0)  // <= FOUND

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L40-L40)']
```solidity
40:         if (params.amount == 0)  // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L34-L34)']
```solidity
34:         if (creditPosition.credit == 0)  // <= FOUND

```
['[99](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L99-L99)']
```solidity
99:         if (r.minimumCreditBorrowAToken == 0)  // <= FOUND

```
['[133](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L133-L133)']
```solidity
133:         if (r.minimumMaturity == 0)  // <= FOUND

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L32-L32)']
```solidity
32:             if (params.maxDueDate == 0)  // <= FOUND

```
['[113](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L113-L113)']
```solidity
113:         if (getDebt(debtPosition) == 0)  // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L21-L21)']
```solidity
21:        if (_staleRateInterval == 0)  // <= FOUND

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L40-L40)']
```solidity
40:         if (params.amount == 0)  // <= FOUND

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L39-L39)']
```solidity
39:         if (_decimals == 0 || _decimals > 18)  // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L43-L43)']
```solidity
43:         if (_baseDecimals == 0 || _baseDecimals > 18 || _quoteDecimals == 0 || _quoteDecimals > 18)  // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L27-L27)']
```solidity
27:        if (self.maturities.length == 0 || self.aprs.length == 0 || self.marketRateMultipliers.length == 0)  // <= FOUND

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L72-L72)']
```solidity
72:         if (marketRateMultiplier == 0)  // <= FOUND

```
['[144](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L144-L144)']
```solidity
144:             if (deltaAmountOut == 0)  // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L36-L36)']
```solidity
36:         if (debt > 0)  // <= FOUND

```
['[160](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L160-L160)']
```solidity
160:         if (debtPositionFaceValue > 0)  // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L36-L36)']
```solidity
36:         if (debt > 0)  // <= FOUND

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L59-L59)']
```solidity
59:             if (amount > 0)  // <= FOUND

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L59-L59)']
```solidity
59:            if (amount > 0)  // <= FOUND

```


</details>

## [NonCritical-26] Defined named returns not used within function 

### Resolution 
Such instances can be replaced with unnamed returns

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[68](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L68-L68)']
```solidity
68:     function getDebtPosition(State storage state, uint256 debtPositionId) public view returns (DebtPosition storage) { // <= FOUND
69:         if (isDebtPositionId(state, debtPositionId)) {
70:             return state.data.debtPositions[debtPositionId];
71:         } else {
72:             revert Errors.INVALID_DEBT_POSITION_ID(debtPositionId);
73:         }
74:     }

```
['[88](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L88-L91)']
```solidity
88:     function getDebtPositionByCreditPositionId(State storage state, uint256 creditPositionId) // <= FOUND
89:         public
90:         view
91:         returns (DebtPosition storage) // <= FOUND
92:     {
93:         CreditPosition memory creditPosition = getCreditPosition(state, creditPositionId);
94:         return getDebtPosition(state, creditPosition.debtPositionId);
95:     }

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L76-L79)']
```solidity
76:     function getCreditPosition(State storage state, uint256 creditPositionId) // <= FOUND
77:         public
78:         view
79:         returns (CreditPosition storage) // <= FOUND
80:     {
81:         if (isCreditPositionId(state, creditPositionId)) {
82:             return state.data.creditPositions[creditPositionId];
83:         } else {
84:             revert Errors.INVALID_CREDIT_POSITION_ID(creditPositionId);
85:         }
86:     }

```


</details>

## [NonCritical-27] Initialize functions do not emit an event

### Resolution 
Emitting an event within initializer functions in Solidity is a best practice for providing transparency and traceability. Initializer functions set the initial state and values of an upgradeable contract. Emitting an event during initialization allows anyone to verify and audit the initial state of the contract via the transaction logs. This can be particularly useful for verifying the parameters set during initialization, tracking the contract's deployment, and troubleshooting or debugging. Therefore, developers should include an event emission in their initializer functions, providing a clear record of the contract's initialization and enhancing the contract's transparency and security.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L95-L95)']
```solidity
95:     function initialize( // <= FOUND
96:         address owner,
97:         InitializeFeeConfigParams calldata f,
98:         InitializeRiskConfigParams calldata r,
99:         InitializeOracleParams calldata o,
100:         InitializeDataParams calldata d
101:     ) external initializer {
102:         state.validateInitialize(owner, f, r, o, d);
103: 
104:         __AccessControl_init();
105:         __Pausable_init();
106:         __Multicall_init();
107:         __UUPSUpgradeable_init();
108: 
109:         state.executeInitialize(f, r, o, d);
110:         _grantRole(DEFAULT_ADMIN_ROLE, owner);
111:         _grantRole(PAUSER_ROLE, owner);
112:         _grantRole(KEEPER_ROLE, owner);
113:     }

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L20-L20)']
```solidity
20:     function initialize(address owner) external initializer { // <= FOUND
21:         __Ownable_init(owner);
22:     }

```


</details>

## [NonCritical-28] Both immutable and constant state variables should be CONSTANT_CASE

### Resolution 
Make found instants CAPITAL_CASE

Num of instances: 7

### Findings 


<details><summary>Click to show findings</summary>

['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L13-L13)']
```solidity
13: uint8 internal immutable _decimals; // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L19-L19)']
```solidity
19: IAaveOracle public immutable aaveOracle; // <= FOUND

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L20-L20)']
```solidity
20: address public immutable base; // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L21-L21)']
```solidity
21: uint8 public immutable baseDecimals; // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L23-L23)']
```solidity
23: uint8 public immutable quoteDecimals; // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L24-L24)']
```solidity
24: uint8 public immutable decimals; // <= FOUND

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L22-L22)']
```solidity
22: address public immutable quote; // <= FOUND

```


</details>

## [NonCritical-29] Overly complicated arithmetic

### Resolution 
To maintain readability in code, particularly in Solidity which can involve complex mathematical operations, it is often recommended to limit the number of arithmetic operations to a maximum of 2-3 per line. Too many operations in a single line can make the code difficult to read and understand, increase the likelihood of mistakes, and complicate the process of debugging and reviewing the code. Consider splitting such operations over more than one line, take special care when dealing with division however. Try to limit the number of arithmetic operations to a maximum of 3 per line.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[122](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L122-L122)']
```solidity
122:                     return y0 + Math.mulDivDown(y1 - y0, maturity - x0, x1 - x0); // <= FOUND

```
['[124](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L124-L124)']
```solidity
124:                     return y0 - Math.mulDivDown(y0 - y1, maturity - x0, x1 - x0); // <= FOUND

```


</details>

## [NonCritical-30] Use a single file for system wide constants

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[87](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L87-L88)']
```solidity
56: contract Size is
57:     ISize,
58:     SizeView,
87:     bytes32 public constant KEEPER_ROLE = "KEEPER_ROLE"; // <= FOUND

88:     bytes32 public constant PAUSER_ROLE = "PAUSER_ROLE"; // <= FOUND


```


</details>

## [NonCritical-31] Return values of transfer()/transferFrom() not checked

### Resolution 
In Solidity, it's crucial to check the return value of `.transfer` and `.transferFrom` methods because not all ERC20 and ERC721 token implementations revert on failure. Notably, If these methods fail silently and the contract doesn't verify their return value, the contract might continue execution as if the tokens were transferred successfully, leading to incorrect balances, loss of funds, or other unexpected behaviors. Therefore, the return values of these methods should always be checked, ensuring a failed token transfer operation correctly halts the execution of the contract.

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L48-L64)']
```solidity
48:     function chargeRepayFeeInCollateral(
49:         State storage state,
50:         DebtPosition storage debtPosition,
51:         uint256 repayAmount,
52:         bool isEarlyRepay
53:     ) public returns (uint256 repayFee) {
54:         repayFee = Math.mulDivDown(debtPosition.repayFee, repayAmount, debtPosition.faceValue);
55:         uint256 repayFeeCollateral;
56: 
57:         if (isEarlyRepay) {
58:             uint256 earlyRepayFee = debtPosition.earlyRepayFee();
59:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, earlyRepayFee);
60:         } else {
61:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, repayFee);
62:         }
63: 
64:         state.data.collateralToken.transferFrom(debtPosition.borrower, state.feeConfig.feeRecipient, repayFeeCollateral); // <= FOUND
65: 
66:         state.data.debtToken.burn(debtPosition.borrower, repayFee);
67:     }

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L15-L17)']
```solidity
15:     function depositUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) external { // <= FOUND
16:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
17:         underlyingCollateralToken.transferFrom(from, address(this), amount); // <= FOUND
18:         state.data.collateralToken.mint(to, amount);
19:     }

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L62-L95)']
```solidity
62:     function _executeLiquidateTakeCollateral(
63:         State storage state,
64:         DebtPosition memory debtPositionCopy,
65:         bool splitCollateralRemainder
66:     ) private returns (uint256 liquidatorProfitCollateralToken) {
67:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
68:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPositionCopy.faceValue);
69: 
70:         
71:         if (assignedCollateral > debtInCollateralToken) {
72:             liquidatorProfitCollateralToken = debtInCollateralToken;
73: 
74:             if (splitCollateralRemainder) {
75:                 
76:                 uint256 collateralRemainder = assignedCollateral - debtInCollateralToken;
77: 
78:                 uint256 collateralRemainderToLiquidator =
79:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitLiquidatorPercent, PERCENT);
80:                 uint256 collateralRemainderToProtocol =
81:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitProtocolPercent, PERCENT);
82: 
83:                 liquidatorProfitCollateralToken += collateralRemainderToLiquidator;
84:                 state.data.collateralToken.transferFrom( // <= FOUND
85:                     debtPositionCopy.borrower, state.feeConfig.feeRecipient, collateralRemainderToProtocol
86:                 );
87:             }
88:             
89:         } else {
90:             
91:             liquidatorProfitCollateralToken = assignedCollateral;
92:         }
93: 
94:         state.transferBorrowATokenFixed(msg.sender, address(this), debtPositionCopy.faceValue);
95:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken); // <= FOUND
96:     }

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L98-L112)']
```solidity
98:     function _executeLiquidateOverdue(
99:         State storage state,
100:         LiquidateParams calldata params,
101:         DebtPosition memory debtPositionCopy
102:     ) private returns (uint256 liquidatorProfitCollateralToken) {
103:         
104:         try state.moveDebtPositionToVariablePool(debtPositionCopy) returns (uint256 _liquidatorProfitCollateralToken) {
105:             emit Events.LiquidateOverdueMoveToVariablePool(params.debtPositionId);
106:             liquidatorProfitCollateralToken = _liquidatorProfitCollateralToken;
107:             
108:         } catch {
109:             emit Events.LiquidateOverdueNoSplitRemainder(params.debtPositionId);
110:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, false)
111:                 + state.feeConfig.collateralOverdueTransferFee;
112:             state.data.collateralToken.transferFrom( // <= FOUND
113:                 debtPositionCopy.borrower, msg.sender, state.feeConfig.collateralOverdueTransferFee
114:             );
115:         }
116:     }

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L52-L65)']
```solidity
52:     function executeSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external { // <= FOUND
53:         emit Events.SelfLiquidate(params.creditPositionId);
54: 
55:         CreditPosition storage creditPosition = state.data.creditPositions[params.creditPositionId];
56:         DebtPosition storage debtPosition = state.getDebtPositionByCreditPositionId(params.creditPositionId);
57: 
58:         uint256 credit = creditPosition.credit;
59:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, credit);
60:         uint256 assignedCollateral = state.getCreditPositionProRataAssignedCollateral(creditPosition);
61:         debtPosition.updateRepayFee(credit, repayFee);
62:         creditPosition.credit = 0;
63: 
64:         state.data.debtToken.burn(debtPosition.borrower, credit);
65:         state.data.collateralToken.transferFrom(debtPosition.borrower, msg.sender, assignedCollateral); // <= FOUND
66:     }

```
['[262](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L262-L270)']
```solidity
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken)
265:     {
266:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
267: 
268:         
269:         liquidatorProfitCollateralToken = state.feeConfig.collateralOverdueTransferFee;
270:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken); // <= FOUND
271: 
272:         address from = debtPositionCopy.borrower;
273:         address to = address(this);
274:         uint256 collateralBalance = assignedCollateral - liquidatorProfitCollateralToken;
275:         uint256 borrowATokenBalance = debtPositionCopy.faceValue;
276: 
277:         
278:         Vault vaultFrom = state.getVaultVariable(from);
279:         Vault vaultTo = state.getVaultFixed(to);
280: 
281:         
282:         state.withdrawUnderlyingCollateralToken(from, address(this), collateralBalance);
283: 
284:         
285:         state.data.underlyingCollateralToken.forceApprove(address(state.data.variablePool), collateralBalance);
286:         state.data.variablePool.supply(
287:             address(state.data.underlyingCollateralToken), collateralBalance, address(vaultFrom), 0
288:         );
289: 
290:         address[] memory targets = new address[](3);
291:         bytes[] memory data = new bytes[](3);
292: 
293:         
294:         targets[0] = address(state.data.variablePool);
295:         data[0] =
296:             abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(state.data.underlyingCollateralToken), true));
297: 
298:         
299:         targets[1] = address(state.data.variablePool);
300:         data[1] = abi.encodeCall(
301:             IPool.borrow,
302:             (
303:                 address(state.data.underlyingBorrowToken),
304:                 borrowATokenBalance,
305:                 uint256(DataTypes.InterestRateMode.VARIABLE),
306:                 0,
307:                 address(vaultFrom)
308:             )
309:         );
310: 
311:         
312:         targets[2] = address(state.data.underlyingBorrowToken);
313:         data[2] = abi.encodeCall(IERC20.transfer, (address(this), borrowATokenBalance));
314: 
315:         
316:         vaultFrom.proxy(targets, data);
317: 
318:         
319:         state.data.underlyingBorrowToken.forceApprove(address(state.data.variablePool), borrowATokenBalance);

```


</details>

## [NonCritical-32] Consider using modifiers for address control

### Resolution 
Modifiers in Solidity can improve code readability and modularity by encapsulating repetitive checks, such as address validity checks, into a reusable construct. For example, an `onlyOwner` modifier can be used to replace repetitive `require(msg.sender == owner)` checks across several functions, reducing code redundancy and enhancing maintainability. To implement, define a modifier with the check, then apply the modifier to relevant functions.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L41-L97)']
```solidity
41:     function validateBorrowAsMarketOrder(State storage state, BorrowAsMarketOrderParams memory params) external view { // <= FOUND
42:         User memory lenderUser = state.data.users[params.lender]; // <= FOUND
43:         LoanOffer memory loanOffer = lenderUser.loanOffer; // <= FOUND
44: 
45:          // <= FOUND
46:          // <= FOUND
47: 
48:          // <= FOUND
49:         if (loanOffer.isNull()) { // <= FOUND
50:             revert Errors.INVALID_LOAN_OFFER(params.lender); // <= FOUND
51:         } // <= FOUND
52: 
53:          // <= FOUND
54:         if (params.amount == 0) { // <= FOUND
55:             revert Errors.NULL_AMOUNT(); // <= FOUND
56:         } // <= FOUND
57: 
58:          // <= FOUND
59:         if (params.dueDate < block.timestamp) { // <= FOUND
60:             revert Errors.PAST_DUE_DATE(params.dueDate); // <= FOUND
61:         } // <= FOUND
62:         if (params.dueDate > loanOffer.maxDueDate) { // <= FOUND
63:             revert Errors.DUE_DATE_GREATER_THAN_MAX_DUE_DATE(params.dueDate, loanOffer.maxDueDate); // <= FOUND
64:         } // <= FOUND
65: 
66:          // <= FOUND
67:         if (params.deadline < block.timestamp) { // <= FOUND
68:             revert Errors.PAST_DEADLINE(params.deadline); // <= FOUND
69:         } // <= FOUND
70: 
71:          // <= FOUND
72:         uint256 ratePerMaturity = // <= FOUND
73:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate); // <= FOUND
74:         uint256 maturity = params.dueDate - block.timestamp; // <= FOUND
75:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) > params.maxAPR) { // <= FOUND
76:             revert Errors.APR_GREATER_THAN_MAX_APR( // <= FOUND
77:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.maxAPR // <= FOUND
78:             ); // <= FOUND
79:         } // <= FOUND
80: 
81:          // <= FOUND
82:          // <= FOUND
83: 
84:          // <= FOUND
85:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) { // <= FOUND
86:             uint256 creditPositionId = params.receivableCreditPositionIds[i]; // <= FOUND
87: 
88:             CreditPosition memory creditPosition = state.getCreditPosition(creditPositionId); // <= FOUND
89:             DebtPosition memory debtPosition = state.getDebtPositionByCreditPositionId(creditPositionId); // <= FOUND
90: 
91:             if (msg.sender != creditPosition.lender) { // <= FOUND
92:                 revert Errors.BORROWER_IS_NOT_LENDER(msg.sender, creditPosition.lender); // <= FOUND
93:             } // <= FOUND
94:             if (params.dueDate < debtPosition.dueDate) { // <= FOUND
95:                 revert Errors.DUE_DATE_LOWER_THAN_DEBT_POSITION_DUE_DATE(params.dueDate, debtPosition.dueDate); // <= FOUND
96:             } // <= FOUND
97:         } // <= FOUND
98:     }

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L34-L81)']
```solidity
34:     function validateBorrowerExit(State storage state, BorrowerExitParams calldata params) external view { // <= FOUND
35:         BorrowOffer memory borrowOffer = state.data.users[params.borrowerToExitTo].borrowOffer; // <= FOUND
36:         DebtPosition memory debtPosition = state.getDebtPosition(params.debtPositionId); // <= FOUND
37: 
38:          // <= FOUND
39:         uint256 dueDate = debtPosition.dueDate; // <= FOUND
40:         if (dueDate < block.timestamp) { // <= FOUND
41:             revert Errors.PAST_DUE_DATE(debtPosition.dueDate); // <= FOUND
42:         } // <= FOUND
43:         uint256 maturity = dueDate - block.timestamp; // <= FOUND
44:         if (maturity < state.riskConfig.minimumMaturity) { // <= FOUND
45:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity); // <= FOUND
46:         } // <= FOUND
47: 
48:         uint256 ratePerMaturity = borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, dueDate); // <= FOUND
49:         uint256 issuanceValue = Math.mulDivUp(debtPosition.faceValue, PERCENT, PERCENT + ratePerMaturity); // <= FOUND
50: 
51:          // <= FOUND
52:         if (msg.sender != debtPosition.borrower) { // <= FOUND
53:             revert Errors.EXITER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower); // <= FOUND
54:         } // <= FOUND
55:         if ( // <= FOUND
56:             state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false) // <= FOUND
57:                 < issuanceValue + state.feeConfig.earlyBorrowerExitFee // <= FOUND
58:         ) { // <= FOUND
59:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
60:                 address(state.data.borrowAToken), // <= FOUND
61:                 msg.sender, // <= FOUND
62:                 false, // <= FOUND
63:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false), // <= FOUND
64:                 issuanceValue + state.feeConfig.earlyBorrowerExitFee // <= FOUND
65:             ); // <= FOUND
66:         } // <= FOUND
67: 
68:          // <= FOUND
69:         if (params.deadline < block.timestamp) { // <= FOUND
70:             revert Errors.PAST_DEADLINE(params.deadline); // <= FOUND
71:         } // <= FOUND
72: 
73:          // <= FOUND
74:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) { // <= FOUND
75:             revert Errors.APR_LOWER_THAN_MIN_APR( // <= FOUND
76:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR // <= FOUND
77:             ); // <= FOUND
78:         } // <= FOUND
79: 
80:          // <= FOUND
81:          // <= FOUND
82:     }

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L31-L75)']
```solidity
31:     function validateCompensate(State storage state, CompensateParams calldata params) external view { // <= FOUND
32:         CreditPosition storage creditPositionWithDebtToRepay = // <= FOUND
33:             state.getCreditPosition(params.creditPositionWithDebtToRepayId); // <= FOUND
34:         DebtPosition storage debtPositionToRepay = // <= FOUND
35:             state.getDebtPositionByCreditPositionId(params.creditPositionWithDebtToRepayId); // <= FOUND
36:         CreditPosition storage creditPositionToCompensate = state.getCreditPosition(params.creditPositionToCompensateId); // <= FOUND
37: 
38:         uint256 amountToCompensate = // <= FOUND
39:             Math.min(params.amount, creditPositionToCompensate.credit, debtPositionToRepay.faceValue); // <= FOUND
40: 
41:          // <= FOUND
42:         if (state.getLoanStatus(params.creditPositionWithDebtToRepayId) == LoanStatus.REPAID) { // <= FOUND
43:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionWithDebtToRepayId); // <= FOUND
44:         } // <= FOUND
45:         if (creditPositionWithDebtToRepay.credit < amountToCompensate) { // <= FOUND
46:             revert Errors.CREDIT_LOWER_THAN_AMOUNT_TO_COMPENSATE( // <= FOUND
47:                 creditPositionWithDebtToRepay.credit, amountToCompensate // <= FOUND
48:             ); // <= FOUND
49:         } // <= FOUND
50: 
51:          // <= FOUND
52:         if (state.getLoanStatus(params.creditPositionToCompensateId) == LoanStatus.REPAID) { // <= FOUND
53:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionToCompensateId); // <= FOUND
54:         } // <= FOUND
55:         if ( // <= FOUND
56:             debtPositionToRepay.dueDate // <= FOUND
57:                 < state.getDebtPositionByCreditPositionId(params.creditPositionToCompensateId).dueDate // <= FOUND
58:         ) { // <= FOUND
59:             revert Errors.DUE_DATE_NOT_COMPATIBLE( // <= FOUND
60:                 params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId // <= FOUND
61:             ); // <= FOUND
62:         } // <= FOUND
63:         if (creditPositionToCompensate.lender != debtPositionToRepay.borrower) { // <= FOUND
64:             revert Errors.INVALID_LENDER(creditPositionToCompensate.lender); // <= FOUND
65:         } // <= FOUND
66: 
67:          // <= FOUND
68:         if (msg.sender != debtPositionToRepay.borrower) { // <= FOUND
69:             revert Errors.COMPENSATOR_IS_NOT_BORROWER(msg.sender, debtPositionToRepay.borrower); // <= FOUND
70:         } // <= FOUND
71: 
72:          // <= FOUND
73:         if (params.amount == 0) { // <= FOUND
74:             revert Errors.NULL_AMOUNT(); // <= FOUND
75:         } // <= FOUND
76:     }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L25-L45)']
```solidity
25:     function validateRepay(State storage state, RepayParams calldata params) external view { // <= FOUND
26:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId); // <= FOUND
27: 
28:          // <= FOUND
29:         if (state.getLoanStatus(params.debtPositionId) == LoanStatus.REPAID) { // <= FOUND
30:             revert Errors.LOAN_ALREADY_REPAID(params.debtPositionId); // <= FOUND
31:         } // <= FOUND
32: 
33:          // <= FOUND
34:         if (msg.sender != debtPosition.borrower) { // <= FOUND
35:             revert Errors.REPAYER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower); // <= FOUND
36:         } // <= FOUND
37:         if (state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false) < debtPosition.faceValue) { // <= FOUND
38:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
39:                 address(state.data.borrowAToken), // <= FOUND
40:                 msg.sender, // <= FOUND
41:                 false, // <= FOUND
42:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false), // <= FOUND
43:                 debtPosition.faceValue // <= FOUND
44:             ); // <= FOUND
45:         } // <= FOUND
46:     }

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L27-L49)']
```solidity
27:     function validateSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external view { // <= FOUND
28:         CreditPosition storage creditPosition = state.getCreditPosition(params.creditPositionId); // <= FOUND
29:         DebtPosition storage debtPosition = state.getDebtPositionByCreditPositionId(params.creditPositionId); // <= FOUND
30: 
31:         uint256 assignedCollateral = state.getCreditPositionProRataAssignedCollateral(creditPosition); // <= FOUND
32:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPosition.faceValue); // <= FOUND
33: 
34:          // <= FOUND
35:         if (!state.isCreditPositionSelfLiquidatable(params.creditPositionId)) { // <= FOUND
36:             revert Errors.LOAN_NOT_SELF_LIQUIDATABLE( // <= FOUND
37:                 params.creditPositionId, // <= FOUND
38:                 state.collateralRatio(debtPosition.borrower), // <= FOUND
39:                 state.getLoanStatus(params.creditPositionId) // <= FOUND
40:             ); // <= FOUND
41:         } // <= FOUND
42:         if (!(assignedCollateral < debtInCollateralToken)) { // <= FOUND
43:             revert Errors.LIQUIDATION_NOT_AT_LOSS(params.creditPositionId, assignedCollateral, debtInCollateralToken); // <= FOUND
44:         } // <= FOUND
45: 
46:          // <= FOUND
47:         if (msg.sender != creditPosition.lender) { // <= FOUND
48:             revert Errors.LIQUIDATOR_IS_NOT_LENDER(msg.sender, creditPosition.lender); // <= FOUND
49:         } // <= FOUND
50:     }

```


</details>

## [NonCritical-33] Off-by-one timestamp error

### Resolution 
In Solidity, using `>=` or `<=` to compare against `block.timestamp` (alias `now`) may introduce off-by-one errors due to the fact that `block.timestamp` is only updated once per block and its value remains constant throughout the block's execution. If an operation happens at the exact second when `block.timestamp` changes, it could result in unexpected behavior. To avoid this, it's safer to use strict inequality operators (`>` or `<`). For instance, if a condition should only be met after a certain time, use `block.timestamp > time` rather than `block.timestamp >= time`. This way, potential off-by-one errors due to the exact timing of block mining are mitigated, leading to safer, more predictable contract behavior.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L101-L115)']
```solidity
101:     function getLoanStatus(State storage state, uint256 positionId) public view returns (LoanStatus) { // <= FOUND
102:         
103:         DebtPosition memory debtPosition = state.data.debtPositions[positionId];
104:         if (isCreditPositionId(state, positionId)) {
105:             
106:             debtPosition = getDebtPositionByCreditPositionId(state, positionId);
107:         } else if (!isDebtPositionId(state, positionId)) {
108:             
109:             revert Errors.INVALID_POSITION_ID(positionId);
110:         }
111: 
112:         
113:         if (getDebt(debtPosition) == 0) {
114:             return LoanStatus.REPAID; // <= FOUND
115:         } else if (block.timestamp >= debtPosition.dueDate) { // <= FOUND
116:             return LoanStatus.OVERDUE;
117:         } else {
118:             return LoanStatus.ACTIVE;
119:         }
120:     }

```


</details>

## [NonCritical-34] Address from parameter can cause issues

### Resolution 
In Solidity, accepting the 'from' address as a public/external function parameter in a non-view/pure function can potentially be misused by an attacker to perform operations on behalf of another user. If not properly checked, an attacker could call the function, pass another user's address as the 'from' parameter, and perform actions like transferring tokens on their behalf. To mitigate this, it's preferable to use 'msg.sender' which refers to the address of the caller of the current function, ensuring that actions are performed by the actual owner of an account or contract. This significantly reduces the risk of unauthorized actions.

Num of instances: 8

### Findings 


<details><summary>Click to show findings</summary>

['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L15-L15)']
```solidity
15:     function depositUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) external {
16:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
17:         underlyingCollateralToken.transferFrom(from, address(this), amount);
18:         state.data.collateralToken.mint(to, amount);
19:     }

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L21-L21)']
```solidity
21:     function withdrawUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount)
22:         external
23:     {
24:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
25:         state.data.collateralToken.burn(from, amount);
26:         underlyingCollateralToken.safeTransfer(to, amount);
27:     }

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L44-L44)']
```solidity
44:     function depositUnderlyingTokenToVariablePool(
45:         State storage state,
46:         IERC20Metadata underlyingToken,
47:         address from,
48:         address to,
49:         uint256 amount,
50:         bool variable,
51:         bool setUseReserveAsCollateral
52:     ) external {
53:         underlyingToken.safeTransferFrom(from, address(this), amount);
54: 
55:         Vault vaultTo = variable ? state.getVaultVariable(to) : state.getVaultFixed(to);
56: 
57:         underlyingToken.forceApprove(address(state.data.variablePool), amount);
58:         state.data.variablePool.supply(address(underlyingToken), amount, address(vaultTo), 0);
59: 
60:         
61:         if (setUseReserveAsCollateral) {
62:             
63:             vaultTo.proxy(
64:                 address(state.data.variablePool),
65:                 abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(underlyingToken), true))
66:             );
67:         }
68:     }

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L79-L79)']
```solidity
79:     function withdrawUnderlyingTokenFromVariablePool(
80:         State storage state,
81:         IAToken aToken,
82:         address from,
83:         address to,
84:         uint256 amount,
85:         bool variable
86:     ) external {
87:         if (aTokenBalanceOf(state, aToken, from, variable) < amount) {
88:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
89:                 address(aToken), from, variable, aTokenBalanceOf(state, aToken, from, variable), amount
90:             );
91:         }
92: 
93:         address underlyingToken = aToken.UNDERLYING_ASSET_ADDRESS();
94: 
95:         Vault vaultFrom = variable ? state.getVaultVariable(from) : state.getVaultFixed(from);
96: 
97:         
98:         vaultFrom.proxy(address(state.data.variablePool), abi.encodeCall(IPool.withdraw, (underlyingToken, amount, to)));
99:     }

```
['[106](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L106-L106)']
```solidity
106:     function borrowVariableLoan(State storage state, address from, address to, uint256 amount) external {
107:         IERC20Metadata underlyingBorrowToken = IERC20Metadata(state.data.underlyingBorrowToken);
108: 
109:         Vault vaultFrom = state.getVaultVariable(from);
110:         Vault vaultTo = state.getVaultVariable(to);
111: 
112:         address[] memory targets = new address[](2);
113:         bytes[] memory data = new bytes[](2);
114: 
115:         
116:         targets[0] = address(state.data.variablePool);
117:         data[0] = abi.encodeCall(
118:             IPool.borrow,
119:             (
120:                 address(underlyingBorrowToken),
121:                 amount,
122:                 uint256(DataTypes.InterestRateMode.VARIABLE),
123:                 0,
124:                 address(vaultFrom)
125:             )
126:         );
127: 
128:         
129:         targets[1] = address(state.data.underlyingBorrowToken);
130:         data[1] = abi.encodeCall(IERC20.transfer, (address(this), amount));
131: 
132:         
133:         vaultFrom.proxy(targets, data);
134: 
135:         
136:         underlyingBorrowToken.forceApprove(address(state.data.variablePool), amount);
137:         state.data.variablePool.supply(address(underlyingBorrowToken), amount, address(vaultTo), 0);
138:     }

```
['[144](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L144-L144)']
```solidity
144:     function repayVariableLoan(State storage state, address from, uint256 amount) external {
145:         
146:         Vault vaultFrom = state.getVaultVariable(from);
147: 
148:         
149:         vaultFrom.proxy(
150:             address(state.data.variablePool),
151:             abi.encodeCall(
152:                 IPool.repayWithATokens,
153:                 (address(state.data.underlyingBorrowToken), amount, uint256(DataTypes.InterestRateMode.VARIABLE))
154:             )
155:         );
156:     }

```
['[164](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L164-L164)']
```solidity
164:     function liquidateVariableLoan(State storage state, address from, address borrower, uint256 amount) external {
165:         
166:         Vault vaultFrom = state.getVaultVariable(from);
167:         Vault vaultTo = state.getVaultVariable(borrower);
168: 
169:         address[] memory targets = new address[](3);
170:         bytes[] memory data = new bytes[](3);
171: 
172:         
173:         targets[0] = address(state.data.variablePool);
174:         data[0] =
175:             abi.encodeCall(IPool.withdraw, (address(state.data.underlyingBorrowToken), amount, address(vaultFrom)));
176: 
177:         
178:         targets[1] = address(state.data.underlyingBorrowToken);
179:         data[1] = abi.encodeCall(IERC20.approve, (address(state.data.variablePool), amount));
180: 
181:         
182:         targets[2] = address(state.data.variablePool);
183:         data[2] = abi.encodeCall(
184:             IPool.liquidationCall,
185:             (
186:                 address(state.data.underlyingCollateralToken),
187:                 address(state.data.underlyingBorrowToken),
188:                 address(vaultTo),
189:                 amount,
190:                 true
191:             )
192:         );
193: 
194:         
195:         vaultFrom.proxy(targets, data);
196:     }

```
['[205](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L205-L205)']
```solidity
205:     function transferBorrowATokenFixed(State storage state, address from, address to, uint256 amount) public {
206:         IAToken borrowAToken = state.data.borrowAToken;
207:         if (aTokenBalanceOf(state, borrowAToken, from, false) < amount) {
208:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
209:                 address(borrowAToken), from, false, aTokenBalanceOf(state, borrowAToken, from, false), amount
210:             );
211:         }
212: 
213:         Vault vaultFrom = state.getVaultFixed(from);
214:         Vault vaultTo = state.getVaultFixed(to);
215: 
216:         
217:         vaultFrom.proxy(address(borrowAToken), abi.encodeCall(IERC20.transfer, (address(vaultTo), amount)));
218:     }

```


</details>

## [NonCritical-35] Use of non-named numeric constants

### Resolution 
Magic numbers should be avoided in Solidity code to enhance readability, maintainability, and reduce the likelihood of errors. Magic numbers are hard-coded values with no clear meaning or context, which can create confusion and make the code harder to understand for developers. Using well-defined constants or variables with descriptive names instead of magic numbers not only clarifies the purpose and significance of the value but also simplifies code updates and modifications.

Num of instances: 12

### Findings 


<details><summary>Click to show findings</summary>

['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L35-L36)']
```solidity
35:         collateralTokenAmount = Math.mulDivUp(
36:             debtTokenAmountWad, 10 ** state.oracle.priceFeed.decimals(), state.oracle.priceFeed.getPrice() // <= FOUND
37:         );

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L9-L9)']
```solidity
9:         return amount * 10 ** (18 - decimals); // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L14-L15)']
```solidity
14:         
15:         return wad / 10 ** (18 - decimals); // <= FOUND

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L39-L39)']
```solidity
39:         if (_decimals == 0 || _decimals > 18) { // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L43-L43)']
```solidity
43:         if (_baseDecimals == 0 || _baseDecimals > 18 || _quoteDecimals == 0 || _quoteDecimals > 18) { // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L58-L60)']
```solidity
58:         return Math.mulDivDown(
59:             _scalePrice(basePrice, baseDecimals, decimals),
60:             10 ** decimals, // <= FOUND
61:             _scalePrice(quotePrice, quoteDecimals, decimals)
62:         );

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L65-L65)']
```solidity
65:             uint256 mid = (low + high) / 2; // <= FOUND

```
['[180](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L180-L180)']
```solidity
180:         uint256 repayFeePercent = Math.mulDivUp(repayFeeAPR, interval, 365 days); // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L42-L42)']
```solidity
42:         return mulDiv(rate, 365 days, SafeCast.toInt256(maturity)); // <= FOUND

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L46-L46)']
```solidity
46:         return mulDivDown(rate, 365 days, maturity); // <= FOUND

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L50-L50)']
```solidity
50:         return mulDiv(rate, SafeCast.toInt256(maturity), 365 days); // <= FOUND

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L54-L54)']
```solidity
54:         return powWadWad(PERCENT + rate, mulDivDown(PERCENT, maturity, 365 days)) - PERCENT; // <= FOUND

```


</details>

## [NonCritical-36] Redundant else statement

Num of instances: 10

### Findings 


<details><summary>Click to show findings</summary>

['[68](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L68-L68)']
```solidity
68:     function getDebtPosition(State storage state, uint256 debtPositionId) public view returns (DebtPosition storage) { // <= FOUND
69:         if (isDebtPositionId(state, debtPositionId)) {
70:             return state.data.debtPositions[debtPositionId];
71:         } else {
72:             revert Errors.INVALID_DEBT_POSITION_ID(debtPositionId);
73:         }
74:     }

```
[]
```solidity
76:     function getCreditPosition(State storage state, uint256 creditPositionId)
77:         public
78:         view
79:         returns (CreditPosition storage)
80:     {
81:         if (isCreditPositionId(state, creditPositionId)) {
82:             return state.data.creditPositions[creditPositionId];
83:         } else {
84:             revert Errors.INVALID_CREDIT_POSITION_ID(creditPositionId);
85:         }
86:     }

```
['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L101-L101)']
```solidity
101:     function getLoanStatus(State storage state, uint256 positionId) public view returns (LoanStatus) { // <= FOUND
102:         
103:         DebtPosition memory debtPosition = state.data.debtPositions[positionId];
104:         if (isCreditPositionId(state, positionId)) {
105:             
106:             debtPosition = getDebtPositionByCreditPositionId(state, positionId);
107:         } else if (!isDebtPositionId(state, positionId)) {
108:             
109:             revert Errors.INVALID_POSITION_ID(positionId);
110:         }
111: 
112:         
113:         if (getDebt(debtPosition) == 0) {
114:             return LoanStatus.REPAID;
115:         } else if (block.timestamp >= debtPosition.dueDate) {
116:             return LoanStatus.OVERDUE;
117:         } else {
118:             return LoanStatus.ACTIVE;
119:         }
120:     }

```
[]
```solidity
128:     function getDebtPositionAssignedCollateral(State storage state, DebtPosition memory debtPosition)
129:         public
130:         view
131:         returns (uint256)
132:     {
133:         uint256 debt = state.data.debtToken.balanceOf(debtPosition.borrower);
134:         uint256 collateral = state.data.collateralToken.balanceOf(debtPosition.borrower);
135: 
136:         if (debt > 0) {
137:             return Math.mulDivDown(collateral, debtPosition.faceValue, debt);
138:         } else {
139:             return 0;
140:         }
141:     }

```
[]
```solidity
149:     function getCreditPositionProRataAssignedCollateral(State storage state, CreditPosition memory creditPosition)
150:         public
151:         view
152:         returns (uint256)
153:     {
154:         DebtPosition storage debtPosition = getDebtPosition(state, creditPosition.debtPositionId);
155: 
156:         uint256 creditPositionCredit = creditPosition.credit;
157:         uint256 debtPositionCollateral = getDebtPositionAssignedCollateral(state, debtPosition);
158:         uint256 debtPositionFaceValue = debtPosition.faceValue;
159: 
160:         if (debtPositionFaceValue > 0) {
161:             return Math.mulDivDown(debtPositionCollateral, creditPositionCredit, debtPositionFaceValue);
162:         } else {
163:             return 0;
164:         }
165:     }

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L57-L57)']
```solidity
57:     function binarySearch(uint256[] memory array, uint256 value) internal pure returns (uint256 low, uint256 high) { // <= FOUND
58:         low = 0;
59:         high = array.length - 1;
60:         if (value < array[low] || value > array[high]) {
61:             
62:             return (type(uint256).max, type(uint256).max);
63:         }
64:         while (low <= high) {
65:             uint256 mid = (low + high) / 2;
66:             if (array[mid] == value) {
67:                 return (mid, mid);
68:             } else if (array[mid] < value) {
69:                 low = mid + 1;
70:             } else {
71:                 high = mid - 1;
72:             }
73:         }
74:         return (high, low);
75:     }

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L30-L30)']
```solidity
30:     function collateralRatio(State storage state, address account) public view returns (uint256) { // <= FOUND
31:         uint256 collateral = state.data.collateralToken.balanceOf(account);
32:         uint256 debt = state.data.debtToken.balanceOf(account);
33:         uint256 debtWad = ConversionLibrary.amountToWad(debt, state.data.underlyingBorrowToken.decimals());
34:         uint256 price = state.oracle.priceFeed.getPrice();
35: 
36:         if (debt > 0) {
37:             return Math.mulDivDown(collateral, price, debtWad);
38:         } else {
39:             return type(uint256).max;
40:         }
41:     }

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L65-L65)']
```solidity
65:     function _scalePrice(uint256 _price, uint8 _priceDecimals, uint8 _decimals) internal pure returns (uint256) { // <= FOUND
66:         if (_priceDecimals < _decimals) {
67:             return _price * (10 ** uint256(_decimals - _priceDecimals));
68:         } else if (_priceDecimals > _decimals) {
69:             return _price / (10 ** uint256(_priceDecimals - _decimals));
70:         } else {
71:             return _price;
72:         }
73:     }

```
[]
```solidity
62:     function getRatePerMaturityByDueDate(
63:         uint256 maturity,
64:         int256 apr,
65:         uint256 marketRateMultiplier,
66:         IMarketBorrowRateFeed marketBorrowRateFeed
67:     ) internal view returns (uint256) {
68:         
69: 
70:         int256 ratePerMaturity = Math.linearAPRToRatePerMaturity(apr, maturity);
71: 
72:         if (marketRateMultiplier == 0) {
73:             return SafeCast.toUint256(ratePerMaturity);
74:         } else {
75:             uint128 marketRateCompound = marketBorrowRateFeed.getMarketBorrowRate();
76:             uint256 marketRateLinear = Math.compoundAPRToRatePerMaturity(marketRateCompound, maturity);
77:             return SafeCast.toUint256(
78:                 ratePerMaturity + SafeCast.toInt256(Math.mulDivDown(marketRateLinear, marketRateMultiplier, PERCENT))
79:             );
80:         }
81:     }

```
[]
```solidity
89:     function getRatePerMaturityByDueDate(
90:         YieldCurve memory curveRelativeTime,
91:         IMarketBorrowRateFeed marketBorrowRateFeed,
92:         uint256 dueDate
93:     ) external view returns (uint256) {
94:         
95:         if (dueDate < block.timestamp) revert Errors.PAST_DUE_DATE(dueDate);
96:         uint256 maturity = dueDate - block.timestamp;
97:         uint256 length = curveRelativeTime.maturities.length;
98:         if (maturity < curveRelativeTime.maturities[0] || maturity > curveRelativeTime.maturities[length - 1]) {
99:             revert Errors.MATURITY_OUT_OF_RANGE(
100:                 maturity, curveRelativeTime.maturities[0], curveRelativeTime.maturities[length - 1]
101:             );
102:         } else {
103:             (uint256 low, uint256 high) = Math.binarySearch(curveRelativeTime.maturities, maturity);
104:             uint256 x0 = curveRelativeTime.maturities[low];
105:             uint256 y0 = getRatePerMaturityByDueDate(
106:                 curveRelativeTime.maturities[low],
107:                 curveRelativeTime.aprs[low],
108:                 curveRelativeTime.marketRateMultipliers[low],
109:                 marketBorrowRateFeed
110:             );
111:             uint256 x1 = curveRelativeTime.maturities[high];
112:             uint256 y1 = getRatePerMaturityByDueDate(
113:                 curveRelativeTime.maturities[high],
114:                 curveRelativeTime.aprs[high],
115:                 curveRelativeTime.marketRateMultipliers[high],
116:                 marketBorrowRateFeed
117:             );
118: 
119:             
120:             if (x1 != x0) {
121:                 if (y1 >= y0) {
122:                     return y0 + Math.mulDivDown(y1 - y0, maturity - x0, x1 - x0);
123:                 } else {
124:                     return y0 - Math.mulDivDown(y0 - y1, maturity - x0, x1 - x0);
125:                 }
126:             } else {
127:                 return y0;
128:             }
129:         }
130:     }

```


</details>

## [NonCritical-37] Consider adding emergency-stop functionality

### Resolution 
In the event of a security breach or any unforeseen emergency, swiftly suspending all protocol operations becomes crucial. Having a mechanism in place to halt all functions collectively, instead of pausing individual contracts separately, substantially enhances the efficiency of mitigating ongoing attacks or vulnerabilities. This not only quickens the response time to potential threats but also reduces operational stress during these critical periods. Therefore, consider integrating a 'circuit breaker' or 'emergency stop' function into the smart contract system architecture. Such a feature would provide the capability to suspend the entire protocol instantly, which could prove invaluable during a time-sensitive crisis management situation.

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L12-L12)']
```solidity
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step 

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20 

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L17-L17)']
```solidity
17: contract VariablePoolPriceFeed is IPriceFeed 

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable 

```


</details>

## [NonCritical-38] Overridden function has no body

### Resolution 
In Ethereum Solidity, functions can be overridden, meaning a contract can change the behavior of a function inherited from a base contract. Sometimes, the overriding function might not have a body. This could be due to a variety of reasons. For instance, the overriding function could be setting up a default behavior (like failing with an error) that can be further overridden in derived contracts, or it could be providing an optional hook that's left empty unless certain specific conditions are met.

In such cases, it can be extremely helpful to future developers, auditors, and users of the contract if a NatSpec comment is added to describe the function's purpose and the reason why it does not have a body. NatSpec, short for Natural Specification, is a form of documentation standard in Ethereum used for expressing what a function does in a human-readable format.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[116](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L116-L116)']
```solidity
116:     function _authorizeUpgrade(address newImplementation) internal override onlyRole(DEFAULT_ADMIN_ROLE) {}

```


</details>

## [NonCritical-39] Empty bytes check is missing

### Resolution 
When developing smart contracts in Solidity, it's crucial to validate the inputs of your functions. This includes ensuring that the bytes parameters are not empty, especially when they represent crucial data such as addresses, identifiers, or raw data that the contract needs to process.

Missing empty bytes checks can lead to unexpected behaviour in your contract. For instance, certain operations might fail, produce incorrect results, or consume unnecessary gas when performed with empty bytes. Moreover, missing input validation can potentially expose your contract to malicious activity, including exploitation of unhandled edge cases.

To mitigate these issues, always validate that bytes parameters are not empty when the logic of your contract requires it.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L24-L24)']
```solidity
24:     function proxy(address target, bytes memory data) public onlyOwner returns (bytes memory returnData) {
25:         if (target == address(0)) {
26:             revert Errors.NULL_ADDRESS();
27:         }
28:         bool success;
29:         (success, returnData) = address(target).call(data);
30:         Address.verifyCallResult(success, returnData);
31:     }

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L33-L33)']
```solidity
33:     function proxy(address target, bytes memory data, uint256 value)
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData)
37:     {
38:         if (target == address(0)) {
39:             revert Errors.NULL_ADDRESS();
40:         }
41:         bool success;
42:         (success, returnData) = address(target).call{value: value}(data);
43:         Address.verifyCallResult(success, returnData);
44:     }

```


</details>

## [NonCritical-40] No equate comparison checks between to and from address parameters

### Resolution 
The function lacks a standard check: it does not validate if the 'to' and 'from' addresses are identical. This omission can lead to unintended outcomes if the same address is used in both parameters. To rectify this, we recommend implementing a comparison check at the beginning of the function. In the context of Solidity, the command `require(to != from, "To and From addresses can't be the same");` could be utilized. This addition will generate an error if the 'to' and 'from' addresses are the same, thereby fortifying the function's robustness and security.

Num of instances: 8

### Findings 


<details><summary>Click to show findings</summary>

['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L15-L15)']
```solidity
15:     function depositUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) external { // <= FOUND
16:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
17:         underlyingCollateralToken.transferFrom(from, address(this), amount);
18:         state.data.collateralToken.mint(to, amount);
19:     }

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L21-L21)']
```solidity
21:     function withdrawUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) // <= FOUND
22:         external
23:     {
24:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
25:         state.data.collateralToken.burn(from, amount);
26:         underlyingCollateralToken.safeTransfer(to, amount);
27:     }

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L31-L31)']
```solidity
31:     function transferFrom(address from, address to, uint256 value) public virtual override onlyOwner returns (bool) { // <= FOUND
32:         _transfer(from, to, value);
33:         return true;
34:     }

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L44-L48)']
```solidity
44:     function depositUnderlyingTokenToVariablePool(
45:         State storage state,
46:         IERC20Metadata underlyingToken,
47:         address from, // <= FOUND
48:         address to, // <= FOUND
49:         uint256 amount,
50:         bool variable,
51:         bool setUseReserveAsCollateral
52:     ) external {
53:         underlyingToken.safeTransferFrom(from, address(this), amount);
54: 
55:         Vault vaultTo = variable ? state.getVaultVariable(to) : state.getVaultFixed(to);
56: 
57:         underlyingToken.forceApprove(address(state.data.variablePool), amount);
58:         state.data.variablePool.supply(address(underlyingToken), amount, address(vaultTo), 0);
59: 
60:         
61:         if (setUseReserveAsCollateral) {
62:             
63:             vaultTo.proxy(
64:                 address(state.data.variablePool),
65:                 abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(underlyingToken), true))
66:             );
67:         }
68:     }

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L79-L83)']
```solidity
79:     function withdrawUnderlyingTokenFromVariablePool(
80:         State storage state,
81:         IAToken aToken,
82:         address from, // <= FOUND
83:         address to, // <= FOUND
84:         uint256 amount,
85:         bool variable
86:     ) external {
87:         if (aTokenBalanceOf(state, aToken, from, variable) < amount) {
88:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
89:                 address(aToken), from, variable, aTokenBalanceOf(state, aToken, from, variable), amount
90:             );
91:         }
92: 
93:         address underlyingToken = aToken.UNDERLYING_ASSET_ADDRESS();
94: 
95:         Vault vaultFrom = variable ? state.getVaultVariable(from) : state.getVaultFixed(from);
96: 
97:         
98:         vaultFrom.proxy(address(state.data.variablePool), abi.encodeCall(IPool.withdraw, (underlyingToken, amount, to)));
99:     }

```
['[106](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L106-L106)']
```solidity
106:     function borrowVariableLoan(State storage state, address from, address to, uint256 amount) external { // <= FOUND
107:         IERC20Metadata underlyingBorrowToken = IERC20Metadata(state.data.underlyingBorrowToken);
108: 
109:         Vault vaultFrom = state.getVaultVariable(from);
110:         Vault vaultTo = state.getVaultVariable(to);
111: 
112:         address[] memory targets = new address[](2);
113:         bytes[] memory data = new bytes[](2);
114: 
115:         
116:         targets[0] = address(state.data.variablePool);
117:         data[0] = abi.encodeCall(
118:             IPool.borrow,
119:             (
120:                 address(underlyingBorrowToken),
121:                 amount,
122:                 uint256(DataTypes.InterestRateMode.VARIABLE),
123:                 0,
124:                 address(vaultFrom)
125:             )
126:         );
127: 
128:         
129:         targets[1] = address(state.data.underlyingBorrowToken);
130:         data[1] = abi.encodeCall(IERC20.transfer, (address(this), amount));
131: 
132:         
133:         vaultFrom.proxy(targets, data);
134: 
135:         
136:         underlyingBorrowToken.forceApprove(address(state.data.variablePool), amount);
137:         state.data.variablePool.supply(address(underlyingBorrowToken), amount, address(vaultTo), 0);
138:     }

```
['[205](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L205-L205)']
```solidity
205:     function transferBorrowATokenFixed(State storage state, address from, address to, uint256 amount) public { // <= FOUND
206:         IAToken borrowAToken = state.data.borrowAToken;
207:         if (aTokenBalanceOf(state, borrowAToken, from, false) < amount) {
208:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
209:                 address(borrowAToken), from, false, aTokenBalanceOf(state, borrowAToken, from, false), amount
210:             );
211:         }
212: 
213:         Vault vaultFrom = state.getVaultFixed(from);
214:         Vault vaultTo = state.getVaultFixed(to);
215: 
216:         
217:         vaultFrom.proxy(address(borrowAToken), abi.encodeCall(IERC20.transfer, (address(vaultTo), amount)));
218:     }

```
['[262](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L262-L273)']
```solidity
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken)
265:     {
266:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
267: 
268:         
269:         liquidatorProfitCollateralToken = state.feeConfig.collateralOverdueTransferFee;
270:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken);
271: 
272:         address from = debtPositionCopy.borrower; // <= FOUND
273:         address to = address(this); // <= FOUND
274:         uint256 collateralBalance = assignedCollateral - liquidatorProfitCollateralToken;
275:         uint256 borrowATokenBalance = debtPositionCopy.faceValue;
276: 
277:         
278:         Vault vaultFrom = state.getVaultVariable(from);
279:         Vault vaultTo = state.getVaultFixed(to);
280: 
281:         
282:         state.withdrawUnderlyingCollateralToken(from, address(this), collateralBalance);
283: 
284:         
285:         state.data.underlyingCollateralToken.forceApprove(address(state.data.variablePool), collateralBalance);
286:         state.data.variablePool.supply(
287:             address(state.data.underlyingCollateralToken), collateralBalance, address(vaultFrom), 0
288:         );
289: 
290:         address[] memory targets = new address[](3);
291:         bytes[] memory data = new bytes[](3);
292: 
293:         
294:         targets[0] = address(state.data.variablePool);
295:         data[0] =
296:             abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(state.data.underlyingCollateralToken), true));
297: 
298:         
299:         targets[1] = address(state.data.variablePool);
300:         data[1] = abi.encodeCall(
301:             IPool.borrow,
302:             (
303:                 address(state.data.underlyingBorrowToken),
304:                 borrowATokenBalance,
305:                 uint256(DataTypes.InterestRateMode.VARIABLE),
306:                 0,
307:                 address(vaultFrom)
308:             )
309:         );
310: 
311:         
312:         targets[2] = address(state.data.underlyingBorrowToken);
313:         data[2] = abi.encodeCall(IERC20.transfer, (address(this), borrowATokenBalance));
314: 
315:         
316:         vaultFrom.proxy(targets, data);
317: 
318:         
319:         state.data.underlyingBorrowToken.forceApprove(address(state.data.variablePool), borrowATokenBalance);
320:         state.data.variablePool.supply(
321:             address(state.data.underlyingBorrowToken), borrowATokenBalance, address(vaultTo), 0
322:         );

```


</details>

## [NonCritical-41] Consider using uint48 for time-related variables

### Resolution 
Solidity variables often default to `uint256`, but when dealing with time-related values, `uint48` is usually sufficient. In Solidity, `block.timestamp` (alias for `now`) is a `uint256` that holds a Unix timestamp, the number of seconds since 1970. However, a `uint48` can hold values up to the year 10889 AD. Using `uint48` instead of `uint256` can save significant gas as it uses less storage and computation, making the contract more efficient without sacrificing functionality or security.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[174](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L174-L180)']
```solidity
174:     function repayFee(uint256 issuanceValue, uint256 startDate, uint256 dueDate, uint256 repayFeeAPR)
175:         internal
176:         pure
177:         returns (uint256)
178:     {
179:         uint256 interval = dueDate - startDate; // <= FOUND
180:         uint256 repayFeePercent = Math.mulDivUp(repayFeeAPR, interval, 365 days); // <= FOUND
181:         uint256 fee = Math.mulDivUp(issuanceValue, repayFeePercent, PERCENT);
182:         return fee;
183:     }

```


</details>

## [NonCritical-42] Return bool not explicit

### Resolution 
In Solidity, when designing functions that return boolean values, it's crucial for clarity and maintainability to explicitly handle both `true` and `false` return scenarios. If a function is intended to return `true` under certain conditions, it should also explicitly return `false` when these conditions are not met, and vice versa. This approach eliminates ambiguity and makes the code's intent more transparent. Explicitly handling all possible outcomes of a boolean function ensures that future modifications or extensions of the contract do not unintentionally alter its logic. It contributes to better readability, easier debugging, and reduces the risk of bugs related to unintended fall-through cases.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L31-L33)']
```solidity
31:     function transferFrom(address from, address to, uint256 value) public virtual override onlyOwner returns (bool) {
32:         _transfer(from, to, value);
33:         return true; // <= FOUND
34:     }

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L36-L38)']
```solidity
36:     function transfer(address to, uint256 value) public virtual override onlyOwner returns (bool) {
37:         _transfer(msg.sender, to, value);
38:         return true; // <= FOUND
39:     }

```


</details>

## [NonCritical-43] Remove unnecessary solhint-disable

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L15-L15)']
```solidity
15:     // solhint-disable-next-line no-empty-blocks // <= FOUND

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L13-L13)']
```solidity
13: // solhint-disable var-name-mixedcase // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L18-L18)']
```solidity
18:     /* solhint-disable immutable-vars-naming */ // <= FOUND

```


</details>

## [NonCritical-44] Consider using SMTChecker

### Resolution 
The SMTChecker is a valuable tool for Solidity developers as it helps detect potential vulnerabilities and logical errors in the contract's code. By utilizing Satisfiability Modulo Theories (SMT) solvers, it can reason about the potential states a contract can be in, and therefore, identify conditions that could lead to undesirable behavior. This automatic formal verification can catch issues that might otherwise be missed in manual code reviews or standard testing, enhancing the overall contract's security and reliability.

Num of instances: 41

### Findings 


<details><summary>Click to show findings</summary>

['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol";
5: import {ERC20} from "@openzeppelin/contracts/token/ERC20/ERC20.sol";
6: 
7: import {Errors} from "@src/libraries/Errors.sol";
8: 
9: /// @title NonTransferrableToken
10: /// @notice An ERC-20 that is not transferrable from outside of the protocol
11: /// @dev The contract owner (e.g. the Size contract) can still mint, burn, and transfer tokens
12: contract NonTransferrableToken is Ownable, ERC20 {
13:     uint8 internal immutable _decimals;
14: 
15:     // solhint-disable-next-line no-empty-blocks
16:     constructor(address owner_, string memory name_, string memory symbol_, uint8 decimals_)
17:         Ownable(owner_)
18:         ERC20(name_, symbol_)
19:     {
20:         _decimals = decimals_;
21:     }
22: 
23:     function mint(address to, uint256 amount) external virtual onlyOwner {
24:         _mint(to, amount);
25:     }
26: 
27:     function burn(address from, uint256 amount) external virtual onlyOwner {
28:         _burn(from, amount);
29:     }
30: 
31:     function transferFrom(address from, address to, uint256 value) public virtual override onlyOwner returns (bool) {
32:         _transfer(from, to, value);
33:         return true;
34:     }
35: 
36:     function transfer(address to, uint256 value) public virtual override onlyOwner returns (bool) {
37:         _transfer(msg.sender, to, value);
38:         return true;
39:     }
40: 
41:     function allowance(address, address spender) public view virtual override returns (uint256) {
42:         return spender == owner() ? type(uint256).max : 0;
43:     }
44: 
45:     function approve(address, uint256) public virtual override returns (bool) {
46:         revert Errors.NOT_SUPPORTED();
47:     }
48: 
49:     function decimals() public view virtual override returns (uint8) {
50:         return _decimals;
51:     }
52: }
53: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {PERCENT} from "@src/libraries/Math.sol";
5: 
6: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol";
7: 
8: import {CreditPosition, DebtPosition, LoanLibrary} from "@src/libraries/fixed/LoanLibrary.sol";
9: import {BorrowOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol";
10: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
11: 
12: import {Math} from "@src/libraries/Math.sol";
13: 
14: import {State} from "@src/SizeStorage.sol";
15: 
16: import {Errors} from "@src/libraries/Errors.sol";
17: import {Events} from "@src/libraries/Events.sol";
18: 
19: struct LendAsMarketOrderParams {
20:     address borrower;
21:     uint256 dueDate;
22:     uint256 amount;
23:     uint256 deadline;
24:     uint256 minAPR;
25:     bool exactAmountIn;
26: }
27: 
28: library LendAsMarketOrder {
29:     using OfferLibrary for BorrowOffer;
30:     using AccountingLibrary for State;
31:     using LoanLibrary for State;
32:     using LoanLibrary for DebtPosition;
33:     using LoanLibrary for CreditPosition;
34:     using VariableLibrary for State;
35:     using AccountingLibrary for State;
36: 
37:     function validateLendAsMarketOrder(State storage state, LendAsMarketOrderParams calldata params) external view {
38:         BorrowOffer memory borrowOffer = state.data.users[params.borrower].borrowOffer;
39: 
40:         // validate msg.sender
41:         // N/A
42: 
43:         // validate borrower
44:         if (borrowOffer.isNull()) {
45:             revert Errors.INVALID_BORROW_OFFER(params.borrower);
46:         }
47: 
48:         // validate dueDate
49:         if (params.dueDate < block.timestamp) {
50:             revert Errors.PAST_DUE_DATE(params.dueDate);
51:         }
52: 
53:         // validate amount
54:         uint256 ratePerMaturity =
55:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
56:         uint256 amountIn;
57:         if (params.exactAmountIn) {
58:             amountIn = params.amount;
59:         } else {
60:             amountIn = Math.mulDivUp(params.amount, PERCENT, PERCENT + ratePerMaturity);
61:         }
62:         if (state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false) < amountIn) {
63:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
64:                 address(state.data.borrowAToken),
65:                 msg.sender,
66:                 false,
67:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
68:                 amountIn
69:             );
70:         }
71: 
72:         // validate deadline
73:         if (params.deadline < block.timestamp) {
74:             revert Errors.PAST_DEADLINE(params.deadline);
75:         }
76: 
77:         // validate minAPR
78:         uint256 maturity = params.dueDate - block.timestamp;
79:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
80:             revert Errors.APR_LOWER_THAN_MIN_APR(
81:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
82:             );
83:         }
84: 
85:         // validate exactAmountIn
86:         // N/A
87:     }
88: 
89:     function executeLendAsMarketOrder(State storage state, LendAsMarketOrderParams memory params) external {
90:         emit Events.LendAsMarketOrder(params.borrower, params.dueDate, params.amount, params.exactAmountIn);
91: 
92:         BorrowOffer storage borrowOffer = state.data.users[params.borrower].borrowOffer;
93: 
94:         uint256 ratePerMaturity =
95:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
96:         uint256 issuanceValue;
97:         if (params.exactAmountIn) {
98:             issuanceValue = params.amount;
99:         } else {
100:             issuanceValue = Math.mulDivUp(params.amount, PERCENT, PERCENT + ratePerMaturity);
101:         }
102:         uint256 faceValue = Math.mulDivDown(issuanceValue, PERCENT + ratePerMaturity, PERCENT);
103: 
104:         // slither-disable-next-line unused-return
105:         (DebtPosition memory debtPosition,) = state.createDebtAndCreditPositions({
106:             lender: msg.sender,
107:             borrower: params.borrower,
108:             issuanceValue: issuanceValue,
109:             faceValue: faceValue,
110:             dueDate: params.dueDate
111:         });
112:         state.data.debtToken.mint(params.borrower, debtPosition.getDebt());
113:         state.transferBorrowATokenFixed(msg.sender, params.borrower, issuanceValue);
114:     }
115: }
116: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";
5: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
6: 
7: import {State} from "@src/SizeStorage.sol";
8: 
9: import {CollateralLibrary} from "@src/libraries/fixed/CollateralLibrary.sol";
10: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
11: 
12: import {Errors} from "@src/libraries/Errors.sol";
13: import {Events} from "@src/libraries/Events.sol";
14: 
15: struct DepositParams {
16:     address token;
17:     uint256 amount;
18:     bool variable;
19:     address to;
20: }
21: 
22: library Deposit {
23:     using SafeERC20 for IERC20Metadata;
24:     using VariableLibrary for State;
25:     using CollateralLibrary for State;
26: 
27:     function validateDeposit(State storage state, DepositParams calldata params) external view {
28:         // validte msg.sender
29:         // N/A
30: 
31:         // validate token
32:         if (
33:             params.token != address(state.data.underlyingCollateralToken)
34:                 && params.token != address(state.data.underlyingBorrowToken)
35:         ) {
36:             revert Errors.INVALID_TOKEN(params.token);
37:         }
38: 
39:         // validate amount
40:         if (params.amount == 0) {
41:             revert Errors.NULL_AMOUNT();
42:         }
43: 
44:         // validate to
45:         if (params.to == address(0)) {
46:             revert Errors.NULL_ADDRESS();
47:         }
48: 
49:         // validate variable
50:         // N/A
51:     }
52: 
53:     function executeDeposit(State storage state, DepositParams calldata params) public {
54:         if (params.variable || params.token == address(state.data.underlyingBorrowToken)) {
55:             bool setUseReserveAsCollateral = params.token == address(state.data.underlyingCollateralToken);
56: 
57:             state.depositUnderlyingTokenToVariablePool(
58:                 IERC20Metadata(params.token),
59:                 msg.sender,
60:                 params.to,
61:                 params.amount,
62:                 params.variable,
63:                 setUseReserveAsCollateral
64:             );
65:         } else {
66:             state.depositUnderlyingCollateralToken(msg.sender, params.to, params.amount);
67:         }
68: 
69:         emit Events.Deposit(params.token, params.to, params.variable, params.amount);
70:     }
71: }
72: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: 
6: import {ConversionLibrary} from "@src/libraries/ConversionLibrary.sol";
7: import {Errors} from "@src/libraries/Errors.sol";
8: 
9: import {Math} from "@src/libraries/Math.sol";
10: import {CreditPosition, DebtPosition, LoanLibrary, LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol";
11: 
12: /// @title RiskLibrary
13: library RiskLibrary {
14:     using LoanLibrary for State;
15:     using LoanLibrary for DebtPosition;
16:     using LoanLibrary for CreditPosition;
17: 
18:     function validateMinimumCredit(State storage state, uint256 credit) public view {
19:         if (0 < credit && credit < state.riskConfig.minimumCreditBorrowAToken) {
20:             revert Errors.CREDIT_LOWER_THAN_MINIMUM_CREDIT(credit, state.riskConfig.minimumCreditBorrowAToken);
21:         }
22:     }
23: 
24:     function validateMinimumCreditOpening(State storage state, uint256 credit) public view {
25:         if (credit < state.riskConfig.minimumCreditBorrowAToken) {
26:             revert Errors.CREDIT_LOWER_THAN_MINIMUM_CREDIT_OPENING(credit, state.riskConfig.minimumCreditBorrowAToken);
27:         }
28:     }
29: 
30:     function collateralRatio(State storage state, address account) public view returns (uint256) {
31:         uint256 collateral = state.data.collateralToken.balanceOf(account);
32:         uint256 debt = state.data.debtToken.balanceOf(account);
33:         uint256 debtWad = ConversionLibrary.amountToWad(debt, state.data.underlyingBorrowToken.decimals());
34:         uint256 price = state.oracle.priceFeed.getPrice();
35: 
36:         if (debt > 0) {
37:             return Math.mulDivDown(collateral, price, debtWad);
38:         } else {
39:             return type(uint256).max;
40:         }
41:     }
42: 
43:     function isCreditPositionSelfLiquidatable(State storage state, uint256 creditPositionId)
44:         public
45:         view
46:         returns (bool)
47:     {
48:         CreditPosition storage creditPosition = state.data.creditPositions[creditPositionId];
49:         DebtPosition storage debtPosition = state.data.debtPositions[creditPosition.debtPositionId];
50:         LoanStatus status = state.getLoanStatus(creditPositionId);
51:         // Only CreditPositions can be self liquidated
52:         return state.isCreditPositionId(creditPositionId)
53:             && (isUserLiquidatable(state, debtPosition.borrower) && status != LoanStatus.REPAID);
54:     }
55: 
56:     function isDebtPositionLiquidatable(State storage state, uint256 debtPositionId) public view returns (bool) {
57:         DebtPosition storage debtPosition = state.data.debtPositions[debtPositionId];
58:         LoanStatus status = state.getLoanStatus(debtPositionId);
59:         // only DebtPositions can be liquidated
60:         return state.isDebtPositionId(debtPositionId)
61:         // case 1: if the user is liquidatable, only ACTIVE/OVERDUE DebtPositions can be liquidated
62:         && (
63:             (isUserLiquidatable(state, debtPosition.borrower) && status != LoanStatus.REPAID)
64:             // case 2: overdue loans can always be liquidated regardless of the user's CR
65:             || status == LoanStatus.OVERDUE
66:         );
67:     }
68: 
69:     function isUserLiquidatable(State storage state, address account) public view returns (bool) {
70:         return collateralRatio(state, account) < state.riskConfig.crLiquidation;
71:     }
72: 
73:     function validateUserIsNotLiquidatable(State storage state, address account) external view {
74:         if (isUserLiquidatable(state, account)) {
75:             revert Errors.USER_IS_LIQUIDATABLE(account, collateralRatio(state, account));
76:         }
77:     }
78: 
79:     function validateUserIsNotBelowopeningLimitBorrowCR(State storage state, address account) external view {
80:         uint256 openingLimitBorrowCR = Math.max(
81:             state.riskConfig.crOpening,
82:             state.data.users[account].borrowOffer.openingLimitBorrowCR // 0 by default, or user-defined if BorrowAsLimitOrder has been placed
83:         );
84:         if (collateralRatio(state, account) < openingLimitBorrowCR) {
85:             revert Errors.CR_BELOW_OPENING_LIMIT_BORROW_CR(
86:                 account, collateralRatio(state, account), openingLimitBorrowCR
87:             );
88:         }
89:     }
90: }
91: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {IAToken} from "@aave/interfaces/IAToken.sol";
5: import {IPool} from "@aave/interfaces/IPool.sol";
6: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";
7: 
8: import {CreditPosition, DebtPosition} from "@src/libraries/fixed/LoanLibrary.sol";
9: 
10: import {User} from "@src/libraries/fixed/UserLibrary.sol";
11: import {Vault} from "@src/proxy/Vault.sol";
12: 
13: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol";
14: import {IPriceFeed} from "@src/oracle/IPriceFeed.sol";
15: import {NonTransferrableToken} from "@src/token/NonTransferrableToken.sol";
16: 
17: struct FeeConfig {
18:     uint256 repayFeeAPR; // annual percentage rate of the protocol repay fee
19:     uint256 earlyLenderExitFee; // fee for early lender exits
20:     uint256 earlyBorrowerExitFee; // fee for early borrower exits
21:     uint256 collateralOverdueTransferFee; // fee for converting overdue fixed-rate loans into the variable-rate loans
22:     address feeRecipient; // address to receive protocol fees
23: }
24: 
25: struct RiskConfig {
26:     uint256 crOpening; // minimum collateral ratio for opening a loan
27:     uint256 crLiquidation; // minimum collateral ratio for liquidation
28:     uint256 minimumCreditBorrowAToken; // minimum credit value of loans
29:     uint256 collateralSplitLiquidatorPercent; // percent of collateral remainder to be split with liquidator on profitable liquidations
30:     uint256 collateralSplitProtocolPercent; // percent of collateral to be split with protocol on profitable liquidations
31:     uint256 collateralTokenCap; // maximum amount of deposited collateral tokens
32:     uint256 borrowATokenCap; // maximum amount of deposited borrowed aTokens
33:     uint256 debtTokenCap; // maximum amount of minted debt tokens
34:     uint256 moveToVariablePoolHFThreshold; // health factor threshold for moving a loan to the variable pool
35:     uint256 minimumMaturity; // minimum maturity for a loan
36: }
37: 
38: struct Oracle {
39:     IPriceFeed priceFeed; // price feed oracle
40:     IMarketBorrowRateFeed marketBorrowRateFeed; // market borrow rate feed oracle
41: }
42: 
43: struct Data {
44:     mapping(address => User) users; // mapping of User structs
45:     mapping(address => bool) variablePoolAllowlisted; // mapping of addresses allowlisted to interact with the Variable Pool
46:     mapping(uint256 => DebtPosition) debtPositions; // mapping of DebtPosition structs
47:     mapping(uint256 => CreditPosition) creditPositions; // mapping of CreditPosition structs
48:     uint256 nextDebtPositionId; // next debt position id
49:     uint256 nextCreditPositionId; // next credit position id
50:     IERC20Metadata underlyingCollateralToken; // e.g. WETH
51:     IERC20Metadata underlyingBorrowToken; // e.g. USDC
52:     NonTransferrableToken collateralToken; // e.g. szWETH
53:     IAToken borrowAToken; // e.g. aszUSDC
54:     IAToken collateralAToken; // e.g. aszWETH
55:     NonTransferrableToken debtToken; // e.g. szDebt
56:     IPool variablePool; // Size Variable Pool (Aave v3 fork)
57:     Vault vaultImplementation; // Vault implementation
58: }
59: 
60: struct State {
61:     FeeConfig feeConfig;
62:     RiskConfig riskConfig;
63:     Oracle oracle;
64:     Data data;
65: }
66: 
67: /// @title SizeStorage
68: /// @notice Storage for the Size protocol
69: /// @dev WARNING: Changing the order of the variables or inner structs in this contract may break the storage layout
70: abstract contract SizeStorage {
71:     State internal state;
72: }
73: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: 
6: import {Errors} from "@src/libraries/Errors.sol";
7: import {Math, PERCENT} from "@src/libraries/Math.sol";
8: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol";
9: 
10: uint256 constant DEBT_POSITION_ID_START = 0;
11: uint256 constant CREDIT_POSITION_ID_START = type(uint256).max / 2;
12: uint256 constant RESERVED_ID = type(uint256).max;
13: 
14: struct DebtPosition {
15:     address lender;
16:     address borrower;
17:     uint256 issuanceValue; // updated on debt reduction
18:     uint256 faceValue; // updated on debt reduction
19:     uint256 repayFee; // updated on debt reduction
20:     uint256 startDate; // updated on borrower replacement
21:     uint256 dueDate;
22:     uint256 liquidityIndexAtRepayment; // set on full repayment
23: }
24: 
25: struct CreditPosition {
26:     address lender;
27:     uint256 credit;
28:     uint256 debtPositionId;
29: }
30: 
31: // When the loan is created, it is in ACTIVE status
32: // When maturity is reached, it is in OVERDUE status
33: // If the loan is not repaid and the CR is sufficient, it is moved to the Variable Pool,
34: //   otherwise it is eligible for liquidation but if the CR < 100% then it will remain in
35: //   the overdue state until the CR is > 100% or the lenders perform self liquidation
36: // When the loan is repaid either by the borrower or by the liquidator, it is in REPAID status
37: enum LoanStatus {
38:     ACTIVE, // not yet due
39:     OVERDUE, // eligible to liquidation
40:     REPAID // by borrower or liquidator
41: 
42: }
43: 
44: /// @title LoanLibrary
45: library LoanLibrary {
46:     using AccountingLibrary for State;
47: 
48:     function isDebtPositionId(State storage state, uint256 positionId) internal view returns (bool) {
49:         return positionId >= DEBT_POSITION_ID_START && positionId < state.data.nextDebtPositionId;
50:     }
51: 
52:     function isCreditPositionId(State storage state, uint256 positionId) internal view returns (bool) {
53:         return positionId >= CREDIT_POSITION_ID_START && positionId < state.data.nextCreditPositionId;
54:     }
55: 
56:     function getDebt(DebtPosition memory self) internal pure returns (uint256) {
57:         return self.faceValue + self.repayFee;
58:     }
59: 
60:     function getDebtPositionIdByCreditPositionId(State storage state, uint256 creditPositionId)
61:         public
62:         view
63:         returns (uint256)
64:     {
65:         return getCreditPosition(state, creditPositionId).debtPositionId;
66:     }
67: 
68:     function getDebtPosition(State storage state, uint256 debtPositionId) public view returns (DebtPosition storage) {
69:         if (isDebtPositionId(state, debtPositionId)) {
70:             return state.data.debtPositions[debtPositionId];
71:         } else {
72:             revert Errors.INVALID_DEBT_POSITION_ID(debtPositionId);
73:         }
74:     }
75: 
76:     function getCreditPosition(State storage state, uint256 creditPositionId)
77:         public
78:         view
79:         returns (CreditPosition storage)
80:     {
81:         if (isCreditPositionId(state, creditPositionId)) {
82:             return state.data.creditPositions[creditPositionId];
83:         } else {
84:             revert Errors.INVALID_CREDIT_POSITION_ID(creditPositionId);
85:         }
86:     }
87: 
88:     function getDebtPositionByCreditPositionId(State storage state, uint256 creditPositionId)
89:         public
90:         view
91:         returns (DebtPosition storage)
92:     {
93:         CreditPosition memory creditPosition = getCreditPosition(state, creditPositionId);
94:         return getDebtPosition(state, creditPosition.debtPositionId);
95:     }
96: 
97:     /// @notice Get the status of a loan
98:     /// @param state The state struct
99:     /// @param positionId The positionId (can be either a DebtPosition or a CreditPosition)
100:     /// @return The status of the loan
101:     function getLoanStatus(State storage state, uint256 positionId) public view returns (LoanStatus) {
102:         // assumes `positionId` is a debt position id
103:         DebtPosition memory debtPosition = state.data.debtPositions[positionId];
104:         if (isCreditPositionId(state, positionId)) {
105:             // if `positionId` is in reality a credit position id, updates the memory variable
106:             debtPosition = getDebtPositionByCreditPositionId(state, positionId);
107:         } else if (!isDebtPositionId(state, positionId)) {
108:             // if `positionId` is neither a debt position id nor a credit position id, reverts
109:             revert Errors.INVALID_POSITION_ID(positionId);
110:         }
111: 
112:         // slither-disable-next-line incorrect-equality
113:         if (getDebt(debtPosition) == 0) {
114:             return LoanStatus.REPAID;
115:         } else if (block.timestamp >= debtPosition.dueDate) {
116:             return LoanStatus.OVERDUE;
117:         } else {
118:             return LoanStatus.ACTIVE;
119:         }
120:     }
121: 
122:     /// @notice Get the amount of collateral assigned to a DebtPosition
123:     /// @dev Takes into account the total debt of the user, which includes the repayment fee
124:     ///      When used to calculate the amount of collateral on liquidations, the repayment fee must be excluded first from the user debt
125:     /// @param state The state struct
126:     /// @param debtPosition The DebtPosition
127:     /// @return The amount of collateral assigned to the DebtPosition
128:     function getDebtPositionAssignedCollateral(State storage state, DebtPosition memory debtPosition)
129:         public
130:         view
131:         returns (uint256)
132:     {
133:         uint256 debt = state.data.debtToken.balanceOf(debtPosition.borrower);
134:         uint256 collateral = state.data.collateralToken.balanceOf(debtPosition.borrower);
135: 
136:         if (debt > 0) {
137:             return Math.mulDivDown(collateral, debtPosition.faceValue, debt);
138:         } else {
139:             return 0;
140:         }
141:     }
142: 
143:     /// @notice Get the amount of collateral assigned to a CreditPosition, pro-rata to the DebtPosition's faceValue
144:     /// @dev Takes into account the total debt of the user, which includes the repayment fee
145:     ///      When used to calculate the amount of collateral on self liquidation, the repayment fee must be excluded first from the user debt
146:     /// @param state The state struct
147:     /// @param creditPosition The CreditPosition
148:     /// @return The amount of collateral assigned to the CreditPosition
149:     function getCreditPositionProRataAssignedCollateral(State storage state, CreditPosition memory creditPosition)
150:         public
151:         view
152:         returns (uint256)
153:     {
154:         DebtPosition storage debtPosition = getDebtPosition(state, creditPosition.debtPositionId);
155: 
156:         uint256 creditPositionCredit = creditPosition.credit;
157:         uint256 debtPositionCollateral = getDebtPositionAssignedCollateral(state, debtPosition);
158:         uint256 debtPositionFaceValue = debtPosition.faceValue;
159: 
160:         if (debtPositionFaceValue > 0) {
161:             return Math.mulDivDown(debtPositionCollateral, creditPositionCredit, debtPositionFaceValue);
162:         } else {
163:             return 0;
164:         }
165:     }
166: 
167:     function updateRepayFee(DebtPosition storage self, uint256 _repayAmount, uint256 _repayFee) external {
168:         uint256 r = Math.mulDivDown(PERCENT, self.faceValue, self.issuanceValue);
169:         self.faceValue -= _repayAmount;
170:         self.repayFee -= _repayFee;
171:         self.issuanceValue = Math.mulDivDown(self.faceValue, PERCENT, r);
172:     }
173: 
174:     function repayFee(uint256 issuanceValue, uint256 startDate, uint256 dueDate, uint256 repayFeeAPR)
175:         internal
176:         pure
177:         returns (uint256)
178:     {
179:         uint256 interval = dueDate - startDate;
180:         uint256 repayFeePercent = Math.mulDivUp(repayFeeAPR, interval, 365 days);
181:         uint256 fee = Math.mulDivUp(issuanceValue, repayFeePercent, PERCENT);
182:         return fee;
183:     }
184: 
185:     function earlyRepayFee(DebtPosition memory self) internal view returns (uint256) {
186:         uint256 elapsed = block.timestamp - self.startDate;
187:         uint256 maturity = self.dueDate - self.startDate;
188:         return Math.mulDivDown(self.repayFee, elapsed, maturity);
189:     }
190: }
191: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol";
5: 
6: /// @title Errors
7: library Errors {
8:     error USER_IS_LIQUIDATABLE(address account, uint256 cr);
9:     error NULL_ADDRESS();
10:     error NULL_AMOUNT();
11:     error NULL_MAX_DUE_DATE();
12:     error NULL_ARRAY();
13:     error NULL_OFFER();
14:     error MATURITIES_NOT_STRICTLY_INCREASING();
15:     error MATURITY_BELOW_MINIMUM_MATURITY(uint256 maturity, uint256 minimumMaturity);
16:     error ARRAY_LENGTHS_MISMATCH();
17:     error INVALID_TOKEN(address token);
18:     error INVALID_KEY(bytes32 key);
19:     error INVALID_COLLATERAL_RATIO(uint256 cr);
20:     error INVALID_COLLATERAL_PERCENTAGE_PREMIUM(uint256 percentage);
21:     error INVALID_COLLATERAL_PERCENTAGE_PREMIUM_SUM(uint256 sum);
22:     error INVALID_LIQUIDATION_COLLATERAL_RATIO(uint256 crOpening, uint256 crLiquidation);
23:     error PAST_DUE_DATE(uint256 dueDate);
24:     error PAST_DEADLINE(uint256 deadline);
25:     error PAST_MAX_DUE_DATE(uint256 maxDueDate);
26:     error APR_LOWER_THAN_MIN_APR(uint256 apr, uint256 minAPR);
27:     error APR_GREATER_THAN_MAX_APR(uint256 apr, uint256 maxAPR);
28:     error DUE_DATE_LOWER_THAN_DEBT_POSITION_DUE_DATE(uint256 dueDate, uint256 debtPositionDueDate);
29:     error DUE_DATE_NOT_COMPATIBLE(uint256 debtPositionIdToRepay, uint256 creditPositionIdToCompensate);
30:     error DUE_DATE_GREATER_THAN_MAX_DUE_DATE(uint256 dueDate, uint256 maxDueDate);
31:     error MATURITY_OUT_OF_RANGE(uint256 maturity, uint256 minMaturity, uint256 maxMaturity);
32:     error INVALID_POSITION_ID(uint256 positionId);
33:     error INVALID_DEBT_POSITION_ID(uint256 debtPositionId);
34:     error INVALID_CREDIT_POSITION_ID(uint256 creditPositionId);
35:     error INVALID_LENDER(address account);
36:     error INVALID_LOAN_OFFER(address lender);
37:     error INVALID_BORROW_OFFER(address borrower);
38: 
39:     error BORROWER_IS_NOT_LENDER(address borrower, address lender);
40:     error COMPENSATOR_IS_NOT_BORROWER(address compensator, address borrower);
41:     error LIQUIDATOR_IS_NOT_LENDER(address liquidator, address lender);
42:     error EXITER_IS_NOT_BORROWER(address exiter, address borrower);
43:     error REPAYER_IS_NOT_BORROWER(address repayer, address borrower);
44: 
45:     error NOT_ENOUGH_ATOKEN_BALANCE(address token, address account, bool variable, uint256 balance, uint256 required);
46:     error NOT_ENOUGH_BORROW_ATOKEN_LIQUIDITY(uint256 liquidity, uint256 required);
47:     error CREDIT_LOWER_THAN_MINIMUM_CREDIT(uint256 faceValue, uint256 minimumCreditBorrowAToken);
48:     error CREDIT_LOWER_THAN_MINIMUM_CREDIT_OPENING(uint256 faceValue, uint256 minimumCreditBorrowAToken);
49:     error CREDIT_LOWER_THAN_AMOUNT_TO_COMPENSATE(uint256 credit, uint256 amountToCompensate);
50: 
51:     error ONLY_DEBT_POSITION_CAN_BE_REPAID(uint256 positionId);
52:     error ONLY_DEBT_POSITION_CAN_BE_EXITED(uint256 positionId);
53:     error ONLY_DEBT_POSITION_CAN_BE_LIQUIDATED(uint256 positionId);
54:     error ONLY_CREDIT_POSITION_CAN_BE_CLAIMED(uint256 positionId);
55:     error ONLY_CREDIT_POSITION_CAN_BE_COMPENSATED(uint256 positionId);
56:     error ONLY_CREDIT_POSITION_CAN_BE_SELF_LIQUIDATED(uint256 positionId);
57: 
58:     error CREDIT_POSITION_ALREADY_CLAIMED(uint256 positionId);
59: 
60:     error LOAN_ALREADY_REPAID(uint256 positionId);
61:     error LOAN_NOT_REPAID(uint256 positionId);
62:     error LOAN_NOT_ACTIVE(uint256 positionId);
63: 
64:     error NOT_LIQUIDATABLE(address account);
65:     error LOAN_NOT_LIQUIDATABLE(uint256 debtPositionId, uint256 cr, LoanStatus status);
66:     error LOAN_NOT_SELF_LIQUIDATABLE(uint256 creditPositionId, uint256 cr, LoanStatus status);
67:     error LIQUIDATE_PROFIT_BELOW_MINIMUM_COLLATERAL_PROFIT(
68:         uint256 liquidatorProfitCollateralToken, uint256 minimumCollateralProfit
69:     );
70:     error CR_BELOW_OPENING_LIMIT_BORROW_CR(address account, uint256 collateralRatio, uint256 riskCollateralRatio);
71:     error LIQUIDATION_NOT_AT_LOSS(uint256 positionId, uint256 assignedCollateral, uint256 debtCollateral);
72: 
73:     error INVALID_DECIMALS(uint8 decimals);
74:     error INVALID_PRICE(address aggregator, int256 price);
75:     error STALE_PRICE(address aggregator, uint256 updatedAt);
76:     error NULL_STALE_PRICE();
77:     error NULL_STALE_RATE();
78:     error STALE_RATE(uint128 updatedAt);
79: 
80:     error INVALID_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(uint256 moveToVariablePoolHFThreshold);
81:     error HEALTH_FACTOR_BELOW_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(
82:         address account, uint256 healthFactor, uint256 moveToVariablePoolHFThreshold
83:     );
84: 
85:     error COLLATERAL_TOKEN_CAP_EXCEEDED(uint256 cap, uint256 amount);
86:     error BORROW_ATOKEN_CAP_EXCEEDED(uint256 cap, uint256 amount);
87:     error DEBT_TOKEN_CAP_EXCEEDED(uint256 cap, uint256 amount);
88: 
89:     error NOT_SUPPORTED();
90: }
91: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {LoanOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol";
5: import {YieldCurve, YieldCurveLibrary} from "@src/libraries/fixed/YieldCurveLibrary.sol";
6: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
7: 
8: import {State} from "@src/SizeStorage.sol";
9: 
10: import {Errors} from "@src/libraries/Errors.sol";
11: import {Events} from "@src/libraries/Events.sol";
12: 
13: struct LendAsLimitOrderParams {
14:     uint256 maxDueDate;
15:     YieldCurve curveRelativeTime;
16: }
17: 
18: library LendAsLimitOrder {
19:     using VariableLibrary for State;
20:     using OfferLibrary for LoanOffer;
21: 
22:     function validateLendAsLimitOrder(State storage state, LendAsLimitOrderParams calldata params) external view {
23:         LoanOffer memory loanOffer =
24:             LoanOffer({maxDueDate: params.maxDueDate, curveRelativeTime: params.curveRelativeTime});
25: 
26:         // a null offer mean clearning their limit orders
27:         if (!loanOffer.isNull()) {
28:             // validate msg.sender
29:             // N/A
30: 
31:             // validate maxDueDate
32:             if (params.maxDueDate == 0) {
33:                 revert Errors.NULL_MAX_DUE_DATE();
34:             }
35:             if (params.maxDueDate < block.timestamp) {
36:                 revert Errors.PAST_MAX_DUE_DATE(params.maxDueDate);
37:             }
38: 
39:             // validate params.curveRelativeTime
40:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity);
41:         }
42:     }
43: 
44:     function executeLendAsLimitOrder(State storage state, LendAsLimitOrderParams calldata params) external {
45:         state.data.users[msg.sender].loanOffer =
46:             LoanOffer({maxDueDate: params.maxDueDate, curveRelativeTime: params.curveRelativeTime});
47:         emit Events.LendAsLimitOrder(params.maxDueDate, params.curveRelativeTime);
48:     }
49: }
50: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: 
6: import {Math} from "@src/libraries/Math.sol";
7: 
8: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol";
9: 
10: import {Errors} from "@src/libraries/Errors.sol";
11: import {Events} from "@src/libraries/Events.sol";
12: import {CreditPosition, DebtPosition, LoanLibrary, LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol";
13: 
14: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol";
15: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
16: 
17: struct CompensateParams {
18:     uint256 creditPositionWithDebtToRepayId;
19:     uint256 creditPositionToCompensateId;
20:     uint256 amount;
21: }
22: 
23: library Compensate {
24:     using AccountingLibrary for State;
25:     using LoanLibrary for State;
26:     using LoanLibrary for DebtPosition;
27:     using LoanLibrary for CreditPosition;
28:     using VariableLibrary for State;
29:     using RiskLibrary for State;
30: 
31:     function validateCompensate(State storage state, CompensateParams calldata params) external view {
32:         CreditPosition storage creditPositionWithDebtToRepay =
33:             state.getCreditPosition(params.creditPositionWithDebtToRepayId);
34:         DebtPosition storage debtPositionToRepay =
35:             state.getDebtPositionByCreditPositionId(params.creditPositionWithDebtToRepayId);
36:         CreditPosition storage creditPositionToCompensate = state.getCreditPosition(params.creditPositionToCompensateId);
37: 
38:         uint256 amountToCompensate =
39:             Math.min(params.amount, creditPositionToCompensate.credit, debtPositionToRepay.faceValue);
40: 
41:         // validate creditPositionWithDebtToRepayId
42:         if (state.getLoanStatus(params.creditPositionWithDebtToRepayId) == LoanStatus.REPAID) {
43:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionWithDebtToRepayId);
44:         }
45:         if (creditPositionWithDebtToRepay.credit < amountToCompensate) {
46:             revert Errors.CREDIT_LOWER_THAN_AMOUNT_TO_COMPENSATE(
47:                 creditPositionWithDebtToRepay.credit, amountToCompensate
48:             );
49:         }
50: 
51:         // validate creditPositionToCompensateId
52:         if (state.getLoanStatus(params.creditPositionToCompensateId) == LoanStatus.REPAID) {
53:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionToCompensateId);
54:         }
55:         if (
56:             debtPositionToRepay.dueDate
57:                 < state.getDebtPositionByCreditPositionId(params.creditPositionToCompensateId).dueDate
58:         ) {
59:             revert Errors.DUE_DATE_NOT_COMPATIBLE(
60:                 params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId
61:             );
62:         }
63:         if (creditPositionToCompensate.lender != debtPositionToRepay.borrower) {
64:             revert Errors.INVALID_LENDER(creditPositionToCompensate.lender);
65:         }
66: 
67:         // validate msg.sender
68:         if (msg.sender != debtPositionToRepay.borrower) {
69:             revert Errors.COMPENSATOR_IS_NOT_BORROWER(msg.sender, debtPositionToRepay.borrower);
70:         }
71: 
72:         // validate amount
73:         if (params.amount == 0) {
74:             revert Errors.NULL_AMOUNT();
75:         }
76:     }
77: 
78:     function executeCompensate(State storage state, CompensateParams calldata params) external {
79:         emit Events.Compensate(
80:             params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId, params.amount
81:         );
82: 
83:         CreditPosition storage creditPositionWithDebtToRepay =
84:             state.getCreditPosition(params.creditPositionWithDebtToRepayId);
85:         DebtPosition storage debtPositionToRepay =
86:             state.getDebtPositionByCreditPositionId(params.creditPositionWithDebtToRepayId);
87:         CreditPosition storage creditPositionToCompensate = state.getCreditPosition(params.creditPositionToCompensateId);
88: 
89:         uint256 amountToCompensate =
90:             Math.min(params.amount, creditPositionToCompensate.credit, debtPositionToRepay.faceValue);
91: 
92:         // debt reduction
93:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPositionToRepay, amountToCompensate);
94:         debtPositionToRepay.updateRepayFee(amountToCompensate, repayFee);
95:         state.data.debtToken.burn(debtPositionToRepay.borrower, amountToCompensate);
96:         creditPositionWithDebtToRepay.credit -= amountToCompensate;
97:         state.validateMinimumCredit(creditPositionWithDebtToRepay.credit);
98: 
99:         // credit emission
100:         // slither-disable-next-line unused-return
101:         state.createCreditPosition({
102:             exitCreditPositionId: params.creditPositionToCompensateId,
103:             lender: debtPositionToRepay.lender,
104:             credit: amountToCompensate
105:         });
106:     }
107: }
108: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {PERCENT} from "@src/libraries/Math.sol";
5: 
6: import {CreditPosition, DebtPosition, LoanLibrary} from "@src/libraries/fixed/LoanLibrary.sol";
7: import {LoanOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol";
8: import {User} from "@src/libraries/fixed/UserLibrary.sol";
9: 
10: import {Math} from "@src/libraries/Math.sol";
11: 
12: import {State} from "@src/SizeStorage.sol";
13: 
14: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol";
15: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol";
16: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
17: 
18: import {Errors} from "@src/libraries/Errors.sol";
19: import {Events} from "@src/libraries/Events.sol";
20: 
21: struct BorrowAsMarketOrderParams {
22:     address lender;
23:     uint256 amount;
24:     uint256 dueDate;
25:     uint256 deadline;
26:     uint256 maxAPR;
27:     bool exactAmountIn;
28:     uint256[] receivableCreditPositionIds;
29: }
30: 
31: library BorrowAsMarketOrder {
32:     using OfferLibrary for LoanOffer;
33:     using LoanLibrary for DebtPosition;
34:     using LoanLibrary for CreditPosition;
35:     using LoanLibrary for State;
36:     using RiskLibrary for State;
37:     using AccountingLibrary for State;
38:     using VariableLibrary for State;
39:     using AccountingLibrary for State;
40: 
41:     function validateBorrowAsMarketOrder(State storage state, BorrowAsMarketOrderParams memory params) external view {
42:         User memory lenderUser = state.data.users[params.lender];
43:         LoanOffer memory loanOffer = lenderUser.loanOffer;
44: 
45:         // validate msg.sender
46:         // N/A
47: 
48:         // validate params.lender
49:         if (loanOffer.isNull()) {
50:             revert Errors.INVALID_LOAN_OFFER(params.lender);
51:         }
52: 
53:         // validate params.amount
54:         if (params.amount == 0) {
55:             revert Errors.NULL_AMOUNT();
56:         }
57: 
58:         // validate params.dueDate
59:         if (params.dueDate < block.timestamp) {
60:             revert Errors.PAST_DUE_DATE(params.dueDate);
61:         }
62:         if (params.dueDate > loanOffer.maxDueDate) {
63:             revert Errors.DUE_DATE_GREATER_THAN_MAX_DUE_DATE(params.dueDate, loanOffer.maxDueDate);
64:         }
65: 
66:         // validate params.deadline
67:         if (params.deadline < block.timestamp) {
68:             revert Errors.PAST_DEADLINE(params.deadline);
69:         }
70: 
71:         // validate params.maxAPR
72:         uint256 ratePerMaturity =
73:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
74:         uint256 maturity = params.dueDate - block.timestamp;
75:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) > params.maxAPR) {
76:             revert Errors.APR_GREATER_THAN_MAX_APR(
77:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.maxAPR
78:             );
79:         }
80: 
81:         // validate params.exactAmountIn
82:         // N/A
83: 
84:         // validate params.receivableCreditPositionIds
85:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) {
86:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
87: 
88:             CreditPosition memory creditPosition = state.getCreditPosition(creditPositionId);
89:             DebtPosition memory debtPosition = state.getDebtPositionByCreditPositionId(creditPositionId);
90: 
91:             if (msg.sender != creditPosition.lender) {
92:                 revert Errors.BORROWER_IS_NOT_LENDER(msg.sender, creditPosition.lender);
93:             }
94:             if (params.dueDate < debtPosition.dueDate) {
95:                 revert Errors.DUE_DATE_LOWER_THAN_DEBT_POSITION_DUE_DATE(params.dueDate, debtPosition.dueDate);
96:             }
97:         }
98:     }
99: 
100:     function executeBorrowAsMarketOrder(State storage state, BorrowAsMarketOrderParams memory params) external {
101:         emit Events.BorrowAsMarketOrder(
102:             params.lender, params.amount, params.dueDate, params.exactAmountIn, params.receivableCreditPositionIds
103:         );
104: 
105:         params.amount = _borrowFromCredit(state, params);
106:         _borrowGeneratingDebt(state, params);
107:     }
108: 
109:     /// @notice Borrow with receivable credit positions, an internal state-modifying function.
110:     /// @dev The `amount` is initialized to `amountOutLeft`, which is decreased as more and more CreditPositions are created
111:     function _borrowFromCredit(State storage state, BorrowAsMarketOrderParams memory params)
112:         internal
113:         returns (uint256 amountOutLeft)
114:     {
115:         //  amountIn: Amount of future cashflow to exit
116:         //  amountOut: Amount of cash to borrow at present time
117: 
118:         User storage lenderUser = state.data.users[params.lender];
119: 
120:         LoanOffer storage loanOffer = lenderUser.loanOffer;
121: 
122:         uint256 ratePerMaturity =
123:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
124: 
125:         amountOutLeft =
126:             params.exactAmountIn ? Math.mulDivDown(params.amount, PERCENT, PERCENT + ratePerMaturity) : params.amount;
127: 
128:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) {
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) {
135:                 deltaAmountIn = creditPosition.credit;
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity);
137:             }
138: 
139:             // the lender doesn't have enought credit to exit
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) {
141:                 continue;
142:             }
143:             // full amount borrowed
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             // slither-disable-next-line unused-return
149:             state.createCreditPosition({
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee
157:             );
158:             amountOutLeft -= deltaAmountOut;
159:         }
160:     }
161: 
162:     /// @notice Borrow with generating debt
163:     /// @dev Cover the remaining amount by generating debt, which is subject to liquidation
164:     function _borrowGeneratingDebt(State storage state, BorrowAsMarketOrderParams memory params) internal {
165:         if (params.amount == 0) {
166:             return;
167:         }
168: 
169:         User storage lenderUser = state.data.users[params.lender];
170: 
171:         LoanOffer storage loanOffer = lenderUser.loanOffer;
172: 
173:         uint256 ratePerMaturity =
174:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
175:         uint256 issuanceValue = params.amount;
176:         uint256 faceValue = Math.mulDivUp(issuanceValue, PERCENT + ratePerMaturity, PERCENT);
177: 
178:         // slither-disable-next-line unused-return
179:         (DebtPosition memory debtPosition,) = state.createDebtAndCreditPositions({
180:             lender: params.lender,
181:             borrower: msg.sender,
182:             issuanceValue: issuanceValue,
183:             faceValue: faceValue,
184:             dueDate: params.dueDate
185:         });
186: 
187:         state.data.debtToken.mint(msg.sender, debtPosition.getDebt());
188:         state.transferBorrowATokenFixed(params.lender, msg.sender, issuanceValue);
189:     }
190: }
191: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {IAToken} from "@aave/interfaces/IAToken.sol";
5: import {IPool} from "@aave/interfaces/IPool.sol";
6: import {VariableDebtToken} from "@aave/protocol/tokenization/VariableDebtToken.sol";
7: 
8: import {DataTypes} from "@aave/protocol/libraries/types/DataTypes.sol";
9: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol";
10: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";
11: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
12: 
13: import {State} from "@src/SizeStorage.sol";
14: import {Errors} from "@src/libraries/Errors.sol";
15: import {CollateralLibrary} from "@src/libraries/fixed/CollateralLibrary.sol";
16: 
17: import {CreditPosition, DebtPosition, LoanLibrary} from "@src/libraries/fixed/LoanLibrary.sol";
18: 
19: import {UserLibrary} from "@src/libraries/fixed/UserLibrary.sol";
20: import {Vault} from "@src/proxy/Vault.sol";
21: 
22: /// @title VariableLibrary
23: /// @dev Contains functions for interacting with the Size Variable Pool (Aave v3 fork)
24: library VariableLibrary {
25:     using SafeERC20 for IERC20Metadata;
26:     using CollateralLibrary for State;
27:     using LoanLibrary for State;
28:     using LoanLibrary for DebtPosition;
29:     using LoanLibrary for CreditPosition;
30:     using UserLibrary for State;
31: 
32:     /// @notice Deposit underlyin tokens into the variable pool
33:     /// @dev Assumes `from` has approved to `address(this)` the `amount` of `underlyingToken`
34:     ///      The deposit is made to the vault of `to`
35:     ///      Note: Only the underlying collateral token should be set as collateral
36:     ///      Note: `setUseReserveAsCollateral` can later be optimized so that it is called only once per vault
37:     /// @param state The state struct
38:     /// @param underlyingToken The underlying token
39:     /// @param from The address of the depositor
40:     /// @param to The address of the recipient
41:     /// @param amount The amount of tokens to deposit
42:     /// @param variable Whether to deposit on the vault for variable or fixed-rate lending
43:     /// @param setUseReserveAsCollateral Whether to set the collateral as collateral.
44:     function depositUnderlyingTokenToVariablePool(
45:         State storage state,
46:         IERC20Metadata underlyingToken,
47:         address from,
48:         address to,
49:         uint256 amount,
50:         bool variable,
51:         bool setUseReserveAsCollateral
52:     ) external {
53:         underlyingToken.safeTransferFrom(from, address(this), amount);
54: 
55:         Vault vaultTo = variable ? state.getVaultVariable(to) : state.getVaultFixed(to);
56: 
57:         underlyingToken.forceApprove(address(state.data.variablePool), amount);
58:         state.data.variablePool.supply(address(underlyingToken), amount, address(vaultTo), 0);
59: 
60:         // set underlyingToken as collateral
61:         if (setUseReserveAsCollateral) {
62:             // slither-disable-next-line unused-return
63:             vaultTo.proxy(
64:                 address(state.data.variablePool),
65:                 abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(underlyingToken), true))
66:             );
67:         }
68:     }
69: 
70:     /// @notice Withdraw underlying tokens from the variable pool
71:     /// @dev Assumes `from` has enough aTokens to withdraw
72:     ///      The withdraw is made from the vault of `from`
73:     /// @param state The state struct
74:     /// @param aToken The aToken
75:     /// @param from The address of the withdrawer
76:     /// @param to The address of the recipient
77:     /// @param amount The amount of tokens to withdraw
78:     /// @param variable Whether to withdrawm from the vault for variable or fixed-rate lending
79:     function withdrawUnderlyingTokenFromVariablePool(
80:         State storage state,
81:         IAToken aToken,
82:         address from,
83:         address to,
84:         uint256 amount,
85:         bool variable
86:     ) external {
87:         if (aTokenBalanceOf(state, aToken, from, variable) < amount) {
88:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
89:                 address(aToken), from, variable, aTokenBalanceOf(state, aToken, from, variable), amount
90:             );
91:         }
92: 
93:         address underlyingToken = aToken.UNDERLYING_ASSET_ADDRESS();
94: 
95:         Vault vaultFrom = variable ? state.getVaultVariable(from) : state.getVaultFixed(from);
96: 
97:         // slither-disable-next-line unused-return
98:         vaultFrom.proxy(address(state.data.variablePool), abi.encodeCall(IPool.withdraw, (underlyingToken, amount, to)));
99:     }
100: 
101:     /// @notice Borrow a variable loan from the variable pool
102:     /// @param state The state struct
103:     /// @param from The address of the borrower
104:     /// @param to The address of the recipient
105:     /// @param amount The amount of tokens to borrow
106:     function borrowVariableLoan(State storage state, address from, address to, uint256 amount) external {
107:         IERC20Metadata underlyingBorrowToken = IERC20Metadata(state.data.underlyingBorrowToken);
108: 
109:         Vault vaultFrom = state.getVaultVariable(from);
110:         Vault vaultTo = state.getVaultVariable(to);
111: 
112:         address[] memory targets = new address[](2);
113:         bytes[] memory data = new bytes[](2);
114: 
115:         // borrow
116:         targets[0] = address(state.data.variablePool);
117:         data[0] = abi.encodeCall(
118:             IPool.borrow,
119:             (
120:                 address(underlyingBorrowToken),
121:                 amount,
122:                 uint256(DataTypes.InterestRateMode.VARIABLE),
123:                 0,
124:                 address(vaultFrom)
125:             )
126:         );
127: 
128:         // transfer to `address(this)`
129:         targets[1] = address(state.data.underlyingBorrowToken);
130:         data[1] = abi.encodeCall(IERC20.transfer, (address(this), amount));
131: 
132:         // slither-disable-next-line unused-return
133:         vaultFrom.proxy(targets, data);
134: 
135:         // supply to `to`
136:         underlyingBorrowToken.forceApprove(address(state.data.variablePool), amount);
137:         state.data.variablePool.supply(address(underlyingBorrowToken), amount, address(vaultTo), 0);
138:     }
139: 
140:     /// @notice Repay a variable loan from the variable pool
141:     /// @param state The state struct
142:     /// @param from The address of the repayer
143:     /// @param amount The amount of tokens to repay
144:     function repayVariableLoan(State storage state, address from, uint256 amount) external {
145:         // @audit Validate if we can use `repayWithATokens` without reaching any caps
146:         Vault vaultFrom = state.getVaultVariable(from);
147: 
148:         // slither-disable-next-line unused-return
149:         vaultFrom.proxy(
150:             address(state.data.variablePool),
151:             abi.encodeCall(
152:                 IPool.repayWithATokens,
153:                 (address(state.data.underlyingBorrowToken), amount, uint256(DataTypes.InterestRateMode.VARIABLE))
154:             )
155:         );
156:     }
157: 
158:     /// @notice Liquidate a variable loan from the variable pool
159:     /// @dev    The caller must have underlying collateral tokens on their vault
160:     /// @param state The state struct
161:     /// @param from The address of the liquidator
162:     /// @param borrower The address of the liquidated borrower
163:     /// @param amount The amount of debt to cover
164:     function liquidateVariableLoan(State storage state, address from, address borrower, uint256 amount) external {
165:         // @audit Validate if we can use `liquidationCall` without reaching any caps
166:         Vault vaultFrom = state.getVaultVariable(from);
167:         Vault vaultTo = state.getVaultVariable(borrower);
168: 
169:         address[] memory targets = new address[](3);
170:         bytes[] memory data = new bytes[](3);
171: 
172:         // unwrap borrow aTokens (e.g. aszUSDC) to underlying borrow tokens (e.g. USDC)
173:         targets[0] = address(state.data.variablePool);
174:         data[0] =
175:             abi.encodeCall(IPool.withdraw, (address(state.data.underlyingBorrowToken), amount, address(vaultFrom)));
176: 
177:         // approve underlying borrow tokens
178:         targets[1] = address(state.data.underlyingBorrowToken);
179:         data[1] = abi.encodeCall(IERC20.approve, (address(state.data.variablePool), amount));
180: 
181:         // liquidate
182:         targets[2] = address(state.data.variablePool);
183:         data[2] = abi.encodeCall(
184:             IPool.liquidationCall,
185:             (
186:                 address(state.data.underlyingCollateralToken),
187:                 address(state.data.underlyingBorrowToken),
188:                 address(vaultTo),
189:                 amount,
190:                 true
191:             )
192:         );
193: 
194:         // slither-disable-next-line unused-return
195:         vaultFrom.proxy(targets, data);
196:     }
197: 
198:     /// @notice Transfer aTokens from one user to another, from the vault destined to fixed-rate loans
199:     /// @dev Assumes `from` has enough aTokens to transfer
200:     ///      The transfer is made from the vault of `from` to the vault of `to`
201:     /// @param state The state struct
202:     /// @param from The address of the sender
203:     /// @param to The address of the recipient
204:     /// @param amount The amount of aTokens to transfer
205:     function transferBorrowATokenFixed(State storage state, address from, address to, uint256 amount) public {
206:         IAToken borrowAToken = state.data.borrowAToken;
207:         if (aTokenBalanceOf(state, borrowAToken, from, false) < amount) {
208:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
209:                 address(borrowAToken), from, false, aTokenBalanceOf(state, borrowAToken, from, false), amount
210:             );
211:         }
212: 
213:         Vault vaultFrom = state.getVaultFixed(from);
214:         Vault vaultTo = state.getVaultFixed(to);
215: 
216:         // slither-disable-next-line unused-return
217:         vaultFrom.proxy(address(borrowAToken), abi.encodeCall(IERC20.transfer, (address(vaultTo), amount)));
218:     }
219: 
220:     /// @notice Get the balance of borrow aTokens for a user on the Variable Pool
221:     /// @param state The state struct
222:     /// @param account The user's address
223:     /// @param variable Whether to get the balance for the variable or fixed-rate vault
224:     /// @return The balance of aTokens
225:     function aTokenBalanceOf(State storage state, IAToken aToken, address account, bool variable)
226:         public
227:         view
228:         returns (uint256)
229:     {
230:         Vault vault = variable ? state.data.users[account].vaultVariable : state.data.users[account].vaultFixed;
231:         return aToken.balanceOf(address(vault));
232:     }
233: 
234:     /// @notice Get the balance of variable debt for a user on the Variable Pool
235:     /// @param state The state struct
236:     /// @param account The user's address
237:     function variableDebtTokenBalanceOf(State storage state, address account) public view returns (uint256) {
238:         VariableDebtToken token = VariableDebtToken(
239:             state.data.variablePool.getReserveData(address(state.data.underlyingBorrowToken)).variableDebtTokenAddress
240:         );
241:         Vault vault = state.data.users[account].vaultVariable;
242:         return token.balanceOf(address(vault));
243:     }
244: 
245:     /// @notice Get the liquidity index of Size Variable Pool (Aave v3 fork)
246:     /// @param state The state struct
247:     /// @return The liquidity index
248:     function borrowATokenLiquidityIndex(State storage state) public view returns (uint256) {
249:         return state.data.variablePool.getReserveNormalizedIncome(address(state.data.underlyingBorrowToken));
250:     }
251: 
252:     /// @notice Move a fixed-rate DebtPosition to the variable pool by supplying the assigned collateral and paying the liquidator with the move fee
253:     ///        Try borrowing underlying borrow tokens from the variable pool by first supplying collateral
254:     ///        The borrow is made on behalf of the variable-rate vault of the `from` user and the supply is made to the fixed-rate vault of the `to` user, so that it later can be claimed
255:     ///        After moving the loan to the Variable Pool, we check the vault's health factor and revert if it is below the liquidation threshold. See https://docs.aave.com/risk/asset-risk/risk-parameters#health-factor
256:     /// @dev Assumes `from` has enough collateral to borrow `amount`
257:     ///      We use a memory copy of the DebtPosition as it might have already changed in storage as a result of the liquidation process
258:     ///      This function may revert due to Variable Pool health checks or liquidity conditions
259:     /// @param state The state struct
260:     /// @param debtPositionCopy The DebtPosition to move
261:     /// @return liquidatorProfitCollateralToken The amount of collateral tokens paid to the liquidator
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken)
265:     {
266:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
267: 
268:         // take overdue transfer fee from collateral
269:         liquidatorProfitCollateralToken = state.feeConfig.collateralOverdueTransferFee;
270:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken);
271: 
272:         address from = debtPositionCopy.borrower;
273:         address to = address(this);
274:         uint256 collateralBalance = assignedCollateral - liquidatorProfitCollateralToken;
275:         uint256 borrowATokenBalance = debtPositionCopy.faceValue;
276: 
277:         // begin move to variable pool
278:         Vault vaultFrom = state.getVaultVariable(from);
279:         Vault vaultTo = state.getVaultFixed(to);
280: 
281:         // unwrap collateralToken (e.g. szETH) to underlyingCollateralToken (e.g. WETH) from `from` to `address(this)`
282:         state.withdrawUnderlyingCollateralToken(from, address(this), collateralBalance);
283: 
284:         // supply underlying collateral token
285:         state.data.underlyingCollateralToken.forceApprove(address(state.data.variablePool), collateralBalance);
286:         state.data.variablePool.supply(
287:             address(state.data.underlyingCollateralToken), collateralBalance, address(vaultFrom), 0
288:         );
289: 
290:         address[] memory targets = new address[](3);
291:         bytes[] memory data = new bytes[](3);
292: 
293:         // set underlyingCollateralToken as collateral
294:         targets[0] = address(state.data.variablePool);
295:         data[0] =
296:             abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(state.data.underlyingCollateralToken), true));
297: 
298:         // borrow
299:         targets[1] = address(state.data.variablePool);
300:         data[1] = abi.encodeCall(
301:             IPool.borrow,
302:             (
303:                 address(state.data.underlyingBorrowToken),
304:                 borrowATokenBalance,
305:                 uint256(DataTypes.InterestRateMode.VARIABLE),
306:                 0,
307:                 address(vaultFrom)
308:             )
309:         );
310: 
311:         // transfer underlying borrow tokens to `address(this)`
312:         targets[2] = address(state.data.underlyingBorrowToken);
313:         data[2] = abi.encodeCall(IERC20.transfer, (address(this), borrowATokenBalance));
314: 
315:         // slither-disable-next-line unused-return
316:         vaultFrom.proxy(targets, data);
317: 
318:         // supply to `to`
319:         state.data.underlyingBorrowToken.forceApprove(address(state.data.variablePool), borrowATokenBalance);
320:         state.data.variablePool.supply(
321:             address(state.data.underlyingBorrowToken), borrowATokenBalance, address(vaultTo), 0
322:         );
323: 
324:         // check if the user HF is greater than the threshold
325:         (,,,,, uint256 healthFactor) = state.data.variablePool.getUserAccountData(address(vaultFrom));
326:         if (healthFactor < state.riskConfig.moveToVariablePoolHFThreshold) {
327:             revert Errors.HEALTH_FACTOR_BELOW_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(
328:                 address(vaultFrom), healthFactor, state.riskConfig.moveToVariablePoolHFThreshold
329:             );
330:         }
331:     }
332: }
333: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: 
6: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol";
7: 
8: import {DebtPosition, LoanLibrary, LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol";
9: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
10: 
11: import {Errors} from "@src/libraries/Errors.sol";
12: import {Events} from "@src/libraries/Events.sol";
13: 
14: struct RepayParams {
15:     uint256 debtPositionId;
16: }
17: 
18: library Repay {
19:     using VariableLibrary for State;
20:     using LoanLibrary for DebtPosition;
21:     using LoanLibrary for State;
22:     using AccountingLibrary for State;
23:     using AccountingLibrary for State;
24: 
25:     function validateRepay(State storage state, RepayParams calldata params) external view {
26:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
27: 
28:         // validate debtPositionId
29:         if (state.getLoanStatus(params.debtPositionId) == LoanStatus.REPAID) {
30:             revert Errors.LOAN_ALREADY_REPAID(params.debtPositionId);
31:         }
32: 
33:         // validate msg.sender
34:         if (msg.sender != debtPosition.borrower) {
35:             revert Errors.REPAYER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower);
36:         }
37:         if (state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false) < debtPosition.faceValue) {
38:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
39:                 address(state.data.borrowAToken),
40:                 msg.sender,
41:                 false,
42:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
43:                 debtPosition.faceValue
44:             );
45:         }
46:     }
47: 
48:     function executeRepay(State storage state, RepayParams calldata params) external {
49:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
50:         uint256 faceValue = debtPosition.faceValue;
51: 
52:         state.transferBorrowATokenFixed(msg.sender, address(this), faceValue);
53:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, faceValue);
54:         debtPosition.updateRepayFee(faceValue, repayFee);
55:         state.data.debtToken.burn(debtPosition.borrower, faceValue);
56:         debtPosition.liquidityIndexAtRepayment = state.borrowATokenLiquidityIndex();
57: 
58:         emit Events.Repay(params.debtPositionId);
59:     }
60: }
61: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {SafeCast} from "@openzeppelin/contracts/utils/math/SafeCast.sol";
5: import {FixedPointMathLib} from "@solady/utils/FixedPointMathLib.sol";
6: 
7: uint256 constant PERCENT = 1e18;
8: 
9: // @audit Check rounding direction of all `FixedPointMath.mulDiv{Up,Down}`
10: 
11: /// @title Math
12: library Math {
13:     function min(uint256 a, uint256 b) internal pure returns (uint256) {
14:         return FixedPointMathLib.min(a, b);
15:     }
16: 
17:     function max(uint256 a, uint256 b) internal pure returns (uint256) {
18:         return FixedPointMathLib.max(a, b);
19:     }
20: 
21:     function min(uint256 a, uint256 b, uint256 c) internal pure returns (uint256) {
22:         return FixedPointMathLib.min(FixedPointMathLib.min(a, b), c);
23:     }
24: 
25:     function mulDivUp(uint256 x, uint256 y, uint256 z) internal pure returns (uint256) {
26:         return FixedPointMathLib.mulDivUp(x, y, z);
27:     }
28: 
29:     function mulDivDown(uint256 x, uint256 y, uint256 z) internal pure returns (uint256) {
30:         return FixedPointMathLib.mulDiv(x, y, z);
31:     }
32: 
33:     function mulDiv(int256 x, int256 y, int256 z) internal pure returns (int256) {
34:         return x * y / z;
35:     }
36: 
37:     function powWadWad(uint256 wad1, uint256 wad2) internal pure returns (uint256) {
38:         return SafeCast.toUint256(FixedPointMathLib.powWad(SafeCast.toInt256(wad1), SafeCast.toInt256(wad2)));
39:     }
40: 
41:     function ratePerMaturityToLinearAPR(int256 rate, uint256 maturity) internal pure returns (int256) {
42:         return mulDiv(rate, 365 days, SafeCast.toInt256(maturity));
43:     }
44: 
45:     function ratePerMaturityToLinearAPR(uint256 rate, uint256 maturity) internal pure returns (uint256) {
46:         return mulDivDown(rate, 365 days, maturity);
47:     }
48: 
49:     function linearAPRToRatePerMaturity(int256 rate, uint256 maturity) internal pure returns (int256) {
50:         return mulDiv(rate, SafeCast.toInt256(maturity), 365 days);
51:     }
52: 
53:     function compoundAPRToRatePerMaturity(uint256 rate, uint256 maturity) internal pure returns (uint256) {
54:         return powWadWad(PERCENT + rate, mulDivDown(PERCENT, maturity, 365 days)) - PERCENT;
55:     }
56: 
57:     function binarySearch(uint256[] memory array, uint256 value) internal pure returns (uint256 low, uint256 high) {
58:         low = 0;
59:         high = array.length - 1;
60:         if (value < array[low] || value > array[high]) {
61:             // @audit-info Covered in test_Math_binarySearch_not_found
62:             return (type(uint256).max, type(uint256).max);
63:         }
64:         while (low <= high) {
65:             uint256 mid = (low + high) / 2;
66:             if (array[mid] == value) {
67:                 return (mid, mid);
68:             } else if (array[mid] < value) {
69:                 low = mid + 1;
70:             } else {
71:                 high = mid - 1;
72:             }
73:         }
74:         return (high, low);
75:     }
76: }
77: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/IPriceFeed.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: /// @title IPriceFeed
5: interface IPriceFeed {
6:     /// @notice Returns the price of the asset
7:     function getPrice() external view returns (uint256);
8:     /// @notice Returns the number of decimals of the price feed
9:     function decimals() external view returns (uint8);
10: }
11: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol";
5: 
6: import {CreditPosition, DebtPosition, LoanLibrary} from "@src/libraries/fixed/LoanLibrary.sol";
7: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol";
8: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
9: 
10: import {State} from "@src/SizeStorage.sol";
11: 
12: import {Errors} from "@src/libraries/Errors.sol";
13: import {Events} from "@src/libraries/Events.sol";
14: 
15: struct SelfLiquidateParams {
16:     uint256 creditPositionId;
17: }
18: 
19: library SelfLiquidate {
20:     using LoanLibrary for DebtPosition;
21:     using LoanLibrary for CreditPosition;
22:     using LoanLibrary for State;
23:     using VariableLibrary for State;
24:     using AccountingLibrary for State;
25:     using RiskLibrary for State;
26: 
27:     function validateSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external view {
28:         CreditPosition storage creditPosition = state.getCreditPosition(params.creditPositionId);
29:         DebtPosition storage debtPosition = state.getDebtPositionByCreditPositionId(params.creditPositionId);
30: 
31:         uint256 assignedCollateral = state.getCreditPositionProRataAssignedCollateral(creditPosition);
32:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPosition.faceValue);
33: 
34:         // validate creditPositionId
35:         if (!state.isCreditPositionSelfLiquidatable(params.creditPositionId)) {
36:             revert Errors.LOAN_NOT_SELF_LIQUIDATABLE(
37:                 params.creditPositionId,
38:                 state.collateralRatio(debtPosition.borrower),
39:                 state.getLoanStatus(params.creditPositionId)
40:             );
41:         }
42:         if (!(assignedCollateral < debtInCollateralToken)) {
43:             revert Errors.LIQUIDATION_NOT_AT_LOSS(params.creditPositionId, assignedCollateral, debtInCollateralToken);
44:         }
45: 
46:         // validate msg.sender
47:         if (msg.sender != creditPosition.lender) {
48:             revert Errors.LIQUIDATOR_IS_NOT_LENDER(msg.sender, creditPosition.lender);
49:         }
50:     }
51: 
52:     function executeSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external {
53:         emit Events.SelfLiquidate(params.creditPositionId);
54: 
55:         CreditPosition storage creditPosition = state.data.creditPositions[params.creditPositionId];
56:         DebtPosition storage debtPosition = state.getDebtPositionByCreditPositionId(params.creditPositionId);
57: 
58:         uint256 credit = creditPosition.credit;
59:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, credit);
60:         uint256 assignedCollateral = state.getCreditPositionProRataAssignedCollateral(creditPosition);
61:         debtPosition.updateRepayFee(credit, repayFee);
62:         creditPosition.credit = 0;
63: 
64:         state.data.debtToken.burn(debtPosition.borrower, credit);
65:         state.data.collateralToken.transferFrom(debtPosition.borrower, msg.sender, assignedCollateral);
66:     }
67: }
68: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {OwnableUpgradeable} from "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";
5: import {Initializable} from "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
6: import {Address} from "@openzeppelin/contracts/utils/Address.sol";
7: 
8: import {Errors} from "@src/libraries/Errors.sol";
9: 
10: /// @title Vault
11: /// @notice A contract that permits the owner to execute arbitrary calls
12: /// @dev This contract is deployed behind minimal proxy contracts, also known as "clones", using OpenZeppelin's Clones library.
13: ///      Because of that, it is not possible to use the `constructor`, so the `initialize` function is used instead.
14: contract Vault is Initializable, OwnableUpgradeable {
15:     /// @custom:oz-upgrades-unsafe-allow constructor
16:     constructor() {
17:         _disableInitializers();
18:     }
19: 
20:     function initialize(address owner) external initializer {
21:         __Ownable_init(owner);
22:     }
23: 
24:     function proxy(address target, bytes memory data) public onlyOwner returns (bytes memory returnData) {
25:         if (target == address(0)) {
26:             revert Errors.NULL_ADDRESS();
27:         }
28:         bool success;
29:         (success, returnData) = address(target).call(data);
30:         Address.verifyCallResult(success, returnData);
31:     }
32: 
33:     function proxy(address target, bytes memory data, uint256 value)
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData)
37:     {
38:         if (target == address(0)) {
39:             revert Errors.NULL_ADDRESS();
40:         }
41:         bool success;
42:         (success, returnData) = address(target).call{value: value}(data);
43:         Address.verifyCallResult(success, returnData);
44:     }
45: 
46:     function proxy(address[] memory targets, bytes[] memory datas)
47:         public
48:         onlyOwner
49:         returns (bytes[] memory returnDatas)
50:     {
51:         if (targets.length != datas.length) {
52:             revert Errors.ARRAY_LENGTHS_MISMATCH();
53:         }
54: 
55:         returnDatas = new bytes[](datas.length);
56:         bool success;
57:         for (uint256 i = 0; i < targets.length; i++) {
58:             if (targets[i] == address(0)) {
59:                 revert Errors.NULL_ADDRESS();
60:             }
61:             // slither-disable-next-line calls-loop
62:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]);
63:             Address.verifyCallResult(success, returnDatas[i]);
64:         }
65:     }
66: 
67:     receive() external payable {}
68: }
69: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: import {BorrowOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol";
6: import {YieldCurve, YieldCurveLibrary} from "@src/libraries/fixed/YieldCurveLibrary.sol";
7: 
8: import {Events} from "@src/libraries/Events.sol";
9: 
10: struct BorrowAsLimitOrderParams {
11:     uint256 openingLimitBorrowCR;
12:     YieldCurve curveRelativeTime;
13: }
14: 
15: library BorrowAsLimitOrder {
16:     using OfferLibrary for BorrowOffer;
17: 
18:     function validateBorrowAsLimitOrder(State storage state, BorrowAsLimitOrderParams calldata params) external view {
19:         BorrowOffer memory borrowOffer = BorrowOffer({
20:             openingLimitBorrowCR: params.openingLimitBorrowCR,
21:             curveRelativeTime: params.curveRelativeTime
22:         });
23: 
24:         // a null offer mean clearning their limit orders
25:         if (!borrowOffer.isNull()) {
26:             // validate msg.sender
27:             // N/A
28: 
29:             // validate openingLimitBorrowCR
30:             // N/A
31: 
32:             // validate curveRelativeTime
33:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity);
34:         }
35:     }
36: 
37:     function executeBorrowAsLimitOrder(State storage state, BorrowAsLimitOrderParams calldata params) external {
38:         state.data.users[msg.sender].borrowOffer = BorrowOffer({
39:             openingLimitBorrowCR: params.openingLimitBorrowCR,
40:             curveRelativeTime: params.curveRelativeTime
41:         });
42:         emit Events.BorrowAsLimitOrder(params.curveRelativeTime);
43:     }
44: }
45: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {IMarketBorrowRateFeed} from "./IMarketBorrowRateFeed.sol";
5: import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol";
6: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
7: import {Errors} from "@src/libraries/Errors.sol";
8: 
9: /// @title MarketBorrowRateFeed
10: /// @notice A feed that returns the market borrow rate of an asset with 18 decimals
11: /// @dev Aave v3 is used to get the market borrow rate
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step {
13:     uint128 internal marketBorrowRate;
14:     uint64 internal marketBorrowRateUpdatedAt;
15:     uint64 internal staleRateInterval;
16: 
17:     event MarketBorrowRateUpdated(uint128 oldMarketBorrowRate, uint128 newMarketBorrowRate);
18:     event StaleRateIntervalUpdated(uint64 oldStaleRateInterval, uint64 newStaleRateInterval);
19: 
20:     constructor(address _owner, uint64 _staleRateInterval) Ownable(_owner) {
21:         if (_staleRateInterval == 0) {
22:             revert Errors.NULL_STALE_RATE();
23:         }
24: 
25:         staleRateInterval = _staleRateInterval;
26:     }
27: 
28:     function setStaleRateInterval(uint64 _staleRateInterval) external onlyOwner {
29:         uint64 oldStaleRateInterval = staleRateInterval;
30:         staleRateInterval = _staleRateInterval;
31:         emit StaleRateIntervalUpdated(oldStaleRateInterval, _staleRateInterval);
32:     }
33: 
34:     function setMarketBorrowRate(uint128 _marketBorrowRate) external onlyOwner {
35:         uint128 oldMarketBorrowRate = marketBorrowRate;
36:         marketBorrowRate = _marketBorrowRate;
37:         marketBorrowRateUpdatedAt = uint64(block.timestamp);
38:         emit MarketBorrowRateUpdated(oldMarketBorrowRate, _marketBorrowRate);
39:     }
40: 
41:     function getMarketBorrowRate() external view override returns (uint128) {
42:         if (block.timestamp - marketBorrowRateUpdatedAt > staleRateInterval) {
43:             revert Errors.STALE_RATE(marketBorrowRateUpdatedAt);
44:         }
45:         return marketBorrowRate;
46:     }
47: }
48: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: 
6: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
7: 
8: import {Errors} from "@src/libraries/Errors.sol";
9: import {Events} from "@src/libraries/Events.sol";
10: 
11: struct RepayVariableParams {
12:     uint256 amount;
13: }
14: 
15: library RepayVariable {
16:     using VariableLibrary for State;
17: 
18:     function validateRepayVariable(State storage, RepayVariableParams calldata params) external pure {
19:         // validte msg.sender
20:         // N/A
21: 
22:         // validate amount
23:         if (params.amount == 0) {
24:             revert Errors.NULL_AMOUNT();
25:         }
26:     }
27: 
28:     function executeRepayVariable(State storage state, RepayVariableParams calldata params) public {
29:         state.repayVariableLoan(msg.sender, params.amount);
30:         emit Events.RepayVariable(params.amount);
31:     }
32: }
33: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/IMarketBorrowRateFeed.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: /// @title IMarketBorrowRateFeed
5: interface IMarketBorrowRateFeed {
6:     /// @notice Returns the market borrow rate with 18 decimals
7:     /// @dev Ex, returns 0.05e18 for 5%
8:     function getMarketBorrowRate() external view returns (uint128);
9: }
10: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {SafeCast} from "@openzeppelin/contracts/utils/math/SafeCast.sol";
5: import {Errors} from "@src/libraries/Errors.sol";
6: import {Math, PERCENT} from "@src/libraries/Math.sol";
7: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol";
8: 
9: struct YieldCurve {
10:     uint256[] maturities;
11:     int256[] aprs;
12:     uint256[] marketRateMultipliers;
13: }
14: 
15: /// @title YieldCurveLibrary
16: /// @notice A library for working with yield curves
17: ///         The yield curve is defined as following:
18: ///         R[t] = aprs[t] + marketRateMultipliers[t] * marketRate,
19: ///         for all t in `maturities`, with `marketRate` defined by an external oracle
20: /// @dev The final rate per maturity is an unsigned integer, as it is a percentage
21: library YieldCurveLibrary {
22:     function isNull(YieldCurve memory self) internal pure returns (bool) {
23:         return self.maturities.length == 0 && self.aprs.length == 0 && self.marketRateMultipliers.length == 0;
24:     }
25: 
26:     function validateYieldCurve(YieldCurve memory self, uint256 minimumMaturity) internal pure {
27:         if (self.maturities.length == 0 || self.aprs.length == 0 || self.marketRateMultipliers.length == 0) {
28:             revert Errors.NULL_ARRAY();
29:         }
30:         if (self.maturities.length != self.aprs.length || self.maturities.length != self.marketRateMultipliers.length) {
31:             revert Errors.ARRAY_LENGTHS_MISMATCH();
32:         }
33: 
34:         // validate curveRelativeTime.aprs
35:         // N/A
36: 
37:         // validate curveRelativeTime.maturities
38:         uint256 lastMaturity = type(uint256).max;
39:         for (uint256 i = self.maturities.length; i > 0; i--) {
40:             if (self.maturities[i - 1] > lastMaturity) {
41:                 revert Errors.MATURITIES_NOT_STRICTLY_INCREASING();
42:             }
43:             lastMaturity = self.maturities[i - 1];
44:         }
45:         if (self.maturities[0] < minimumMaturity) {
46:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(self.maturities[0], minimumMaturity);
47:         }
48: 
49:         // validate curveRelativeTime.marketRateMultipliers
50:         // N/A
51:     }
52: 
53:     /// @notice Get the rate from the yield curve adjusted by the market rate
54:     /// @dev Reverts if the final result is negative
55:     ///      Only query the market borrow rate feed oracle if the market rate multiplier is not 0
56:     ///      Converts the market borrow rate from compound to linear interest
57:     /// @param maturity The maturity
58:     /// @param apr The annual percentage rate from the yield curve (linear interest)
59:     /// @param marketBorrowRateFeed The market borrow rate feed
60:     /// @param marketRateMultiplier The market rate multiplier
61:     /// @return Returns rate + (marketRate * marketRateMultiplier) / PERCENT for the given maturity
62:     function getRatePerMaturityByDueDate(
63:         uint256 maturity,
64:         int256 apr,
65:         uint256 marketRateMultiplier,
66:         IMarketBorrowRateFeed marketBorrowRateFeed
67:     ) internal view returns (uint256) {
68:         // @audit Check if the result should be capped to 0 instead of reverting
69: 
70:         int256 ratePerMaturity = Math.linearAPRToRatePerMaturity(apr, maturity);
71: 
72:         if (marketRateMultiplier == 0) {
73:             return SafeCast.toUint256(ratePerMaturity);
74:         } else {
75:             uint128 marketRateCompound = marketBorrowRateFeed.getMarketBorrowRate();
76:             uint256 marketRateLinear = Math.compoundAPRToRatePerMaturity(marketRateCompound, maturity);
77:             return SafeCast.toUint256(
78:                 ratePerMaturity + SafeCast.toInt256(Math.mulDivDown(marketRateLinear, marketRateMultiplier, PERCENT))
79:             );
80:         }
81:     }
82: 
83:     /// @notice Get the rate from the yield curve by performing a linear interpolation between two time buckets
84:     /// @dev Reverts if the due date is in the past or out of range
85:     /// @param curveRelativeTime The yield curve
86:     /// @param marketBorrowRateFeed The market borrow rate feed
87:     /// @param dueDate The due date
88:     /// @return The rate from the yield curve per given maturity
89:     function getRatePerMaturityByDueDate(
90:         YieldCurve memory curveRelativeTime,
91:         IMarketBorrowRateFeed marketBorrowRateFeed,
92:         uint256 dueDate
93:     ) external view returns (uint256) {
94:         // @audit Check the correctness of this function
95:         if (dueDate < block.timestamp) revert Errors.PAST_DUE_DATE(dueDate);
96:         uint256 maturity = dueDate - block.timestamp;
97:         uint256 length = curveRelativeTime.maturities.length;
98:         if (maturity < curveRelativeTime.maturities[0] || maturity > curveRelativeTime.maturities[length - 1]) {
99:             revert Errors.MATURITY_OUT_OF_RANGE(
100:                 maturity, curveRelativeTime.maturities[0], curveRelativeTime.maturities[length - 1]
101:             );
102:         } else {
103:             (uint256 low, uint256 high) = Math.binarySearch(curveRelativeTime.maturities, maturity);
104:             uint256 x0 = curveRelativeTime.maturities[low];
105:             uint256 y0 = getRatePerMaturityByDueDate(
106:                 curveRelativeTime.maturities[low],
107:                 curveRelativeTime.aprs[low],
108:                 curveRelativeTime.marketRateMultipliers[low],
109:                 marketBorrowRateFeed
110:             );
111:             uint256 x1 = curveRelativeTime.maturities[high];
112:             uint256 y1 = getRatePerMaturityByDueDate(
113:                 curveRelativeTime.maturities[high],
114:                 curveRelativeTime.aprs[high],
115:                 curveRelativeTime.marketRateMultipliers[high],
116:                 marketBorrowRateFeed
117:             );
118: 
119:             // @audit Check the rounding direction, as this may lead to debt rounding down
120:             if (x1 != x0) {
121:                 if (y1 >= y0) {
122:                     return y0 + Math.mulDivDown(y1 - y0, maturity - x0, x1 - x0);
123:                 } else {
124:                     return y0 - Math.mulDivDown(y0 - y1, maturity - x0, x1 - x0);
125:                 }
126:             } else {
127:                 return y0;
128:             }
129:         }
130:     }
131: }
132: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: 
6: import {ConversionLibrary} from "@src/libraries/ConversionLibrary.sol";
7: 
8: import {Events} from "@src/libraries/Events.sol";
9: import {Math} from "@src/libraries/Math.sol";
10: 
11: import {CreditPosition, DebtPosition, LoanLibrary, RESERVED_ID} from "@src/libraries/fixed/LoanLibrary.sol";
12: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol";
13: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
14: 
15: /// @title AccountingLibrary
16: library AccountingLibrary {
17:     using RiskLibrary for State;
18:     using LoanLibrary for DebtPosition;
19:     using LoanLibrary for CreditPosition;
20:     using LoanLibrary for State;
21:     using VariableLibrary for State;
22: 
23:     /// @notice Converts debt token amount to a value in collateral tokens
24:     /// @dev Rounds up the debt token amount
25:     /// @param state The state object
26:     /// @param debtTokenAmount The amount of debt tokens
27:     /// @return collateralTokenAmount The amount of collateral tokens
28:     function debtTokenAmountToCollateralTokenAmount(State storage state, uint256 debtTokenAmount)
29:         internal
30:         view
31:         returns (uint256 collateralTokenAmount)
32:     {
33:         uint256 debtTokenAmountWad =
34:             ConversionLibrary.amountToWad(debtTokenAmount, state.data.underlyingBorrowToken.decimals());
35:         collateralTokenAmount = Math.mulDivUp(
36:             debtTokenAmountWad, 10 ** state.oracle.priceFeed.decimals(), state.oracle.priceFeed.getPrice()
37:         );
38:     }
39: 
40:     /// @notice Charges the repay fee and updates the debt position
41:     /// @dev The repay fee is charged in collateral tokens
42:     ///      Rounds fees down during partial repayment
43:     ///      During early repayment, the full repayFee is deducted from the borrower debt, as it had been provisioned during the loan creation
44:     /// @param state The state object
45:     /// @param debtPosition The debt position
46:     /// @param repayAmount The amount to repay
47:     /// @param isEarlyRepay Whether the repayment is early. In this case, the fee is charged pro-rata to the time elapsed
48:     function chargeRepayFeeInCollateral(
49:         State storage state,
50:         DebtPosition storage debtPosition,
51:         uint256 repayAmount,
52:         bool isEarlyRepay
53:     ) public returns (uint256 repayFee) {
54:         repayFee = Math.mulDivDown(debtPosition.repayFee, repayAmount, debtPosition.faceValue);
55:         uint256 repayFeeCollateral;
56: 
57:         if (isEarlyRepay) {
58:             uint256 earlyRepayFee = debtPosition.earlyRepayFee();
59:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, earlyRepayFee);
60:         } else {
61:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, repayFee);
62:         }
63: 
64:         state.data.collateralToken.transferFrom(debtPosition.borrower, state.feeConfig.feeRecipient, repayFeeCollateral);
65: 
66:         state.data.debtToken.burn(debtPosition.borrower, repayFee);
67:     }
68: 
69:     function chargeEarlyRepayFeeInCollateral(State storage state, DebtPosition storage debtPosition)
70:         external
71:         returns (uint256)
72:     {
73:         return chargeRepayFeeInCollateral(state, debtPosition, debtPosition.faceValue, true);
74:     }
75: 
76:     function chargeRepayFeeInCollateral(State storage state, DebtPosition storage debtPosition, uint256 repayAmount)
77:         external
78:         returns (uint256)
79:     {
80:         return chargeRepayFeeInCollateral(state, debtPosition, repayAmount, false);
81:     }
82: 
83:     function createDebtAndCreditPositions(
84:         State storage state,
85:         address lender,
86:         address borrower,
87:         uint256 issuanceValue,
88:         uint256 faceValue,
89:         uint256 dueDate
90:     ) external returns (DebtPosition memory debtPosition, CreditPosition memory creditPosition) {
91:         debtPosition = DebtPosition({
92:             lender: lender,
93:             borrower: borrower,
94:             issuanceValue: issuanceValue,
95:             faceValue: faceValue,
96:             repayFee: LoanLibrary.repayFee(issuanceValue, block.timestamp, dueDate, state.feeConfig.repayFeeAPR),
97:             startDate: block.timestamp,
98:             dueDate: dueDate,
99:             liquidityIndexAtRepayment: 0
100:         });
101: 
102:         uint256 debtPositionId = state.data.nextDebtPositionId++;
103:         state.data.debtPositions[debtPositionId] = debtPosition;
104: 
105:         emit Events.CreateDebtPosition(debtPositionId, lender, borrower, issuanceValue, faceValue, dueDate);
106: 
107:         creditPosition =
108:             CreditPosition({lender: lender, credit: debtPosition.faceValue, debtPositionId: debtPositionId});
109: 
110:         uint256 creditPositionId = state.data.nextCreditPositionId++;
111:         state.data.creditPositions[creditPositionId] = creditPosition;
112:         state.validateMinimumCreditOpening(creditPosition.credit);
113: 
114:         emit Events.CreateCreditPosition(creditPositionId, lender, RESERVED_ID, debtPositionId, creditPosition.credit);
115:     }
116: 
117:     function createCreditPosition(State storage state, uint256 exitCreditPositionId, address lender, uint256 credit)
118:         external
119:         returns (CreditPosition memory creditPosition)
120:     {
121:         uint256 debtPositionId = state.getDebtPositionIdByCreditPositionId(exitCreditPositionId);
122:         CreditPosition storage exitPosition = state.data.creditPositions[exitCreditPositionId];
123: 
124:         creditPosition = CreditPosition({lender: lender, credit: credit, debtPositionId: debtPositionId});
125: 
126:         uint256 creditPositionId = state.data.nextCreditPositionId++;
127:         state.data.creditPositions[creditPositionId] = creditPosition;
128: 
129:         exitPosition.credit -= credit;
130:         state.validateMinimumCredit(exitPosition.credit);
131:         state.validateMinimumCreditOpening(creditPosition.credit);
132: 
133:         emit Events.CreateCreditPosition(creditPositionId, lender, exitCreditPositionId, debtPositionId, credit);
134:     }
135: }
136: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol";
5: import {YieldCurve} from "@src/libraries/fixed/YieldCurveLibrary.sol";
6: import {
7:     InitializeDataParams,
8:     InitializeFeeConfigParams,
9:     InitializeOracleParams,
10:     InitializeRiskConfigParams
11: } from "@src/libraries/general/actions/Initialize.sol";
12: 
13: // solhint-disable var-name-mixedcase
14: /// @title Events
15: library Events {
16:     // general
17: 
18:     event Initialize(
19:         InitializeFeeConfigParams indexed f,
20:         InitializeRiskConfigParams indexed r,
21:         InitializeOracleParams indexed o,
22:         InitializeDataParams d
23:     );
24:     event UpdateConfig(bytes32 indexed key, uint256 value);
25:     event CreateVault(address indexed user, address indexed vault, bool indexed variable);
26:     event Deposit(address indexed token, address indexed to, bool indexed variable, uint256 amount);
27:     event Withdraw(address indexed token, address indexed to, bool indexed variable, uint256 amount);
28: 
29:     // variable
30: 
31:     event BorrowVariable(address indexed to, uint256 indexed amount);
32:     event RepayVariable(uint256 indexed amount);
33:     event LiquidateVariable(address indexed borrower, uint256 indexed amount);
34: 
35:     // fixed
36: 
37:     event BorrowAsMarketOrder(
38:         address indexed lender,
39:         uint256 indexed amount,
40:         uint256 indexed dueDate,
41:         bool exactAmountIn,
42:         uint256[] receivableCreditPositionIds
43:     );
44:     event BorrowAsLimitOrder(YieldCurve indexed curveRelativeTime);
45:     event LendAsMarketOrder(
46:         address indexed borrower, uint256 indexed dueDate, uint256 indexed amount, bool exactAmountIn
47:     );
48:     event LendAsLimitOrder(uint256 indexed maxDueDate, YieldCurve indexed curveRelativeTime);
49:     event CreateDebtPosition(
50:         uint256 indexed debtPositionId,
51:         address indexed lender,
52:         address indexed borrower,
53:         uint256 issuanceValue,
54:         uint256 faceValue,
55:         uint256 dueDate
56:     );
57:     event CreateCreditPosition(
58:         uint256 indexed creditPositionId,
59:         address indexed lender,
60:         uint256 indexed exitPositionId,
61:         uint256 debtPositionId,
62:         uint256 credit
63:     );
64:     event BorrowerExit(uint256 indexed debtPositionId, address indexed borrowerExitedTo);
65:     event Repay(uint256 indexed debtPositionId);
66:     event Claim(uint256 indexed creditPositionId);
67:     event Liquidate(
68:         uint256 indexed debtPositionId,
69:         uint256 indexed minimumCollateralProfit,
70:         uint256 indexed collateralRatio,
71:         LoanStatus loanStatus
72:     );
73:     event SelfLiquidate(uint256 indexed creditPositionId);
74:     event LiquidateWithReplacement(
75:         uint256 indexed debtPositionId, address indexed borrower, uint256 indexed minimumCollateralProfit
76:     );
77:     event LiquidateUserLiquidatableProfitably(uint256 indexed debtPositionId);
78:     event LiquidateUserLiquidatableUnprofitably(uint256 indexed debtPositionId);
79:     event LiquidateOverdueMoveToVariablePool(uint256 indexed debtPositionId);
80:     event LiquidateOverdueNoSplitRemainder(uint256 indexed debtPositionId);
81:     event Compensate(
82:         uint256 indexed creditPositionWithDebtToRepayId,
83:         uint256 indexed creditPositionToCompensateId,
84:         uint256 indexed amount
85:     );
86: }
87: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {IAToken} from "@aave/interfaces/IAToken.sol";
5: import {IPool} from "@aave/interfaces/IPool.sol";
6: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";
7: 
8: import {PERCENT} from "@src/libraries/Math.sol";
9: import {CREDIT_POSITION_ID_START, DEBT_POSITION_ID_START} from "@src/libraries/fixed/LoanLibrary.sol";
10: 
11: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol";
12: import {IPriceFeed} from "@src/oracle/IPriceFeed.sol";
13: import {NonTransferrableToken} from "@src/token/NonTransferrableToken.sol";
14: 
15: import {Vault} from "@src/proxy/Vault.sol";
16: 
17: import {State} from "@src/SizeStorage.sol";
18: 
19: import {Errors} from "@src/libraries/Errors.sol";
20: import {Events} from "@src/libraries/Events.sol";
21: 
22: struct InitializeFeeConfigParams {
23:     uint256 repayFeeAPR;
24:     uint256 earlyLenderExitFee;
25:     uint256 earlyBorrowerExitFee;
26:     uint256 collateralOverdueTransferFee;
27:     address feeRecipient;
28: }
29: 
30: struct InitializeRiskConfigParams {
31:     uint256 crOpening;
32:     uint256 crLiquidation;
33:     uint256 minimumCreditBorrowAToken;
34:     uint256 collateralSplitLiquidatorPercent;
35:     uint256 collateralSplitProtocolPercent;
36:     uint256 collateralTokenCap;
37:     uint256 borrowATokenCap;
38:     uint256 debtTokenCap;
39:     uint256 moveToVariablePoolHFThreshold;
40:     uint256 minimumMaturity;
41: }
42: 
43: struct InitializeOracleParams {
44:     address priceFeed;
45:     address marketBorrowRateFeed;
46: }
47: 
48: struct InitializeDataParams {
49:     address underlyingCollateralToken;
50:     address underlyingBorrowToken;
51:     address variablePool;
52: }
53: 
54: /// @title Initialize
55: /// @notice Contains the logic to initialize the protocol
56: /// @dev The collateralToken (e.g. szETH) and debtToken (e.g. szDebt) are created in the `executeInitialize` function
57: ///      The borrowAToken (e.g. aszUSDC) is deployed on the Size Variable Pool (Aave v3 fork)
58: library Initialize {
59:     function validateOwner(address owner) internal pure {
60:         if (owner == address(0)) {
61:             revert Errors.NULL_ADDRESS();
62:         }
63:     }
64: 
65:     function validateInitializeFeeConfigParams(InitializeFeeConfigParams memory f) internal pure {
66:         // validate repayFeeAPR
67:         // N/A
68: 
69:         // validate earlyLenderExitFee
70:         // N/A
71: 
72:         // validate earlyBorrowerExitFee
73:         // N/A
74: 
75:         // validate collateralOverdueTransferFee
76:         // N/A
77: 
78:         // validate feeRecipient
79:         if (f.feeRecipient == address(0)) {
80:             revert Errors.NULL_ADDRESS();
81:         }
82:     }
83: 
84:     function validateInitializeRiskConfigParams(InitializeRiskConfigParams memory r) internal pure {
85:         // validate crOpening
86:         if (r.crOpening < PERCENT) {
87:             revert Errors.INVALID_COLLATERAL_RATIO(r.crOpening);
88:         }
89: 
90:         // validate crLiquidation
91:         if (r.crLiquidation < PERCENT) {
92:             revert Errors.INVALID_COLLATERAL_RATIO(r.crLiquidation);
93:         }
94:         if (r.crOpening <= r.crLiquidation) {
95:             revert Errors.INVALID_LIQUIDATION_COLLATERAL_RATIO(r.crOpening, r.crLiquidation);
96:         }
97: 
98:         // validate minimumCreditBorrowAToken
99:         if (r.minimumCreditBorrowAToken == 0) {
100:             revert Errors.NULL_AMOUNT();
101:         }
102: 
103:         // validate collateralSplitLiquidatorPercent
104:         if (r.collateralSplitLiquidatorPercent > PERCENT) {
105:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM(r.collateralSplitLiquidatorPercent);
106:         }
107: 
108:         // validate collateralSplitProtocolPercent
109:         if (r.collateralSplitProtocolPercent > PERCENT) {
110:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM(r.collateralSplitProtocolPercent);
111:         }
112:         if (r.collateralSplitLiquidatorPercent + r.collateralSplitProtocolPercent > PERCENT) {
113:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM_SUM(
114:                 r.collateralSplitLiquidatorPercent + r.collateralSplitProtocolPercent
115:             );
116:         }
117: 
118:         // validate underlyingCollateralTokenCap
119:         // N/A
120: 
121:         // validate underlyingBorrowTokenCap
122:         // N/A
123: 
124:         // validate debtTokenCap
125:         // N/A
126: 
127:         // validate moveToVariablePoolHFThreshold
128:         if (r.moveToVariablePoolHFThreshold < PERCENT) {
129:             revert Errors.INVALID_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(r.moveToVariablePoolHFThreshold);
130:         }
131: 
132:         // validate minimumMaturity
133:         if (r.minimumMaturity == 0) {
134:             revert Errors.NULL_AMOUNT();
135:         }
136:     }
137: 
138:     function validateInitializeOracleParams(InitializeOracleParams memory o) internal view {
139:         // validate priceFeed
140:         if (o.priceFeed == address(0)) {
141:             revert Errors.NULL_ADDRESS();
142:         }
143:         IPriceFeed(o.priceFeed).getPrice();
144: 
145:         // validate marketBorrowRateFeed
146:         if (o.marketBorrowRateFeed == address(0)) {
147:             revert Errors.NULL_ADDRESS();
148:         }
149:         IMarketBorrowRateFeed(o.marketBorrowRateFeed).getMarketBorrowRate();
150:     }
151: 
152:     function validateInitializeDataParams(InitializeDataParams memory d) internal pure {
153:         // validate underlyingCollateralToken
154:         if (d.underlyingCollateralToken == address(0)) {
155:             revert Errors.NULL_ADDRESS();
156:         }
157: 
158:         // validate underlyingBorrowToken
159:         if (d.underlyingBorrowToken == address(0)) {
160:             revert Errors.NULL_ADDRESS();
161:         }
162: 
163:         // validate variablePool
164:         if (d.variablePool == address(0)) {
165:             revert Errors.NULL_ADDRESS();
166:         }
167:     }
168: 
169:     function validateInitialize(
170:         State storage,
171:         address owner,
172:         InitializeFeeConfigParams memory f,
173:         InitializeRiskConfigParams memory r,
174:         InitializeOracleParams memory o,
175:         InitializeDataParams memory d
176:     ) external view {
177:         validateOwner(owner);
178:         validateInitializeFeeConfigParams(f);
179:         validateInitializeRiskConfigParams(r);
180:         validateInitializeOracleParams(o);
181:         validateInitializeDataParams(d);
182:     }
183: 
184:     function executeInitializeFeeConfig(State storage state, InitializeFeeConfigParams memory f) internal {
185:         state.feeConfig.repayFeeAPR = f.repayFeeAPR;
186: 
187:         state.feeConfig.earlyLenderExitFee = f.earlyLenderExitFee;
188:         state.feeConfig.earlyBorrowerExitFee = f.earlyBorrowerExitFee;
189: 
190:         state.feeConfig.collateralOverdueTransferFee = f.collateralOverdueTransferFee;
191: 
192:         state.feeConfig.feeRecipient = f.feeRecipient;
193:     }
194: 
195:     function executeInitializeRiskConfig(State storage state, InitializeRiskConfigParams memory r) internal {
196:         state.riskConfig.crOpening = r.crOpening;
197:         state.riskConfig.crLiquidation = r.crLiquidation;
198: 
199:         state.riskConfig.minimumCreditBorrowAToken = r.minimumCreditBorrowAToken;
200: 
201:         state.riskConfig.collateralSplitLiquidatorPercent = r.collateralSplitLiquidatorPercent;
202:         state.riskConfig.collateralSplitProtocolPercent = r.collateralSplitProtocolPercent;
203: 
204:         state.riskConfig.collateralTokenCap = r.collateralTokenCap;
205:         state.riskConfig.borrowATokenCap = r.borrowATokenCap;
206:         state.riskConfig.debtTokenCap = r.debtTokenCap;
207: 
208:         state.riskConfig.moveToVariablePoolHFThreshold = r.moveToVariablePoolHFThreshold;
209:         state.riskConfig.minimumMaturity = r.minimumMaturity;
210:     }
211: 
212:     function executeInitializeOracle(State storage state, InitializeOracleParams memory o) internal {
213:         state.oracle.priceFeed = IPriceFeed(o.priceFeed);
214:         state.oracle.marketBorrowRateFeed = IMarketBorrowRateFeed(o.marketBorrowRateFeed);
215:     }
216: 
217:     function executeInitializeData(State storage state, InitializeDataParams memory d) internal {
218:         state.data.nextDebtPositionId = DEBT_POSITION_ID_START;
219:         state.data.nextCreditPositionId = CREDIT_POSITION_ID_START;
220: 
221:         state.data.underlyingCollateralToken = IERC20Metadata(d.underlyingCollateralToken);
222:         state.data.underlyingBorrowToken = IERC20Metadata(d.underlyingBorrowToken);
223:         state.data.variablePool = IPool(d.variablePool);
224: 
225:         state.data.collateralToken = new NonTransferrableToken(
226:             address(this),
227:             string.concat("Size Fixed ", IERC20Metadata(state.data.underlyingCollateralToken).name()),
228:             string.concat("sz", IERC20Metadata(state.data.underlyingCollateralToken).symbol()),
229:             IERC20Metadata(state.data.underlyingCollateralToken).decimals()
230:         );
231:         state.data.borrowAToken =
232:             IAToken(state.data.variablePool.getReserveData(address(state.data.underlyingBorrowToken)).aTokenAddress);
233:         state.data.collateralAToken =
234:             IAToken(state.data.variablePool.getReserveData(address(state.data.underlyingCollateralToken)).aTokenAddress);
235:         state.data.debtToken = new NonTransferrableToken(
236:             address(this), "Size Fixed Debt", "szDebt", IERC20Metadata(state.data.underlyingBorrowToken).decimals()
237:         );
238: 
239:         state.data.vaultImplementation = new Vault();
240:     }
241: 
242:     function executeInitialize(
243:         State storage state,
244:         InitializeFeeConfigParams memory f,
245:         InitializeRiskConfigParams memory r,
246:         InitializeOracleParams memory o,
247:         InitializeDataParams memory d
248:     ) external {
249:         executeInitializeFeeConfig(state, f);
250:         executeInitializeRiskConfig(state, r);
251:         executeInitializeOracle(state, o);
252:         executeInitializeData(state, d);
253:         emit Events.Initialize(f, r, o, d);
254:     }
255: }
256: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {BorrowAsLimitOrderParams} from "@src/libraries/fixed/actions/BorrowAsLimitOrder.sol";
5: import {BorrowAsMarketOrderParams} from "@src/libraries/fixed/actions/BorrowAsMarketOrder.sol";
6: 
7: import {BorrowerExitParams} from "@src/libraries/fixed/actions/BorrowerExit.sol";
8: import {ClaimParams} from "@src/libraries/fixed/actions/Claim.sol";
9: 
10: import {LendAsLimitOrderParams} from "@src/libraries/fixed/actions/LendAsLimitOrder.sol";
11: import {LendAsMarketOrderParams} from "@src/libraries/fixed/actions/LendAsMarketOrder.sol";
12: import {LiquidateParams} from "@src/libraries/fixed/actions/Liquidate.sol";
13: import {DepositParams} from "@src/libraries/general/actions/Deposit.sol";
14: 
15: import {LiquidateWithReplacementParams} from "@src/libraries/fixed/actions/LiquidateWithReplacement.sol";
16: import {RepayParams} from "@src/libraries/fixed/actions/Repay.sol";
17: import {SelfLiquidateParams} from "@src/libraries/fixed/actions/SelfLiquidate.sol";
18: 
19: import {CompensateParams} from "@src/libraries/fixed/actions/Compensate.sol";
20: import {WithdrawParams} from "@src/libraries/general/actions/Withdraw.sol";
21: 
22: import {BorrowVariableParams} from "@src/libraries/variable/actions/BorrowVariable.sol";
23: import {LiquidateVariableParams} from "@src/libraries/variable/actions/LiquidateVariable.sol";
24: import {RepayVariableParams} from "@src/libraries/variable/actions/RepayVariable.sol";
25: 
26: /// @title ISize
27: /// @author Size Lending
28: /// @notice This interface is the main interface for all user-facing methods of the Size v2 protocol
29: interface ISize {
30:     /// @notice Deposit underlying borrow/collateral tokens to the protocol (e.g. USDC, WETH)
31:     ///         Borrow tokens are always deposited into the Variable Pool,
32:     ///         wheteher `variable` is passed as `true` or `false`. The difference is that a `true`
33:     ///         value means this deposit is destined for variable-rate lending only, while a `false` value
34:     ///         means this deposit is destined for both fixed-rate lending and variable-rate lending.
35:     ///         Collateral tokens are deposited into the Variable Pool only if the user passes
36:     ///         `variable` as `true`. If `variable` is `false`, the collateral tokens are deposited
37:     ///         into the Size contract through the CollateralLibrary.
38:     /// @dev The caller must approve the transfer of the token to the protocol.
39:     ///      This function mints 1:1 szTokens (e.g. aszUSDC, szETH) in exchange of the deposited tokens
40:     /// @param params DepositParams struct containing the following fields:
41:     ///     - address token: The address of the token to deposit
42:     ///     - uint256 amount: The amount of tokens to deposit
43:     ///     - uint256 to: The recipient of the deposit
44:     ///     - bool variable: Whether the deposit is destined for variable-rate lending or fixed-rate lending
45:     function deposit(DepositParams calldata params) external;
46: 
47:     /// @notice Withdraw underlying borrow/collateral tokens from the protocol (e.g. USDC, WETH)
48:     ///         Borrow tokens are always withdrawn into the Variable Pool,
49:     ///         wheteher `variable` is passed as `true` or `false`. The difference is that a `true`
50:     ///         value means the withdrawal is taken from variable-rate lending, while a `false` value
51:     ///         means the withdrawal is taken for both fixed-rate lending and variable-rate lending.
52:     ///         Collateral tokens are withdrawn from the Variable Pool only if the user passes
53:     ///         `variable` as `true`. If `variable` is `false`, the collateral tokens are withdrawn
54:     ///         from the Size contract through the CollateralLibrary.
55:     /// @dev This function burns 1:1 szTokens (e.g. aszUSDC, szETH) in exchange of the withdrawn tokens
56:     /// @param params WithdrawParams struct containing the following fields:
57:     ///     - address token: The address of the token to withdraw
58:     ///     - uint256 amount: The amount of tokens to withdraw (in decimals, e.g. 1_000e6 for 1000 USDC or 10e18 for 10 WETH)
59:     ///     - uint256 to: The recipient of the withdrawal
60:     ///     - bool variable: Whether the deposit is destined for variable-rate lending or fixed-rate lending
61:     function withdraw(WithdrawParams calldata params) external;
62: 
63:     /// @notice Picks a lender offer and borrow tokens from the orderbook
64:     ///         When using receivable credit positions as credit, the early exit lender fee is applied to the borrower
65:     /// @dev The `amount` parameter is altered by the function, which is why the `params` argument is marked as `memory`
66:     ///      Order "takers" are the ones who pay the rounding, since "makers" are the ones passively waiting for an order to be matched
67:     /// @param params BorrowAsMarketOrderParams struct containing the following fields:
68:     ///     - address lender: The address of the lender
69:     ///     - uint256 amount: The amount of tokens to borrow (in decimals, e.g. 1_000e6 for 1000 aszUSDC)
70:     ///     - uint256 dueDate: The due date of the loan
71:     ///     - bool exactAmountIn: When passing an array of receivable credit position ids, this flag indicates if the amount is value to be returned at due date
72:     ///     - uint256[] receivableCreditPositionIds: The ids of receivable credit positions that can be used as credit to borrow without assigining new collateral
73:     function borrowAsMarketOrder(BorrowAsMarketOrderParams memory params) external;
74: 
75:     /// @notice Places a new borrow offer in the orderbook
76:     /// @param params BorrowAsLimitOrderParams struct containing the following fields:
77:     ///     - uint256 openingLimitBorrowCR: The opening limit borrow collateral ratio, which indicates the maximum CR the borrower is willing to accept after their offer is picked by a lender
78:     ///     - YieldCurve curveRelativeTime: The yield curve for the borrow offer, a struct containing the following fields:
79:     ///         - uint256[] maturities: The relative timestamps of the yield curve (for example, [30 days, 60 days, 90 days])
80:     ///         - uint256[] aprs: The aprs of the yield curve (for example, [0.05e18, 0.07e18, 0.08e18] to represent 5% APR, 7% APR, and 8% APR, linear interest, respectively)
81:     ///         - int256[] marketRateMultipliers: The market rate multipliers of the yield curve (for example, [0.99e18, 1e18, 1.1e18] to represent 99%, 100%, and 110% of the market borrow rate, respectively)
82:     function borrowAsLimitOrder(BorrowAsLimitOrderParams calldata params) external;
83: 
84:     /// @notice Places a new lend offer in the orderbook
85:     /// @param params LendAsMarketOrderParams struct containing the following fields:
86:     ///     - address borrower: The address of the borrower
87:     ///     - uint256 amount: The amount of tokens to lend (in decimals, e.g. 1_000e6 for 1000 aszUSDC)
88:     ///     - uint256 dueDate: The due date of the loan
89:     ///     - bool exactAmountIn: This flag indicates if the amount is the value to be transferred to the borrower or if it should be used to calculate the amount to be transferred
90:     function lendAsMarketOrder(LendAsMarketOrderParams calldata params) external;
91: 
92:     /// @notice Places a new lend offer in the orderbook
93:     /// @param params LendAsLimitOrderParams struct containing the following fields:
94:     ///     - uint256 maxDueDate: The maximum timestamp the limit order can be picked by a borrower (e.g., 1712188800 for April 4th, 2024)
95:     ///     - YieldCurve curveRelativeTime: The yield curve for the lend offer, a struct containing the following fields:
96:     ///         - uint256[] maturities: The relative timestamps of the yield curve (for example, [30 days, 60 days, 90 days])
97:     ///         - uint256[] aprs: The aprs of the yield curve (for example, [0.05e18, 0.07e18, 0.08e18] to represent 5% APR, 7% APR, and 8% APR, linear interest, respectively)
98:     ///         - int256[] marketRateMultipliers: The market rate multipliers of the yield curve (for example, [1e18, 1.2e18, 1.3e18] to represent 100%, 120%, and 130% of the market borrow rate, respectively)
99:     function lendAsLimitOrder(LendAsLimitOrderParams calldata params) external;
100: 
101:     /// @notice Exits a debt position to a new borrower by picking the new borrower offer from the orderbook
102:     ///         When exiting a debt position to a new borrower, the early exit borrower fee is applied to the current borrower
103:     ///         Protocol repayment fees are paid pro rata
104:     ///         1. Previous borrower pays an "early" protocol repay fee pro rata to the block.timestamp, and their debt is reduced by the full protocol repay fee amount
105:     ///         2. previous borrower also pays to the protocol the early borrower exit fee
106:     ///         3. previous borrower transfers to the new borrower FV/(1+r), which is the present value of faceValue adjusted by the rate the new borrower has specified
107:     ///         4. previous borrower debt referring to faceValue is transferred to the new borrower
108:     ///         5. issuanceValue is updated, which in turn updates the protocol repay fees for that loan
109:     ///         6. new borrower debt increases by the updated protocol repay fees
110:     /// @dev The current borrower debt is transferred to the new borrower, together with the borrow tokens according to the new borrower yield curve
111:     /// @param params BorrowerExitParams struct containing the following fields:
112:     ///     - uint256 debtPositionId: The id of the debt position to exit
113:     ///     - address borrowerToExitTo: The address of the borrower to exit to
114:     function borrowerExit(BorrowerExitParams calldata params) external;
115: 
116:     /// @notice Repay a debt position by transferring the amount due of borrow tokens to the protocol, which are deposited to the Variable Pool for the lenders to claim
117:     ///         Partial repayment are currently unsupported
118:     ///         The protocol repay fee is applied upon repayment
119:     /// @dev The Variable Pool liquidity index is snapshotted at the time of the repayment in order to calculate the accrued interest for lenders to claim
120:     /// @param params RepayParams struct containing the following fields:
121:     ///     - uint256 debtPositionId: The id of the debt position to repay
122:     function repay(RepayParams calldata params) external;
123: 
124:     /// @notice Claim the repayment of a loan with accrued interest from the Variable Pool
125:     /// @dev Both ACTIVE and OVERDUE loans can't be claimed because the money is not in the protocol yet.
126:     ///      CLAIMED loans can't be claimed either because its credit has already been consumed entirely either by a previous claim or by exiting before
127:     /// @param params ClaimParams struct containing the following fields:
128:     ///     - uint256 creditPositionId: The id of the credit position to claim
129:     function claim(ClaimParams calldata params) external;
130: 
131:     /// @notice Liquidate a debt position
132:     ///         In case of protifable liquiadtion, part of the collateral remainder is split between the protocol and the liquidator
133:     ///         The protocol repayment fee is charged from the borrower
134:     ///         If the loan is overdue, a move transfer fee is charged from the borrower
135:     ///
136:     ///         The liquidation logic contains the following specification:
137:     ///             if 100% <= CR < CRL:
138:     ///                 liquidate loan and split the collateral remainder
139:     ///             else if 0% <= CR < 100%:
140:     ///                 liquidate unprofitably depending on minCR parameter
141:     ///             else: // CR >= CRL
142:     ///                 if loan is overdue:
143:     ///                     if loan can be moved to the variable pool:
144:     ///                         move loan to the variable pool, charge move transfer fee in collateral from the borrower
145:     ///                     else:
146:     ///                         liquidate loan, do not split the collateral remainder, charge move transfer fee in collateral from the borrower
147:     ///                 else:
148:     ///                     loan cannot be liquidated
149:     /// @param params LiquidateParams struct containing the following fields:
150:     ///     - uint256 debtPositionId: The id of the debt position to liquidate
151:     ///     - uint256 minimumCollateralProfit: The minimum collateral profit that the liquidator is willing to accept from the borrower (keepers might choose to pass a value below 100% of the cash they bring and take the risk of liquidating unprofitably)
152:     function liquidate(LiquidateParams calldata params) external returns (uint256);
153: 
154:     /// @notice Self liquidate a credit position that is undercollateralized
155:     ///         The lender cancels an amount of debt equivalent to their credit and a percentage of the protocol fees
156:     /// @dev Due to always rounding fees up, it is possible that fees become greater than the debt balance after a partial repayment
157:     ///      This can be mitigated by either rounding fees down, which is not ideal, or by capping the burned/transferred amount to the user balance
158:     ///      Example:
159:     ///               Alice borrows $100 due 1 year with a 0.5% APR repay fee. Her debt is $100.50.
160:     ///               The first lender exits to another lender, and now there are two credit positions, $94.999999 and $5.000001.
161:     ///               If the first lender self liquidates, the pro-rata repay fee will be $0.475, and the borrower's debt will be updated to $5.025001.
162:     ///               Then, on the second lender self liquidation, the pro-rata repay fee will be $0.025001 due to rounding up, and the borrower's debt would underflow due to the reduction of $5.000001 + $0.025001 = $5.025002.
163:     /// @param params SelfLiquidateParams struct containing the following fields:
164:     ///     - uint256 creditPositionId: The id of the credit position to self-liquidate
165:     function selfLiquidate(SelfLiquidateParams calldata params) external;
166: 
167:     /// @notice Liquidate a debt position with a replacement borrower
168:     /// @dev This function works exactly like `liquidate`, with an added logic of replacing the borrower on the storage
169:     ///         When liquidating with replacement, nothing changes from the lender's perspective, but a spread is created between the previous borrower rate and the new borrower rate.
170:     ///         As a result of the spread of these borrow aprs, the protocol is able to profit from the liquidation. Since the choice of the borrower impacts on the protocol's profit, this method is permissioned
171:     /// @param params LiquidateWithReplacementParams struct containing the following fields:
172:     ///     - uint256 debtPositionId: The id of the debt position to liquidate
173:     ///     - uint256 minimumCollateralProfit: The minimum collateral profit that the liquidator is willing to accept from the borrower (keepers might choose to pass a value below 100% of the cash they bring and take the risk of liquidating unprofitably)
174:     ///     - address borrower: The address of the replacement borrower
175:     function liquidateWithReplacement(LiquidateWithReplacementParams calldata params)
176:         external
177:         returns (uint256, uint256);
178: 
179:     /// @notice Compensate a borrower's debt with his credit in another loan
180:     ///         The compensation can not exceed both 1) the credit the lender of `debtPositionToRepayId` to the borrower and 2) the credit the lender of `creditPositionToCompensateId`
181:     /// @param params CompensateParams struct containing the following fields:
182:     ///     - uint256 debtPositionToRepayId: The id of the debt position to repay
183:     ///     - uint256 creditPositionToCompensateId: The id of the credit position to compensate
184:     ///     - uint256 amount: The amount of tokens to compensate (in decimals, e.g. 1_000e6 for 1000 aszUSDC)
185:     function compensate(CompensateParams calldata params) external;
186: 
187:     /// @notice Check if an account is allowlisted to interact with the Variable Pool
188:     /// @dev Only vaults should be allowlisted. See `UserLibrary`
189:     /// @param account The address of the account to check
190:     /// @return Whether the account is allowlisted
191:     function variablePoolAllowlisted(address account) external returns (bool);
192: 
193:     /// @notice Borrow a variable loan by forwarding a call from the user proxy to the Variable Pool `borrow`
194:     /// @param params BorrowVariableParams struct containing the following fields:
195:     ///     - address to: The recipient address
196:     ///     - uint256 amount: The amount to borrow
197:     function borrowVariable(BorrowVariableParams calldata params) external;
198: 
199:     /// @notice Repay a variable loan by forwarding a call from the user proxy to the Variable Pool `repayWithATokens`
200:     /// @param params RepayVariableParams struct containing the following fields:
201:     ///     - uint256 amount: The amount to repay
202:     function repayVariable(RepayVariableParams calldata params) external;
203: 
204:     /// @notice Liquidate a variable loan by forwarding a call from the user proxy to the Variable Pool `liquidationCall`
205:     /// @param params RepayVariableParams struct containing the following fields:
206:     ///     - address borrower: The liquidated address
207:     ///     - uint256 amount: The debt amount to cover
208:     function liquidateVariable(LiquidateVariableParams calldata params) external;
209: }
210: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: 
6: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
7: 
8: import {Errors} from "@src/libraries/Errors.sol";
9: import {Events} from "@src/libraries/Events.sol";
10: 
11: struct BorrowVariableParams {
12:     address to;
13:     uint256 amount;
14: }
15: 
16: library BorrowVariable {
17:     using VariableLibrary for State;
18: 
19:     function validateBorrowVariable(State storage, BorrowVariableParams calldata params) external pure {
20:         // validte msg.sender
21:         // N/A
22: 
23:         // validate to
24:         if (params.to == address(0)) {
25:             revert Errors.NULL_ADDRESS();
26:         }
27: 
28:         // validate amount
29:         if (params.amount == 0) {
30:             revert Errors.NULL_AMOUNT();
31:         }
32:     }
33: 
34:     function executeBorrowVariable(State storage state, BorrowVariableParams calldata params) public {
35:         state.borrowVariableLoan(msg.sender, params.to, params.amount);
36:         emit Events.BorrowVariable(params.to, params.amount);
37:     }
38: }
39: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {Math} from "@src/libraries/Math.sol";
5: import {CreditPosition, DebtPosition, LoanLibrary, LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol";
6: 
7: import {State} from "@src/SizeStorage.sol";
8: 
9: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol";
10: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
11: 
12: import {Errors} from "@src/libraries/Errors.sol";
13: import {Events} from "@src/libraries/Events.sol";
14: 
15: struct ClaimParams {
16:     uint256 creditPositionId;
17: }
18: 
19: library Claim {
20:     using VariableLibrary for State;
21:     using LoanLibrary for CreditPosition;
22:     using LoanLibrary for State;
23:     using AccountingLibrary for State;
24: 
25:     function validateClaim(State storage state, ClaimParams calldata params) external view {
26:         CreditPosition storage creditPosition = state.getCreditPosition(params.creditPositionId);
27:         // validate msg.sender
28:         // N/A
29: 
30:         // validate creditPositionId
31:         if (state.getLoanStatus(params.creditPositionId) != LoanStatus.REPAID) {
32:             revert Errors.LOAN_NOT_REPAID(params.creditPositionId);
33:         }
34:         if (creditPosition.credit == 0) {
35:             revert Errors.CREDIT_POSITION_ALREADY_CLAIMED(params.creditPositionId);
36:         }
37:     }
38: 
39:     function executeClaim(State storage state, ClaimParams calldata params) external {
40:         CreditPosition storage creditPosition = state.getCreditPosition(params.creditPositionId);
41:         DebtPosition storage debtPosition = state.getDebtPositionByCreditPositionId(params.creditPositionId);
42: 
43:         uint256 claimAmount = Math.mulDivDown(
44:             creditPosition.credit, state.borrowATokenLiquidityIndex(), debtPosition.liquidityIndexAtRepayment
45:         );
46:         creditPosition.credit = 0;
47:         state.transferBorrowATokenFixed(address(this), creditPosition.lender, claimAmount);
48: 
49:         emit Events.Claim(params.creditPositionId);
50:     }
51: }
52: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: 
6: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
7: 
8: import {Errors} from "@src/libraries/Errors.sol";
9: import {Events} from "@src/libraries/Events.sol";
10: 
11: struct LiquidateVariableParams {
12:     address borrower;
13:     uint256 amount;
14: }
15: 
16: library LiquidateVariable {
17:     using VariableLibrary for State;
18: 
19:     function validateLiquidateVariable(State storage, LiquidateVariableParams calldata params) external pure {
20:         // validte msg.sender
21:         // N/A
22: 
23:         // validate borrower
24:         if (params.borrower == address(0)) {
25:             revert Errors.NULL_ADDRESS();
26:         }
27: 
28:         // validate amount
29:         if (params.amount == 0) {
30:             revert Errors.NULL_AMOUNT();
31:         }
32:     }
33: 
34:     function executeLiquidateVariable(State storage state, LiquidateVariableParams calldata params) public {
35:         state.liquidateVariableLoan(msg.sender, params.borrower, params.amount);
36:         emit Events.LiquidateVariable(params.borrower, params.amount);
37:     }
38: }
39: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {IAaveOracle} from "@aave/interfaces/IAaveOracle.sol";
5: import {Math} from "@src/libraries/Math.sol";
6: 
7: import {IPriceFeed} from "./IPriceFeed.sol";
8: import {Errors} from "@src/libraries/Errors.sol";
9: 
10: /// @title VariablePoolPriceFeed
11: /// @notice A contract that provides the price of an asset in terms of another asset by interacting with the Variable Pool Price Feed
12: /// @dev The price is calculated as `base / quote`. Example configuration:
13: ///      _base: ETH/USD feed
14: ///      _quote: USDC/USD feed
15: ///      _decimals: 18
16: ///      answer: ETH/USDC in 1e18
17: contract VariablePoolPriceFeed is IPriceFeed {
18:     /* solhint-disable immutable-vars-naming */
19:     IAaveOracle public immutable aaveOracle;
20:     address public immutable base;
21:     uint8 public immutable baseDecimals;
22:     address public immutable quote;
23:     uint8 public immutable quoteDecimals;
24:     uint8 public immutable decimals;
25:     /* solhint-enable immutable-vars-naming */
26: 
27:     constructor(
28:         address _aaveOracle,
29:         address _base,
30:         uint8 _baseDecimals,
31:         address _quote,
32:         uint8 _quoteDecimals,
33:         uint8 _decimals
34:     ) {
35:         if (_aaveOracle == address(0) || _base == address(0) || _quote == address(0)) {
36:             revert Errors.NULL_ADDRESS();
37:         }
38: 
39:         if (_decimals == 0 || _decimals > 18) {
40:             revert Errors.INVALID_DECIMALS(_decimals);
41:         }
42: 
43:         if (_baseDecimals == 0 || _baseDecimals > 18 || _quoteDecimals == 0 || _quoteDecimals > 18) {
44:             revert Errors.INVALID_DECIMALS(_baseDecimals);
45:         }
46: 
47:         aaveOracle = IAaveOracle(_aaveOracle);
48:         base = _base;
49:         baseDecimals = _baseDecimals;
50:         quote = _quote;
51:         quoteDecimals = _quoteDecimals;
52:         decimals = _decimals;
53:     }
54: 
55:     function getPrice() external view returns (uint256) {
56:         uint256 basePrice = aaveOracle.getAssetPrice(base);
57:         uint256 quotePrice = aaveOracle.getAssetPrice(quote);
58:         return Math.mulDivDown(
59:             _scalePrice(basePrice, baseDecimals, decimals),
60:             10 ** decimals,
61:             _scalePrice(quotePrice, quoteDecimals, decimals)
62:         );
63:     }
64: 
65:     function _scalePrice(uint256 _price, uint8 _priceDecimals, uint8 _decimals) internal pure returns (uint256) {
66:         if (_priceDecimals < _decimals) {
67:             return _price * (10 ** uint256(_decimals - _priceDecimals));
68:         } else if (_priceDecimals > _decimals) {
69:             return _price / (10 ** uint256(_priceDecimals - _decimals));
70:         } else {
71:             return _price;
72:         }
73:     }
74: }
75: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";
5: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
6: 
7: import {State} from "@src/SizeStorage.sol";
8: 
9: /// @title CollateralLibrary
10: /// @notice Contains functions for interacting with the underlying collateral token (e.g. WETH)
11: /// @dev Mints and burns 1:1 the collateral token (e.g. szETH)
12: library CollateralLibrary {
13:     using SafeERC20 for IERC20Metadata;
14: 
15:     function depositUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) external {
16:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
17:         underlyingCollateralToken.transferFrom(from, address(this), amount);
18:         state.data.collateralToken.mint(to, amount);
19:     }
20: 
21:     function withdrawUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount)
22:         external
23:     {
24:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
25:         state.data.collateralToken.burn(from, amount);
26:         underlyingCollateralToken.safeTransfer(to, amount);
27:     }
28: }
29: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: import {Errors} from "@src/libraries/Errors.sol";
6: import {Events} from "@src/libraries/Events.sol";
7: import {Initialize} from "@src/libraries/general/actions/Initialize.sol";
8: 
9: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol";
10: import {IPriceFeed} from "@src/oracle/IPriceFeed.sol";
11: 
12: import {
13:     InitializeDataParams,
14:     InitializeFeeConfigParams,
15:     InitializeOracleParams,
16:     InitializeRiskConfigParams
17: } from "@src/libraries/general/actions/Initialize.sol";
18: 
19: struct UpdateConfigParams {
20:     bytes32 key;
21:     uint256 value;
22: }
23: 
24: /// @title UpdateConfig
25: /// @notice Contains the logic to update the configuration of the protocol
26: /// @dev The input validation is performed using the Initialize library
27: ///      A `key` bytes32 string is used to identify the configuration parameter to update and a `value` uint256 is used to set the new value
28: ///      In case where an address is being updated, the `value` is converted to `uint160` and then to `address`
29: library UpdateConfig {
30:     using Initialize for State;
31: 
32:     function feeConfigParams(State storage state) public view returns (InitializeFeeConfigParams memory) {
33:         return InitializeFeeConfigParams({
34:             repayFeeAPR: state.feeConfig.repayFeeAPR,
35:             earlyLenderExitFee: state.feeConfig.earlyLenderExitFee,
36:             earlyBorrowerExitFee: state.feeConfig.earlyBorrowerExitFee,
37:             collateralOverdueTransferFee: state.feeConfig.collateralOverdueTransferFee,
38:             feeRecipient: state.feeConfig.feeRecipient
39:         });
40:     }
41: 
42:     function riskConfigParams(State storage state) public view returns (InitializeRiskConfigParams memory) {
43:         return InitializeRiskConfigParams({
44:             crOpening: state.riskConfig.crOpening,
45:             crLiquidation: state.riskConfig.crLiquidation,
46:             minimumCreditBorrowAToken: state.riskConfig.minimumCreditBorrowAToken,
47:             collateralSplitLiquidatorPercent: state.riskConfig.collateralSplitLiquidatorPercent,
48:             collateralSplitProtocolPercent: state.riskConfig.collateralSplitProtocolPercent,
49:             collateralTokenCap: state.riskConfig.collateralTokenCap,
50:             borrowATokenCap: state.riskConfig.borrowATokenCap,
51:             debtTokenCap: state.riskConfig.debtTokenCap,
52:             moveToVariablePoolHFThreshold: state.riskConfig.moveToVariablePoolHFThreshold,
53:             minimumMaturity: state.riskConfig.minimumMaturity
54:         });
55:     }
56: 
57:     function oracleParams(State storage state) public view returns (InitializeOracleParams memory) {
58:         return InitializeOracleParams({
59:             priceFeed: address(state.oracle.priceFeed),
60:             marketBorrowRateFeed: address(state.oracle.marketBorrowRateFeed)
61:         });
62:     }
63: 
64:     function dataParams(State storage state) public view returns (InitializeDataParams memory) {
65:         return InitializeDataParams({
66:             underlyingCollateralToken: address(state.data.underlyingCollateralToken),
67:             underlyingBorrowToken: address(state.data.underlyingBorrowToken),
68:             variablePool: address(state.data.variablePool)
69:         });
70:     }
71: 
72:     function validateUpdateConfig(State storage, UpdateConfigParams calldata) external pure {
73:         // validation is done at execution
74:     }
75: 
76:     function executeUpdateConfig(State storage state, UpdateConfigParams calldata params) external {
77:         if (params.key == "crOpening") {
78:             state.riskConfig.crOpening = params.value;
79:         } else if (params.key == "crLiquidation") {
80:             state.riskConfig.crLiquidation = params.value;
81:         } else if (params.key == "minimumCreditBorrowAToken") {
82:             state.riskConfig.minimumCreditBorrowAToken = params.value;
83:         } else if (params.key == "collateralSplitLiquidatorPercent") {
84:             state.riskConfig.collateralSplitLiquidatorPercent = params.value;
85:         } else if (params.key == "collateralSplitProtocolPercent") {
86:             state.riskConfig.collateralSplitProtocolPercent = params.value;
87:         } else if (params.key == "collateralTokenCap") {
88:             state.riskConfig.collateralTokenCap = params.value;
89:         } else if (params.key == "borrowATokenCap") {
90:             state.riskConfig.borrowATokenCap = params.value;
91:         } else if (params.key == "debtTokenCap") {
92:             state.riskConfig.debtTokenCap = params.value;
93:         } else if (params.key == "moveToVariablePoolHFThreshold") {
94:             state.riskConfig.moveToVariablePoolHFThreshold = params.value;
95:         } else if (params.key == "minimumMaturity") {
96:             state.riskConfig.minimumMaturity = params.value;
97:         } else if (params.key == "repayFeeAPR") {
98:             state.feeConfig.repayFeeAPR = params.value;
99:         } else if (params.key == "earlyLenderExitFee") {
100:             state.feeConfig.earlyLenderExitFee = params.value;
101:         } else if (params.key == "earlyBorrowerExitFee") {
102:             state.feeConfig.earlyBorrowerExitFee = params.value;
103:         } else if (params.key == "collateralOverdueTransferFee") {
104:             state.feeConfig.collateralOverdueTransferFee = params.value;
105:         } else if (params.key == "feeRecipient") {
106:             state.feeConfig.feeRecipient = address(uint160(params.value));
107:         } else if (params.key == "priceFeed") {
108:             state.oracle.priceFeed = IPriceFeed(address(uint160(params.value)));
109:         } else if (params.key == "marketBorrowRateFeed") {
110:             state.oracle.marketBorrowRateFeed = IMarketBorrowRateFeed(address(uint160(params.value)));
111:         } else {
112:             revert Errors.INVALID_KEY(params.key);
113:         }
114: 
115:         Initialize.validateInitializeFeeConfigParams(feeConfigParams(state));
116:         Initialize.validateInitializeRiskConfigParams(riskConfigParams(state));
117:         Initialize.validateInitializeOracleParams(oracleParams(state));
118: 
119:         emit Events.UpdateConfig(params.key, params.value);
120:     }
121: }
122: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {AccessControlUpgradeable} from "@openzeppelin/contracts-upgradeable/access/AccessControlUpgradeable.sol";
5: 
6: import {Initializable} from "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
7: import {UUPSUpgradeable} from "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";
8: import {MulticallUpgradeable} from "@openzeppelin/contracts-upgradeable/utils/MulticallUpgradeable.sol";
9: import {PausableUpgradeable} from "@openzeppelin/contracts-upgradeable/utils/PausableUpgradeable.sol";
10: 
11: import {
12:     Initialize,
13:     InitializeDataParams,
14:     InitializeFeeConfigParams,
15:     InitializeOracleParams,
16:     InitializeRiskConfigParams
17: } from "@src/libraries/general/actions/Initialize.sol";
18: import {UpdateConfig, UpdateConfigParams} from "@src/libraries/general/actions/UpdateConfig.sol";
19: 
20: import {BorrowAsLimitOrder, BorrowAsLimitOrderParams} from "@src/libraries/fixed/actions/BorrowAsLimitOrder.sol";
21: import {BorrowAsMarketOrder, BorrowAsMarketOrderParams} from "@src/libraries/fixed/actions/BorrowAsMarketOrder.sol";
22: 
23: import {BorrowerExit, BorrowerExitParams} from "@src/libraries/fixed/actions/BorrowerExit.sol";
24: import {Claim, ClaimParams} from "@src/libraries/fixed/actions/Claim.sol";
25: import {Deposit, DepositParams} from "@src/libraries/general/actions/Deposit.sol";
26: 
27: import {LendAsLimitOrder, LendAsLimitOrderParams} from "@src/libraries/fixed/actions/LendAsLimitOrder.sol";
28: import {LendAsMarketOrder, LendAsMarketOrderParams} from "@src/libraries/fixed/actions/LendAsMarketOrder.sol";
29: import {Liquidate, LiquidateParams} from "@src/libraries/fixed/actions/Liquidate.sol";
30: 
31: import {Compensate, CompensateParams} from "@src/libraries/fixed/actions/Compensate.sol";
32: import {
33:     LiquidateWithReplacement,
34:     LiquidateWithReplacementParams
35: } from "@src/libraries/fixed/actions/LiquidateWithReplacement.sol";
36: import {Repay, RepayParams} from "@src/libraries/fixed/actions/Repay.sol";
37: import {SelfLiquidate, SelfLiquidateParams} from "@src/libraries/fixed/actions/SelfLiquidate.sol";
38: import {Withdraw, WithdrawParams} from "@src/libraries/general/actions/Withdraw.sol";
39: 
40: import {State} from "@src/SizeStorage.sol";
41: 
42: import {CapsLibrary} from "@src/libraries/fixed/CapsLibrary.sol";
43: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol";
44: 
45: import {BorrowVariable, BorrowVariableParams} from "@src/libraries/variable/actions/BorrowVariable.sol";
46: 
47: import {LiquidateVariable, LiquidateVariableParams} from "@src/libraries/variable/actions/LiquidateVariable.sol";
48: import {RepayVariable, RepayVariableParams} from "@src/libraries/variable/actions/RepayVariable.sol";
49: 
50: import {SizeView} from "@src/SizeView.sol";
51: 
52: import {ISize} from "@src/interfaces/ISize.sol";
53: 
54: /// @title Size
55: /// @notice See the documentation in {ISize}.
56: contract Size is
57:     ISize,
58:     SizeView,
59:     Initializable,
60:     AccessControlUpgradeable,
61:     PausableUpgradeable,
62:     MulticallUpgradeable,
63:     UUPSUpgradeable
64: {
65:     // @audit Check if borrower == lender == liquidator may cause any issues
66:     using Initialize for State;
67:     using UpdateConfig for State;
68:     using Deposit for State;
69:     using Withdraw for State;
70:     using BorrowAsMarketOrder for State;
71:     using BorrowAsLimitOrder for State;
72:     using LendAsMarketOrder for State;
73:     using LendAsLimitOrder for State;
74:     using BorrowerExit for State;
75:     using Repay for State;
76:     using Claim for State;
77:     using Liquidate for State;
78:     using SelfLiquidate for State;
79:     using LiquidateWithReplacement for State;
80:     using Compensate for State;
81:     using RiskLibrary for State;
82:     using CapsLibrary for State;
83:     using BorrowVariable for State;
84:     using RepayVariable for State;
85:     using LiquidateVariable for State;
86: 
87:     bytes32 public constant KEEPER_ROLE = "KEEPER_ROLE";
88:     bytes32 public constant PAUSER_ROLE = "PAUSER_ROLE";
89: 
90:     /// @custom:oz-upgrades-unsafe-allow constructor
91:     constructor() {
92:         _disableInitializers();
93:     }
94: 
95:     function initialize(
96:         address owner,
97:         InitializeFeeConfigParams calldata f,
98:         InitializeRiskConfigParams calldata r,
99:         InitializeOracleParams calldata o,
100:         InitializeDataParams calldata d
101:     ) external initializer {
102:         state.validateInitialize(owner, f, r, o, d);
103: 
104:         __AccessControl_init();
105:         __Pausable_init();
106:         __Multicall_init();
107:         __UUPSUpgradeable_init();
108: 
109:         state.executeInitialize(f, r, o, d);
110:         _grantRole(DEFAULT_ADMIN_ROLE, owner);
111:         _grantRole(PAUSER_ROLE, owner);
112:         _grantRole(KEEPER_ROLE, owner);
113:     }
114: 
115:     // solhint-disable-next-line no-empty-blocks
116:     function _authorizeUpgrade(address newImplementation) internal override onlyRole(DEFAULT_ADMIN_ROLE) {}
117: 
118:     function updateConfig(UpdateConfigParams calldata params) external onlyRole(DEFAULT_ADMIN_ROLE) {
119:         state.validateUpdateConfig(params);
120:         state.executeUpdateConfig(params);
121:     }
122: 
123:     function pause() public onlyRole(PAUSER_ROLE) {
124:         _pause();
125:     }
126: 
127:     function unpause() public onlyRole(PAUSER_ROLE) {
128:         _unpause();
129:     }
130: 
131:     /// @inheritdoc ISize
132:     function deposit(DepositParams calldata params) external override(ISize) whenNotPaused {
133:         state.validateDeposit(params);
134:         state.executeDeposit(params);
135:         state.validateCollateralTokenCap();
136:         state.validateBorrowATokenCap();
137:     }
138: 
139:     /// @inheritdoc ISize
140:     function withdraw(WithdrawParams calldata params) external override(ISize) whenNotPaused {
141:         state.validateWithdraw(params);
142:         state.executeWithdraw(params);
143:         state.validateUserIsNotBelowopeningLimitBorrowCR(msg.sender);
144:     }
145: 
146:     /// @inheritdoc ISize
147:     function lendAsLimitOrder(LendAsLimitOrderParams calldata params) external override(ISize) whenNotPaused {
148:         state.validateLendAsLimitOrder(params);
149:         state.executeLendAsLimitOrder(params);
150:     }
151: 
152:     /// @inheritdoc ISize
153:     function borrowAsLimitOrder(BorrowAsLimitOrderParams calldata params) external override(ISize) whenNotPaused {
154:         state.validateBorrowAsLimitOrder(params);
155:         state.executeBorrowAsLimitOrder(params);
156:     }
157: 
158:     /// @inheritdoc ISize
159:     function lendAsMarketOrder(LendAsMarketOrderParams calldata params) external override(ISize) whenNotPaused {
160:         state.validateLendAsMarketOrder(params);
161:         state.executeLendAsMarketOrder(params);
162:         state.validateUserIsNotBelowopeningLimitBorrowCR(params.borrower);
163:         state.validateDebtTokenCap();
164:         state.validateVariablePoolHasEnoughLiquidity();
165:     }
166: 
167:     /// @inheritdoc ISize
168:     function borrowAsMarketOrder(BorrowAsMarketOrderParams memory params) external override(ISize) whenNotPaused {
169:         state.validateBorrowAsMarketOrder(params);
170:         state.executeBorrowAsMarketOrder(params);
171:         state.validateUserIsNotBelowopeningLimitBorrowCR(msg.sender);
172:         state.validateDebtTokenCap();
173:         state.validateVariablePoolHasEnoughLiquidity();
174:     }
175: 
176:     /// @inheritdoc ISize
177:     function borrowerExit(BorrowerExitParams calldata params) external override(ISize) whenNotPaused {
178:         state.validateBorrowerExit(params);
179:         state.executeBorrowerExit(params);
180:         state.validateUserIsNotBelowopeningLimitBorrowCR(params.borrowerToExitTo);
181:         state.validateVariablePoolHasEnoughLiquidity();
182:     }
183: 
184:     /// @inheritdoc ISize
185:     function repay(RepayParams calldata params) external override(ISize) whenNotPaused {
186:         state.validateRepay(params);
187:         state.executeRepay(params);
188:         state.validateUserIsNotLiquidatable(msg.sender);
189:     }
190: 
191:     /// @inheritdoc ISize
192:     function claim(ClaimParams calldata params) external override(ISize) whenNotPaused {
193:         state.validateClaim(params);
194:         state.executeClaim(params);
195:     }
196: 
197:     /// @inheritdoc ISize
198:     function liquidate(LiquidateParams calldata params)
199:         external
200:         override(ISize)
201:         whenNotPaused
202:         returns (uint256 liquidatorProfitCollateralAsset)
203:     {
204:         state.validateLiquidate(params);
205:         liquidatorProfitCollateralAsset = state.executeLiquidate(params);
206:         state.validateMinimumCollateralProfit(params, liquidatorProfitCollateralAsset);
207:     }
208: 
209:     /// @inheritdoc ISize
210:     function selfLiquidate(SelfLiquidateParams calldata params) external override(ISize) whenNotPaused {
211:         state.validateSelfLiquidate(params);
212:         state.executeSelfLiquidate(params);
213:     }
214: 
215:     /// @inheritdoc ISize
216:     function liquidateWithReplacement(LiquidateWithReplacementParams calldata params)
217:         external
218:         override(ISize)
219:         whenNotPaused
220:         onlyRole(KEEPER_ROLE)
221:         returns (uint256 liquidatorProfitCollateralAsset, uint256 liquidatorProfitBorrowAsset)
222:     {
223:         state.validateLiquidateWithReplacement(params);
224:         (liquidatorProfitCollateralAsset, liquidatorProfitBorrowAsset) = state.executeLiquidateWithReplacement(params);
225:         state.validateUserIsNotBelowopeningLimitBorrowCR(params.borrower);
226:         state.validateMinimumCollateralProfit(params, liquidatorProfitCollateralAsset);
227:     }
228: 
229:     /// @inheritdoc ISize
230:     function compensate(CompensateParams calldata params) external override(ISize) whenNotPaused {
231:         state.validateCompensate(params);
232:         state.executeCompensate(params);
233:         state.validateUserIsNotBelowopeningLimitBorrowCR(msg.sender);
234:     }
235: 
236:     /// @inheritdoc ISize
237:     function variablePoolAllowlisted(address account) external view override(ISize) whenNotPaused returns (bool) {
238:         return state.data.variablePoolAllowlisted[account];
239:     }
240: 
241:     /// @inheritdoc ISize
242:     function borrowVariable(BorrowVariableParams calldata params) external override(ISize) whenNotPaused {
243:         state.validateBorrowVariable(params);
244:         state.executeBorrowVariable(params);
245:     }
246: 
247:     /// @inheritdoc ISize
248:     function repayVariable(RepayVariableParams calldata params) external override(ISize) whenNotPaused {
249:         state.validateRepayVariable(params);
250:         state.executeRepayVariable(params);
251:     }
252: 
253:     /// @inheritdoc ISize
254:     function liquidateVariable(LiquidateVariableParams calldata params) external override(ISize) whenNotPaused {
255:         state.validateLiquidateVariable(params);
256:         state.executeLiquidateVariable(params);
257:     }
258: }
259: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: import {Errors} from "@src/libraries/Errors.sol";
6: 
7: /// @title CapsLibrary
8: /// @notice Contains functions for validating the cap of minted protocol-controlled tokens
9: library CapsLibrary {
10:     function validateCollateralTokenCap(State storage state) external view {
11:         if (state.data.collateralToken.totalSupply() > state.riskConfig.collateralTokenCap) {
12:             revert Errors.COLLATERAL_TOKEN_CAP_EXCEEDED(
13:                 state.riskConfig.collateralTokenCap, state.data.collateralToken.totalSupply()
14:             );
15:         }
16:     }
17: 
18:     function validateBorrowATokenCap(State storage state) external view {
19:         if (state.data.borrowAToken.totalSupply() > state.riskConfig.borrowATokenCap) {
20:             revert Errors.BORROW_ATOKEN_CAP_EXCEEDED(
21:                 state.riskConfig.borrowATokenCap, state.data.borrowAToken.totalSupply()
22:             );
23:         }
24:     }
25: 
26:     function validateDebtTokenCap(State storage state) external view {
27:         if (state.data.debtToken.totalSupply() > state.riskConfig.debtTokenCap) {
28:             revert Errors.DEBT_TOKEN_CAP_EXCEEDED(state.riskConfig.debtTokenCap, state.data.debtToken.totalSupply());
29:         }
30:     }
31: 
32:     function validateVariablePoolHasEnoughLiquidity(State storage state) public view {
33:         uint256 redeemable = state.data.borrowAToken.totalSupply();
34:         uint256 liquidity = state.data.underlyingBorrowToken.balanceOf(address(state.data.variablePool));
35:         if (liquidity < redeemable) {
36:             revert Errors.NOT_ENOUGH_BORROW_ATOKEN_LIQUIDITY(liquidity, redeemable);
37:         }
38:     }
39: }
40: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {State} from "@src/SizeStorage.sol";
5: 
6: import {IAToken} from "@aave/interfaces/IAToken.sol";
7: import {Math} from "@src/libraries/Math.sol";
8: import {CollateralLibrary} from "@src/libraries/fixed/CollateralLibrary.sol";
9: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
10: 
11: import {Errors} from "@src/libraries/Errors.sol";
12: import {Events} from "@src/libraries/Events.sol";
13: 
14: struct WithdrawParams {
15:     address token;
16:     uint256 amount;
17:     bool variable;
18:     address to;
19: }
20: 
21: library Withdraw {
22:     using VariableLibrary for State;
23:     using CollateralLibrary for State;
24: 
25:     function validateWithdraw(State storage state, WithdrawParams calldata params) external view {
26:         // validte msg.sender
27:         // N/A
28: 
29:         // validate token
30:         if (
31:             params.token != address(state.data.underlyingCollateralToken)
32:                 && params.token != address(state.data.underlyingBorrowToken)
33:         ) {
34:             revert Errors.INVALID_TOKEN(params.token);
35:         }
36: 
37:         // validate amount
38:         if (params.amount == 0) {
39:             revert Errors.NULL_AMOUNT();
40:         }
41: 
42:         // validate to
43:         if (params.to == address(0)) {
44:             revert Errors.NULL_ADDRESS();
45:         }
46: 
47:         // validate variable
48:         // N/A
49:     }
50: 
51:     function executeWithdraw(State storage state, WithdrawParams calldata params) public {
52:         uint256 amount;
53:         if (params.variable || params.token == address(state.data.underlyingBorrowToken)) {
54:             IAToken aToken = params.token == address(state.data.underlyingBorrowToken)
55:                 ? state.data.borrowAToken
56:                 : state.data.collateralAToken;
57: 
58:             amount = Math.min(params.amount, state.aTokenBalanceOf(aToken, msg.sender, params.variable));
59:             if (amount > 0) {
60:                 state.withdrawUnderlyingTokenFromVariablePool(aToken, msg.sender, params.to, amount, params.variable);
61:             }
62:         } else {
63:             amount = Math.min(params.amount, state.data.collateralToken.balanceOf(msg.sender));
64:             if (amount > 0) {
65:                 state.withdrawUnderlyingCollateralToken(msg.sender, params.to, amount);
66:             }
67:         }
68: 
69:         emit Events.Withdraw(params.token, params.to, params.variable, amount);
70:     }
71: }
72: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
5: 
6: import {PERCENT} from "@src/libraries/Math.sol";
7: 
8: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol";
9: 
10: import {DebtPosition, LoanLibrary} from "@src/libraries/fixed/LoanLibrary.sol";
11: import {BorrowOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol";
12: 
13: import {Math} from "@src/libraries/Math.sol";
14: 
15: import {State} from "@src/SizeStorage.sol";
16: 
17: import {Errors} from "@src/libraries/Errors.sol";
18: import {Events} from "@src/libraries/Events.sol";
19: 
20: struct BorrowerExitParams {
21:     uint256 debtPositionId;
22:     address borrowerToExitTo;
23:     uint256 deadline;
24:     uint256 minAPR;
25: }
26: 
27: library BorrowerExit {
28:     using OfferLibrary for BorrowOffer;
29:     using LoanLibrary for DebtPosition;
30:     using LoanLibrary for State;
31:     using VariableLibrary for State;
32:     using AccountingLibrary for State;
33: 
34:     function validateBorrowerExit(State storage state, BorrowerExitParams calldata params) external view {
35:         BorrowOffer memory borrowOffer = state.data.users[params.borrowerToExitTo].borrowOffer;
36:         DebtPosition memory debtPosition = state.getDebtPosition(params.debtPositionId);
37: 
38:         // validate debtPositionId
39:         uint256 dueDate = debtPosition.dueDate;
40:         if (dueDate < block.timestamp) {
41:             revert Errors.PAST_DUE_DATE(debtPosition.dueDate);
42:         }
43:         uint256 maturity = dueDate - block.timestamp;
44:         if (maturity < state.riskConfig.minimumMaturity) {
45:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity);
46:         }
47: 
48:         uint256 ratePerMaturity = borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, dueDate);
49:         uint256 issuanceValue = Math.mulDivUp(debtPosition.faceValue, PERCENT, PERCENT + ratePerMaturity);
50: 
51:         // validate msg.sender
52:         if (msg.sender != debtPosition.borrower) {
53:             revert Errors.EXITER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower);
54:         }
55:         if (
56:             state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false)
57:                 < issuanceValue + state.feeConfig.earlyBorrowerExitFee
58:         ) {
59:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
60:                 address(state.data.borrowAToken),
61:                 msg.sender,
62:                 false,
63:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
64:                 issuanceValue + state.feeConfig.earlyBorrowerExitFee
65:             );
66:         }
67: 
68:         // validate deadline
69:         if (params.deadline < block.timestamp) {
70:             revert Errors.PAST_DEADLINE(params.deadline);
71:         }
72: 
73:         // validate minAPR
74:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
75:             revert Errors.APR_LOWER_THAN_MIN_APR(
76:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
77:             );
78:         }
79: 
80:         // validate borrowerToExitTo
81:         // N/A
82:     }
83: 
84:     function executeBorrowerExit(State storage state, BorrowerExitParams calldata params) external {
85:         emit Events.BorrowerExit(params.debtPositionId, params.borrowerToExitTo);
86: 
87:         BorrowOffer storage borrowOffer = state.data.users[params.borrowerToExitTo].borrowOffer;
88:         DebtPosition storage debtPosition = state.data.debtPositions[params.debtPositionId];
89: 
90:         uint256 ratePerMaturity =
91:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, debtPosition.dueDate);
92: 
93:         uint256 faceValue = debtPosition.faceValue;
94:         uint256 issuanceValue = Math.mulDivUp(faceValue, PERCENT, PERCENT + ratePerMaturity);
95: 
96:         uint256 repayFee = state.chargeEarlyRepayFeeInCollateral(debtPosition);
97:         debtPosition.updateRepayFee(faceValue, repayFee);
98:         state.transferBorrowATokenFixed(msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyBorrowerExitFee);
99:         state.transferBorrowATokenFixed(msg.sender, params.borrowerToExitTo, issuanceValue);
100:         state.data.debtToken.burn(msg.sender, faceValue);
101: 
102:         debtPosition.borrower = params.borrowerToExitTo;
103:         debtPosition.startDate = block.timestamp;
104:         debtPosition.issuanceValue = issuanceValue;
105:         debtPosition.faceValue = faceValue;
106:         debtPosition.repayFee =
107:             LoanLibrary.repayFee(issuanceValue, block.timestamp, debtPosition.dueDate, state.feeConfig.repayFeeAPR);
108: 
109:         state.data.debtToken.mint(params.borrowerToExitTo, debtPosition.getDebt());
110:     }
111: }
112: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {Clones} from "@openzeppelin/contracts/proxy/Clones.sol";
5: 
6: import {State} from "@src/SizeStorage.sol";
7: import {Events} from "@src/libraries/Events.sol";
8: import {BorrowOffer, LoanOffer} from "@src/libraries/fixed/OfferLibrary.sol";
9: import {Vault} from "@src/proxy/Vault.sol";
10: 
11: struct User {
12:     LoanOffer loanOffer;
13:     BorrowOffer borrowOffer;
14:     Vault vaultFixed;
15:     Vault vaultVariable;
16: }
17: 
18: library UserLibrary {
19:     /// @notice Get the vault for a user destined for fixed-rate lending
20:     /// @dev If the user does not have a vault, create one
21:     ///      Allowlists the vault to interact with the variable pool
22:     /// @param state The state struct
23:     /// @param user The user's address
24:     /// @return vault The user's vault
25:     function getVaultFixed(State storage state, address user) public returns (Vault) {
26:         if (address(state.data.users[user].vaultFixed) != address(0)) {
27:             return state.data.users[user].vaultFixed;
28:         }
29:         Vault vault = Vault(payable(Clones.clone(address(state.data.vaultImplementation))));
30:         emit Events.CreateVault(user, address(vault), false);
31:         vault.initialize(address(this));
32:         state.data.users[user].vaultFixed = vault;
33:         state.data.variablePoolAllowlisted[address(vault)] = true;
34:         return vault;
35:     }
36: 
37:     /// @notice Get the vault for a user destined for variable-rate lending
38:     /// @dev If the user does not have a vault, create one
39:     ///      Allowlists the vault to interact with the variable pool
40:     /// @param state The state struct
41:     /// @param user The user's address
42:     /// @return vault The user's vault
43:     function getVaultVariable(State storage state, address user) public returns (Vault) {
44:         if (address(state.data.users[user].vaultVariable) != address(0)) {
45:             return state.data.users[user].vaultVariable;
46:         }
47:         Vault vault = Vault(payable(Clones.clone(address(state.data.vaultImplementation))));
48:         emit Events.CreateVault(user, address(vault), true);
49:         vault.initialize(address(this));
50:         state.data.users[user].vaultVariable = vault;
51:         state.data.variablePoolAllowlisted[address(vault)] = true;
52:         return vault;
53:     }
54: }
55: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {YieldCurve, YieldCurveLibrary} from "@src/libraries/fixed/YieldCurveLibrary.sol";
5: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol";
6: 
7: struct LoanOffer {
8:     uint256 maxDueDate;
9:     YieldCurve curveRelativeTime;
10: }
11: 
12: struct BorrowOffer {
13:     uint256 openingLimitBorrowCR;
14:     YieldCurve curveRelativeTime;
15: }
16: 
17: /// @title OfferLibrary
18: library OfferLibrary {
19:     using YieldCurveLibrary for YieldCurve;
20: 
21:     function isNull(LoanOffer memory self) internal pure returns (bool) {
22:         return self.maxDueDate == 0 && self.curveRelativeTime.isNull();
23:     }
24: 
25:     function isNull(BorrowOffer memory self) internal pure returns (bool) {
26:         return self.openingLimitBorrowCR == 0 && self.curveRelativeTime.isNull();
27:     }
28: 
29:     function getRatePerMaturityByDueDate(
30:         LoanOffer memory self,
31:         IMarketBorrowRateFeed marketBorrowRateFeed,
32:         uint256 dueDate
33:     ) internal view returns (uint256) {
34:         return YieldCurveLibrary.getRatePerMaturityByDueDate(self.curveRelativeTime, marketBorrowRateFeed, dueDate);
35:     }
36: 
37:     function getRatePerMaturityByDueDate(
38:         BorrowOffer memory self,
39:         IMarketBorrowRateFeed marketBorrowRateFeed,
40:         uint256 dueDate
41:     ) internal view returns (uint256) {
42:         return YieldCurveLibrary.getRatePerMaturityByDueDate(self.curveRelativeTime, marketBorrowRateFeed, dueDate);
43:     }
44: }
45: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {Math} from "@src/libraries/Math.sol";
5: 
6: import {PERCENT} from "@src/libraries/Math.sol";
7: 
8: import {CreditPosition, DebtPosition, LoanLibrary, LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol";
9: import {BorrowOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol";
10: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
11: 
12: import {State} from "@src/SizeStorage.sol";
13: 
14: import {Liquidate, LiquidateParams} from "@src/libraries/fixed/actions/Liquidate.sol";
15: 
16: import {Errors} from "@src/libraries/Errors.sol";
17: import {Events} from "@src/libraries/Events.sol";
18: 
19: struct LiquidateWithReplacementParams {
20:     uint256 debtPositionId;
21:     address borrower;
22:     uint256 minimumCollateralProfit;
23:     uint256 deadline;
24:     uint256 minAPR;
25: }
26: 
27: library LiquidateWithReplacement {
28:     using LoanLibrary for CreditPosition;
29:     using OfferLibrary for BorrowOffer;
30:     using VariableLibrary for State;
31:     using LoanLibrary for State;
32:     using Liquidate for State;
33:     using LoanLibrary for DebtPosition;
34: 
35:     function validateLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params)
36:         external
37:         view
38:     {
39:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
40:         BorrowOffer storage borrowOffer = state.data.users[params.borrower].borrowOffer;
41:         uint256 ratePerMaturity =
42:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, debtPosition.dueDate);
43: 
44:         // validate liquidate
45:         state.validateLiquidate(
46:             LiquidateParams({
47:                 debtPositionId: params.debtPositionId,
48:                 minimumCollateralProfit: params.minimumCollateralProfit
49:             })
50:         );
51: 
52:         // validate debtPositionId
53:         if (state.getLoanStatus(params.debtPositionId) != LoanStatus.ACTIVE) {
54:             revert Errors.LOAN_NOT_ACTIVE(params.debtPositionId);
55:         }
56:         uint256 maturity = debtPosition.dueDate - block.timestamp;
57:         if (maturity < state.riskConfig.minimumMaturity) {
58:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity);
59:         }
60: 
61:         // validate borrower
62:         if (borrowOffer.isNull()) {
63:             revert Errors.INVALID_BORROW_OFFER(params.borrower);
64:         }
65: 
66:         // validate deadline
67:         if (params.deadline < block.timestamp) {
68:             revert Errors.PAST_DEADLINE(params.deadline);
69:         }
70: 
71:         // validate minAPR
72:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
73:             revert Errors.APR_LOWER_THAN_MIN_APR(
74:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
75:             );
76:         }
77:     }
78: 
79:     function validateMinimumCollateralProfit(
80:         State storage state,
81:         LiquidateWithReplacementParams calldata params,
82:         uint256 liquidatorProfitCollateralToken
83:     ) external pure {
84:         Liquidate.validateMinimumCollateralProfit(
85:             state,
86:             LiquidateParams({
87:                 debtPositionId: params.debtPositionId,
88:                 minimumCollateralProfit: params.minimumCollateralProfit
89:             }),
90:             liquidatorProfitCollateralToken
91:         );
92:     }
93: 
94:     function executeLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params)
95:         external
96:         returns (uint256, uint256)
97:     {
98:         emit Events.LiquidateWithReplacement(params.debtPositionId, params.borrower, params.minimumCollateralProfit);
99: 
100:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
101:         DebtPosition memory debtPositionCopy = debtPosition;
102:         BorrowOffer storage borrowOffer = state.data.users[params.borrower].borrowOffer;
103: 
104:         uint256 liquidatorProfitCollateralAsset = state.executeLiquidate(
105:             LiquidateParams({
106:                 debtPositionId: params.debtPositionId,
107:                 minimumCollateralProfit: params.minimumCollateralProfit
108:             })
109:         );
110: 
111:         uint256 ratePerMaturity =
112:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, debtPositionCopy.dueDate);
113:         uint256 issuanceValue = Math.mulDivDown(debtPositionCopy.faceValue, PERCENT, PERCENT + ratePerMaturity);
114:         uint256 liquidatorProfitBorrowAsset = debtPositionCopy.faceValue - issuanceValue;
115: 
116:         debtPosition.borrower = params.borrower;
117:         debtPosition.startDate = block.timestamp;
118:         debtPosition.issuanceValue = issuanceValue;
119:         debtPosition.faceValue = debtPositionCopy.faceValue;
120:         debtPosition.liquidityIndexAtRepayment = 0;
121:         debtPosition.repayFee =
122:             LoanLibrary.repayFee(issuanceValue, block.timestamp, debtPosition.dueDate, state.feeConfig.repayFeeAPR);
123: 
124:         state.data.debtToken.mint(params.borrower, debtPositionCopy.getDebt());
125:         state.transferBorrowATokenFixed(address(this), params.borrower, issuanceValue);
126:         state.transferBorrowATokenFixed(address(this), state.feeConfig.feeRecipient, liquidatorProfitBorrowAsset);
127: 
128:         return (liquidatorProfitCollateralAsset, liquidatorProfitBorrowAsset);
129:     }
130: }
131: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";
5: import {SizeStorage, State} from "@src/SizeStorage.sol";
6: import {Math, PERCENT} from "@src/libraries/Math.sol";
7: 
8: import {
9:     CREDIT_POSITION_ID_START,
10:     CreditPosition,
11:     DEBT_POSITION_ID_START,
12:     DebtPosition,
13:     LoanLibrary,
14:     LoanStatus
15: } from "@src/libraries/fixed/LoanLibrary.sol";
16: import {UpdateConfig} from "@src/libraries/general/actions/UpdateConfig.sol";
17: 
18: import {IAToken} from "@aave/interfaces/IAToken.sol";
19: import {IPool} from "@aave/interfaces/IPool.sol";
20: import {NonTransferrableToken} from "@src/token/NonTransferrableToken.sol";
21: 
22: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol";
23: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol";
24: 
25: import {Errors} from "@src/libraries/Errors.sol";
26: import {BorrowOffer, LoanOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol";
27: import {User} from "@src/libraries/fixed/UserLibrary.sol";
28: import {
29:     InitializeDataParams,
30:     InitializeFeeConfigParams,
31:     InitializeOracleParams,
32:     InitializeRiskConfigParams
33: } from "@src/libraries/general/actions/Initialize.sol";
34: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
35: 
36: struct UserView {
37:     User user;
38:     address account;
39:     uint256 collateralTokenBalanceFixed;
40:     uint256 collateralATokenBalanceVariable;
41:     uint256 borrowATokenBalanceFixed;
42:     uint256 borrowATokenBalanceVariable;
43:     uint256 debtBalanceFixed;
44:     uint256 debtBalanceVariable;
45: }
46: 
47: struct DataView {
48:     uint256 nextDebtPositionId;
49:     uint256 nextCreditPositionId;
50:     IERC20Metadata underlyingCollateralToken;
51:     IERC20Metadata underlyingBorrowToken;
52:     IPool variablePool;
53:     NonTransferrableToken collateralToken;
54:     IAToken collateralAToken;
55:     IAToken borrowAToken;
56:     NonTransferrableToken debtToken;
57: }
58: 
59: /// @title SizeView
60: /// @notice View methods for the Size protocol
61: abstract contract SizeView is SizeStorage {
62:     using OfferLibrary for LoanOffer;
63:     using OfferLibrary for BorrowOffer;
64:     using LoanLibrary for DebtPosition;
65:     using LoanLibrary for CreditPosition;
66:     using LoanLibrary for State;
67:     using RiskLibrary for State;
68:     using VariableLibrary for State;
69:     using AccountingLibrary for State;
70:     using UpdateConfig for State;
71: 
72:     function collateralRatio(address user) external view returns (uint256) {
73:         return state.collateralRatio(user);
74:     }
75: 
76:     function isUserLiquidatable(address user) external view returns (bool) {
77:         return state.isUserLiquidatable(user);
78:     }
79: 
80:     function isDebtPositionLiquidatable(uint256 debtPositionId) external view returns (bool) {
81:         return state.isDebtPositionLiquidatable(debtPositionId);
82:     }
83: 
84:     function getDebt(uint256 debtPositionId) external view returns (uint256) {
85:         return state.getDebtPosition(debtPositionId).getDebt();
86:     }
87: 
88:     function getAPR(uint256 debtPositionId) external view returns (uint256) {
89:         DebtPosition memory debtPosition = state.getDebtPosition(debtPositionId);
90:         uint256 maturity = debtPosition.dueDate - debtPosition.startDate;
91:         uint256 ratePerMaturity = Math.mulDivDown(debtPosition.faceValue, PERCENT, debtPosition.issuanceValue) - PERCENT;
92:         return Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity);
93:     }
94: 
95:     function debtTokenAmountToCollateralTokenAmount(uint256 borrowATokenAmount) external view returns (uint256) {
96:         return state.debtTokenAmountToCollateralTokenAmount(borrowATokenAmount);
97:     }
98: 
99:     function feeConfig() external view returns (InitializeFeeConfigParams memory) {
100:         return state.feeConfigParams();
101:     }
102: 
103:     function riskConfig() external view returns (InitializeRiskConfigParams memory) {
104:         return state.riskConfigParams();
105:     }
106: 
107:     function oracle() external view returns (InitializeOracleParams memory) {
108:         return state.oracleParams();
109:     }
110: 
111:     function data() external view returns (DataView memory) {
112:         return DataView({
113:             nextDebtPositionId: state.data.nextDebtPositionId,
114:             nextCreditPositionId: state.data.nextCreditPositionId,
115:             underlyingCollateralToken: state.data.underlyingCollateralToken,
116:             underlyingBorrowToken: state.data.underlyingBorrowToken,
117:             variablePool: state.data.variablePool,
118:             collateralToken: state.data.collateralToken,
119:             collateralAToken: state.data.collateralAToken,
120:             borrowAToken: state.data.borrowAToken,
121:             debtToken: state.data.debtToken
122:         });
123:     }
124: 
125:     function getUserView(address user) external view returns (UserView memory) {
126:         return UserView({
127:             user: state.data.users[user],
128:             account: user,
129:             collateralTokenBalanceFixed: state.data.collateralToken.balanceOf(user),
130:             collateralATokenBalanceVariable: state.aTokenBalanceOf(state.data.collateralAToken, user, true),
131:             borrowATokenBalanceFixed: state.aTokenBalanceOf(state.data.borrowAToken, user, false),
132:             borrowATokenBalanceVariable: state.aTokenBalanceOf(state.data.borrowAToken, user, true),
133:             debtBalanceFixed: state.data.debtToken.balanceOf(user),
134:             debtBalanceVariable: state.variableDebtTokenBalanceOf(user)
135:         });
136:     }
137: 
138:     function isDebtPositionId(uint256 debtPositionId) external view returns (bool) {
139:         return state.isDebtPositionId(debtPositionId);
140:     }
141: 
142:     function isCreditPositionId(uint256 creditPositionId) external view returns (bool) {
143:         return state.isCreditPositionId(creditPositionId);
144:     }
145: 
146:     function getDebtPosition(uint256 debtPositionId) external view returns (DebtPosition memory) {
147:         return state.getDebtPosition(debtPositionId);
148:     }
149: 
150:     function getCreditPosition(uint256 creditPositionId) external view returns (CreditPosition memory) {
151:         return state.getCreditPosition(creditPositionId);
152:     }
153: 
154:     function getLoanStatus(uint256 positionId) external view returns (LoanStatus) {
155:         return state.getLoanStatus(positionId);
156:     }
157: 
158:     function repayFee(uint256 issuanceValue, uint256 startDate, uint256 dueDate, uint256 repayFeeAPR)
159:         external
160:         pure
161:         returns (uint256)
162:     {
163:         return LoanLibrary.repayFee(issuanceValue, startDate, dueDate, repayFeeAPR);
164:     }
165: 
166:     function getPositionsCount() external view returns (uint256, uint256) {
167:         return (
168:             state.data.nextDebtPositionId - DEBT_POSITION_ID_START,
169:             state.data.nextCreditPositionId - CREDIT_POSITION_ID_START
170:         );
171:     }
172: 
173:     function getBorrowOfferAPR(address borrower, uint256 dueDate) external view returns (uint256) {
174:         BorrowOffer memory offer = state.data.users[borrower].borrowOffer;
175:         if (offer.isNull()) {
176:             revert Errors.NULL_OFFER();
177:         }
178:         if (dueDate < block.timestamp) {
179:             revert Errors.PAST_DUE_DATE(dueDate);
180:         }
181:         uint256 ratePerMaturity = offer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, dueDate);
182:         uint256 maturity = dueDate - block.timestamp;
183:         return Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity);
184:     }
185: 
186:     function getLoanOfferAPR(address lender, uint256 dueDate) external view returns (uint256) {
187:         LoanOffer memory offer = state.data.users[lender].loanOffer;
188:         if (offer.isNull()) {
189:             revert Errors.NULL_OFFER();
190:         }
191:         if (dueDate < block.timestamp) {
192:             revert Errors.PAST_DUE_DATE(dueDate);
193:         }
194:         uint256 ratePerMaturity = offer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, dueDate);
195:         uint256 maturity = dueDate - block.timestamp;
196:         return Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity);
197:     }
198: 
199:     function getDebtPositionAssignedCollateral(uint256 debtPositionId) external view returns (uint256) {
200:         DebtPosition memory debtPosition = state.getDebtPosition(debtPositionId);
201:         return state.getDebtPositionAssignedCollateral(debtPosition);
202:     }
203: 
204:     function getCreditPositionProRataAssignedCollateral(uint256 creditPositionId) external view returns (uint256) {
205:         CreditPosition memory creditPosition = state.getCreditPosition(creditPositionId);
206:         return state.getCreditPositionProRataAssignedCollateral(creditPosition);
207:     }
208: }
209: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: // @audit-info The protocol does not support tokens with more than 18 decimals
5: 
6: /// @title ConversionLibrary
7: library ConversionLibrary {
8:     function amountToWad(uint256 amount, uint8 decimals) internal pure returns (uint256) {
9:         return amount * 10 ** (18 - decimals);
10:     }
11: 
12:     function wadToAmountDown(uint256 wad, uint8 decimals) internal pure returns (uint256) {
13:         // @audit-info Covered in test_ConversionLibrary_wadToAmountDown*
14:         return wad / 10 ** (18 - decimals);
15:     }
16: 
17:     function rayToWadDown(uint256 ray) internal pure returns (uint256) {
18:         // @audit-info Covered in test_ConversionLibrary_rayToWadDown
19:         return ray / 1e9;
20:     }
21: }
22: 

```
['[1](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED
2: pragma solidity 0.8.23;
3: 
4: import {Math} from "@src/libraries/Math.sol";
5: 
6: import {PERCENT} from "@src/libraries/Math.sol";
7: 
8: import {DebtPosition, LoanLibrary, LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol";
9: 
10: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol";
11: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol";
12: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol";
13: 
14: import {State} from "@src/SizeStorage.sol";
15: 
16: import {Errors} from "@src/libraries/Errors.sol";
17: import {Events} from "@src/libraries/Events.sol";
18: 
19: struct LiquidateParams {
20:     uint256 debtPositionId;
21:     uint256 minimumCollateralProfit;
22: }
23: 
24: library Liquidate {
25:     using VariableLibrary for State;
26:     using LoanLibrary for DebtPosition;
27:     using LoanLibrary for State;
28:     using RiskLibrary for State;
29:     using AccountingLibrary for State;
30: 
31:     function validateLiquidate(State storage state, LiquidateParams calldata params) external view {
32:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
33: 
34:         // validate msg.sender
35:         // N/A
36: 
37:         // validate debtPositionId
38:         if (!state.isDebtPositionLiquidatable(params.debtPositionId)) {
39:             revert Errors.LOAN_NOT_LIQUIDATABLE(
40:                 params.debtPositionId,
41:                 state.collateralRatio(debtPosition.borrower),
42:                 state.getLoanStatus(params.debtPositionId)
43:             );
44:         }
45: 
46:         // validate minimumCollateralProfit
47:         // N/A
48:     }
49: 
50:     function validateMinimumCollateralProfit(
51:         State storage,
52:         LiquidateParams calldata params,
53:         uint256 liquidatorProfitCollateralToken
54:     ) external pure {
55:         if (liquidatorProfitCollateralToken < params.minimumCollateralProfit) {
56:             revert Errors.LIQUIDATE_PROFIT_BELOW_MINIMUM_COLLATERAL_PROFIT(
57:                 liquidatorProfitCollateralToken, params.minimumCollateralProfit
58:             );
59:         }
60:     }
61: 
62:     function _executeLiquidateTakeCollateral(
63:         State storage state,
64:         DebtPosition memory debtPositionCopy,
65:         bool splitCollateralRemainder
66:     ) private returns (uint256 liquidatorProfitCollateralToken) {
67:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
68:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPositionCopy.faceValue);
69: 
70:         // CR > 100%
71:         if (assignedCollateral > debtInCollateralToken) {
72:             liquidatorProfitCollateralToken = debtInCollateralToken;
73: 
74:             if (splitCollateralRemainder) {
75:                 // split remaining collateral between liquidator and protocol
76:                 uint256 collateralRemainder = assignedCollateral - debtInCollateralToken;
77: 
78:                 uint256 collateralRemainderToLiquidator =
79:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitLiquidatorPercent, PERCENT);
80:                 uint256 collateralRemainderToProtocol =
81:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitProtocolPercent, PERCENT);
82: 
83:                 liquidatorProfitCollateralToken += collateralRemainderToLiquidator;
84:                 state.data.collateralToken.transferFrom(
85:                     debtPositionCopy.borrower, state.feeConfig.feeRecipient, collateralRemainderToProtocol
86:                 );
87:             }
88:             // CR <= 100%
89:         } else {
90:             // unprofitable liquidation
91:             liquidatorProfitCollateralToken = assignedCollateral;
92:         }
93: 
94:         state.transferBorrowATokenFixed(msg.sender, address(this), debtPositionCopy.faceValue);
95:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken);
96:     }
97: 
98:     function _executeLiquidateOverdue(
99:         State storage state,
100:         LiquidateParams calldata params,
101:         DebtPosition memory debtPositionCopy
102:     ) private returns (uint256 liquidatorProfitCollateralToken) {
103:         // case 2a: the loan is overdue and can be moved to the variable pool
104:         try state.moveDebtPositionToVariablePool(debtPositionCopy) returns (uint256 _liquidatorProfitCollateralToken) {
105:             emit Events.LiquidateOverdueMoveToVariablePool(params.debtPositionId);
106:             liquidatorProfitCollateralToken = _liquidatorProfitCollateralToken;
107:             // case 2b: the loan is overdue and cannot be moved to the variable pool
108:         } catch {
109:             emit Events.LiquidateOverdueNoSplitRemainder(params.debtPositionId);
110:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, false)
111:                 + state.feeConfig.collateralOverdueTransferFee;
112:             state.data.collateralToken.transferFrom(
113:                 debtPositionCopy.borrower, msg.sender, state.feeConfig.collateralOverdueTransferFee
114:             );
115:         }
116:     }
117: 
118:     // @audit Check corner cases where liquidate reverts even if the loan is liquidatable
119:     function executeLiquidate(State storage state, LiquidateParams calldata params)
120:         external
121:         returns (uint256 liquidatorProfitCollateralToken)
122:     {
123:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
124:         DebtPosition memory debtPositionCopy = debtPosition;
125:         LoanStatus loanStatus = state.getLoanStatus(params.debtPositionId);
126:         uint256 collateralRatio = state.collateralRatio(debtPosition.borrower);
127: 
128:         emit Events.Liquidate(params.debtPositionId, params.minimumCollateralProfit, collateralRatio, loanStatus);
129: 
130:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, debtPosition.faceValue);
131:         debtPosition.updateRepayFee(debtPosition.faceValue, repayFee);
132: 
133:         // case 1a: the user is liquidatable profitably
134:         if (PERCENT <= collateralRatio && collateralRatio < state.riskConfig.crLiquidation) {
135:             emit Events.LiquidateUserLiquidatableProfitably(params.debtPositionId);
136:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, true);
137:             // case 1b: the user is liquidatable unprofitably
138:         } else if (collateralRatio < PERCENT) {
139:             emit Events.LiquidateUserLiquidatableUnprofitably(params.debtPositionId);
140:             liquidatorProfitCollateralToken =
141:                 _executeLiquidateTakeCollateral(state, debtPositionCopy, false /* this parameter should not matter */ );
142:             // case 2: the loan is overdue
143:         } else {
144:             // collateralRatio > state.riskConfig.crLiquidation
145:             if (loanStatus == LoanStatus.OVERDUE) {
146:                 liquidatorProfitCollateralToken = _executeLiquidateOverdue(state, params, debtPositionCopy);
147:                 // loan is ACTIVE
148:             } else {
149:                 // @audit unreachable code, check if the validation function is correct and not making this branch possible
150:                 revert Errors.LOAN_NOT_LIQUIDATABLE(params.debtPositionId, collateralRatio, loanStatus);
151:             }
152:         }
153: 
154:         state.data.debtToken.burn(debtPosition.borrower, debtPositionCopy.faceValue);
155:         debtPosition.liquidityIndexAtRepayment = state.borrowATokenLiquidityIndex();
156:     }
157: }
158: 

```


</details>

## [NonCritical-45] Top level declarations should be separated by two blank lines

Num of instances: 42

### Findings 


<details><summary>Click to show findings</summary>

['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L25-L27)']
```solidity
25:     } // <= FOUND
26: 
27:     function burn(address from, uint256 amount) external virtual onlyOwner { // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L34-L36)']
```solidity
34:     } // <= FOUND
35: 
36:     function transfer(address to, uint256 value) public virtual override onlyOwner returns (bool) { // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L43-L45)']
```solidity
43:     } // <= FOUND
44: 
45:     function approve(address, uint256) public virtual override returns (bool) { // <= FOUND

```
['[51](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L51-L53)']
```solidity
51:     } // <= FOUND
52: 
53:     function executeDeposit(State storage state, DepositParams calldata params) public { // <= FOUND

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L54-L56)']
```solidity
54:     } // <= FOUND
55: 
56:     function isDebtPositionLiquidatable(State storage state, uint256 debtPositionId) public view returns (bool) { // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L58-L60)']
```solidity
58:     } // <= FOUND
59: 
60:     function getDebtPositionIdByCreditPositionId(State storage state, uint256 creditPositionId) // <= FOUND

```
['[172](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L172-L174)']
```solidity
172:     } // <= FOUND
173: 
174:     function repayFee(uint256 issuanceValue, uint256 startDate, uint256 dueDate, uint256 repayFeeAPR) // <= FOUND

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L98-L100)']
```solidity
98:     } // <= FOUND
99: 
100:     function executeBorrowAsMarketOrder(State storage state, BorrowAsMarketOrderParams memory params) external { // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L23-L25)']
```solidity
23:     } // <= FOUND
24: 
25:     function mulDivUp(uint256 x, uint256 y, uint256 z) internal pure returns (uint256) { // <= FOUND

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L35-L37)']
```solidity
35:     } // <= FOUND
36: 
37:     function powWadWad(uint256 wad1, uint256 wad2) internal pure returns (uint256) { // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L47-L49)']
```solidity
47:     } // <= FOUND
48: 
49:     function linearAPRToRatePerMaturity(int256 rate, uint256 maturity) internal pure returns (int256) { // <= FOUND

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L44-L46)']
```solidity
44:     } // <= FOUND
45: 
46:     function proxy(address[] memory targets, bytes[] memory datas) // <= FOUND

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L35-L37)']
```solidity
35:     } // <= FOUND
36: 
37:     function executeBorrowAsLimitOrder(State storage state, BorrowAsLimitOrderParams calldata params) external { // <= FOUND

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L26-L28)']
```solidity
26:     } // <= FOUND
27: 
28:     function setStaleRateInterval(uint64 _staleRateInterval) external onlyOwner { // <= FOUND

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L32-L34)']
```solidity
32:     } // <= FOUND
33: 
34:     function setMarketBorrowRate(uint128 _marketBorrowRate) external onlyOwner { // <= FOUND

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L26-L28)']
```solidity
26:     } // <= FOUND
27: 
28:     function executeRepayVariable(State storage state, RepayVariableParams calldata params) public { // <= FOUND

```
['[67](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L67-L69)']
```solidity
67:     } // <= FOUND
68: 
69:     function chargeEarlyRepayFeeInCollateral(State storage state, DebtPosition storage debtPosition) // <= FOUND

```
['[115](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L115-L117)']
```solidity
115:     } // <= FOUND
116: 
117:     function createCreditPosition(State storage state, uint256 exitCreditPositionId, address lender, uint256 credit) // <= FOUND

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L63-L65)']
```solidity
63:     } // <= FOUND
64: 
65:     function validateInitializeFeeConfigParams(InitializeFeeConfigParams memory f) internal pure { // <= FOUND

```
['[150](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L150-L152)']
```solidity
150:     } // <= FOUND
151: 
152:     function validateInitializeDataParams(InitializeDataParams memory d) internal pure { // <= FOUND

```
['[210](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L210-L212)']
```solidity
210:     } // <= FOUND
211: 
212:     function executeInitializeOracle(State storage state, InitializeOracleParams memory o) internal { // <= FOUND

```
['[240](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L240-L242)']
```solidity
240:     } // <= FOUND
241: 
242:     function executeInitialize( // <= FOUND

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L32-L34)']
```solidity
32:     } // <= FOUND
33: 
34:     function executeBorrowVariable(State storage state, BorrowVariableParams calldata params) public { // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L19-L21)']
```solidity
19:     } // <= FOUND
20: 
21:     function withdrawUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) // <= FOUND

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L62-L64)']
```solidity
62:     } // <= FOUND
63: 
64:     function dataParams(State storage state) public view returns (InitializeDataParams memory) { // <= FOUND

```
['[74](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L74-L76)']
```solidity
74:     } // <= FOUND
75: 
76:     function executeUpdateConfig(State storage state, UpdateConfigParams calldata params) external { // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L18-L20)']
```solidity
18:     } // <= FOUND
19: 
20:     function initialize( // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L49-L51)']
```solidity
49:     } // <= FOUND
50: 
51:     function executeWithdraw(State storage state, WithdrawParams calldata params) public { // <= FOUND

```
['[82](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L82-L84)']
```solidity
82:     } // <= FOUND
83: 
84:     function executeBorrowerExit(State storage state, BorrowerExitParams calldata params) external { // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L23-L25)']
```solidity
23:     } // <= FOUND
24: 
25:     function isNull(BorrowOffer memory self) internal pure returns (bool) { // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L27-L29)']
```solidity
27:     } // <= FOUND
28: 
29:     function getRatePerMaturityByDueDate( // <= FOUND

```
['[77](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L77-L79)']
```solidity
77:     } // <= FOUND
78: 
79:     function validateMinimumCollateralProfit( // <= FOUND

```
['[92](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L92-L94)']
```solidity
92:     } // <= FOUND
93: 
94:     function executeLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params) // <= FOUND

```
['[78](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L78-L80)']
```solidity
78:     } // <= FOUND
79: 
80:     function isDebtPositionLiquidatable(uint256 debtPositionId) external view returns (bool) { // <= FOUND

```
['[93](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L93-L95)']
```solidity
93:     } // <= FOUND
94: 
95:     function debtTokenAmountToCollateralTokenAmount(uint256 borrowATokenAmount) external view returns (uint256) { // <= FOUND

```
['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L105-L107)']
```solidity
105:     } // <= FOUND
106: 
107:     function oracle() external view returns (InitializeOracleParams memory) { // <= FOUND

```
['[123](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L123-L125)']
```solidity
123:     } // <= FOUND
124: 
125:     function getUserView(address user) external view returns (UserView memory) { // <= FOUND

```
['[144](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L144-L146)']
```solidity
144:     } // <= FOUND
145: 
146:     function getDebtPosition(uint256 debtPositionId) external view returns (DebtPosition memory) { // <= FOUND

```
['[171](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L171-L173)']
```solidity
171:     } // <= FOUND
172: 
173:     function getBorrowOfferAPR(address borrower, uint256 dueDate) external view returns (uint256) { // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L10-L12)']
```solidity
10:     } // <= FOUND
11: 
12:     function wadToAmountDown(uint256 wad, uint8 decimals) internal pure returns (uint256) { // <= FOUND

```
['[60](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L60-L62)']
```solidity
60:     } // <= FOUND
61: 
62:     function _executeLiquidateTakeCollateral( // <= FOUND

```
['[96](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L96-L98)']
```solidity
96:     } // <= FOUND
97: 
98:     function _executeLiquidateOverdue( // <= FOUND

```


</details>

## [NonCritical-46] The function symbol() is not part of the ERC20 standard

### Resolution 
Assuming that the `symbol()` function is always present in an ERC20 contract can lead to unexpected issues, as not all ERC20 tokens implement it. Some tokens may omit this function or use a non-standard implementation. If your contract makes an external call to `symbol()` on a token that does not implement this function, it will result in a runtime error, possibly breaking your contract's functionality. The recommended solution is to use try/catch statements when calling `symbol()`. This way, your contract can handle cases where the function is missing or implemented differently, ensuring robust interaction with any ERC20 token.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[225](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L225-L228)']
```solidity
225:         state.data.collateralToken = new NonTransferrableToken(
226:             address(this),
227:             string.concat("Size Fixed ", IERC20Metadata(state.data.underlyingCollateralToken).name()),
228:             string.concat("sz", IERC20Metadata(state.data.underlyingCollateralToken).symbol()), // <= FOUND
229:             IERC20Metadata(state.data.underlyingCollateralToken).decimals()
230:         );

```


</details>

## [NonCritical-47] Contracts should have full test coverage

### Resolution 
Attaining 100% code coverage is not an assurance of a bug-free codebase, but it significantly improves the likelihood of identifying simple bugs and aids in maintaining a stable codebase by preventing regressions during code modifications. Additionally, to achieve complete coverage, code writers usually have to structure their code more modularly, which implies testing each component independently. This reduces the complex interdependencies between modules and layers, creating a more understandable and auditable codebase. Consequently, this practice aids in enhancing code maintainability and reduces the risk of introducing bugs during future changes.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L12-L12)']
```solidity
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step  // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20  // <= FOUND

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L56-L64)']
```solidity
56: contract Size is // <= FOUND
57:     ISize, // <= FOUND
58:     SizeView, // <= FOUND
59:     Initializable, // <= FOUND
60:     AccessControlUpgradeable, // <= FOUND
61:     PausableUpgradeable, // <= FOUND
62:     MulticallUpgradeable, // <= FOUND
63:     UUPSUpgradeable // <= FOUND
64:  // <= FOUND

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L17-L17)']
```solidity
17: contract VariablePoolPriceFeed is IPriceFeed  // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable  // <= FOUND

```


</details>

## [NonCritical-48] Consider using named function calls

### Resolution 
Named function calls in Solidity greatly improve code readability by explicitly mapping arguments to their respective parameter names. This clarity becomes critical when dealing with functions that have numerous or complex parameters, reducing potential errors due to misordered arguments. Therefore, adopting named function calls contributes to more maintainable and less error-prone code.

Num of instances: 27

### Findings 


<details><summary>Click to show findings</summary>

['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L59-L59)']
```solidity
59:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, earlyRepayFee); // <= FOUND

```
['[61](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L61-L61)']
```solidity
61:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, repayFee); // <= FOUND

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L80-L80)']
```solidity
80:         return chargeRepayFeeInCollateral(state, debtPosition, repayAmount, false); // <= FOUND

```
['[106](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L106-L106)']
```solidity
106:         _borrowGeneratingDebt(state, params); // <= FOUND

```
['[249](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L249-L249)']
```solidity
249:         executeInitializeFeeConfig(state, f); // <= FOUND

```
['[250](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L250-L250)']
```solidity
250:         executeInitializeRiskConfig(state, r); // <= FOUND

```
['[251](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L251-L251)']
```solidity
251:         executeInitializeOracle(state, o); // <= FOUND

```
['[252](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L252-L252)']
```solidity
252:         executeInitializeData(state, d); // <= FOUND

```
['[136](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L136-L136)']
```solidity
136:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, true); // <= FOUND

```
['[140](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L140-L141)']
```solidity
140:             liquidatorProfitCollateralToken =
141:                 _executeLiquidateTakeCollateral(state, debtPositionCopy, false  ); // <= FOUND

```
['[146](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L146-L146)']
```solidity
146:                 liquidatorProfitCollateralToken = _executeLiquidateOverdue(state, params, debtPositionCopy); // <= FOUND

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L69-L69)']
```solidity
69:         if (isDebtPositionId(state, debtPositionId)) { // <= FOUND

```
['[107](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L107-L107)']
```solidity
107:         } else if (!isDebtPositionId(state, positionId)) { // <= FOUND

```
['[81](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L81-L81)']
```solidity
81:         if (isCreditPositionId(state, creditPositionId)) { // <= FOUND

```
['[104](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L104-L104)']
```solidity
104:         if (isCreditPositionId(state, positionId)) { // <= FOUND

```
['[93](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L93-L93)']
```solidity
93:         CreditPosition memory creditPosition = getCreditPosition(state, creditPositionId); // <= FOUND

```
['[106](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L106-L107)']
```solidity
106:             
107:             debtPosition = getDebtPositionByCreditPositionId(state, positionId); // <= FOUND

```
['[157](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L157-L157)']
```solidity
157:         uint256 debtPositionCollateral = getDebtPositionAssignedCollateral(state, debtPosition); // <= FOUND

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L46-L46)']
```solidity
46:         return mulDivDown(rate, 365 days, maturity); // <= FOUND

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L54-L54)']
```solidity
54:         return powWadWad(PERCENT + rate, mulDivDown(PERCENT, maturity, 365 days)) - PERCENT; // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L24-L24)']
```solidity
24:         _mint(to, amount); // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L28-L28)']
```solidity
28:         _burn(from, amount); // <= FOUND

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L32-L32)']
```solidity
32:         _transfer(from, to, value); // <= FOUND

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L84-L84)']
```solidity
84:         if (collateralRatio(state, account) < openingLimitBorrowCR) { // <= FOUND

```
['[74](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L74-L74)']
```solidity
74:         if (isUserLiquidatable(state, account)) { // <= FOUND

```
['[87](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L87-L87)']
```solidity
87:         if (aTokenBalanceOf(state, aToken, from, variable) < amount) { // <= FOUND

```
['[207](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L207-L207)']
```solidity
207:         if (aTokenBalanceOf(state, borrowAToken, from, false) < amount) { // <= FOUND

```


</details>

## [NonCritical-49] Using XOR (^) and AND (&) bitwise equivalents

### Resolution 
XOR (^) and AND (&) are bitwise operators that can be more efficient for specific operations in Solidity. XOR returns true if the bits being compared are different, and AND returns true if both bits are true. Using these operators can lead to more concise and efficient code for tasks such as toggling bits or checking specific bit conditions. By applying bitwise logic, you can reduce computational complexity and enhance code performance. Consider using XOR and AND where appropriate, understanding the specific requirements and ensuring that the use of these operators aligns with the intended logic of the application.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L56-L58)']
```solidity
56:     function isDebtPositionLiquidatable(State storage state, uint256 debtPositionId) public view returns (bool) { // <= FOUND
57:         DebtPosition storage debtPosition = state.data.debtPositions[debtPositionId];
58:         LoanStatus status = state.getLoanStatus(debtPositionId); // <= FOUND
59:         
60:         return state.isDebtPositionId(debtPositionId)
61:         
62:         && (
63:             (isUserLiquidatable(state, debtPosition.borrower) && status != LoanStatus.REPAID)
64:             
65:             || status == LoanStatus.OVERDUE
66:         );
67:     }

```


</details>

## [NonCritical-50] Lack Of Brace Spacing

### Resolution 
Lack of brace spacing in coding refers to the absence of spaces around braces, which can hinder code readability. In Solidity, as in many programming languages, spacing can enhance the visual distinction between different parts of the code, making it easier to follow. A lack of spacing can lead to a dense, confusing appearance. The resolution to this issue is to follow a consistent style guide that defines rules for brace spacing. By including spaces around braces, such as `{ statement }` instead of `{statement}`, developers can ensure that the code is more legible and maintainable, especially in larger codebases.

Num of instances: 95

### Findings 


<details><summary>Click to show findings</summary>

['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L14-L14)']
```solidity
14: import {State} from "@src/SizeStorage.sol"; // <= FOUND

```
['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L6-L6)']
```solidity
6: import {ConversionLibrary} from "@src/libraries/ConversionLibrary.sol"; // <= FOUND

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L17-L17)']
```solidity
17: import {Events} from "@src/libraries/Events.sol"; // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L12-L12)']
```solidity
12: import {Math} from "@src/libraries/Math.sol"; // <= FOUND

```
['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L11-L11)']
```solidity
11: import {CreditPosition, DebtPosition, LoanLibrary, RESERVED_ID} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L14-L14)']
```solidity
14: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol"; // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L10-L10)']
```solidity
10: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol"; // <= FOUND

```
['[108](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L108-L108)']
```solidity
108:             CreditPosition({lender: lender, credit: debtPosition.faceValue, debtPositionId: debtPositionId}); // <= FOUND

```
['[124](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L124-L124)']
```solidity
124:         creditPosition = CreditPosition({lender: lender, credit: credit, debtPositionId: debtPositionId}); // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L9-L9)']
```solidity
9: import {BorrowOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L5-L5)']
```solidity
5: import {YieldCurve, YieldCurveLibrary} from "@src/libraries/fixed/YieldCurveLibrary.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L4-L4)']
```solidity
4: import {PERCENT} from "@src/libraries/Math.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L8-L8)']
```solidity
8: import {CreditPosition, DebtPosition, LoanLibrary} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L4-L4)']
```solidity
4: import {LoanOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol"; // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L10-L10)']
```solidity
10: import {User} from "@src/libraries/fixed/UserLibrary.sol"; // <= FOUND

```
['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L6-L6)']
```solidity
6: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L7-L7)']
```solidity
7: import {Errors} from "@src/libraries/Errors.sol"; // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L10-L10)']
```solidity
10: import {DebtPosition, LoanLibrary} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L10-L10)']
```solidity
10: import {CreditPosition, DebtPosition, LoanLibrary, LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L4-L4)']
```solidity
4: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L5-L5)']
```solidity
5: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"; // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L9-L9)']
```solidity
9: import {CollateralLibrary} from "@src/libraries/fixed/CollateralLibrary.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L4-L4)']
```solidity
4: import {LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L5-L5)']
```solidity
5: import {YieldCurve} from "@src/libraries/fixed/YieldCurveLibrary.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L4-L4)']
```solidity
4: import {BorrowAsLimitOrderParams} from "@src/libraries/fixed/actions/BorrowAsLimitOrder.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L5-L5)']
```solidity
5: import {BorrowAsMarketOrderParams} from "@src/libraries/fixed/actions/BorrowAsMarketOrder.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L7-L7)']
```solidity
7: import {BorrowerExitParams} from "@src/libraries/fixed/actions/BorrowerExit.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L8-L8)']
```solidity
8: import {ClaimParams} from "@src/libraries/fixed/actions/Claim.sol"; // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L10-L10)']
```solidity
10: import {LendAsLimitOrderParams} from "@src/libraries/fixed/actions/LendAsLimitOrder.sol"; // <= FOUND

```
['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L11-L11)']
```solidity
11: import {LendAsMarketOrderParams} from "@src/libraries/fixed/actions/LendAsMarketOrder.sol"; // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L12-L12)']
```solidity
12: import {LiquidateParams} from "@src/libraries/fixed/actions/Liquidate.sol"; // <= FOUND

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L13-L13)']
```solidity
13: import {DepositParams} from "@src/libraries/general/actions/Deposit.sol"; // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L15-L15)']
```solidity
15: import {LiquidateWithReplacementParams} from "@src/libraries/fixed/actions/LiquidateWithReplacement.sol"; // <= FOUND

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L16-L16)']
```solidity
16: import {RepayParams} from "@src/libraries/fixed/actions/Repay.sol"; // <= FOUND

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L17-L17)']
```solidity
17: import {SelfLiquidateParams} from "@src/libraries/fixed/actions/SelfLiquidate.sol"; // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L19-L19)']
```solidity
19: import {CompensateParams} from "@src/libraries/fixed/actions/Compensate.sol"; // <= FOUND

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L20-L20)']
```solidity
20: import {WithdrawParams} from "@src/libraries/general/actions/Withdraw.sol"; // <= FOUND

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L22-L22)']
```solidity
22: import {BorrowVariableParams} from "@src/libraries/variable/actions/BorrowVariable.sol"; // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L23-L23)']
```solidity
23: import {LiquidateVariableParams} from "@src/libraries/variable/actions/LiquidateVariable.sol"; // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L24-L24)']
```solidity
24: import {RepayVariableParams} from "@src/libraries/variable/actions/RepayVariable.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L4-L4)']
```solidity
4: import {IAToken} from "@aave/interfaces/IAToken.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L5-L5)']
```solidity
5: import {IPool} from "@aave/interfaces/IPool.sol"; // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L9-L9)']
```solidity
9: import {CREDIT_POSITION_ID_START, DEBT_POSITION_ID_START} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L13-L13)']
```solidity
13: import {IMarketBorrowRateFeed} from "@src/oracle/IMarketBorrowRateFeed.sol"; // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L14-L14)']
```solidity
14: import {IPriceFeed} from "@src/oracle/IPriceFeed.sol"; // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L15-L15)']
```solidity
15: import {NonTransferrableToken} from "@src/token/NonTransferrableToken.sol"; // <= FOUND

```
['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L11-L11)']
```solidity
11: import {Vault} from "@src/proxy/Vault.sol"; // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L24-L24)']
```solidity
24:             LoanOffer({maxDueDate: params.maxDueDate, curveRelativeTime: params.curveRelativeTime}); // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L8-L8)']
```solidity
8: import {DebtPosition, LoanLibrary, LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L29-L29)']
```solidity
29: import {Liquidate, LiquidateParams} from "@src/libraries/fixed/actions/Liquidate.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L7-L7)']
```solidity
7: import {Math, PERCENT} from "@src/libraries/Math.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L4-L4)']
```solidity
4: import {IMarketBorrowRateFeed} from "./IMarketBorrowRateFeed.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L4-L4)']
```solidity
4: import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol"; // <= FOUND

```
['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L6-L6)']
```solidity
6: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L4-L4)']
```solidity
4: import {SafeCast} from "@openzeppelin/contracts/utils/math/SafeCast.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L5-L5)']
```solidity
5: import {FixedPointMathLib} from "@solady/utils/FixedPointMathLib.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L5-L5)']
```solidity
5: import {ERC20} from "@openzeppelin/contracts/token/ERC20/ERC20.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L4-L4)']
```solidity
4: import {AccessControlUpgradeable} from "@openzeppelin/contracts-upgradeable/access/AccessControlUpgradeable.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L5-L5)']
```solidity
5: import {Initializable} from "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L7-L7)']
```solidity
7: import {UUPSUpgradeable} from "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L8-L8)']
```solidity
8: import {MulticallUpgradeable} from "@openzeppelin/contracts-upgradeable/utils/MulticallUpgradeable.sol"; // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L9-L9)']
```solidity
9: import {PausableUpgradeable} from "@openzeppelin/contracts-upgradeable/utils/PausableUpgradeable.sol"; // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L18-L18)']
```solidity
18: import {UpdateConfig, UpdateConfigParams} from "@src/libraries/general/actions/UpdateConfig.sol"; // <= FOUND

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L20-L20)']
```solidity
20: import {BorrowAsLimitOrder, BorrowAsLimitOrderParams} from "@src/libraries/fixed/actions/BorrowAsLimitOrder.sol"; // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L21-L21)']
```solidity
21: import {BorrowAsMarketOrder, BorrowAsMarketOrderParams} from "@src/libraries/fixed/actions/BorrowAsMarketOrder.sol"; // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L23-L23)']
```solidity
23: import {BorrowerExit, BorrowerExitParams} from "@src/libraries/fixed/actions/BorrowerExit.sol"; // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L24-L24)']
```solidity
24: import {Claim, ClaimParams} from "@src/libraries/fixed/actions/Claim.sol"; // <= FOUND

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L25-L25)']
```solidity
25: import {Deposit, DepositParams} from "@src/libraries/general/actions/Deposit.sol"; // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L27-L27)']
```solidity
27: import {LendAsLimitOrder, LendAsLimitOrderParams} from "@src/libraries/fixed/actions/LendAsLimitOrder.sol"; // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L28-L28)']
```solidity
28: import {LendAsMarketOrder, LendAsMarketOrderParams} from "@src/libraries/fixed/actions/LendAsMarketOrder.sol"; // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L31-L31)']
```solidity
31: import {Compensate, CompensateParams} from "@src/libraries/fixed/actions/Compensate.sol"; // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L36-L36)']
```solidity
36: import {Repay, RepayParams} from "@src/libraries/fixed/actions/Repay.sol"; // <= FOUND

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L37-L37)']
```solidity
37: import {SelfLiquidate, SelfLiquidateParams} from "@src/libraries/fixed/actions/SelfLiquidate.sol"; // <= FOUND

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L38-L38)']
```solidity
38: import {Withdraw, WithdrawParams} from "@src/libraries/general/actions/Withdraw.sol"; // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L42-L42)']
```solidity
42: import {CapsLibrary} from "@src/libraries/fixed/CapsLibrary.sol"; // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L45-L45)']
```solidity
45: import {BorrowVariable, BorrowVariableParams} from "@src/libraries/variable/actions/BorrowVariable.sol"; // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L47-L47)']
```solidity
47: import {LiquidateVariable, LiquidateVariableParams} from "@src/libraries/variable/actions/LiquidateVariable.sol"; // <= FOUND

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L48-L48)']
```solidity
48: import {RepayVariable, RepayVariableParams} from "@src/libraries/variable/actions/RepayVariable.sol"; // <= FOUND

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L50-L50)']
```solidity
50: import {SizeView} from "@src/SizeView.sol"; // <= FOUND

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L52-L52)']
```solidity
52: import {ISize} from "@src/interfaces/ISize.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L8-L8)']
```solidity
8: import {CreditPosition, DebtPosition} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L5-L5)']
```solidity
5: import {SizeStorage, State} from "@src/SizeStorage.sol"; // <= FOUND

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L16-L16)']
```solidity
16: import {UpdateConfig} from "@src/libraries/general/actions/UpdateConfig.sol"; // <= FOUND

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L26-L26)']
```solidity
26: import {BorrowOffer, LoanOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L7-L7)']
```solidity
7: import {Initialize} from "@src/libraries/general/actions/Initialize.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L4-L4)']
```solidity
4: import {Clones} from "@openzeppelin/contracts/proxy/Clones.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L8-L8)']
```solidity
8: import {BorrowOffer, LoanOffer} from "@src/libraries/fixed/OfferLibrary.sol"; // <= FOUND

```
['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L6-L6)']
```solidity
6: import {VariableDebtToken} from "@aave/protocol/tokenization/VariableDebtToken.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L8-L8)']
```solidity
8: import {DataTypes} from "@aave/protocol/libraries/types/DataTypes.sol"; // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L9-L9)']
```solidity
9: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol"; // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L19-L19)']
```solidity
19: import {UserLibrary} from "@src/libraries/fixed/UserLibrary.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L4-L4)']
```solidity
4: import {IAaveOracle} from "@aave/interfaces/IAaveOracle.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L7-L7)']
```solidity
7: import {IPriceFeed} from "./IPriceFeed.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L4-L4)']
```solidity
4: import {OwnableUpgradeable} from "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol"; // <= FOUND

```
['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L6-L6)']
```solidity
6: import {Address} from "@openzeppelin/contracts/utils/Address.sol"; // <= FOUND

```


</details>

## [NonCritical-51] .call bypasses function existence check, type checking and argument packing

### Resolution 
Using the `.call` method in Solidity enables direct communication with an address, bypassing function existence checks, type checking, and argument packing. While this can save gas and provide flexibility, it can also introduce security risks and potential errors. The absence of these checks can lead to unexpected behavior if the callee contract's interface changes or if the input parameters are not crafted with care. The resolution to these issues is to use Solidity's high-level interface for calling functions when possible, as it automatically manages these aspects. If using `.call` is necessary, ensure that the inputs are carefully validated and that awareness of the called contract's behavior is maintained.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L29-L29)']
```solidity
29:         (success, returnData) = address(target).call(data); // <= FOUND

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L62-L63)']
```solidity
62:             
63:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]); // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L42-L42)']
```solidity
42:         (success, returnData) = address(target).call{value: value}(data); // <= FOUND

```


</details>

## [NonCritical-52] Using while for unbounded loops isnâ€™t recommended

### Resolution 
Utilizing a `while` loop for unbounded iterations in Solidity isn't advisable as it can lead to unintended infinite loops. Such loops could consume all the available gas, causing transactions to fail and losing the gas spent. This can lead to a denial-of-service vulnerability if used maliciously. It's generally better to impose an upper limit on iterations or apply a pattern that ensures termination. If an unbounded loop is necessary, implementing safeguards, careful logic, and possibly an emergency stop mechanism can mitigate the risks. Using tools to analyze loop conditions and behavior can also help avoid potential issues.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L64-L64)']
```solidity
64:         while (low <= high)  // <= FOUND

```


</details>

## [NonCritical-53] Use of override is unnecessary

### Resolution 
Starting with Solidity version 0.8.8, the use of the `override` keyword is simplified. If a function solely overrides an interface function and does not exist in multiple base contracts, specifying `override` becomes unnecessary. This change streamlines the code and makes it less verbose. Removing unnecessary use of `override` in these situations can make the code cleaner and more maintainable, aligning with the newer Solidity guidelines. It's a good practice to adapt to this updated behavior to stay consistent with the language's evolution and current best practices.

Num of instances: 7

### Findings 


<details><summary>Click to show findings</summary>

['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L41-L41)']
```solidity
41:     function getMarketBorrowRate() external view override returns (uint128)  // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L31-L31)']
```solidity
31:     function transferFrom(address from, address to, uint256 value) public virtual override onlyOwner returns (bool)  // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L36-L36)']
```solidity
36:     function transfer(address to, uint256 value) public virtual override onlyOwner returns (bool)  // <= FOUND

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L41-L41)']
```solidity
41:     function allowance(address, address spender) public view virtual override returns (uint256)  // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L45-L45)']
```solidity
45:     function approve(address, uint256) public virtual override returns (bool)  // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L49-L49)']
```solidity
49:     function decimals() public view virtual override returns (uint8)  // <= FOUND

```
['[116](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L116-L116)']
```solidity
116:     function _authorizeUpgrade(address newImplementation) internal override onlyRole(DEFAULT_ADMIN_ROLE)  // <= FOUND

```


</details>

## [NonCritical-54] No access control on receive/payable fallback

### Resolution 
Without access control on receive/payable fallback functions in a contract, anyone can send Ether (ETH) to the contract's address. If there's no way to withdraw those funds defined within the contract, any Ether sent, whether intentionally or by mistake, will be permanently stuck. This could lead to unintended loss of funds. Implementing proper access control ensures that only authorized addresses can interact with these functions. Resolution could involve adding access control mechanisms, like Ownable or specific permission requirements, or creating a withdrawal function accessible only to the contract's owner, thus preventing unintentional loss of funds.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[67](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L67-L67)']
```solidity
67:     receive() external payable {} // <= FOUND

```


</details>

## [NonCritical-55] If statement control structures do not comply with best practices

### Resolution 
If statements which include a single line do not need to have curly brackets, however according to the Solidiity style guide the line of code executed upon the if statement condition being met should still be on the next line, not on the same line as the if statement declaration.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L95-L96)']
```solidity
95:         
96:         if (dueDate < block.timestamp) revert Errors.PAST_DUE_DATE(dueDate); // <= FOUND

```


</details>

## [NonCritical-56] Cyclomatic complexity in functions

### Resolution 
Cyclomatic complexity is a software metric used to measure the complexity of a program. It quantifies the number of linearly independent paths through a program's source code, giving an idea of how complex the control flow is. High cyclomatic complexity may indicate a higher risk of defects and can make the code harder to understand, test, and maintain. It often suggests that a function or method is trying to do too much, and a refactor might be needed. By breaking down complex functions into smaller, more focused pieces, you can improve readability, ease of testing, and overall maintainability.

Num of instances: 20

### Findings 


<details><summary>Click to show findings</summary>

['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L41-L41)']
```solidity
41:     function validateBorrowAsMarketOrder(State storage state, BorrowAsMarketOrderParams memory params) external view { // <= FOUND
42:         User memory lenderUser = state.data.users[params.lender];
43:         LoanOffer memory loanOffer = lenderUser.loanOffer;
44: 
45:         
46:         
47: 
48:         
49:         if (loanOffer.isNull()) {
50:             revert Errors.INVALID_LOAN_OFFER(params.lender);
51:         }
52: 
53:         
54:         if (params.amount == 0) {
55:             revert Errors.NULL_AMOUNT();
56:         }
57: 
58:         
59:         if (params.dueDate < block.timestamp) {
60:             revert Errors.PAST_DUE_DATE(params.dueDate);
61:         }
62:         if (params.dueDate > loanOffer.maxDueDate) {
63:             revert Errors.DUE_DATE_GREATER_THAN_MAX_DUE_DATE(params.dueDate, loanOffer.maxDueDate);
64:         }
65: 
66:         
67:         if (params.deadline < block.timestamp) {
68:             revert Errors.PAST_DEADLINE(params.deadline);
69:         }
70: 
71:         
72:         uint256 ratePerMaturity =
73:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
74:         uint256 maturity = params.dueDate - block.timestamp;
75:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) > params.maxAPR) {
76:             revert Errors.APR_GREATER_THAN_MAX_APR(
77:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.maxAPR
78:             );
79:         }
80: 
81:         
82:         
83: 
84:         
85:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) {
86:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
87: 
88:             CreditPosition memory creditPosition = state.getCreditPosition(creditPositionId);
89:             DebtPosition memory debtPosition = state.getDebtPositionByCreditPositionId(creditPositionId);
90: 

```
[]
```solidity
111:     function _borrowFromCredit(State storage state, BorrowAsMarketOrderParams memory params)
112:         internal
113:         returns (uint256 amountOutLeft)
114:     {
115:         
116:         
117: 
118:         User storage lenderUser = state.data.users[params.lender];
119: 
120:         LoanOffer storage loanOffer = lenderUser.loanOffer;
121: 
122:         uint256 ratePerMaturity =
123:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
124: 
125:         amountOutLeft =
126:             params.exactAmountIn ? Math.mulDivDown(params.amount, PERCENT, PERCENT + ratePerMaturity) : params.amount;
127: 
128:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) {
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) {
135:                 deltaAmountIn = creditPosition.credit;
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity);
137:             }
138: 
139:             
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) {
141:                 continue;
142:             }
143:             
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             
149:             state.createCreditPosition({
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee
157:             );
158:             amountOutLeft -= deltaAmountOut;
159:         }
160:     }

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L34-L34)']
```solidity
34:     function validateBorrowerExit(State storage state, BorrowerExitParams calldata params) external view { // <= FOUND
35:         BorrowOffer memory borrowOffer = state.data.users[params.borrowerToExitTo].borrowOffer;
36:         DebtPosition memory debtPosition = state.getDebtPosition(params.debtPositionId);
37: 
38:         
39:         uint256 dueDate = debtPosition.dueDate;
40:         if (dueDate < block.timestamp) {
41:             revert Errors.PAST_DUE_DATE(debtPosition.dueDate);
42:         }
43:         uint256 maturity = dueDate - block.timestamp;
44:         if (maturity < state.riskConfig.minimumMaturity) {
45:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity);
46:         }
47: 
48:         uint256 ratePerMaturity = borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, dueDate);
49:         uint256 issuanceValue = Math.mulDivUp(debtPosition.faceValue, PERCENT, PERCENT + ratePerMaturity);
50: 
51:         
52:         if (msg.sender != debtPosition.borrower) {
53:             revert Errors.EXITER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower);
54:         }
55:         if (
56:             state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false)
57:                 < issuanceValue + state.feeConfig.earlyBorrowerExitFee
58:         ) {
59:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
60:                 address(state.data.borrowAToken),
61:                 msg.sender,
62:                 false,
63:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
64:                 issuanceValue + state.feeConfig.earlyBorrowerExitFee
65:             );
66:         }
67: 
68:         
69:         if (params.deadline < block.timestamp) {
70:             revert Errors.PAST_DEADLINE(params.deadline);
71:         }
72: 
73:         
74:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
75:             revert Errors.APR_LOWER_THAN_MIN_APR(
76:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
77:             );
78:         }
79: 
80:         
81:         
82:     }

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L31-L31)']
```solidity
31:     function validateCompensate(State storage state, CompensateParams calldata params) external view { // <= FOUND
32:         CreditPosition storage creditPositionWithDebtToRepay =
33:             state.getCreditPosition(params.creditPositionWithDebtToRepayId);
34:         DebtPosition storage debtPositionToRepay =
35:             state.getDebtPositionByCreditPositionId(params.creditPositionWithDebtToRepayId);
36:         CreditPosition storage creditPositionToCompensate = state.getCreditPosition(params.creditPositionToCompensateId);
37: 
38:         uint256 amountToCompensate =
39:             Math.min(params.amount, creditPositionToCompensate.credit, debtPositionToRepay.faceValue);
40: 
41:         
42:         if (state.getLoanStatus(params.creditPositionWithDebtToRepayId) == LoanStatus.REPAID) {
43:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionWithDebtToRepayId);
44:         }
45:         if (creditPositionWithDebtToRepay.credit < amountToCompensate) {
46:             revert Errors.CREDIT_LOWER_THAN_AMOUNT_TO_COMPENSATE(
47:                 creditPositionWithDebtToRepay.credit, amountToCompensate
48:             );
49:         }
50: 
51:         
52:         if (state.getLoanStatus(params.creditPositionToCompensateId) == LoanStatus.REPAID) {
53:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionToCompensateId);
54:         }
55:         if (
56:             debtPositionToRepay.dueDate
57:                 < state.getDebtPositionByCreditPositionId(params.creditPositionToCompensateId).dueDate
58:         ) {
59:             revert Errors.DUE_DATE_NOT_COMPATIBLE(
60:                 params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId
61:             );
62:         }
63:         if (creditPositionToCompensate.lender != debtPositionToRepay.borrower) {
64:             revert Errors.INVALID_LENDER(creditPositionToCompensate.lender);
65:         }
66: 
67:         
68:         if (msg.sender != debtPositionToRepay.borrower) {
69:             revert Errors.COMPENSATOR_IS_NOT_BORROWER(msg.sender, debtPositionToRepay.borrower);
70:         }
71: 
72:         
73:         if (params.amount == 0) {
74:             revert Errors.NULL_AMOUNT();
75:         }
76:     }

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L27-L27)']
```solidity
27:     function validateDeposit(State storage state, DepositParams calldata params) external view { // <= FOUND
28:         
29:         
30: 
31:         
32:         if (
33:             params.token != address(state.data.underlyingCollateralToken)
34:                 && params.token != address(state.data.underlyingBorrowToken)
35:         ) {
36:             revert Errors.INVALID_TOKEN(params.token);
37:         }
38: 
39:         
40:         if (params.amount == 0) {
41:             revert Errors.NULL_AMOUNT();
42:         }
43: 
44:         
45:         if (params.to == address(0)) {
46:             revert Errors.NULL_ADDRESS();
47:         }
48: 
49:         
50:         
51:     }

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L84-L84)']
```solidity
84:     function validateInitializeRiskConfigParams(InitializeRiskConfigParams memory r) internal pure { // <= FOUND
85:         
86:         if (r.crOpening < PERCENT) {
87:             revert Errors.INVALID_COLLATERAL_RATIO(r.crOpening);
88:         }
89: 
90:         
91:         if (r.crLiquidation < PERCENT) {
92:             revert Errors.INVALID_COLLATERAL_RATIO(r.crLiquidation);
93:         }
94:         if (r.crOpening <= r.crLiquidation) {
95:             revert Errors.INVALID_LIQUIDATION_COLLATERAL_RATIO(r.crOpening, r.crLiquidation);
96:         }
97: 
98:         
99:         if (r.minimumCreditBorrowAToken == 0) {
100:             revert Errors.NULL_AMOUNT();
101:         }
102: 
103:         
104:         if (r.collateralSplitLiquidatorPercent > PERCENT) {
105:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM(r.collateralSplitLiquidatorPercent);
106:         }
107: 
108:         
109:         if (r.collateralSplitProtocolPercent > PERCENT) {
110:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM(r.collateralSplitProtocolPercent);
111:         }
112:         if (r.collateralSplitLiquidatorPercent + r.collateralSplitProtocolPercent > PERCENT) {
113:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM_SUM(
114:                 r.collateralSplitLiquidatorPercent + r.collateralSplitProtocolPercent
115:             );
116:         }
117: 
118:         
119:         
120: 
121:         
122:         
123: 
124:         
125:         
126: 
127:         
128:         if (r.moveToVariablePoolHFThreshold < PERCENT) {
129:             revert Errors.INVALID_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(r.moveToVariablePoolHFThreshold);
130:         }
131: 
132:         
133:         if (r.minimumMaturity == 0) {

```
['[152](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L152-L152)']
```solidity
152:     function validateInitializeDataParams(InitializeDataParams memory d) internal pure { // <= FOUND
153:         
154:         if (d.underlyingCollateralToken == address(0)) {
155:             revert Errors.NULL_ADDRESS();
156:         }
157: 
158:         
159:         if (d.underlyingBorrowToken == address(0)) {
160:             revert Errors.NULL_ADDRESS();
161:         }
162: 
163:         
164:         if (d.variablePool == address(0)) {
165:             revert Errors.NULL_ADDRESS();
166:         }
167:     }

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L22-L22)']
```solidity
22:     function validateLendAsLimitOrder(State storage state, LendAsLimitOrderParams calldata params) external view { // <= FOUND
23:         LoanOffer memory loanOffer =
24:             LoanOffer({maxDueDate: params.maxDueDate, curveRelativeTime: params.curveRelativeTime});
25: 
26:         
27:         if (!loanOffer.isNull()) {
28:             
29:             
30: 
31:             
32:             if (params.maxDueDate == 0) {
33:                 revert Errors.NULL_MAX_DUE_DATE();
34:             }
35:             if (params.maxDueDate < block.timestamp) {
36:                 revert Errors.PAST_MAX_DUE_DATE(params.maxDueDate);
37:             }
38: 
39:             
40:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity);
41:         }
42:     }

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L37-L37)']
```solidity
37:     function validateLendAsMarketOrder(State storage state, LendAsMarketOrderParams calldata params) external view { // <= FOUND
38:         BorrowOffer memory borrowOffer = state.data.users[params.borrower].borrowOffer;
39: 
40:         
41:         
42: 
43:         
44:         if (borrowOffer.isNull()) {
45:             revert Errors.INVALID_BORROW_OFFER(params.borrower);
46:         }
47: 
48:         
49:         if (params.dueDate < block.timestamp) {
50:             revert Errors.PAST_DUE_DATE(params.dueDate);
51:         }
52: 
53:         
54:         uint256 ratePerMaturity =
55:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
56:         uint256 amountIn;
57:         if (params.exactAmountIn) {
58:             amountIn = params.amount;
59:         } else {
60:             amountIn = Math.mulDivUp(params.amount, PERCENT, PERCENT + ratePerMaturity);
61:         }
62:         if (state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false) < amountIn) {
63:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
64:                 address(state.data.borrowAToken),
65:                 msg.sender,
66:                 false,
67:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
68:                 amountIn
69:             );
70:         }
71: 
72:         
73:         if (params.deadline < block.timestamp) {
74:             revert Errors.PAST_DEADLINE(params.deadline);
75:         }
76: 
77:         
78:         uint256 maturity = params.dueDate - block.timestamp;
79:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
80:             revert Errors.APR_LOWER_THAN_MIN_APR(
81:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
82:             );
83:         }
84: 
85:         
86:         

```
[]
```solidity
119:     function executeLiquidate(State storage state, LiquidateParams calldata params)
120:         external
121:         returns (uint256 liquidatorProfitCollateralToken)
122:     {
123:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
124:         DebtPosition memory debtPositionCopy = debtPosition;
125:         LoanStatus loanStatus = state.getLoanStatus(params.debtPositionId);
126:         uint256 collateralRatio = state.collateralRatio(debtPosition.borrower);
127: 
128:         emit Events.Liquidate(params.debtPositionId, params.minimumCollateralProfit, collateralRatio, loanStatus);
129: 
130:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, debtPosition.faceValue);
131:         debtPosition.updateRepayFee(debtPosition.faceValue, repayFee);
132: 
133:         
134:         if (PERCENT <= collateralRatio && collateralRatio < state.riskConfig.crLiquidation) {
135:             emit Events.LiquidateUserLiquidatableProfitably(params.debtPositionId);
136:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, true);
137:             
138:         } else if (collateralRatio < PERCENT) {
139:             emit Events.LiquidateUserLiquidatableUnprofitably(params.debtPositionId);
140:             liquidatorProfitCollateralToken =
141:                 _executeLiquidateTakeCollateral(state, debtPositionCopy, false  );
142:             
143:         } else {
144:             
145:             if (loanStatus == LoanStatus.OVERDUE) {
146:                 liquidatorProfitCollateralToken = _executeLiquidateOverdue(state, params, debtPositionCopy);
147:                 
148:             } else {
149:                 
150:                 revert Errors.LOAN_NOT_LIQUIDATABLE(params.debtPositionId, collateralRatio, loanStatus);
151:             }
152:         }
153: 
154:         state.data.debtToken.burn(debtPosition.borrower, debtPositionCopy.faceValue);
155:         debtPosition.liquidityIndexAtRepayment = state.borrowATokenLiquidityIndex();
156:     }

```
[]
```solidity
35:     function validateLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params)
36:         external
37:         view
38:     {
39:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
40:         BorrowOffer storage borrowOffer = state.data.users[params.borrower].borrowOffer;
41:         uint256 ratePerMaturity =
42:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, debtPosition.dueDate);
43: 
44:         
45:         state.validateLiquidate(
46:             LiquidateParams({
47:                 debtPositionId: params.debtPositionId,
48:                 minimumCollateralProfit: params.minimumCollateralProfit
49:             })
50:         );
51: 
52:         
53:         if (state.getLoanStatus(params.debtPositionId) != LoanStatus.ACTIVE) {
54:             revert Errors.LOAN_NOT_ACTIVE(params.debtPositionId);
55:         }
56:         uint256 maturity = debtPosition.dueDate - block.timestamp;
57:         if (maturity < state.riskConfig.minimumMaturity) {
58:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity);
59:         }
60: 
61:         
62:         if (borrowOffer.isNull()) {
63:             revert Errors.INVALID_BORROW_OFFER(params.borrower);
64:         }
65: 
66:         
67:         if (params.deadline < block.timestamp) {
68:             revert Errors.PAST_DEADLINE(params.deadline);
69:         }
70: 
71:         
72:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
73:             revert Errors.APR_LOWER_THAN_MIN_APR(
74:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
75:             );
76:         }
77:     }

```
['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L101-L101)']
```solidity
101:     function getLoanStatus(State storage state, uint256 positionId) public view returns (LoanStatus) { // <= FOUND
102:         
103:         DebtPosition memory debtPosition = state.data.debtPositions[positionId];
104:         if (isCreditPositionId(state, positionId)) {
105:             
106:             debtPosition = getDebtPositionByCreditPositionId(state, positionId);
107:         } else if (!isDebtPositionId(state, positionId)) {
108:             
109:             revert Errors.INVALID_POSITION_ID(positionId);
110:         }
111: 
112:         
113:         if (getDebt(debtPosition) == 0) {
114:             return LoanStatus.REPAID;
115:         } else if (block.timestamp >= debtPosition.dueDate) {
116:             return LoanStatus.OVERDUE;
117:         } else {
118:             return LoanStatus.ACTIVE;
119:         }
120:     }

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L57-L57)']
```solidity
57:     function binarySearch(uint256[] memory array, uint256 value) internal pure returns (uint256 low, uint256 high) { // <= FOUND
58:         low = 0;
59:         high = array.length - 1;
60:         if (value < array[low] || value > array[high]) {
61:             
62:             return (type(uint256).max, type(uint256).max);
63:         }
64:         while (low <= high) {
65:             uint256 mid = (low + high) / 2;
66:             if (array[mid] == value) {
67:                 return (mid, mid);
68:             } else if (array[mid] < value) {
69:                 low = mid + 1;
70:             } else {
71:                 high = mid - 1;
72:             }
73:         }
74:         return (high, low);
75:     }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L25-L25)']
```solidity
25:     function validateRepay(State storage state, RepayParams calldata params) external view { // <= FOUND
26:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
27: 
28:         
29:         if (state.getLoanStatus(params.debtPositionId) == LoanStatus.REPAID) {
30:             revert Errors.LOAN_ALREADY_REPAID(params.debtPositionId);
31:         }
32: 
33:         
34:         if (msg.sender != debtPosition.borrower) {
35:             revert Errors.REPAYER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower);
36:         }
37:         if (state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false) < debtPosition.faceValue) {
38:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
39:                 address(state.data.borrowAToken),
40:                 msg.sender,
41:                 false,
42:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
43:                 debtPosition.faceValue
44:             );
45:         }
46:     }

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L27-L27)']
```solidity
27:     function validateSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external view { // <= FOUND
28:         CreditPosition storage creditPosition = state.getCreditPosition(params.creditPositionId);
29:         DebtPosition storage debtPosition = state.getDebtPositionByCreditPositionId(params.creditPositionId);
30: 
31:         uint256 assignedCollateral = state.getCreditPositionProRataAssignedCollateral(creditPosition);
32:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPosition.faceValue);
33: 
34:         
35:         if (!state.isCreditPositionSelfLiquidatable(params.creditPositionId)) {
36:             revert Errors.LOAN_NOT_SELF_LIQUIDATABLE(
37:                 params.creditPositionId,
38:                 state.collateralRatio(debtPosition.borrower),
39:                 state.getLoanStatus(params.creditPositionId)
40:             );
41:         }
42:         if (!(assignedCollateral < debtInCollateralToken)) {
43:             revert Errors.LIQUIDATION_NOT_AT_LOSS(params.creditPositionId, assignedCollateral, debtInCollateralToken);
44:         }
45: 
46:         
47:         if (msg.sender != creditPosition.lender) {
48:             revert Errors.LIQUIDATOR_IS_NOT_LENDER(msg.sender, creditPosition.lender);
49:         }
50:     }

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L76-L76)']
```solidity
76:     function executeUpdateConfig(State storage state, UpdateConfigParams calldata params) external { // <= FOUND
77:         if (params.key == "crOpening") {
78:             state.riskConfig.crOpening = params.value;
79:         } else if (params.key == "crLiquidation") {
80:             state.riskConfig.crLiquidation = params.value;
81:         } else if (params.key == "minimumCreditBorrowAToken") {
82:             state.riskConfig.minimumCreditBorrowAToken = params.value;
83:         } else if (params.key == "collateralSplitLiquidatorPercent") {
84:             state.riskConfig.collateralSplitLiquidatorPercent = params.value;
85:         } else if (params.key == "collateralSplitProtocolPercent") {
86:             state.riskConfig.collateralSplitProtocolPercent = params.value;
87:         } else if (params.key == "collateralTokenCap") {
88:             state.riskConfig.collateralTokenCap = params.value;
89:         } else if (params.key == "borrowATokenCap") {
90:             state.riskConfig.borrowATokenCap = params.value;
91:         } else if (params.key == "debtTokenCap") {
92:             state.riskConfig.debtTokenCap = params.value;
93:         } else if (params.key == "moveToVariablePoolHFThreshold") {
94:             state.riskConfig.moveToVariablePoolHFThreshold = params.value;
95:         } else if (params.key == "minimumMaturity") {
96:             state.riskConfig.minimumMaturity = params.value;
97:         } else if (params.key == "repayFeeAPR") {
98:             state.feeConfig.repayFeeAPR = params.value;
99:         } else if (params.key == "earlyLenderExitFee") {
100:             state.feeConfig.earlyLenderExitFee = params.value;
101:         } else if (params.key == "earlyBorrowerExitFee") {
102:             state.feeConfig.earlyBorrowerExitFee = params.value;
103:         } else if (params.key == "collateralOverdueTransferFee") {
104:             state.feeConfig.collateralOverdueTransferFee = params.value;
105:         } else if (params.key == "feeRecipient") {
106:             state.feeConfig.feeRecipient = address(uint160(params.value));
107:         } else if (params.key == "priceFeed") {
108:             state.oracle.priceFeed = IPriceFeed(address(uint160(params.value)));
109:         } else if (params.key == "marketBorrowRateFeed") {
110:             state.oracle.marketBorrowRateFeed = IMarketBorrowRateFeed(address(uint160(params.value)));
111:         } else {
112:             revert Errors.INVALID_KEY(params.key);
113:         }
114: 
115:         Initialize.validateInitializeFeeConfigParams(feeConfigParams(state));
116:         Initialize.validateInitializeRiskConfigParams(riskConfigParams(state));
117:         Initialize.validateInitializeOracleParams(oracleParams(state));
118: 
119:         emit Events.UpdateConfig(params.key, params.value);
120:     }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L25-L25)']
```solidity
25:     function validateWithdraw(State storage state, WithdrawParams calldata params) external view { // <= FOUND
26:         
27:         
28: 
29:         
30:         if (
31:             params.token != address(state.data.underlyingCollateralToken)
32:                 && params.token != address(state.data.underlyingBorrowToken)
33:         ) {
34:             revert Errors.INVALID_TOKEN(params.token);
35:         }
36: 
37:         
38:         if (params.amount == 0) {
39:             revert Errors.NULL_AMOUNT();
40:         }
41: 
42:         
43:         if (params.to == address(0)) {
44:             revert Errors.NULL_ADDRESS();
45:         }
46: 
47:         
48:         
49:     }

```
['[51](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L51-L51)']
```solidity
51:     function executeWithdraw(State storage state, WithdrawParams calldata params) public { // <= FOUND
52:         uint256 amount;
53:         if (params.variable || params.token == address(state.data.underlyingBorrowToken)) {
54:             IAToken aToken = params.token == address(state.data.underlyingBorrowToken)
55:                 ? state.data.borrowAToken
56:                 : state.data.collateralAToken;
57: 
58:             amount = Math.min(params.amount, state.aTokenBalanceOf(aToken, msg.sender, params.variable));
59:             if (amount > 0) {
60:                 state.withdrawUnderlyingTokenFromVariablePool(aToken, msg.sender, params.to, amount, params.variable);
61:             }
62:         } else {
63:             amount = Math.min(params.amount, state.data.collateralToken.balanceOf(msg.sender));
64:             if (amount > 0) {
65:                 state.withdrawUnderlyingCollateralToken(msg.sender, params.to, amount);
66:             }
67:         }
68: 
69:         emit Events.Withdraw(params.token, params.to, params.variable, amount);
70:     }

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L26-L26)']
```solidity
26:     function validateYieldCurve(YieldCurve memory self, uint256 minimumMaturity) internal pure { // <= FOUND
27:         if (self.maturities.length == 0 || self.aprs.length == 0 || self.marketRateMultipliers.length == 0) {
28:             revert Errors.NULL_ARRAY();
29:         }
30:         if (self.maturities.length != self.aprs.length || self.maturities.length != self.marketRateMultipliers.length) {
31:             revert Errors.ARRAY_LENGTHS_MISMATCH();
32:         }
33: 
34:         
35:         
36: 
37:         
38:         uint256 lastMaturity = type(uint256).max;
39:         for (uint256 i = self.maturities.length; i > 0; i--) {
40:             if (self.maturities[i - 1] > lastMaturity) {
41:                 revert Errors.MATURITIES_NOT_STRICTLY_INCREASING();
42:             }
43:             lastMaturity = self.maturities[i - 1];
44:         }
45:         if (self.maturities[0] < minimumMaturity) {
46:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(self.maturities[0], minimumMaturity);
47:         }
48: 
49:         
50:         
51:     }

```
[]
```solidity
89:     function getRatePerMaturityByDueDate(
90:         YieldCurve memory curveRelativeTime,
91:         IMarketBorrowRateFeed marketBorrowRateFeed,
92:         uint256 dueDate
93:     ) external view returns (uint256) {
94:         
95:         if (dueDate < block.timestamp) revert Errors.PAST_DUE_DATE(dueDate);
96:         uint256 maturity = dueDate - block.timestamp;
97:         uint256 length = curveRelativeTime.maturities.length;
98:         if (maturity < curveRelativeTime.maturities[0] || maturity > curveRelativeTime.maturities[length - 1]) {
99:             revert Errors.MATURITY_OUT_OF_RANGE(
100:                 maturity, curveRelativeTime.maturities[0], curveRelativeTime.maturities[length - 1]
101:             );
102:         } else {
103:             (uint256 low, uint256 high) = Math.binarySearch(curveRelativeTime.maturities, maturity);
104:             uint256 x0 = curveRelativeTime.maturities[low];
105:             uint256 y0 = getRatePerMaturityByDueDate(
106:                 curveRelativeTime.maturities[low],
107:                 curveRelativeTime.aprs[low],
108:                 curveRelativeTime.marketRateMultipliers[low],
109:                 marketBorrowRateFeed
110:             );
111:             uint256 x1 = curveRelativeTime.maturities[high];
112:             uint256 y1 = getRatePerMaturityByDueDate(
113:                 curveRelativeTime.maturities[high],
114:                 curveRelativeTime.aprs[high],
115:                 curveRelativeTime.marketRateMultipliers[high],
116:                 marketBorrowRateFeed
117:             );
118: 
119:             
120:             if (x1 != x0) {
121:                 if (y1 >= y0) {
122:                     return y0 + Math.mulDivDown(y1 - y0, maturity - x0, x1 - x0);
123:                 } else {
124:                     return y0 - Math.mulDivDown(y0 - y1, maturity - x0, x1 - x0);
125:                 }
126:             } else {
127:                 return y0;
128:             }
129:         }
130:     }

```


</details>

## [NonCritical-57] Incorrect withdraw declaration

### Resolution 
In Solidity, it's essential for clarity and interoperability to correctly specify return types in function declarations. If the `withdraw` function is expected to return a `bool` to indicate success or failure, its omission could lead to ambiguity or unexpected behavior when interacting with or calling this function from other contracts or off-chain systems. Missing return values can mislead developers and potentially lead to contract integrations built on incorrect assumptions. To resolve this, the function declaration for `withdraw` should be modified to explicitly include the `bool` return type, ensuring clarity and correctness in contract interactions.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[140](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L140-L140)']
```solidity
140:     function withdraw(WithdrawParams calldata params) external override(ISize) whenNotPaused  // <= FOUND

```


</details>

## [NonCritical-58] Consider adding formal verification proofs

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L12-L12)']
```solidity
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step  // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20  // <= FOUND

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L56-L56)']
```solidity
56: contract Size is // <= FOUND
57:     ISize,
58:     SizeView,
59:     Initializable,
60:     AccessControlUpgradeable,
61:     PausableUpgradeable,
62:     MulticallUpgradeable,
63:     UUPSUpgradeable
64: 

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L17-L17)']
```solidity
17: contract VariablePoolPriceFeed is IPriceFeed  // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable  // <= FOUND

```


</details>

## [NonCritical-59] Consider bounding input array length

### Resolution 
Unbounded array inputs in functions can lead to unintentional excessive gas consumption, potentially causing a transaction to revert after expending substantial gas. To enhance user experience and prevent such scenarios, consider implementing a `require()` statement that limits the array length to a defined maximum. This constraint ensures that transactions won't proceed if they're likely to hit gas limits due to array size, saving users from unnecessary gas costs and offering a more predictable interaction with the contract.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L128-L128)']
```solidity
128:        for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) { // <= FOUND
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) {
135:                 deltaAmountIn = creditPosition.credit;
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity);
137:             }
138: 
139:             
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) {
141:                 continue;
142:             }
143:             
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             
149:             state.createCreditPosition({
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee
157:             );
158:             amountOutLeft -= deltaAmountOut;
159:         }

```


</details>

## [NonCritical-60] Missing events in sensitive functions

### Resolution 
Sensitive setter functions in smart contracts often alter critical state variables. Without events emitted in these functions, external observers or dApps cannot easily track or react to these state changes. Missing events can obscure contract activity, hampering transparency and making integration more challenging. To resolve this, incorporate appropriate event emissions within these functions. Events offer an efficient way to log crucial changes, aiding in real-time tracking and post-transaction verification.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[167](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L167-L167)']
```solidity
167:     function updateRepayFee(DebtPosition storage self, uint256 _repayAmount, uint256 _repayFee) external { // <= FOUND
168:         uint256 r = Math.mulDivDown(PERCENT, self.faceValue, self.issuanceValue);
169:         self.faceValue -= _repayAmount;
170:         self.repayFee -= _repayFee;
171:         self.issuanceValue = Math.mulDivDown(self.faceValue, PERCENT, r);
172:     }

```
['[118](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L118-L118)']
```solidity
118:     function updateConfig(UpdateConfigParams calldata params) external onlyRole(DEFAULT_ADMIN_ROLE) { // <= FOUND
119:         state.validateUpdateConfig(params);
120:         state.executeUpdateConfig(params);
121:     }

```


</details>

## [NonCritical-61] Consider disallowing transfers to "address(this)"

### Resolution 
Disallowing transfers to "address(this)" prevents accidental token lockup within the contract. Transferring tokens to the contract's own address might render them irretrievable. Implement a check in the transfer function to reject transactions with the contract's address as the recipient, ensuring tokens aren't unintentionally trapped.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L36-L37)']
```solidity
36:     function transfer(address to, uint256 value) public virtual override onlyOwner returns (bool) { // <= FOUND
37:         _transfer(msg.sender, to, value); // <= FOUND
38:         return true;
39:     }

```


</details>

## [NonCritical-62] Add inline comments for unnamed variables in function declarations

### Resolution 
Unnamed variables in function declarations can confuse developers. To enhance clarity, add inline comments next to each unnamed variable. E.g address, -> address /* to */,

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L45-L45)']
```solidity
45:     function approve(address, uint256) public virtual override returns (bool)  // <= FOUND

```


</details>

## [NonCritical-63] The function name() is not part of the ERC20 standard

### Resolution 
Assuming that the `name()` function is always present in an ERC20 contract can lead to unexpected issues, as not all ERC20 tokens implement it. Some tokens may omit this function or use a non-standard implementation. If your contract makes an external call to `name()` on a token that does not implement this function, it will result in a runtime error, possibly breaking your contract's functionality. The recommended solution is to use try/catch statements when calling `name()`. This way, your contract can handle cases where the function is missing or implemented differently, ensuring robust interaction with any ERC20 token.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[225](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L225-L227)']
```solidity
225:         state.data.collateralToken = new NonTransferrableToken(
226:             address(this),
227:             string.concat("Size Fixed ", IERC20Metadata(state.data.underlyingCollateralToken).name()), // <= FOUND
228:             string.concat("sz", IERC20Metadata(state.data.underlyingCollateralToken).symbol()),
229:             IERC20Metadata(state.data.underlyingCollateralToken).decimals()
230:         );

```


</details>

## [NonCritical-64] Don't only depend on Solidity's arithmetic ordering.

### Resolution 
Relying on Solidity's default arithmetic operator precedence can lead to misunderstood or overlooked nuances in code execution. Misinterpretation risks can be significant, especially when different developers or auditors review the code. To ensure clarity and minimize potential errors, it's recommended to use parentheses. These not only override the default precedence when needed but also emphasize the intended order of operations. By deliberately showing the intended calculation sequence using parentheses, developers make the code's logic explicit, reducing the risk of unintended behaviors and making the codebase more maintainable and understandable for all stakeholders.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L34-L34)']
```solidity
34:         return x * y / z; // <= FOUND

```


</details>

## [NonCritical-65] View function is not defined as such in interface

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L29-L191)']
```solidity
29: interface ISize {
30:     
45:     function deposit(DepositParams calldata params) external;
46: 
61:     function withdraw(WithdrawParams calldata params) external;
62: 
73:     function borrowAsMarketOrder(BorrowAsMarketOrderParams memory params) external;
74: 
82:     function borrowAsLimitOrder(BorrowAsLimitOrderParams calldata params) external;
83: 
90:     function lendAsMarketOrder(LendAsMarketOrderParams calldata params) external;
91: 
99:     function lendAsLimitOrder(LendAsLimitOrderParams calldata params) external;
100: 
114:     function borrowerExit(BorrowerExitParams calldata params) external;
115: 
122:     function repay(RepayParams calldata params) external;
123: 
129:     function claim(ClaimParams calldata params) external;
130: 
152:     function liquidate(LiquidateParams calldata params) external returns (uint256);
153: 
165:     function selfLiquidate(SelfLiquidateParams calldata params) external;
166: 
175:     function liquidateWithReplacement(LiquidateWithReplacementParams calldata params)
176:         external
177:         returns (uint256, uint256);
178: 
185:     function compensate(CompensateParams calldata params) external;
186: 
191:     function variablePoolAllowlisted(address account) external returns (bool); // <= FOUND
192: 
197:     function borrowVariable(BorrowVariableParams calldata params) external;
198: 
202:     function repayVariable(RepayVariableParams calldata params) external;
203: 
208:     function liquidateVariable(LiquidateVariableParams calldata params) external;
209: }

```


</details>

## [NonCritical-66] It is best practice to use linear inheritance

### Resolution 
In Solidity, complex inheritance structures can obfuscate code understanding, introducing potential security risks. Multiple inheritance, especially with overlapping function names or state variables, can cause unintentional overrides or ambiguous behavior. Resolution: Strive for linear and simple inheritance chains. Avoid diamond or circular inheritance patterns. Clearly document the purpose and relationships of base contracts, ensuring that overrides are intentional. Tools like Remix or Hardhat can visualize inheritance chains, assisting in verification. Keeping inheritance streamlined aids in better code readability, reduces potential errors, and ensures smoother audits and upgrades.

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L12-L12)']
```solidity
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step  // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20  // <= FOUND

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L57-L62)']
```solidity
56: contract Size is
57:     ISize, // <= FOUND
58:     SizeView, // <= FOUND
59:     Initializable, // <= FOUND
60:     AccessControlUpgradeable, // <= FOUND
61:     PausableUpgradeable, // <= FOUND
62:     MulticallUpgradeable, // <= FOUND
63:     UUPSUpgradeable
64: 

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable  // <= FOUND

```


</details>

## [NonCritical-67] A event should be emitted if a non immutable state variable is set in a constructor

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L20-L25)']
```solidity
20:     constructor(address _owner, uint64 _staleRateInterval) Ownable(_owner) {
21:         if (_staleRateInterval == 0) {
22:             revert Errors.NULL_STALE_RATE();
23:         }
24: 
25:         staleRateInterval = _staleRateInterval; // <= FOUND
26:     }

```


</details>

## [NonCritical-68] Create methods are suspicious of the reorg attack

### Resolution 
"Create" methods, which deploy contracts via " = new <contract>", are at risk from re-org attacks since the derived contract address is solely based on the Factory's nonce. Re-orgs, chain reorganizations, can occur across all EVM chains. The vulnerability amplifies when deploying contracts on EVM-compatible L2 solutions like Arbitrum and Polygon, which are notably susceptible to re-org attacks. Ethereum, a primary deployment target, has already experienced re-org events.

To bolster security against re-org threats, developers are advised to use the `create2` method for contract deployments instead of the basic `create`. By using `create2` with a salt that includes `msg.sender`, the contract's address derivation becomes more predictable and less prone to unexpected changes due to re-orgs. This strategy not only provides a more consistent deployment pattern but also minimizes risks associated with potential blockchain reorganizations.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[225](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L225-L235)']
```solidity
217:     function executeInitializeData(State storage state, InitializeDataParams memory d) internal {
218:         state.data.nextDebtPositionId = DEBT_POSITION_ID_START;
219:         state.data.nextCreditPositionId = CREDIT_POSITION_ID_START;
220: 
221:         state.data.underlyingCollateralToken = IERC20Metadata(d.underlyingCollateralToken);
222:         state.data.underlyingBorrowToken = IERC20Metadata(d.underlyingBorrowToken);
223:         state.data.variablePool = IPool(d.variablePool);
224: 
225:         state.data.collateralToken = new NonTransferrableToken( // <= FOUND
226:             address(this),
227:             string.concat("Size Fixed ", IERC20Metadata(state.data.underlyingCollateralToken).name()),
228:             string.concat("sz", IERC20Metadata(state.data.underlyingCollateralToken).symbol()),
229:             IERC20Metadata(state.data.underlyingCollateralToken).decimals()
230:         );
231:         state.data.borrowAToken =
232:             IAToken(state.data.variablePool.getReserveData(address(state.data.underlyingBorrowToken)).aTokenAddress);
233:         state.data.collateralAToken =
234:             IAToken(state.data.variablePool.getReserveData(address(state.data.underlyingCollateralToken)).aTokenAddress);
235:         state.data.debtToken = new NonTransferrableToken( // <= FOUND
236:             address(this), "Size Fixed Debt", "szDebt", IERC20Metadata(state.data.underlyingBorrowToken).decimals()
237:         );
238: 
239:         state.data.vaultImplementation = new Vault();
240:     }

```


</details>

## [NonCritical-69] Numbers downcast to addresses may result in collisions

### Resolution 
Downcasting numbers to addresses in blockchain contracts, particularly in Ethereum's Solidity, involves risks such as possible address collisions. A collision occurs when different inputs, when cast or hashed, generate the same output address, potentially compromising contract integrity and asset security. If an uint256, for instance, is downcast to an address (effectively an uint160) without ensuring itâ€™s a legitimate, collision-free conversion, different uint256 inputs might yield the same address, creating vulnerabilities attackers might exploit. Implementing thorough checks and opting for secure practices, like avoiding downcasting in critical logic or utilizing mappings with original uint256 as keys, mitigates risks

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[106](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L106-L106)']
```solidity
106:             state.feeConfig.feeRecipient = address(uint160(params.value)); // <= FOUND

```
['[108](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L108-L108)']
```solidity
108:             state.oracle.priceFeed = IPriceFeed(address(uint160(params.value))); // <= FOUND

```
['[110](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L110-L110)']
```solidity
110:             state.oracle.marketBorrowRateFeed = IMarketBorrowRateFeed(address(uint160(params.value))); // <= FOUND

```


</details>

## [NonCritical-70] Public variable declarations should have NatSpec descriptions

### Resolution 
Public variable declarations in smart contracts should ideally be accompanied by NatSpec comments to enhance code readability and provide clear documentation. NatSpec (Natural Language Specification) is a standard for writing comments in Ethereum smart contracts that can generate user-friendly documentation, improving the transparency of the contract's functionality. This is particularly crucial for public variables, as they are accessible externally, and understanding their role and impact is vital for both developers and users interacting with the contract

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L19-L21)']
```solidity
19:     IAaveOracle public immutable aaveOracle; // <= FOUND
20:     address public immutable base; // <= FOUND
21:     uint8 public immutable baseDecimals; // <= FOUND

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L22-L24)']
```solidity
22:     address public immutable quote; // <= FOUND
23:     uint8 public immutable quoteDecimals; // <= FOUND
24:     uint8 public immutable decimals; // <= FOUND

```
['[87](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L87-L88)']
```solidity
87:     bytes32 public constant KEEPER_ROLE = "KEEPER_ROLE"; // <= FOUND
88:     bytes32 public constant PAUSER_ROLE = "PAUSER_ROLE"; // <= FOUND
89: 

```


</details>

## [NonCritical-71] Use the Modern Upgradeable Contract Paradigm

### Resolution 
Modern smart contract development often employs upgradeable contract structures, utilizing proxy patterns like OpenZeppelinâ€™s Upgradeable Contracts. This paradigm separates logic and state, allowing developers to amend and enhance the contract's functionality without altering its state or the deployed contract address. Transitioning to this approach enhances long-term maintainability.

**Resolution**: Adopt a well-established proxy pattern for upgradeability, ensuring proper initialization and employing transparent proxies to mitigate potential risks. Embrace comprehensive testing and audit practices, particularly when updating contract logic, to ensure state consistency and security are preserved across upgrades. This ensures your contract remains robust and adaptable to future requirements.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L12-L12)']
```solidity
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step 

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20 

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L17-L17)']
```solidity
17: contract VariablePoolPriceFeed is IPriceFeed 

```


</details>

## [NonCritical-72] Upgrade openzeppelin to the Latest Version - 5.0.0

Num of instances: 15

### Findings 


<details><summary>Click to show findings</summary>

['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L4-L4)']
```solidity
4: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L5-L5)']
```solidity
5: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L4-L4)']
```solidity
4: import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol"; // <= FOUND

```
['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L6-L6)']
```solidity
6: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L4-L4)']
```solidity
4: import {SafeCast} from "@openzeppelin/contracts/utils/math/SafeCast.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L5-L5)']
```solidity
5: import {ERC20} from "@openzeppelin/contracts/token/ERC20/ERC20.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L4-L4)']
```solidity
4: import {AccessControlUpgradeable} from "@openzeppelin/contracts-upgradeable/access/AccessControlUpgradeable.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L5-L5)']
```solidity
5: import {Initializable} from "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L7-L7)']
```solidity
7: import {UUPSUpgradeable} from "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L8-L8)']
```solidity
8: import {MulticallUpgradeable} from "@openzeppelin/contracts-upgradeable/utils/MulticallUpgradeable.sol"; // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L9-L9)']
```solidity
9: import {PausableUpgradeable} from "@openzeppelin/contracts-upgradeable/utils/PausableUpgradeable.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L4-L4)']
```solidity
4: import {Clones} from "@openzeppelin/contracts/proxy/Clones.sol"; // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L9-L9)']
```solidity
9: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L4-L4)']
```solidity
4: import {OwnableUpgradeable} from "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol"; // <= FOUND

```
['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L6-L6)']
```solidity
6: import {Address} from "@openzeppelin/contracts/utils/Address.sol"; // <= FOUND

```


</details>

## [NonCritical-73] Use a struct to encapsulate multiple function parameters

### Resolution 
Using a struct to encapsulate multiple parameters in Solidity functions can significantly enhance code readability and maintainability. Instead of passing a long list of arguments, which can be error-prone and hard to manage, a struct allows grouping related data into a single, coherent entity. This approach simplifies function signatures and makes the code more organized. It also enhances code clarity, as developers can easily understand the relationship between the parameters. Moreover, it aids in future code modifications and expansions, as adding or modifying a parameter only requires changes in the struct definition, rather than in every function that uses these parameters.

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L84-L90)']
```solidity
83:     function createDebtAndCreditPositions(
84:         State storage state, // <= FOUND
85:         address lender, // <= FOUND
86:         address borrower, // <= FOUND
87:         uint256 issuanceValue, // <= FOUND
88:         uint256 faceValue, // <= FOUND
89:         uint256 dueDate
90:     ) external returns (DebtPosition memory debtPosition, CreditPosition memory creditPosition)  // <= FOUND

```
['[170](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L170-L174)']
```solidity
169:     function validateInitialize(
170:         State storage, // <= FOUND
171:         address owner, // <= FOUND
172:         InitializeFeeConfigParams memory f, // <= FOUND
173:         InitializeRiskConfigParams memory r, // <= FOUND
174:         InitializeOracleParams memory o, // <= FOUND
175:         InitializeDataParams memory d
176:     ) external view 

```
['[243](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L243-L246)']
```solidity
242:     function executeInitialize(
243:         State storage state, // <= FOUND
244:         InitializeFeeConfigParams memory f, // <= FOUND
245:         InitializeRiskConfigParams memory r, // <= FOUND
246:         InitializeOracleParams memory o, // <= FOUND
247:         InitializeDataParams memory d
248:     ) external 

```
['[96](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L96-L99)']
```solidity
95:     function initialize(
96:         address owner, // <= FOUND
97:         InitializeFeeConfigParams calldata f, // <= FOUND
98:         InitializeRiskConfigParams calldata r, // <= FOUND
99:         InitializeOracleParams calldata o, // <= FOUND
100:         InitializeDataParams calldata d
101:     ) external initializer 

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L45-L50)']
```solidity
44:     function depositUnderlyingTokenToVariablePool(
45:         State storage state, // <= FOUND
46:         IERC20Metadata underlyingToken, // <= FOUND
47:         address from, // <= FOUND
48:         address to, // <= FOUND
49:         uint256 amount, // <= FOUND
50:         bool variable, // <= FOUND
51:         bool setUseReserveAsCollateral
52:     ) external 

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L80-L84)']
```solidity
79:     function withdrawUnderlyingTokenFromVariablePool(
80:         State storage state, // <= FOUND
81:         IAToken aToken, // <= FOUND
82:         address from, // <= FOUND
83:         address to, // <= FOUND
84:         uint256 amount, // <= FOUND
85:         bool variable
86:     ) external 

```


</details>

## [NonCritical-74] Empty function body without natspec comments

### Resolution 
In Solidity, encountering an empty function body without explanatory comments can be problematic. Such functions can lead to confusion about their purpose or the reasoning behind their lack of implementation. To maintain code clarity and facilitate understanding for other developers, including future maintainers, it's crucial to accompany empty function bodies with descriptive comments. These comments should explain why the function is intentionally left empty, whether it's a placeholder for future implementation, a requirement of an interface, or a specific design choice. Providing this context helps preserve the intent of the code, prevents misinterpretation, and ensures that the codebase remains understandable and maintainable.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[116](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L116-L116)']
```solidity
116:     function _authorizeUpgrade(address newImplementation) internal override onlyRole(DEFAULT_ADMIN_ROLE) {}

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L72-L72)']
```solidity
72:     function validateUpdateConfig(State storage, UpdateConfigParams calldata) external pure {
73:         
74:     }

```


</details>

## [NonCritical-75] Consider using ERC20Capped

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L23-L24)']
```solidity
23:     function mint(address to, uint256 amount) external virtual onlyOwner { // <= FOUND
24:         _mint(to, amount); // <= FOUND
25:     }

```


</details>

## [NonCritical-76] Consider using a format prettier or forge fmt

### Resolution 
Some comments use // X and others //X Amend comments to use only use // X or //X consistently such style inconsistencies can be resolved by running the project through a format prettier or by using forge fmt.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[6](project_package.txt: 6-6)']
```solidity
6: ///

```


</details>

## [NonCritical-77] Use 'using' keyword when using specific imports rather than calling the specific import directly

### Resolution 
In Solidity, the `using` keyword can streamline the use of library functions for specific types. Instead of calling library functions directly with their full import paths, you can declare a library once with `using` for a specific type. This approach makes your code more readable and concise. For example, instead of `LibraryName.functionName(variable)`, you would first declare `using LibraryName for TypeName;` at the contract level. After this, you can call library functions directly on variables of `TypeName` like `variable.functionName()`. This method not only enhances code clarity but also promotes cleaner and more organized code, especially when multiple functions from the same library are used frequently.

Num of instances: 173

### Findings 


<details><summary>Click to show findings</summary>

['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L33-L34)']
```solidity
33:         uint256 debtTokenAmountWad =
34:             ConversionLibrary.amountToWad(debtTokenAmount, state.data.underlyingBorrowToken.decimals()); // <= FOUND 'ConversionLibrary.'

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L33-L33)']
```solidity
33:         uint256 debtWad = ConversionLibrary.amountToWad(debt, state.data.underlyingBorrowToken.decimals()); // <= FOUND 'ConversionLibrary.'

```
['[91](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L91-L96)']
```solidity
91:         debtPosition = DebtPosition({
92:             lender: lender,
93:             borrower: borrower,
94:             issuanceValue: issuanceValue,
95:             faceValue: faceValue,
96:             repayFee: LoanLibrary.repayFee(issuanceValue, block.timestamp, dueDate, state.feeConfig.repayFeeAPR), // <= FOUND 'LoanLibrary.'
97:             startDate: block.timestamp,
98:             dueDate: dueDate,
99:             liquidityIndexAtRepayment: 0
100:         });

```
['[106](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L106-L107)']
```solidity
106:         debtPosition.repayFee =
107:             LoanLibrary.repayFee(issuanceValue, block.timestamp, debtPosition.dueDate, state.feeConfig.repayFeeAPR); // <= FOUND 'LoanLibrary.'

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L9-L15)']
```solidity
9:     CREDIT_POSITION_ID_START,
10:     CreditPosition,
11:     DEBT_POSITION_ID_START,
12:     DebtPosition,
13:     LoanLibrary,
14:     LoanStatus
15: } from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND 'LoanLibrary.'

```
['[163](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L163-L163)']
```solidity
163:         return LoanLibrary.repayFee(issuanceValue, startDate, dueDate, repayFeeAPR); // <= FOUND 'LoanLibrary.'

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L40-L47)']
```solidity
40:             
41:             
42: 
43:             
44:             
45: 
46:             
47:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity); // <= FOUND 'YieldCurveLibrary.'

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L40-L41)']
```solidity
40:             
41:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity); // <= FOUND 'YieldCurveLibrary.'

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L34-L34)']
```solidity
34:         return YieldCurveLibrary.getRatePerMaturityByDueDate(self.curveRelativeTime, marketBorrowRateFeed, dueDate); // <= FOUND 'YieldCurveLibrary.'

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L14-L14)']
```solidity
14:         return FixedPointMathLib.min(a, b); // <= FOUND 'FixedPointMathLib.'

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L18-L18)']
```solidity
18:         return FixedPointMathLib.max(a, b); // <= FOUND 'FixedPointMathLib.'

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L22-L22)']
```solidity
22:         return FixedPointMathLib.min(FixedPointMathLib.min(a, b), c); // <= FOUND 'FixedPointMathLib.'

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L26-L26)']
```solidity
26:         return FixedPointMathLib.mulDivUp(x, y, z); // <= FOUND 'FixedPointMathLib.'

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L30-L30)']
```solidity
30:         return FixedPointMathLib.mulDiv(x, y, z); // <= FOUND 'FixedPointMathLib.'

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L38-L38)']
```solidity
38:         return SafeCast.toUint256(FixedPointMathLib.powWad(SafeCast.toInt256(wad1), SafeCast.toInt256(wad2))); // <= FOUND 'FixedPointMathLib.'

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L42-L42)']
```solidity
42:         return mulDiv(rate, 365 days, SafeCast.toInt256(maturity)); // <= FOUND 'SafeCast.'

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L50-L50)']
```solidity
50:         return mulDiv(rate, SafeCast.toInt256(maturity), 365 days); // <= FOUND 'SafeCast.'

```
['[73](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L73-L73)']
```solidity
73:             return SafeCast.toUint256(ratePerMaturity); // <= FOUND 'SafeCast.'

```
['[77](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L77-L78)']
```solidity
77:             return SafeCast.toUint256( // <= FOUND 'SafeCast.'
78:                 ratePerMaturity + SafeCast.toInt256(Math.mulDivDown(marketRateLinear, marketRateMultiplier, PERCENT)) // <= FOUND 'SafeCast.'
79:             );

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L38-L39)']
```solidity
38:         uint256 amountToCompensate =
39:             Math.min(params.amount, creditPositionToCompensate.credit, debtPositionToRepay.faceValue); // <= FOUND 'Compensate.'

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L63-L63)']
```solidity
63:         if (creditPositionToCompensate.lender != debtPositionToRepay.borrower) { // <= FOUND 'Compensate.'

```
['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L64-L64)']
```solidity
64:             revert Errors.INVALID_LENDER(creditPositionToCompensate.lender); // <= FOUND 'Compensate.'

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L50-L50)']
```solidity
50:             revert Errors.INVALID_LOAN_OFFER(params.lender); // <= FOUND 'Errors.'

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L41-L41)']
```solidity
41:             revert Errors.NULL_AMOUNT(); // <= FOUND 'Errors.'

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L50-L50)']
```solidity
50:             revert Errors.PAST_DUE_DATE(params.dueDate); // <= FOUND 'Errors.'

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L63-L63)']
```solidity
63:             revert Errors.DUE_DATE_GREATER_THAN_MAX_DUE_DATE(params.dueDate, loanOffer.maxDueDate); // <= FOUND 'Errors.'

```
['[74](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L74-L74)']
```solidity
74:             revert Errors.PAST_DEADLINE(params.deadline); // <= FOUND 'Errors.'

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L76-L77)']
```solidity
76:             revert Errors.APR_GREATER_THAN_MAX_APR( // <= FOUND 'Errors.'
77:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.maxAPR // <= FOUND 'Math.'
78:             );

```
['[92](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L92-L92)']
```solidity
92:                 revert Errors.BORROWER_IS_NOT_LENDER(msg.sender, creditPosition.lender); // <= FOUND 'Errors.'

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L95-L95)']
```solidity
95:                 revert Errors.DUE_DATE_LOWER_THAN_DEBT_POSITION_DUE_DATE(params.dueDate, debtPosition.dueDate); // <= FOUND 'Errors.'

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L46-L46)']
```solidity
46:             revert Errors.NULL_ADDRESS(); // <= FOUND 'Errors.'

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L41-L41)']
```solidity
41:             revert Errors.PAST_DUE_DATE(debtPosition.dueDate); // <= FOUND 'Errors.'

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L45-L45)']
```solidity
45:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity); // <= FOUND 'Errors.'

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L53-L53)']
```solidity
53:             revert Errors.EXITER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower); // <= FOUND 'Errors.'

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L59-L59)']
```solidity
59:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND 'Errors.'
60:                 address(state.data.borrowAToken),
61:                 msg.sender,
62:                 false,
63:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
64:                 issuanceValue + state.feeConfig.earlyBorrowerExitFee
65:             );

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L80-L81)']
```solidity
80:             revert Errors.APR_LOWER_THAN_MIN_APR( // <= FOUND 'Errors.'
81:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR // <= FOUND 'Math.'
82:             );

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L12-L12)']
```solidity
12:             revert Errors.COLLATERAL_TOKEN_CAP_EXCEEDED( // <= FOUND 'Errors.'
13:                 state.riskConfig.collateralTokenCap, state.data.collateralToken.totalSupply()
14:             );

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L20-L20)']
```solidity
20:             revert Errors.BORROW_ATOKEN_CAP_EXCEEDED( // <= FOUND 'Errors.'
21:                 state.riskConfig.borrowATokenCap, state.data.borrowAToken.totalSupply()
22:             );

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L28-L28)']
```solidity
28:             revert Errors.DEBT_TOKEN_CAP_EXCEEDED(state.riskConfig.debtTokenCap, state.data.debtToken.totalSupply()); // <= FOUND 'Errors.'

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L36-L36)']
```solidity
36:             revert Errors.NOT_ENOUGH_BORROW_ATOKEN_LIQUIDITY(liquidity, redeemable); // <= FOUND 'Errors.'

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L32-L32)']
```solidity
32:             revert Errors.LOAN_NOT_REPAID(params.creditPositionId); // <= FOUND 'Errors.'

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L35-L35)']
```solidity
35:             revert Errors.CREDIT_POSITION_ALREADY_CLAIMED(params.creditPositionId); // <= FOUND 'Errors.'

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L43-L43)']
```solidity
43:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionWithDebtToRepayId); // <= FOUND 'Errors.'

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L46-L47)']
```solidity
46:             revert Errors.CREDIT_LOWER_THAN_AMOUNT_TO_COMPENSATE( // <= FOUND 'Errors.'
47:                 creditPositionWithDebtToRepay.credit, amountToCompensate // <= FOUND 'Repay.'
48:             );

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L53-L53)']
```solidity
53:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionToCompensateId); // <= FOUND 'Errors.'

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L59-L59)']
```solidity
59:             revert Errors.DUE_DATE_NOT_COMPATIBLE( // <= FOUND 'Errors.'
60:                 params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId
61:             );

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L69-L69)']
```solidity
69:             revert Errors.COMPENSATOR_IS_NOT_BORROWER(msg.sender, debtPositionToRepay.borrower); // <= FOUND 'Errors.'

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L36-L36)']
```solidity
36:             revert Errors.INVALID_TOKEN(params.token); // <= FOUND 'Errors.'

```
['[87](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L87-L87)']
```solidity
87:             revert Errors.INVALID_COLLATERAL_RATIO(r.crOpening); // <= FOUND 'Errors.'

```
['[92](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L92-L92)']
```solidity
92:             revert Errors.INVALID_COLLATERAL_RATIO(r.crLiquidation); // <= FOUND 'Errors.'

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L95-L95)']
```solidity
95:             revert Errors.INVALID_LIQUIDATION_COLLATERAL_RATIO(r.crOpening, r.crLiquidation); // <= FOUND 'Errors.'

```
['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L105-L105)']
```solidity
105:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM(r.collateralSplitLiquidatorPercent); // <= FOUND 'Errors.'

```
['[110](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L110-L110)']
```solidity
110:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM(r.collateralSplitProtocolPercent); // <= FOUND 'Errors.'

```
['[113](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L113-L113)']
```solidity
113:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM_SUM( // <= FOUND 'Errors.'
114:                 r.collateralSplitLiquidatorPercent + r.collateralSplitProtocolPercent
115:             );

```
['[129](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L129-L129)']
```solidity
129:             revert Errors.INVALID_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(r.moveToVariablePoolHFThreshold); // <= FOUND 'Errors.'

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L33-L33)']
```solidity
33:                 revert Errors.NULL_MAX_DUE_DATE(); // <= FOUND 'Errors.'

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L36-L36)']
```solidity
36:                 revert Errors.PAST_MAX_DUE_DATE(params.maxDueDate); // <= FOUND 'Errors.'

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L45-L45)']
```solidity
45:             revert Errors.INVALID_BORROW_OFFER(params.borrower); // <= FOUND 'Errors.'

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L63-L63)']
```solidity
63:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND 'Errors.'
64:                 address(state.data.borrowAToken),
65:                 msg.sender,
66:                 false,
67:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
68:                 amountIn
69:             );

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L39-L39)']
```solidity
39:             revert Errors.LOAN_NOT_LIQUIDATABLE( // <= FOUND 'Errors.'
40:                 params.debtPositionId,
41:                 state.collateralRatio(debtPosition.borrower),
42:                 state.getLoanStatus(params.debtPositionId)
43:             );

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L56-L56)']
```solidity
56:             revert Errors.LIQUIDATE_PROFIT_BELOW_MINIMUM_COLLATERAL_PROFIT( // <= FOUND 'Errors.'
57:                 liquidatorProfitCollateralToken, params.minimumCollateralProfit
58:             );

```
['[150](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L150-L151)']
```solidity
150:                 
151:                 revert Errors.LOAN_NOT_LIQUIDATABLE(params.debtPositionId, collateralRatio, loanStatus); // <= FOUND 'Errors.'

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L54-L54)']
```solidity
54:             revert Errors.LOAN_NOT_ACTIVE(params.debtPositionId); // <= FOUND 'Errors.'

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L72-L72)']
```solidity
72:             revert Errors.INVALID_DEBT_POSITION_ID(debtPositionId); // <= FOUND 'Errors.'

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L84-L84)']
```solidity
84:             revert Errors.INVALID_CREDIT_POSITION_ID(creditPositionId); // <= FOUND 'Errors.'

```
['[109](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L109-L110)']
```solidity
109:             
110:             revert Errors.INVALID_POSITION_ID(positionId); // <= FOUND 'Errors.'

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L22-L22)']
```solidity
22:             revert Errors.NULL_STALE_RATE(); // <= FOUND 'Errors.'

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L43-L43)']
```solidity
43:             revert Errors.STALE_RATE(marketBorrowRateUpdatedAt); // <= FOUND 'Errors.'

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L46-L46)']
```solidity
46:         revert Errors.NOT_SUPPORTED(); // <= FOUND 'Errors.'

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L30-L30)']
```solidity
30:             revert Errors.LOAN_ALREADY_REPAID(params.debtPositionId); // <= FOUND 'Errors.'

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L35-L35)']
```solidity
35:             revert Errors.REPAYER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower); // <= FOUND 'Errors.'

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L38-L38)']
```solidity
38:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND 'Errors.'
39:                 address(state.data.borrowAToken),
40:                 msg.sender,
41:                 false,
42:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
43:                 debtPosition.faceValue
44:             );

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L20-L20)']
```solidity
20:             revert Errors.CREDIT_LOWER_THAN_MINIMUM_CREDIT(credit, state.riskConfig.minimumCreditBorrowAToken); // <= FOUND 'Errors.'

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L26-L26)']
```solidity
26:             revert Errors.CREDIT_LOWER_THAN_MINIMUM_CREDIT_OPENING(credit, state.riskConfig.minimumCreditBorrowAToken); // <= FOUND 'Errors.'

```
['[75](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L75-L75)']
```solidity
75:             revert Errors.USER_IS_LIQUIDATABLE(account, collateralRatio(state, account)); // <= FOUND 'Errors.'

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L85-L85)']
```solidity
85:             revert Errors.CR_BELOW_OPENING_LIMIT_BORROW_CR( // <= FOUND 'Errors.'
86:                 account, collateralRatio(state, account), openingLimitBorrowCR
87:             );

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L36-L36)']
```solidity
36:             revert Errors.LOAN_NOT_SELF_LIQUIDATABLE( // <= FOUND 'Errors.'
37:                 params.creditPositionId,
38:                 state.collateralRatio(debtPosition.borrower),
39:                 state.getLoanStatus(params.creditPositionId)
40:             );

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L43-L43)']
```solidity
43:             revert Errors.LIQUIDATION_NOT_AT_LOSS(params.creditPositionId, assignedCollateral, debtInCollateralToken); // <= FOUND 'Errors.'

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L48-L48)']
```solidity
48:             revert Errors.LIQUIDATOR_IS_NOT_LENDER(msg.sender, creditPosition.lender); // <= FOUND 'Errors.'

```
['[176](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L176-L176)']
```solidity
176:             revert Errors.NULL_OFFER(); // <= FOUND 'Errors.'

```
['[179](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L179-L179)']
```solidity
179:             revert Errors.PAST_DUE_DATE(dueDate); // <= FOUND 'Errors.'

```
['[112](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L112-L112)']
```solidity
112:             revert Errors.INVALID_KEY(params.key); // <= FOUND 'Errors.'

```
['[88](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L88-L88)']
```solidity
88:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND 'Errors.'
89:                 address(aToken), from, variable, aTokenBalanceOf(state, aToken, from, variable), amount
90:             );

```
['[208](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L208-L208)']
```solidity
208:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND 'Errors.'
209:                 address(borrowAToken), from, false, aTokenBalanceOf(state, borrowAToken, from, false), amount
210:             );

```
['[327](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L327-L327)']
```solidity
327:             revert Errors.HEALTH_FACTOR_BELOW_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD( // <= FOUND 'Errors.'
328:                 address(vaultFrom), healthFactor, state.riskConfig.moveToVariablePoolHFThreshold
329:             );

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L40-L40)']
```solidity
40:             revert Errors.INVALID_DECIMALS(_decimals); // <= FOUND 'Errors.'

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L44-L44)']
```solidity
44:             revert Errors.INVALID_DECIMALS(_baseDecimals); // <= FOUND 'Errors.'

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L52-L52)']
```solidity
52:             revert Errors.ARRAY_LENGTHS_MISMATCH(); // <= FOUND 'Errors.'

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L59-L59)']
```solidity
59:                 revert Errors.NULL_ADDRESS(); // <= FOUND 'Errors.'

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L28-L28)']
```solidity
28:             revert Errors.NULL_ARRAY(); // <= FOUND 'Errors.'

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L41-L41)']
```solidity
41:                 revert Errors.MATURITIES_NOT_STRICTLY_INCREASING(); // <= FOUND 'Errors.'

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L46-L46)']
```solidity
46:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(self.maturities[0], minimumMaturity); // <= FOUND 'Errors.'

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L95-L96)']
```solidity
95:         
96:         if (dueDate < block.timestamp) revert Errors.PAST_DUE_DATE(dueDate); // <= FOUND 'Errors.'

```
['[99](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L99-L99)']
```solidity
99:             revert Errors.MATURITY_OUT_OF_RANGE( // <= FOUND 'Errors.'
100:                 maturity, curveRelativeTime.maturities[0], curveRelativeTime.maturities[length - 1]
101:             );

```
['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L105-L105)']
```solidity
105:         emit Events.CreateDebtPosition(debtPositionId, lender, borrower, issuanceValue, faceValue, dueDate); // <= FOUND 'Events.'

```
['[114](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L114-L114)']
```solidity
114:         emit Events.CreateCreditPosition(creditPositionId, lender, RESERVED_ID, debtPositionId, creditPosition.credit); // <= FOUND 'Events.'

```
['[133](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L133-L133)']
```solidity
133:         emit Events.CreateCreditPosition(creditPositionId, lender, exitCreditPositionId, debtPositionId, credit); // <= FOUND 'Events.'

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L42-L42)']
```solidity
42:         emit Events.BorrowAsLimitOrder(params.curveRelativeTime); // <= FOUND 'Events.'

```
['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L101-L101)']
```solidity
101:         emit Events.BorrowAsMarketOrder( // <= FOUND 'Events.'
102:             params.lender, params.amount, params.dueDate, params.exactAmountIn, params.receivableCreditPositionIds
103:         );

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L36-L36)']
```solidity
36:         emit Events.BorrowVariable(params.to, params.amount); // <= FOUND 'Events.'

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L85-L85)']
```solidity
85:         emit Events.BorrowerExit(params.debtPositionId, params.borrowerToExitTo); // <= FOUND 'Events.'

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L49-L49)']
```solidity
49:         emit Events.Claim(params.creditPositionId); // <= FOUND 'Events.'

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L79-L79)']
```solidity
79:         emit Events.Compensate( // <= FOUND 'Events.'
80:             params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId, params.amount
81:         );

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L69-L69)']
```solidity
69:         emit Events.Deposit(params.token, params.to, params.variable, params.amount); // <= FOUND 'Events.'

```
['[253](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L253-L253)']
```solidity
253:         emit Events.Initialize(f, r, o, d); // <= FOUND 'Events.'

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L47-L47)']
```solidity
47:         emit Events.LendAsLimitOrder(params.maxDueDate, params.curveRelativeTime); // <= FOUND 'Events.'

```
['[90](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L90-L90)']
```solidity
90:         emit Events.LendAsMarketOrder(params.borrower, params.dueDate, params.amount, params.exactAmountIn); // <= FOUND 'Events.'

```
['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L105-L105)']
```solidity
105:             emit Events.LiquidateOverdueMoveToVariablePool(params.debtPositionId); // <= FOUND 'Events.'

```
['[109](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L109-L109)']
```solidity
109:             emit Events.LiquidateOverdueNoSplitRemainder(params.debtPositionId); // <= FOUND 'Events.'

```
['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L128-L128)']
```solidity
128:         emit Events.Liquidate(params.debtPositionId, params.minimumCollateralProfit, collateralRatio, loanStatus); // <= FOUND 'Events.'

```
['[135](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L135-L135)']
```solidity
135:             emit Events.LiquidateUserLiquidatableProfitably(params.debtPositionId); // <= FOUND 'Events.'

```
['[139](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L139-L139)']
```solidity
139:             emit Events.LiquidateUserLiquidatableUnprofitably(params.debtPositionId); // <= FOUND 'Events.'

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L36-L36)']
```solidity
36:         emit Events.LiquidateVariable(params.borrower, params.amount); // <= FOUND 'Events.'

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L98-L98)']
```solidity
98:         emit Events.LiquidateWithReplacement(params.debtPositionId, params.borrower, params.minimumCollateralProfit); // <= FOUND 'Events.'

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L58-L58)']
```solidity
58:         emit Events.Repay(params.debtPositionId); // <= FOUND 'Events.'

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L30-L30)']
```solidity
30:         emit Events.RepayVariable(params.amount); // <= FOUND 'Events.'

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L53-L53)']
```solidity
53:         emit Events.SelfLiquidate(params.creditPositionId); // <= FOUND 'Events.'

```
['[119](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L119-L119)']
```solidity
119:         emit Events.UpdateConfig(params.key, params.value); // <= FOUND 'Events.'

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L30-L30)']
```solidity
30:         emit Events.CreateVault(user, address(vault), false); // <= FOUND 'Events.'

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L48-L48)']
```solidity
48:         emit Events.CreateVault(user, address(vault), true); // <= FOUND 'Events.'

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L69-L69)']
```solidity
69:         emit Events.Withdraw(params.token, params.to, params.variable, amount); // <= FOUND 'Events.'

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L7-L11)']
```solidity
7:     InitializeDataParams,
8:     InitializeFeeConfigParams,
9:     InitializeOracleParams,
10:     InitializeRiskConfigParams
11: } from "@src/libraries/general/actions/Initialize.sol"; // <= FOUND 'Initialize.'

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L12-L17)']
```solidity
12:     Initialize,
13:     InitializeDataParams,
14:     InitializeFeeConfigParams,
15:     InitializeOracleParams,
16:     InitializeRiskConfigParams
17: } from "@src/libraries/general/actions/Initialize.sol"; // <= FOUND 'Initialize.'

```
['[115](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L115-L115)']
```solidity
115:         Initialize.validateInitializeFeeConfigParams(feeConfigParams(state)); // <= FOUND 'Initialize.'

```
['[116](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L116-L116)']
```solidity
116:         Initialize.validateInitializeRiskConfigParams(riskConfigParams(state)); // <= FOUND 'Initialize.'

```
['[117](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L117-L117)']
```solidity
117:         Initialize.validateInitializeOracleParams(oracleParams(state)); // <= FOUND 'Initialize.'

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L84-L84)']
```solidity
84:         Liquidate.validateMinimumCollateralProfit( // <= FOUND 'Liquidate.'
85:             state,
86:             LiquidateParams({
87:                 debtPositionId: params.debtPositionId,
88:                 minimumCollateralProfit: params.minimumCollateralProfit
89:             }),

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L33-L35)']
```solidity
33:     LiquidateWithReplacement,
34:     LiquidateWithReplacementParams
35: } from "@src/libraries/fixed/actions/LiquidateWithReplacement.sol"; // <= FOUND 'LiquidateWithReplacement.'

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L35-L35)']
```solidity
35:         collateralTokenAmount = Math.mulDivUp( // <= FOUND 'Math.'
36:             debtTokenAmountWad, 10 ** state.oracle.priceFeed.decimals(), state.oracle.priceFeed.getPrice()
37:         );

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L54-L54)']
```solidity
54:         repayFee = Math.mulDivDown(debtPosition.repayFee, repayAmount, debtPosition.faceValue); // <= FOUND 'Math.'

```
['[75](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L75-L75)']
```solidity
75:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) > params.maxAPR) { // <= FOUND 'Math.'

```
['[125](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L125-L126)']
```solidity
125:         amountOutLeft =
126:             params.exactAmountIn ? Math.mulDivDown(params.amount, PERCENT, PERCENT + ratePerMaturity) : params.amount; // <= FOUND 'Math.'

```
['[132](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L132-L132)']
```solidity
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT); // <= FOUND 'Math.'

```
['[136](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L136-L136)']
```solidity
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity); // <= FOUND 'Math.'

```
['[176](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L176-L176)']
```solidity
176:         uint256 faceValue = Math.mulDivUp(issuanceValue, PERCENT + ratePerMaturity, PERCENT); // <= FOUND 'Math.'

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L49-L49)']
```solidity
49:         uint256 issuanceValue = Math.mulDivUp(debtPosition.faceValue, PERCENT, PERCENT + ratePerMaturity); // <= FOUND 'Math.'

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L79-L80)']
```solidity
79:         
80:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) { // <= FOUND 'Math.'

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L94-L94)']
```solidity
94:         uint256 issuanceValue = Math.mulDivUp(faceValue, PERCENT, PERCENT + ratePerMaturity); // <= FOUND 'Math.'

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L43-L43)']
```solidity
43:         uint256 claimAmount = Math.mulDivDown( // <= FOUND 'Math.'
44:             creditPosition.credit, state.borrowATokenLiquidityIndex(), debtPosition.liquidityIndexAtRepayment
45:         );

```
['[60](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L60-L60)']
```solidity
60:             amountIn = Math.mulDivUp(params.amount, PERCENT, PERCENT + ratePerMaturity); // <= FOUND 'Math.'

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L79-L79)']
```solidity
79:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) { // <= FOUND 'Math.'

```
['[100](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L100-L100)']
```solidity
100:             issuanceValue = Math.mulDivUp(params.amount, PERCENT, PERCENT + ratePerMaturity); // <= FOUND 'Math.'

```
['[102](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L102-L102)']
```solidity
102:         uint256 faceValue = Math.mulDivDown(issuanceValue, PERCENT + ratePerMaturity, PERCENT); // <= FOUND 'Math.'

```
['[78](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L78-L79)']
```solidity
78:                 uint256 collateralRemainderToLiquidator =
79:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitLiquidatorPercent, PERCENT); // <= FOUND 'Math.'

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L80-L81)']
```solidity
80:                 uint256 collateralRemainderToProtocol =
81:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitProtocolPercent, PERCENT); // <= FOUND 'Math.'

```
['[113](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L113-L113)']
```solidity
113:         uint256 issuanceValue = Math.mulDivDown(debtPositionCopy.faceValue, PERCENT, PERCENT + ratePerMaturity); // <= FOUND 'Math.'

```
['[137](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L137-L137)']
```solidity
137:             return Math.mulDivDown(collateral, debtPosition.faceValue, debt); // <= FOUND 'Math.'

```
['[161](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L161-L161)']
```solidity
161:             return Math.mulDivDown(debtPositionCollateral, creditPositionCredit, debtPositionFaceValue); // <= FOUND 'Math.'

```
['[168](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L168-L168)']
```solidity
168:         uint256 r = Math.mulDivDown(PERCENT, self.faceValue, self.issuanceValue); // <= FOUND 'Math.'

```
['[171](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L171-L171)']
```solidity
171:         self.issuanceValue = Math.mulDivDown(self.faceValue, PERCENT, r); // <= FOUND 'Math.'

```
['[180](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L180-L180)']
```solidity
180:         uint256 repayFeePercent = Math.mulDivUp(repayFeeAPR, interval, 365 days); // <= FOUND 'Math.'

```
['[181](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L181-L181)']
```solidity
181:         uint256 fee = Math.mulDivUp(issuanceValue, repayFeePercent, PERCENT); // <= FOUND 'Math.'

```
['[188](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L188-L188)']
```solidity
188:         return Math.mulDivDown(self.repayFee, elapsed, maturity); // <= FOUND 'Math.'

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L37-L37)']
```solidity
37:             return Math.mulDivDown(collateral, price, debtWad); // <= FOUND 'Math.'

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L80-L80)']
```solidity
80:         uint256 openingLimitBorrowCR = Math.max( // <= FOUND 'Math.'
81:             state.riskConfig.crOpening,
82:             state.data.users[account].borrowOffer.openingLimitBorrowCR 
83:         );

```
['[91](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L91-L91)']
```solidity
91:         uint256 ratePerMaturity = Math.mulDivDown(debtPosition.faceValue, PERCENT, debtPosition.issuanceValue) - PERCENT; // <= FOUND 'Math.'

```
['[92](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L92-L92)']
```solidity
92:         return Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity); // <= FOUND 'Math.'

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L58-L58)']
```solidity
58:         return Math.mulDivDown( // <= FOUND 'Math.'
59:             _scalePrice(basePrice, baseDecimals, decimals),
60:             10 ** decimals,
61:             _scalePrice(quotePrice, quoteDecimals, decimals)
62:         );

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L58-L58)']
```solidity
58:             amount = Math.min(params.amount, state.aTokenBalanceOf(aToken, msg.sender, params.variable)); // <= FOUND 'Math.'

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L63-L63)']
```solidity
63:             amount = Math.min(params.amount, state.data.collateralToken.balanceOf(msg.sender)); // <= FOUND 'Math.'

```
['[70](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L70-L72)']
```solidity
70:         
71: 
72:         int256 ratePerMaturity = Math.linearAPRToRatePerMaturity(apr, maturity); // <= FOUND 'Math.'

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L76-L76)']
```solidity
76:             uint256 marketRateLinear = Math.compoundAPRToRatePerMaturity(marketRateCompound, maturity); // <= FOUND 'Math.'

```
['[103](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L103-L103)']
```solidity
103:             (uint256 low, uint256 high) = Math.binarySearch(curveRelativeTime.maturities, maturity); // <= FOUND 'Math.'

```
['[122](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L122-L122)']
```solidity
122:                     return y0 + Math.mulDivDown(y1 - y0, maturity - x0, x1 - x0); // <= FOUND 'Math.'

```
['[124](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L124-L124)']
```solidity
124:                     return y0 - Math.mulDivDown(y0 - y1, maturity - x0, x1 - x0); // <= FOUND 'Math.'

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L45-L45)']
```solidity
45:         if (creditPositionWithDebtToRepay.credit < amountToCompensate) { // <= FOUND 'Repay.'

```
['[55](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L55-L56)']
```solidity
55:         if (
56:             debtPositionToRepay.dueDate // <= FOUND 'Repay.'
57:                 < state.getDebtPositionByCreditPositionId(params.creditPositionToCompensateId).dueDate
58:         ) {

```
['[68](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L68-L69)']
```solidity
68:         
69:         if (msg.sender != debtPositionToRepay.borrower) { // <= FOUND 'Repay.'

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L94-L94)']
```solidity
94:         debtPositionToRepay.updateRepayFee(amountToCompensate, repayFee); // <= FOUND 'Repay.'

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L95-L95)']
```solidity
95:         state.data.debtToken.burn(debtPositionToRepay.borrower, amountToCompensate); // <= FOUND 'Repay.'

```
['[96](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L96-L96)']
```solidity
96:         creditPositionWithDebtToRepay.credit -= amountToCompensate; // <= FOUND 'Repay.'

```
['[97](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L97-L97)']
```solidity
97:         state.validateMinimumCredit(creditPositionWithDebtToRepay.credit); // <= FOUND 'Repay.'

```
['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L101-L105)']
```solidity
101:         
102:         
103:         state.createCreditPosition({
104:             exitCreditPositionId: params.creditPositionToCompensateId,
105:             lender: debtPositionToRepay.lender, // <= FOUND 'Repay.'
106:             credit: amountToCompensate
107:         });

```


</details>

## [NonCritical-78] package.json name variable should only consist of lowercase letters and underscores

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[1](project_package.txt: 1-2)']
```solidity
1: {
2:   "name": "size-v2-solidity", // <= FOUND
3:   "description": "Size v2",
4:   "scripts": {
5:     "solhint": "solhint \"src/**/*.sol\"  --max-warnings 0",
6:     "get-libraries": "(j=$((0x10)); find src/libraries test/helpers/libraries -type f | sed 's/.*\\///' | sed 's/.sol//' | while read i; do echo -n \"($i,$(printf \"0x%x\" $j))\\n\";j=$((j+1));done) | paste -sd, -",
7:     "deploy": "forge script script/Deploy.s.sol --rpc-url $CHAIN_NAME --gas-limit 30000000 --sender $DEPLOYER_ADDRESS --account size-testnet-4 --ffi",
8:     "coverage": "forge coverage --report lcov && lcov --remove lcov.info -o lcov.info 'test/*' 'script/*' && genhtml lcov.info -o report --branch-coverage && open report/index.html"
9:   },
10:   "devDependencies": {
11:     "@typechain/ethers-v5": "^11.1.2",
12:     "solhint": "^4.0.0"
13:   }
14: }
15: 

```


</details>

## [NonCritical-79] Try catch statement without human readable error

### Resolution 
In Solidity, the `try-catch` statement is used for handling exceptions in external function calls and contract creation. However, when a `try-catch` block doesn't include a catch for specific human-readable errors (using `catch Error(string memory reason)`), it can miss catching exceptions that provide explanatory error messages. This lack of detailed error handling could hinder debugging and obscure the reasons behind transaction failures. To address this, it's recommended to include a catch block specifically for `Error` to capture and handle these descriptive error messages effectively. This practice enhances the contract's robustness by providing clearer insights into why certain operations fail, thereby improving maintainability and troubleshooting.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[108](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L108-L109)']
```solidity
108:             
109:         } catch { // <= FOUND

```


</details>

## [NonCritical-80] Avoid declaring variables with the names of defined functions within the project

### Resolution 
Having such variables can create confusion in both developers and in users of the project. Consider renaming these variables to improve code clarity.

Num of instances: 10

### Findings 


<details><summary>Click to show findings</summary>

['[96](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L96-L96)']
```solidity
96:         uint256 repayFee = state.chargeEarlyRepayFeeInCollateral(debtPosition); // <= FOUND

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L94-L94)']
```solidity
93:         
94:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPositionToRepay, amountToCompensate); // <= FOUND

```
['[130](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L130-L130)']
```solidity
130:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, debtPosition.faceValue); // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L53-L53)']
```solidity
53:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, faceValue); // <= FOUND

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L59-L59)']
```solidity
59:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, credit); // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L58-L58)']
```solidity
58:             uint256 earlyRepayFee = debtPosition.earlyRepayFee(); // <= FOUND

```
['[126](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L126-L126)']
```solidity
126:         uint256 collateralRatio = state.collateralRatio(debtPosition.borrower); // <= FOUND

```
['[70](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L70-L70)']
```solidity
70:     error CR_BELOW_OPENING_LIMIT_BORROW_CR(address account, uint256 collateralRatio, uint256 riskCollateralRatio); // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L19-L19)']
```solidity
19:     uint256 repayFee;  // <= FOUND

```
['[61](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L61-L61)']
```solidity
48:     
56:     function chargeRepayFeeInCollateral(
57:         State storage state,
58:         DebtPosition storage debtPosition,
59:         uint256 repayAmount,
60:         bool isEarlyRepay
61:     ) public returns (uint256 repayFee) { // <= FOUND

```


</details>

## [NonCritical-81] Avoid caching global vars used once within the function

### Resolution 
If a cached variable is not used many times, it can be cheaper to call the global var directly.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[273](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L273-L273)']
```solidity
273:         address to = address(this); // <= FOUND

```


</details>

## [NonCritical-82] Complicated functions should have explicit comments

### Resolution 
Complex functions with either high cyclomatic complexity and/or longer than 50 lines of code should include both dev and notice comments to explain the complexities within the code.

Num of instances: 18

### Findings 


<details><summary>Click to show findings</summary>

['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L41-L41)']
```solidity
41:     function validateBorrowAsMarketOrder(State storage state, BorrowAsMarketOrderParams memory params) external view {
42:         User memory lenderUser = state.data.users[params.lender];
43:         LoanOffer memory loanOffer = lenderUser.loanOffer;
44: 
45:         
46:         
47: 
48:         
49:         if (loanOffer.isNull()) {
50:             revert Errors.INVALID_LOAN_OFFER(params.lender);
51:         }
52: 
53:         
54:         if (params.amount == 0) {
55:             revert Errors.NULL_AMOUNT();
56:         }
57: 
58:         
59:         if (params.dueDate < block.timestamp) {
60:             revert Errors.PAST_DUE_DATE(params.dueDate);
61:         }
62:         if (params.dueDate > loanOffer.maxDueDate) {
63:             revert Errors.DUE_DATE_GREATER_THAN_MAX_DUE_DATE(params.dueDate, loanOffer.maxDueDate);
64:         }
65: 
66:         
67:         if (params.deadline < block.timestamp) {
68:             revert Errors.PAST_DEADLINE(params.deadline);
69:         }
70: 
71:         
72:         uint256 ratePerMaturity =
73:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
74:         uint256 maturity = params.dueDate - block.timestamp;
75:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) > params.maxAPR) {
76:             revert Errors.APR_GREATER_THAN_MAX_APR(
77:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.maxAPR
78:             );
79:         }
80: 
81:         
82:         
83: 
84:         
85:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) {
86:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
87: 
88:             CreditPosition memory creditPosition = state.getCreditPosition(creditPositionId);
89:             DebtPosition memory debtPosition = state.getDebtPositionByCreditPositionId(creditPositionId);
90: 
91:             if (msg.sender != creditPosition.lender) {
92:                 revert Errors.BORROWER_IS_NOT_LENDER(msg.sender, creditPosition.lender);
93:             }
94:             if (params.dueDate < debtPosition.dueDate) {
95:                 revert Errors.DUE_DATE_LOWER_THAN_DEBT_POSITION_DUE_DATE(params.dueDate, debtPosition.dueDate);
96:             }
97:         }
98:     }

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L34-L34)']
```solidity
34:     function validateBorrowerExit(State storage state, BorrowerExitParams calldata params) external view {
35:         BorrowOffer memory borrowOffer = state.data.users[params.borrowerToExitTo].borrowOffer;
36:         DebtPosition memory debtPosition = state.getDebtPosition(params.debtPositionId);
37: 
38:         
39:         uint256 dueDate = debtPosition.dueDate;
40:         if (dueDate < block.timestamp) {
41:             revert Errors.PAST_DUE_DATE(debtPosition.dueDate);
42:         }
43:         uint256 maturity = dueDate - block.timestamp;
44:         if (maturity < state.riskConfig.minimumMaturity) {
45:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity);
46:         }
47: 
48:         uint256 ratePerMaturity = borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, dueDate);
49:         uint256 issuanceValue = Math.mulDivUp(debtPosition.faceValue, PERCENT, PERCENT + ratePerMaturity);
50: 
51:         
52:         if (msg.sender != debtPosition.borrower) {
53:             revert Errors.EXITER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower);
54:         }
55:         if (
56:             state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false)
57:                 < issuanceValue + state.feeConfig.earlyBorrowerExitFee
58:         ) {
59:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
60:                 address(state.data.borrowAToken),
61:                 msg.sender,
62:                 false,
63:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
64:                 issuanceValue + state.feeConfig.earlyBorrowerExitFee
65:             );
66:         }
67: 
68:         
69:         if (params.deadline < block.timestamp) {
70:             revert Errors.PAST_DEADLINE(params.deadline);
71:         }
72: 
73:         
74:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
75:             revert Errors.APR_LOWER_THAN_MIN_APR(
76:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
77:             );
78:         }
79: 
80:         
81:         
82:     }

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L31-L31)']
```solidity
31:     function validateCompensate(State storage state, CompensateParams calldata params) external view {
32:         CreditPosition storage creditPositionWithDebtToRepay =
33:             state.getCreditPosition(params.creditPositionWithDebtToRepayId);
34:         DebtPosition storage debtPositionToRepay =
35:             state.getDebtPositionByCreditPositionId(params.creditPositionWithDebtToRepayId);
36:         CreditPosition storage creditPositionToCompensate = state.getCreditPosition(params.creditPositionToCompensateId);
37: 
38:         uint256 amountToCompensate =
39:             Math.min(params.amount, creditPositionToCompensate.credit, debtPositionToRepay.faceValue);
40: 
41:         
42:         if (state.getLoanStatus(params.creditPositionWithDebtToRepayId) == LoanStatus.REPAID) {
43:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionWithDebtToRepayId);
44:         }
45:         if (creditPositionWithDebtToRepay.credit < amountToCompensate) {
46:             revert Errors.CREDIT_LOWER_THAN_AMOUNT_TO_COMPENSATE(
47:                 creditPositionWithDebtToRepay.credit, amountToCompensate
48:             );
49:         }
50: 
51:         
52:         if (state.getLoanStatus(params.creditPositionToCompensateId) == LoanStatus.REPAID) {
53:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionToCompensateId);
54:         }
55:         if (
56:             debtPositionToRepay.dueDate
57:                 < state.getDebtPositionByCreditPositionId(params.creditPositionToCompensateId).dueDate
58:         ) {
59:             revert Errors.DUE_DATE_NOT_COMPATIBLE(
60:                 params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId
61:             );
62:         }
63:         if (creditPositionToCompensate.lender != debtPositionToRepay.borrower) {
64:             revert Errors.INVALID_LENDER(creditPositionToCompensate.lender);
65:         }
66: 
67:         
68:         if (msg.sender != debtPositionToRepay.borrower) {
69:             revert Errors.COMPENSATOR_IS_NOT_BORROWER(msg.sender, debtPositionToRepay.borrower);
70:         }
71: 
72:         
73:         if (params.amount == 0) {
74:             revert Errors.NULL_AMOUNT();
75:         }
76:     }

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L27-L27)']
```solidity
27:     function validateDeposit(State storage state, DepositParams calldata params) external view {
28:         
29:         
30: 
31:         
32:         if (
33:             params.token != address(state.data.underlyingCollateralToken)
34:                 && params.token != address(state.data.underlyingBorrowToken)
35:         ) {
36:             revert Errors.INVALID_TOKEN(params.token);
37:         }
38: 
39:         
40:         if (params.amount == 0) {
41:             revert Errors.NULL_AMOUNT();
42:         }
43: 
44:         
45:         if (params.to == address(0)) {
46:             revert Errors.NULL_ADDRESS();
47:         }
48: 
49:         
50:         
51:     }

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L84-L84)']
```solidity
84:     function validateInitializeRiskConfigParams(InitializeRiskConfigParams memory r) internal pure {
85:         
86:         if (r.crOpening < PERCENT) {
87:             revert Errors.INVALID_COLLATERAL_RATIO(r.crOpening);
88:         }
89: 
90:         
91:         if (r.crLiquidation < PERCENT) {
92:             revert Errors.INVALID_COLLATERAL_RATIO(r.crLiquidation);
93:         }
94:         if (r.crOpening <= r.crLiquidation) {
95:             revert Errors.INVALID_LIQUIDATION_COLLATERAL_RATIO(r.crOpening, r.crLiquidation);
96:         }
97: 
98:         
99:         if (r.minimumCreditBorrowAToken == 0) {
100:             revert Errors.NULL_AMOUNT();
101:         }
102: 
103:         
104:         if (r.collateralSplitLiquidatorPercent > PERCENT) {
105:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM(r.collateralSplitLiquidatorPercent);
106:         }
107: 
108:         
109:         if (r.collateralSplitProtocolPercent > PERCENT) {
110:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM(r.collateralSplitProtocolPercent);
111:         }
112:         if (r.collateralSplitLiquidatorPercent + r.collateralSplitProtocolPercent > PERCENT) {
113:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM_SUM(
114:                 r.collateralSplitLiquidatorPercent + r.collateralSplitProtocolPercent
115:             );
116:         }
117: 
118:         
119:         
120: 
121:         
122:         
123: 
124:         
125:         
126: 
127:         
128:         if (r.moveToVariablePoolHFThreshold < PERCENT) {
129:             revert Errors.INVALID_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(r.moveToVariablePoolHFThreshold);
130:         }
131: 
132:         
133:         if (r.minimumMaturity == 0) {
134:             revert Errors.NULL_AMOUNT();
135:         }
136:     }

```
['[152](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L152-L152)']
```solidity
152:     function validateInitializeDataParams(InitializeDataParams memory d) internal pure {
153:         
154:         if (d.underlyingCollateralToken == address(0)) {
155:             revert Errors.NULL_ADDRESS();
156:         }
157: 
158:         
159:         if (d.underlyingBorrowToken == address(0)) {
160:             revert Errors.NULL_ADDRESS();
161:         }
162: 
163:         
164:         if (d.variablePool == address(0)) {
165:             revert Errors.NULL_ADDRESS();
166:         }
167:     }

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L22-L22)']
```solidity
22:     function validateLendAsLimitOrder(State storage state, LendAsLimitOrderParams calldata params) external view {
23:         LoanOffer memory loanOffer =
24:             LoanOffer({maxDueDate: params.maxDueDate, curveRelativeTime: params.curveRelativeTime});
25: 
26:         
27:         if (!loanOffer.isNull()) {
28:             
29:             
30: 
31:             
32:             if (params.maxDueDate == 0) {
33:                 revert Errors.NULL_MAX_DUE_DATE();
34:             }
35:             if (params.maxDueDate < block.timestamp) {
36:                 revert Errors.PAST_MAX_DUE_DATE(params.maxDueDate);
37:             }
38: 
39:             
40:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity);
41:         }
42:     }

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L37-L37)']
```solidity
37:     function validateLendAsMarketOrder(State storage state, LendAsMarketOrderParams calldata params) external view {
38:         BorrowOffer memory borrowOffer = state.data.users[params.borrower].borrowOffer;
39: 
40:         
41:         
42: 
43:         
44:         if (borrowOffer.isNull()) {
45:             revert Errors.INVALID_BORROW_OFFER(params.borrower);
46:         }
47: 
48:         
49:         if (params.dueDate < block.timestamp) {
50:             revert Errors.PAST_DUE_DATE(params.dueDate);
51:         }
52: 
53:         
54:         uint256 ratePerMaturity =
55:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
56:         uint256 amountIn;
57:         if (params.exactAmountIn) {
58:             amountIn = params.amount;
59:         } else {
60:             amountIn = Math.mulDivUp(params.amount, PERCENT, PERCENT + ratePerMaturity);
61:         }
62:         if (state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false) < amountIn) {
63:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
64:                 address(state.data.borrowAToken),
65:                 msg.sender,
66:                 false,
67:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
68:                 amountIn
69:             );
70:         }
71: 
72:         
73:         if (params.deadline < block.timestamp) {
74:             revert Errors.PAST_DEADLINE(params.deadline);
75:         }
76: 
77:         
78:         uint256 maturity = params.dueDate - block.timestamp;
79:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
80:             revert Errors.APR_LOWER_THAN_MIN_APR(
81:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
82:             );
83:         }
84: 
85:         
86:         
87:     }

```
['[119](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L119-L119)']
```solidity
119:     function executeLiquidate(State storage state, LiquidateParams calldata params)
120:         external
121:         returns (uint256 liquidatorProfitCollateralToken)
122:     {
123:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
124:         DebtPosition memory debtPositionCopy = debtPosition;
125:         LoanStatus loanStatus = state.getLoanStatus(params.debtPositionId);
126:         uint256 collateralRatio = state.collateralRatio(debtPosition.borrower);
127: 
128:         emit Events.Liquidate(params.debtPositionId, params.minimumCollateralProfit, collateralRatio, loanStatus);
129: 
130:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, debtPosition.faceValue);
131:         debtPosition.updateRepayFee(debtPosition.faceValue, repayFee);
132: 
133:         
134:         if (PERCENT <= collateralRatio && collateralRatio < state.riskConfig.crLiquidation) {
135:             emit Events.LiquidateUserLiquidatableProfitably(params.debtPositionId);
136:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, true);
137:             
138:         } else if (collateralRatio < PERCENT) {
139:             emit Events.LiquidateUserLiquidatableUnprofitably(params.debtPositionId);
140:             liquidatorProfitCollateralToken =
141:                 _executeLiquidateTakeCollateral(state, debtPositionCopy, false  );
142:             
143:         } else {
144:             
145:             if (loanStatus == LoanStatus.OVERDUE) {
146:                 liquidatorProfitCollateralToken = _executeLiquidateOverdue(state, params, debtPositionCopy);
147:                 
148:             } else {
149:                 
150:                 revert Errors.LOAN_NOT_LIQUIDATABLE(params.debtPositionId, collateralRatio, loanStatus);
151:             }
152:         }
153: 
154:         state.data.debtToken.burn(debtPosition.borrower, debtPositionCopy.faceValue);
155:         debtPosition.liquidityIndexAtRepayment = state.borrowATokenLiquidityIndex();
156:     }

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L35-L35)']
```solidity
35:     function validateLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params)
36:         external
37:         view
38:     {
39:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
40:         BorrowOffer storage borrowOffer = state.data.users[params.borrower].borrowOffer;
41:         uint256 ratePerMaturity =
42:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, debtPosition.dueDate);
43: 
44:         
45:         state.validateLiquidate(
46:             LiquidateParams({
47:                 debtPositionId: params.debtPositionId,
48:                 minimumCollateralProfit: params.minimumCollateralProfit
49:             })
50:         );
51: 
52:         
53:         if (state.getLoanStatus(params.debtPositionId) != LoanStatus.ACTIVE) {
54:             revert Errors.LOAN_NOT_ACTIVE(params.debtPositionId);
55:         }
56:         uint256 maturity = debtPosition.dueDate - block.timestamp;
57:         if (maturity < state.riskConfig.minimumMaturity) {
58:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity);
59:         }
60: 
61:         
62:         if (borrowOffer.isNull()) {
63:             revert Errors.INVALID_BORROW_OFFER(params.borrower);
64:         }
65: 
66:         
67:         if (params.deadline < block.timestamp) {
68:             revert Errors.PAST_DEADLINE(params.deadline);
69:         }
70: 
71:         
72:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) {
73:             revert Errors.APR_LOWER_THAN_MIN_APR(
74:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR
75:             );
76:         }
77:     }

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L57-L57)']
```solidity
57:     function binarySearch(uint256[] memory array, uint256 value) internal pure returns (uint256 low, uint256 high) {
58:         low = 0;
59:         high = array.length - 1;
60:         if (value < array[low] || value > array[high]) {
61:             
62:             return (type(uint256).max, type(uint256).max);
63:         }
64:         while (low <= high) {
65:             uint256 mid = (low + high) / 2;
66:             if (array[mid] == value) {
67:                 return (mid, mid);
68:             } else if (array[mid] < value) {
69:                 low = mid + 1;
70:             } else {
71:                 high = mid - 1;
72:             }
73:         }
74:         return (high, low);
75:     }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L25-L25)']
```solidity
25:     function validateRepay(State storage state, RepayParams calldata params) external view {
26:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
27: 
28:         
29:         if (state.getLoanStatus(params.debtPositionId) == LoanStatus.REPAID) {
30:             revert Errors.LOAN_ALREADY_REPAID(params.debtPositionId);
31:         }
32: 
33:         
34:         if (msg.sender != debtPosition.borrower) {
35:             revert Errors.REPAYER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower);
36:         }
37:         if (state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false) < debtPosition.faceValue) {
38:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
39:                 address(state.data.borrowAToken),
40:                 msg.sender,
41:                 false,
42:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
43:                 debtPosition.faceValue
44:             );
45:         }
46:     }

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L27-L27)']
```solidity
27:     function validateSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external view {
28:         CreditPosition storage creditPosition = state.getCreditPosition(params.creditPositionId);
29:         DebtPosition storage debtPosition = state.getDebtPositionByCreditPositionId(params.creditPositionId);
30: 
31:         uint256 assignedCollateral = state.getCreditPositionProRataAssignedCollateral(creditPosition);
32:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPosition.faceValue);
33: 
34:         
35:         if (!state.isCreditPositionSelfLiquidatable(params.creditPositionId)) {
36:             revert Errors.LOAN_NOT_SELF_LIQUIDATABLE(
37:                 params.creditPositionId,
38:                 state.collateralRatio(debtPosition.borrower),
39:                 state.getLoanStatus(params.creditPositionId)
40:             );
41:         }
42:         if (!(assignedCollateral < debtInCollateralToken)) {
43:             revert Errors.LIQUIDATION_NOT_AT_LOSS(params.creditPositionId, assignedCollateral, debtInCollateralToken);
44:         }
45: 
46:         
47:         if (msg.sender != creditPosition.lender) {
48:             revert Errors.LIQUIDATOR_IS_NOT_LENDER(msg.sender, creditPosition.lender);
49:         }
50:     }

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L76-L76)']
```solidity
76:     function executeUpdateConfig(State storage state, UpdateConfigParams calldata params) external {
77:         if (params.key == "crOpening") {
78:             state.riskConfig.crOpening = params.value;
79:         } else if (params.key == "crLiquidation") {
80:             state.riskConfig.crLiquidation = params.value;
81:         } else if (params.key == "minimumCreditBorrowAToken") {
82:             state.riskConfig.minimumCreditBorrowAToken = params.value;
83:         } else if (params.key == "collateralSplitLiquidatorPercent") {
84:             state.riskConfig.collateralSplitLiquidatorPercent = params.value;
85:         } else if (params.key == "collateralSplitProtocolPercent") {
86:             state.riskConfig.collateralSplitProtocolPercent = params.value;
87:         } else if (params.key == "collateralTokenCap") {
88:             state.riskConfig.collateralTokenCap = params.value;
89:         } else if (params.key == "borrowATokenCap") {
90:             state.riskConfig.borrowATokenCap = params.value;
91:         } else if (params.key == "debtTokenCap") {
92:             state.riskConfig.debtTokenCap = params.value;
93:         } else if (params.key == "moveToVariablePoolHFThreshold") {
94:             state.riskConfig.moveToVariablePoolHFThreshold = params.value;
95:         } else if (params.key == "minimumMaturity") {
96:             state.riskConfig.minimumMaturity = params.value;
97:         } else if (params.key == "repayFeeAPR") {
98:             state.feeConfig.repayFeeAPR = params.value;
99:         } else if (params.key == "earlyLenderExitFee") {
100:             state.feeConfig.earlyLenderExitFee = params.value;
101:         } else if (params.key == "earlyBorrowerExitFee") {
102:             state.feeConfig.earlyBorrowerExitFee = params.value;
103:         } else if (params.key == "collateralOverdueTransferFee") {
104:             state.feeConfig.collateralOverdueTransferFee = params.value;
105:         } else if (params.key == "feeRecipient") {
106:             state.feeConfig.feeRecipient = address(uint160(params.value));
107:         } else if (params.key == "priceFeed") {
108:             state.oracle.priceFeed = IPriceFeed(address(uint160(params.value)));
109:         } else if (params.key == "marketBorrowRateFeed") {
110:             state.oracle.marketBorrowRateFeed = IMarketBorrowRateFeed(address(uint160(params.value)));
111:         } else {
112:             revert Errors.INVALID_KEY(params.key);
113:         }
114: 
115:         Initialize.validateInitializeFeeConfigParams(feeConfigParams(state));
116:         Initialize.validateInitializeRiskConfigParams(riskConfigParams(state));
117:         Initialize.validateInitializeOracleParams(oracleParams(state));
118: 
119:         emit Events.UpdateConfig(params.key, params.value);
120:     }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L25-L25)']
```solidity
25:     function validateWithdraw(State storage state, WithdrawParams calldata params) external view {
26:         
27:         
28: 
29:         
30:         if (
31:             params.token != address(state.data.underlyingCollateralToken)
32:                 && params.token != address(state.data.underlyingBorrowToken)
33:         ) {
34:             revert Errors.INVALID_TOKEN(params.token);
35:         }
36: 
37:         
38:         if (params.amount == 0) {
39:             revert Errors.NULL_AMOUNT();
40:         }
41: 
42:         
43:         if (params.to == address(0)) {
44:             revert Errors.NULL_ADDRESS();
45:         }
46: 
47:         
48:         
49:     }

```
['[51](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L51-L51)']
```solidity
51:     function executeWithdraw(State storage state, WithdrawParams calldata params) public {
52:         uint256 amount;
53:         if (params.variable || params.token == address(state.data.underlyingBorrowToken)) {
54:             IAToken aToken = params.token == address(state.data.underlyingBorrowToken)
55:                 ? state.data.borrowAToken
56:                 : state.data.collateralAToken;
57: 
58:             amount = Math.min(params.amount, state.aTokenBalanceOf(aToken, msg.sender, params.variable));
59:             if (amount > 0) {
60:                 state.withdrawUnderlyingTokenFromVariablePool(aToken, msg.sender, params.to, amount, params.variable);
61:             }
62:         } else {
63:             amount = Math.min(params.amount, state.data.collateralToken.balanceOf(msg.sender));
64:             if (amount > 0) {
65:                 state.withdrawUnderlyingCollateralToken(msg.sender, params.to, amount);
66:             }
67:         }
68: 
69:         emit Events.Withdraw(params.token, params.to, params.variable, amount);
70:     }

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L26-L26)']
```solidity
26:     function validateYieldCurve(YieldCurve memory self, uint256 minimumMaturity) internal pure {
27:         if (self.maturities.length == 0 || self.aprs.length == 0 || self.marketRateMultipliers.length == 0) {
28:             revert Errors.NULL_ARRAY();
29:         }
30:         if (self.maturities.length != self.aprs.length || self.maturities.length != self.marketRateMultipliers.length) {
31:             revert Errors.ARRAY_LENGTHS_MISMATCH();
32:         }
33: 
34:         
35:         
36: 
37:         
38:         uint256 lastMaturity = type(uint256).max;
39:         for (uint256 i = self.maturities.length; i > 0; i--) {
40:             if (self.maturities[i - 1] > lastMaturity) {
41:                 revert Errors.MATURITIES_NOT_STRICTLY_INCREASING();
42:             }
43:             lastMaturity = self.maturities[i - 1];
44:         }
45:         if (self.maturities[0] < minimumMaturity) {
46:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(self.maturities[0], minimumMaturity);
47:         }
48: 
49:         
50:         
51:     }

```
['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L101-L101)']
```solidity
101:     function getLoanStatus(State storage state, uint256 positionId) public view returns (LoanStatus) {
102:         
103:         DebtPosition memory debtPosition = state.data.debtPositions[positionId];
104:         if (isCreditPositionId(state, positionId)) {
105:             
106:             debtPosition = getDebtPositionByCreditPositionId(state, positionId);
107:         } else if (!isDebtPositionId(state, positionId)) {
108:             
109:             revert Errors.INVALID_POSITION_ID(positionId);
110:         }
111: 
112:         
113:         if (getDebt(debtPosition) == 0) {
114:             return LoanStatus.REPAID;
115:         } else if (block.timestamp >= debtPosition.dueDate) {
116:             return LoanStatus.OVERDUE;
117:         } else {
118:             return LoanStatus.ACTIVE;
119:         }
120:     }

```


</details>

## [NonCritical-83] Consider using the Upgradeable version of the OpenZeppelin libraries/contracts

### Resolution 
Using the upgradeable counterpart of the OpenZeppelin (OZ) library in Solidity is beneficial for creating contracts that can be updated in the future. OpenZeppelin's upgradeable contracts library is designed with proxy patterns in mind, which allow the logic of contracts to be upgraded while preserving the contract's state and address. This can be crucial for long-lived contracts where future requirements or improvements may not be fully known at the time of deployment. The upgradeable OZ contracts also include protection against a class of vulnerabilities related to initialization of storage variables in upgradeable contracts. Hence, it's a good idea to use them when developing contracts that may need to be upgraded in the future, as they provide a solid foundation for secure and upgradeable smart contracts.

Num of instances: 10

### Findings 


<details><summary>Click to show findings</summary>

['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L6-L6)']
```solidity
6: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L4-L4)']
```solidity
4: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol"; // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L9-L9)']
```solidity
9: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L4-L4)']
```solidity
4: import {SafeCast} from "@openzeppelin/contracts/utils/math/SafeCast.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L5-L5)']
```solidity
5: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L4-L4)']
```solidity
4: import {Clones} from "@openzeppelin/contracts/proxy/Clones.sol"; // <= FOUND

```
['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L6-L6)']
```solidity
6: import {Address} from "@openzeppelin/contracts/utils/Address.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L5-L5)']
```solidity
5: import {ERC20} from "@openzeppelin/contracts/token/ERC20/ERC20.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L7-L7)']
```solidity
7: import {UUPSUpgradeable} from "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L4-L4)']
```solidity
4: import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol"; // <= FOUND

```


</details>

## [NonCritical-84] All verbatim blocks are considered identical by deduplicator and can incorrectly be unified

### Resolution 
The Solidity Team reported a bug on October 24, 2023, affecting Yul code using the verbatim builtin, specifically in the Block Deduplicator optimizer step. This bug, present since Solidity version 0.8.5, caused incorrect deduplication of verbatim assembly items surrounded by identical opcodes, considering them identical regardless of their data. The bug was confined to pure Yul compilation with optimization enabled and was unlikely to be exploited as an attack vector. The conditions triggering the bug were very specific, and its occurrence was deemed to have a low likelihood. The bug was rated with an overall low score due to these factors. 

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[2](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L2-L2)']
```solidity
2: pragma solidity 0.8.23; // <= FOUND

```


</details>

## [NonCritical-85] Constructors should emit an event

### Resolution 
Emitting an event in a constructor of a smart contract provides transparency and traceability in blockchain applications. This event logs the contractâ€™s creation, aiding in monitoring and verifying contract deployment. Although constructors are executed only once, the emitted event ensures the contract's initialization is recorded on the blockchain.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L20-L20)']
```solidity
20:     constructor(address _owner, uint64 _staleRateInterval) Ownable(_owner) { // <= FOUND
21:         if (_staleRateInterval == 0) {
22:             revert Errors.NULL_STALE_RATE();
23:         }
24: 
25:         staleRateInterval = _staleRateInterval;
26:     }

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L16-L16)']
```solidity
16:     constructor(address owner_, string memory name_, string memory symbol_, uint8 decimals_) // <= FOUND
17:         Ownable(owner_)
18:         ERC20(name_, symbol_)
19:     {
20:         _decimals = decimals_;
21:     }

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L16-L16)']
```solidity
16:     constructor() { // <= FOUND
17:         _disableInitializers();
18:     }

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L27-L27)']
```solidity
27:     constructor( // <= FOUND
28:         address _aaveOracle,
29:         address _base,
30:         uint8 _baseDecimals,
31:         address _quote,
32:         uint8 _quoteDecimals,
33:         uint8 _decimals
34:     ) {
35:         if (_aaveOracle == address(0) || _base == address(0) || _quote == address(0)) {
36:             revert Errors.NULL_ADDRESS();
37:         }
38: 
39:         if (_decimals == 0 || _decimals > 18) {
40:             revert Errors.INVALID_DECIMALS(_decimals);
41:         }
42: 
43:         if (_baseDecimals == 0 || _baseDecimals > 18 || _quoteDecimals == 0 || _quoteDecimals > 18) {
44:             revert Errors.INVALID_DECIMALS(_baseDecimals);
45:         }
46: 
47:         aaveOracle = IAaveOracle(_aaveOracle);
48:         base = _base;
49:         baseDecimals = _baseDecimals;
50:         quote = _quote;
51:         quoteDecimals = _quoteDecimals;
52:         decimals = _decimals;
53:     }

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L16-L16)']
```solidity
16:     constructor() { // <= FOUND
17:         _disableInitializers();
18:     }

```


</details>

## [NonCritical-86] Consider using 'using-for' syntax when using libraries

### Resolution 
The `using-for` directive in Solidity allows smart contracts to utilize library functions as if they were methods of the type being passed. This syntactical feature streamlines code by enabling type-specific function applications without the need for explicit function calls. When a contract uses a library with the `using-for` declaration, it implicitly attaches the library's functions to a given type, enhancing code readability and efficiency. This approach is particularly beneficial for common operations on data types, such as array manipulation or complex mathematical computations, making it a valuable tool for developing more maintainable and intuitive smart contract code.

Num of instances: 225

### Findings 


<details><summary>Click to show findings</summary>

['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L6-L6)']
```solidity
6: import {AccountingLibrary} from "@src/libraries/fixed/AccountingLibrary.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L4-L4)']
```solidity
4: import {BorrowAsLimitOrderParams} from "@src/libraries/fixed/actions/BorrowAsLimitOrder.sol"; // <= FOUND

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L20-L20)']
```solidity
20: import {BorrowAsLimitOrder, BorrowAsLimitOrderParams} from "@src/libraries/fixed/actions/BorrowAsLimitOrder.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L5-L5)']
```solidity
5: import {BorrowAsMarketOrderParams} from "@src/libraries/fixed/actions/BorrowAsMarketOrder.sol"; // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L21-L21)']
```solidity
21: import {BorrowAsMarketOrder, BorrowAsMarketOrderParams} from "@src/libraries/fixed/actions/BorrowAsMarketOrder.sol"; // <= FOUND

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L22-L22)']
```solidity
22: import {BorrowVariableParams} from "@src/libraries/variable/actions/BorrowVariable.sol"; // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L45-L45)']
```solidity
45: import {BorrowVariable, BorrowVariableParams} from "@src/libraries/variable/actions/BorrowVariable.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L7-L7)']
```solidity
7: import {BorrowerExitParams} from "@src/libraries/fixed/actions/BorrowerExit.sol"; // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L23-L23)']
```solidity
23: import {BorrowerExit, BorrowerExitParams} from "@src/libraries/fixed/actions/BorrowerExit.sol"; // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L42-L42)']
```solidity
42: import {CapsLibrary} from "@src/libraries/fixed/CapsLibrary.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L8-L8)']
```solidity
8: import {ClaimParams} from "@src/libraries/fixed/actions/Claim.sol"; // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L24-L24)']
```solidity
24: import {Claim, ClaimParams} from "@src/libraries/fixed/actions/Claim.sol"; // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L9-L9)']
```solidity
9: import {CollateralLibrary} from "@src/libraries/fixed/CollateralLibrary.sol"; // <= FOUND

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L39-L39)']
```solidity
38:         uint256 amountToCompensate =
39:             Math.min(params.amount, creditPositionToCompensate.credit, debtPositionToRepay.faceValue); // <= FOUND

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L63-L63)']
```solidity
63:         if (creditPositionToCompensate.lender != debtPositionToRepay.borrower) { // <= FOUND

```
['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L64-L64)']
```solidity
64:             revert Errors.INVALID_LENDER(creditPositionToCompensate.lender); // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L19-L19)']
```solidity
19: import {CompensateParams} from "@src/libraries/fixed/actions/Compensate.sol"; // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L31-L31)']
```solidity
31: import {Compensate, CompensateParams} from "@src/libraries/fixed/actions/Compensate.sol"; // <= FOUND

```
['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L6-L6)']
```solidity
6: import {ConversionLibrary} from "@src/libraries/ConversionLibrary.sol"; // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L34-L34)']
```solidity
33:         uint256 debtTokenAmountWad =
34:             ConversionLibrary.amountToWad(debtTokenAmount, state.data.underlyingBorrowToken.decimals()); // <= FOUND

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L33-L33)']
```solidity
33:         uint256 debtWad = ConversionLibrary.amountToWad(debt, state.data.underlyingBorrowToken.decimals()); // <= FOUND

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L13-L13)']
```solidity
13: import {DepositParams} from "@src/libraries/general/actions/Deposit.sol"; // <= FOUND

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L25-L25)']
```solidity
25: import {Deposit, DepositParams} from "@src/libraries/general/actions/Deposit.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L7-L7)']
```solidity
7: import {Errors} from "@src/libraries/Errors.sol"; // <= FOUND

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L50-L50)']
```solidity
50:             revert Errors.INVALID_LOAN_OFFER(params.lender); // <= FOUND

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L41-L41)']
```solidity
41:             revert Errors.NULL_AMOUNT(); // <= FOUND

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L50-L50)']
```solidity
50:             revert Errors.PAST_DUE_DATE(params.dueDate); // <= FOUND

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L63-L63)']
```solidity
63:             revert Errors.DUE_DATE_GREATER_THAN_MAX_DUE_DATE(params.dueDate, loanOffer.maxDueDate); // <= FOUND

```
['[74](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L74-L74)']
```solidity
74:             revert Errors.PAST_DEADLINE(params.deadline); // <= FOUND

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L76-L77)']
```solidity
76:             revert Errors.APR_GREATER_THAN_MAX_APR( // <= FOUND
77:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.maxAPR // <= FOUND
78:             );

```
['[92](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L92-L92)']
```solidity
92:                 revert Errors.BORROWER_IS_NOT_LENDER(msg.sender, creditPosition.lender); // <= FOUND

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L95-L95)']
```solidity
95:                 revert Errors.DUE_DATE_LOWER_THAN_DEBT_POSITION_DUE_DATE(params.dueDate, debtPosition.dueDate); // <= FOUND

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L46-L46)']
```solidity
46:             revert Errors.NULL_ADDRESS(); // <= FOUND

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L41-L41)']
```solidity
41:             revert Errors.PAST_DUE_DATE(debtPosition.dueDate); // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L45-L45)']
```solidity
45:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(maturity, state.riskConfig.minimumMaturity); // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L53-L53)']
```solidity
53:             revert Errors.EXITER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower); // <= FOUND

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L59-L59)']
```solidity
59:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
60:                 address(state.data.borrowAToken),
61:                 msg.sender,
62:                 false,
63:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
64:                 issuanceValue + state.feeConfig.earlyBorrowerExitFee
65:             );

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L80-L81)']
```solidity
80:             revert Errors.APR_LOWER_THAN_MIN_APR( // <= FOUND
81:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.minAPR // <= FOUND
82:             );

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L12-L12)']
```solidity
12:             revert Errors.COLLATERAL_TOKEN_CAP_EXCEEDED( // <= FOUND
13:                 state.riskConfig.collateralTokenCap, state.data.collateralToken.totalSupply()
14:             );

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L20-L20)']
```solidity
20:             revert Errors.BORROW_ATOKEN_CAP_EXCEEDED( // <= FOUND
21:                 state.riskConfig.borrowATokenCap, state.data.borrowAToken.totalSupply()
22:             );

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L28-L28)']
```solidity
28:             revert Errors.DEBT_TOKEN_CAP_EXCEEDED(state.riskConfig.debtTokenCap, state.data.debtToken.totalSupply()); // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L36-L36)']
```solidity
36:             revert Errors.NOT_ENOUGH_BORROW_ATOKEN_LIQUIDITY(liquidity, redeemable); // <= FOUND

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L32-L32)']
```solidity
32:             revert Errors.LOAN_NOT_REPAID(params.creditPositionId); // <= FOUND

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L35-L35)']
```solidity
35:             revert Errors.CREDIT_POSITION_ALREADY_CLAIMED(params.creditPositionId); // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L43-L43)']
```solidity
43:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionWithDebtToRepayId); // <= FOUND

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L46-L47)']
```solidity
46:             revert Errors.CREDIT_LOWER_THAN_AMOUNT_TO_COMPENSATE( // <= FOUND
47:                 creditPositionWithDebtToRepay.credit, amountToCompensate // <= FOUND
48:             );

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L53-L53)']
```solidity
53:             revert Errors.LOAN_ALREADY_REPAID(params.creditPositionToCompensateId); // <= FOUND

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L59-L59)']
```solidity
59:             revert Errors.DUE_DATE_NOT_COMPATIBLE( // <= FOUND
60:                 params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId
61:             );

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L69-L69)']
```solidity
69:             revert Errors.COMPENSATOR_IS_NOT_BORROWER(msg.sender, debtPositionToRepay.borrower); // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L36-L36)']
```solidity
36:             revert Errors.INVALID_TOKEN(params.token); // <= FOUND

```
['[87](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L87-L87)']
```solidity
87:             revert Errors.INVALID_COLLATERAL_RATIO(r.crOpening); // <= FOUND

```
['[92](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L92-L92)']
```solidity
92:             revert Errors.INVALID_COLLATERAL_RATIO(r.crLiquidation); // <= FOUND

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L95-L95)']
```solidity
95:             revert Errors.INVALID_LIQUIDATION_COLLATERAL_RATIO(r.crOpening, r.crLiquidation); // <= FOUND

```
['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L105-L105)']
```solidity
105:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM(r.collateralSplitLiquidatorPercent); // <= FOUND

```
['[110](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L110-L110)']
```solidity
110:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM(r.collateralSplitProtocolPercent); // <= FOUND

```
['[113](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L113-L113)']
```solidity
113:             revert Errors.INVALID_COLLATERAL_PERCENTAGE_PREMIUM_SUM( // <= FOUND
114:                 r.collateralSplitLiquidatorPercent + r.collateralSplitProtocolPercent
115:             );

```
['[129](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L129-L129)']
```solidity
129:             revert Errors.INVALID_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(r.moveToVariablePoolHFThreshold); // <= FOUND

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L33-L33)']
```solidity
33:                 revert Errors.NULL_MAX_DUE_DATE(); // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L36-L36)']
```solidity
36:                 revert Errors.PAST_MAX_DUE_DATE(params.maxDueDate); // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L45-L45)']
```solidity
45:             revert Errors.INVALID_BORROW_OFFER(params.borrower); // <= FOUND

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L63-L63)']
```solidity
63:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
64:                 address(state.data.borrowAToken),
65:                 msg.sender,
66:                 false,
67:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
68:                 amountIn
69:             );

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L39-L39)']
```solidity
39:             revert Errors.LOAN_NOT_LIQUIDATABLE( // <= FOUND
40:                 params.debtPositionId,
41:                 state.collateralRatio(debtPosition.borrower),
42:                 state.getLoanStatus(params.debtPositionId)
43:             );

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L56-L56)']
```solidity
56:             revert Errors.LIQUIDATE_PROFIT_BELOW_MINIMUM_COLLATERAL_PROFIT( // <= FOUND
57:                 liquidatorProfitCollateralToken, params.minimumCollateralProfit
58:             );

```
['[151](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L151-L151)']
```solidity
150:                 
151:                 revert Errors.LOAN_NOT_LIQUIDATABLE(params.debtPositionId, collateralRatio, loanStatus); // <= FOUND

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L54-L54)']
```solidity
54:             revert Errors.LOAN_NOT_ACTIVE(params.debtPositionId); // <= FOUND

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L72-L72)']
```solidity
72:             revert Errors.INVALID_DEBT_POSITION_ID(debtPositionId); // <= FOUND

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L84-L84)']
```solidity
84:             revert Errors.INVALID_CREDIT_POSITION_ID(creditPositionId); // <= FOUND

```
['[110](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L110-L110)']
```solidity
109:             
110:             revert Errors.INVALID_POSITION_ID(positionId); // <= FOUND

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L22-L22)']
```solidity
22:             revert Errors.NULL_STALE_RATE(); // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L43-L43)']
```solidity
43:             revert Errors.STALE_RATE(marketBorrowRateUpdatedAt); // <= FOUND

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L46-L46)']
```solidity
46:         revert Errors.NOT_SUPPORTED(); // <= FOUND

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L30-L30)']
```solidity
30:             revert Errors.LOAN_ALREADY_REPAID(params.debtPositionId); // <= FOUND

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L35-L35)']
```solidity
35:             revert Errors.REPAYER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower); // <= FOUND

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L38-L38)']
```solidity
38:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
39:                 address(state.data.borrowAToken),
40:                 msg.sender,
41:                 false,
42:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false),
43:                 debtPosition.faceValue
44:             );

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L20-L20)']
```solidity
20:             revert Errors.CREDIT_LOWER_THAN_MINIMUM_CREDIT(credit, state.riskConfig.minimumCreditBorrowAToken); // <= FOUND

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L26-L26)']
```solidity
26:             revert Errors.CREDIT_LOWER_THAN_MINIMUM_CREDIT_OPENING(credit, state.riskConfig.minimumCreditBorrowAToken); // <= FOUND

```
['[75](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L75-L75)']
```solidity
75:             revert Errors.USER_IS_LIQUIDATABLE(account, collateralRatio(state, account)); // <= FOUND

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L85-L85)']
```solidity
85:             revert Errors.CR_BELOW_OPENING_LIMIT_BORROW_CR( // <= FOUND
86:                 account, collateralRatio(state, account), openingLimitBorrowCR
87:             );

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L36-L36)']
```solidity
36:             revert Errors.LOAN_NOT_SELF_LIQUIDATABLE( // <= FOUND
37:                 params.creditPositionId,
38:                 state.collateralRatio(debtPosition.borrower),
39:                 state.getLoanStatus(params.creditPositionId)
40:             );

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L43-L43)']
```solidity
43:             revert Errors.LIQUIDATION_NOT_AT_LOSS(params.creditPositionId, assignedCollateral, debtInCollateralToken); // <= FOUND

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L48-L48)']
```solidity
48:             revert Errors.LIQUIDATOR_IS_NOT_LENDER(msg.sender, creditPosition.lender); // <= FOUND

```
['[176](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L176-L176)']
```solidity
176:             revert Errors.NULL_OFFER(); // <= FOUND

```
['[179](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L179-L179)']
```solidity
179:             revert Errors.PAST_DUE_DATE(dueDate); // <= FOUND

```
['[112](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L112-L112)']
```solidity
112:             revert Errors.INVALID_KEY(params.key); // <= FOUND

```
['[88](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L88-L88)']
```solidity
88:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
89:                 address(aToken), from, variable, aTokenBalanceOf(state, aToken, from, variable), amount
90:             );

```
['[208](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L208-L208)']
```solidity
208:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
209:                 address(borrowAToken), from, false, aTokenBalanceOf(state, borrowAToken, from, false), amount
210:             );

```
['[327](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L327-L327)']
```solidity
327:             revert Errors.HEALTH_FACTOR_BELOW_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD( // <= FOUND
328:                 address(vaultFrom), healthFactor, state.riskConfig.moveToVariablePoolHFThreshold
329:             );

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L40-L40)']
```solidity
40:             revert Errors.INVALID_DECIMALS(_decimals); // <= FOUND

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L44-L44)']
```solidity
44:             revert Errors.INVALID_DECIMALS(_baseDecimals); // <= FOUND

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L52-L52)']
```solidity
52:             revert Errors.ARRAY_LENGTHS_MISMATCH(); // <= FOUND

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L59-L59)']
```solidity
59:                 revert Errors.NULL_ADDRESS(); // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L28-L28)']
```solidity
28:             revert Errors.NULL_ARRAY(); // <= FOUND

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L41-L41)']
```solidity
41:                 revert Errors.MATURITIES_NOT_STRICTLY_INCREASING(); // <= FOUND

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L46-L46)']
```solidity
46:             revert Errors.MATURITY_BELOW_MINIMUM_MATURITY(self.maturities[0], minimumMaturity); // <= FOUND

```
['[96](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L96-L96)']
```solidity
95:         
96:         if (dueDate < block.timestamp) revert Errors.PAST_DUE_DATE(dueDate); // <= FOUND

```
['[99](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L99-L99)']
```solidity
99:             revert Errors.MATURITY_OUT_OF_RANGE( // <= FOUND
100:                 maturity, curveRelativeTime.maturities[0], curveRelativeTime.maturities[length - 1]
101:             );

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L17-L17)']
```solidity
17: import {Events} from "@src/libraries/Events.sol"; // <= FOUND

```
['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L105-L105)']
```solidity
105:         emit Events.CreateDebtPosition(debtPositionId, lender, borrower, issuanceValue, faceValue, dueDate); // <= FOUND

```
['[114](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L114-L114)']
```solidity
114:         emit Events.CreateCreditPosition(creditPositionId, lender, RESERVED_ID, debtPositionId, creditPosition.credit); // <= FOUND

```
['[133](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L133-L133)']
```solidity
133:         emit Events.CreateCreditPosition(creditPositionId, lender, exitCreditPositionId, debtPositionId, credit); // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L42-L42)']
```solidity
42:         emit Events.BorrowAsLimitOrder(params.curveRelativeTime); // <= FOUND

```
['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L101-L101)']
```solidity
101:         emit Events.BorrowAsMarketOrder( // <= FOUND
102:             params.lender, params.amount, params.dueDate, params.exactAmountIn, params.receivableCreditPositionIds
103:         );

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L36-L36)']
```solidity
36:         emit Events.BorrowVariable(params.to, params.amount); // <= FOUND

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L85-L85)']
```solidity
85:         emit Events.BorrowerExit(params.debtPositionId, params.borrowerToExitTo); // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L49-L49)']
```solidity
49:         emit Events.Claim(params.creditPositionId); // <= FOUND

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L79-L79)']
```solidity
79:         emit Events.Compensate( // <= FOUND
80:             params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId, params.amount
81:         );

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L69-L69)']
```solidity
69:         emit Events.Deposit(params.token, params.to, params.variable, params.amount); // <= FOUND

```
['[253](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L253-L253)']
```solidity
253:         emit Events.Initialize(f, r, o, d); // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L47-L47)']
```solidity
47:         emit Events.LendAsLimitOrder(params.maxDueDate, params.curveRelativeTime); // <= FOUND

```
['[90](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L90-L90)']
```solidity
90:         emit Events.LendAsMarketOrder(params.borrower, params.dueDate, params.amount, params.exactAmountIn); // <= FOUND

```
['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L105-L105)']
```solidity
105:             emit Events.LiquidateOverdueMoveToVariablePool(params.debtPositionId); // <= FOUND

```
['[109](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L109-L109)']
```solidity
109:             emit Events.LiquidateOverdueNoSplitRemainder(params.debtPositionId); // <= FOUND

```
['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L128-L128)']
```solidity
128:         emit Events.Liquidate(params.debtPositionId, params.minimumCollateralProfit, collateralRatio, loanStatus); // <= FOUND

```
['[135](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L135-L135)']
```solidity
135:             emit Events.LiquidateUserLiquidatableProfitably(params.debtPositionId); // <= FOUND

```
['[139](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L139-L139)']
```solidity
139:             emit Events.LiquidateUserLiquidatableUnprofitably(params.debtPositionId); // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L36-L36)']
```solidity
36:         emit Events.LiquidateVariable(params.borrower, params.amount); // <= FOUND

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L98-L98)']
```solidity
98:         emit Events.LiquidateWithReplacement(params.debtPositionId, params.borrower, params.minimumCollateralProfit); // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L58-L58)']
```solidity
58:         emit Events.Repay(params.debtPositionId); // <= FOUND

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L30-L30)']
```solidity
30:         emit Events.RepayVariable(params.amount); // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L53-L53)']
```solidity
53:         emit Events.SelfLiquidate(params.creditPositionId); // <= FOUND

```
['[119](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L119-L119)']
```solidity
119:         emit Events.UpdateConfig(params.key, params.value); // <= FOUND

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L30-L30)']
```solidity
30:         emit Events.CreateVault(user, address(vault), false); // <= FOUND

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L48-L48)']
```solidity
48:         emit Events.CreateVault(user, address(vault), true); // <= FOUND

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L69-L69)']
```solidity
69:         emit Events.Withdraw(params.token, params.to, params.variable, amount); // <= FOUND

```
['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L11-L11)']
```solidity
7:     InitializeDataParams,
8:     InitializeFeeConfigParams,
9:     InitializeOracleParams,
10:     InitializeRiskConfigParams
11: } from "@src/libraries/general/actions/Initialize.sol"; // <= FOUND

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L17-L17)']
```solidity
12:     Initialize,
13:     InitializeDataParams,
14:     InitializeFeeConfigParams,
15:     InitializeOracleParams,
16:     InitializeRiskConfigParams
17: } from "@src/libraries/general/actions/Initialize.sol"; // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L7-L7)']
```solidity
7: import {Initialize} from "@src/libraries/general/actions/Initialize.sol"; // <= FOUND

```
['[115](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L115-L115)']
```solidity
115:         Initialize.validateInitializeFeeConfigParams(feeConfigParams(state)); // <= FOUND

```
['[116](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L116-L116)']
```solidity
116:         Initialize.validateInitializeRiskConfigParams(riskConfigParams(state)); // <= FOUND

```
['[117](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L117-L117)']
```solidity
117:         Initialize.validateInitializeOracleParams(oracleParams(state)); // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L10-L10)']
```solidity
10: import {LendAsLimitOrderParams} from "@src/libraries/fixed/actions/LendAsLimitOrder.sol"; // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L27-L27)']
```solidity
27: import {LendAsLimitOrder, LendAsLimitOrderParams} from "@src/libraries/fixed/actions/LendAsLimitOrder.sol"; // <= FOUND

```
['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L11-L11)']
```solidity
11: import {LendAsMarketOrderParams} from "@src/libraries/fixed/actions/LendAsMarketOrder.sol"; // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L28-L28)']
```solidity
28: import {LendAsMarketOrder, LendAsMarketOrderParams} from "@src/libraries/fixed/actions/LendAsMarketOrder.sol"; // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L12-L12)']
```solidity
12: import {LiquidateParams} from "@src/libraries/fixed/actions/Liquidate.sol"; // <= FOUND

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L17-L17)']
```solidity
17: import {SelfLiquidateParams} from "@src/libraries/fixed/actions/SelfLiquidate.sol"; // <= FOUND

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L29-L29)']
```solidity
29: import {Liquidate, LiquidateParams} from "@src/libraries/fixed/actions/Liquidate.sol"; // <= FOUND

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L84-L84)']
```solidity
84:         Liquidate.validateMinimumCollateralProfit( // <= FOUND
85:             state,
86:             LiquidateParams({
87:                 debtPositionId: params.debtPositionId,
88:                 minimumCollateralProfit: params.minimumCollateralProfit
89:             }),

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L37-L37)']
```solidity
37: import {SelfLiquidate, SelfLiquidateParams} from "@src/libraries/fixed/actions/SelfLiquidate.sol"; // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L23-L23)']
```solidity
23: import {LiquidateVariableParams} from "@src/libraries/variable/actions/LiquidateVariable.sol"; // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L47-L47)']
```solidity
47: import {LiquidateVariable, LiquidateVariableParams} from "@src/libraries/variable/actions/LiquidateVariable.sol"; // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L15-L15)']
```solidity
15: import {LiquidateWithReplacementParams} from "@src/libraries/fixed/actions/LiquidateWithReplacement.sol"; // <= FOUND

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L35-L35)']
```solidity
33:     LiquidateWithReplacement,
34:     LiquidateWithReplacementParams
35: } from "@src/libraries/fixed/actions/LiquidateWithReplacement.sol"; // <= FOUND

```
['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L11-L11)']
```solidity
11: import {CreditPosition, DebtPosition, LoanLibrary, RESERVED_ID} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[96](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L96-L96)']
```solidity
91:         debtPosition = DebtPosition({
92:             lender: lender,
93:             borrower: borrower,
94:             issuanceValue: issuanceValue,
95:             faceValue: faceValue,
96:             repayFee: LoanLibrary.repayFee(issuanceValue, block.timestamp, dueDate, state.feeConfig.repayFeeAPR), // <= FOUND
97:             startDate: block.timestamp,
98:             dueDate: dueDate,
99:             liquidityIndexAtRepayment: 0
100:         });

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L8-L8)']
```solidity
8: import {CreditPosition, DebtPosition, LoanLibrary} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L10-L10)']
```solidity
10: import {DebtPosition, LoanLibrary} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[107](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L107-L107)']
```solidity
106:         debtPosition.repayFee =
107:             LoanLibrary.repayFee(issuanceValue, block.timestamp, debtPosition.dueDate, state.feeConfig.repayFeeAPR); // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L10-L10)']
```solidity
10: import {CreditPosition, DebtPosition, LoanLibrary, LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L4-L4)']
```solidity
4: import {LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L9-L9)']
```solidity
9: import {CREDIT_POSITION_ID_START, DEBT_POSITION_ID_START} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L8-L8)']
```solidity
8: import {DebtPosition, LoanLibrary, LoanStatus} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L8-L8)']
```solidity
8: import {CreditPosition, DebtPosition} from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L15-L15)']
```solidity
9:     CREDIT_POSITION_ID_START,
10:     CreditPosition,
11:     DEBT_POSITION_ID_START,
12:     DebtPosition,
13:     LoanLibrary,
14:     LoanStatus
15: } from "@src/libraries/fixed/LoanLibrary.sol"; // <= FOUND

```
['[163](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L163-L163)']
```solidity
163:         return LoanLibrary.repayFee(issuanceValue, startDate, dueDate, repayFeeAPR); // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L12-L12)']
```solidity
12: import {Math} from "@src/libraries/Math.sol"; // <= FOUND

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L35-L35)']
```solidity
35:         collateralTokenAmount = Math.mulDivUp( // <= FOUND
36:             debtTokenAmountWad, 10 ** state.oracle.priceFeed.decimals(), state.oracle.priceFeed.getPrice()
37:         );

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L54-L54)']
```solidity
54:         repayFee = Math.mulDivDown(debtPosition.repayFee, repayAmount, debtPosition.faceValue); // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L4-L4)']
```solidity
4: import {PERCENT} from "@src/libraries/Math.sol"; // <= FOUND

```
['[75](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L75-L75)']
```solidity
75:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) > params.maxAPR) { // <= FOUND

```
['[126](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L126-L126)']
```solidity
125:         amountOutLeft =
126:             params.exactAmountIn ? Math.mulDivDown(params.amount, PERCENT, PERCENT + ratePerMaturity) : params.amount; // <= FOUND

```
['[132](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L132-L132)']
```solidity
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT); // <= FOUND

```
['[136](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L136-L136)']
```solidity
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity); // <= FOUND

```
['[176](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L176-L176)']
```solidity
176:         uint256 faceValue = Math.mulDivUp(issuanceValue, PERCENT + ratePerMaturity, PERCENT); // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L49-L49)']
```solidity
49:         uint256 issuanceValue = Math.mulDivUp(debtPosition.faceValue, PERCENT, PERCENT + ratePerMaturity); // <= FOUND

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L80-L80)']
```solidity
79:         
80:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) { // <= FOUND

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L94-L94)']
```solidity
94:         uint256 issuanceValue = Math.mulDivUp(faceValue, PERCENT, PERCENT + ratePerMaturity); // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L43-L43)']
```solidity
43:         uint256 claimAmount = Math.mulDivDown( // <= FOUND
44:             creditPosition.credit, state.borrowATokenLiquidityIndex(), debtPosition.liquidityIndexAtRepayment
45:         );

```
['[60](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L60-L60)']
```solidity
60:             amountIn = Math.mulDivUp(params.amount, PERCENT, PERCENT + ratePerMaturity); // <= FOUND

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L79-L79)']
```solidity
79:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) < params.minAPR) { // <= FOUND

```
['[100](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L100-L100)']
```solidity
100:             issuanceValue = Math.mulDivUp(params.amount, PERCENT, PERCENT + ratePerMaturity); // <= FOUND

```
['[102](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L102-L102)']
```solidity
102:         uint256 faceValue = Math.mulDivDown(issuanceValue, PERCENT + ratePerMaturity, PERCENT); // <= FOUND

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L79-L79)']
```solidity
78:                 uint256 collateralRemainderToLiquidator =
79:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitLiquidatorPercent, PERCENT); // <= FOUND

```
['[81](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L81-L81)']
```solidity
80:                 uint256 collateralRemainderToProtocol =
81:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitProtocolPercent, PERCENT); // <= FOUND

```
['[113](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L113-L113)']
```solidity
113:         uint256 issuanceValue = Math.mulDivDown(debtPositionCopy.faceValue, PERCENT, PERCENT + ratePerMaturity); // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L7-L7)']
```solidity
7: import {Math, PERCENT} from "@src/libraries/Math.sol"; // <= FOUND

```
['[137](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L137-L137)']
```solidity
137:             return Math.mulDivDown(collateral, debtPosition.faceValue, debt); // <= FOUND

```
['[161](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L161-L161)']
```solidity
161:             return Math.mulDivDown(debtPositionCollateral, creditPositionCredit, debtPositionFaceValue); // <= FOUND

```
['[168](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L168-L168)']
```solidity
168:         uint256 r = Math.mulDivDown(PERCENT, self.faceValue, self.issuanceValue); // <= FOUND

```
['[171](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L171-L171)']
```solidity
171:         self.issuanceValue = Math.mulDivDown(self.faceValue, PERCENT, r); // <= FOUND

```
['[180](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L180-L180)']
```solidity
180:         uint256 repayFeePercent = Math.mulDivUp(repayFeeAPR, interval, 365 days); // <= FOUND

```
['[181](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L181-L181)']
```solidity
181:         uint256 fee = Math.mulDivUp(issuanceValue, repayFeePercent, PERCENT); // <= FOUND

```
['[188](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L188-L188)']
```solidity
188:         return Math.mulDivDown(self.repayFee, elapsed, maturity); // <= FOUND

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L37-L37)']
```solidity
37:             return Math.mulDivDown(collateral, price, debtWad); // <= FOUND

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L80-L80)']
```solidity
80:         uint256 openingLimitBorrowCR = Math.max( // <= FOUND
81:             state.riskConfig.crOpening,
82:             state.data.users[account].borrowOffer.openingLimitBorrowCR 
83:         );

```
['[91](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L91-L91)']
```solidity
91:         uint256 ratePerMaturity = Math.mulDivDown(debtPosition.faceValue, PERCENT, debtPosition.issuanceValue) - PERCENT; // <= FOUND

```
['[92](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L92-L92)']
```solidity
92:         return Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity); // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L58-L58)']
```solidity
58:         return Math.mulDivDown( // <= FOUND
59:             _scalePrice(basePrice, baseDecimals, decimals),
60:             10 ** decimals,
61:             _scalePrice(quotePrice, quoteDecimals, decimals)
62:         );

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L58-L58)']
```solidity
58:             amount = Math.min(params.amount, state.aTokenBalanceOf(aToken, msg.sender, params.variable)); // <= FOUND

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L63-L63)']
```solidity
63:             amount = Math.min(params.amount, state.data.collateralToken.balanceOf(msg.sender)); // <= FOUND

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L72-L72)']
```solidity
70:         
71: 
72:         int256 ratePerMaturity = Math.linearAPRToRatePerMaturity(apr, maturity); // <= FOUND

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L76-L76)']
```solidity
76:             uint256 marketRateLinear = Math.compoundAPRToRatePerMaturity(marketRateCompound, maturity); // <= FOUND

```
['[78](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L78-L78)']
```solidity
77:             return SafeCast.toUint256(
78:                 ratePerMaturity + SafeCast.toInt256(Math.mulDivDown(marketRateLinear, marketRateMultiplier, PERCENT)) // <= FOUND
79:             );

```
['[103](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L103-L103)']
```solidity
103:             (uint256 low, uint256 high) = Math.binarySearch(curveRelativeTime.maturities, maturity); // <= FOUND

```
['[122](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L122-L122)']
```solidity
122:                     return y0 + Math.mulDivDown(y1 - y0, maturity - x0, x1 - x0); // <= FOUND

```
['[124](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L124-L124)']
```solidity
124:                     return y0 - Math.mulDivDown(y0 - y1, maturity - x0, x1 - x0); // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L9-L9)']
```solidity
9: import {BorrowOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L4-L4)']
```solidity
4: import {LoanOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol"; // <= FOUND

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L26-L26)']
```solidity
26: import {BorrowOffer, LoanOffer, OfferLibrary} from "@src/libraries/fixed/OfferLibrary.sol"; // <= FOUND

```
['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L8-L8)']
```solidity
8: import {BorrowOffer, LoanOffer} from "@src/libraries/fixed/OfferLibrary.sol"; // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L45-L45)']
```solidity
45:         if (creditPositionWithDebtToRepay.credit < amountToCompensate) { // <= FOUND

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L56-L56)']
```solidity
55:         if (
56:             debtPositionToRepay.dueDate // <= FOUND
57:                 < state.getDebtPositionByCreditPositionId(params.creditPositionToCompensateId).dueDate
58:         ) {

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L69-L69)']
```solidity
68:         
69:         if (msg.sender != debtPositionToRepay.borrower) { // <= FOUND

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L94-L94)']
```solidity
94:         debtPositionToRepay.updateRepayFee(amountToCompensate, repayFee); // <= FOUND

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L95-L95)']
```solidity
95:         state.data.debtToken.burn(debtPositionToRepay.borrower, amountToCompensate); // <= FOUND

```
['[96](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L96-L96)']
```solidity
96:         creditPositionWithDebtToRepay.credit -= amountToCompensate; // <= FOUND

```
['[97](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L97-L97)']
```solidity
97:         state.validateMinimumCredit(creditPositionWithDebtToRepay.credit); // <= FOUND

```
['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L105-L105)']
```solidity
101:         
102:         
103:         state.createCreditPosition({
104:             exitCreditPositionId: params.creditPositionToCompensateId,
105:             lender: debtPositionToRepay.lender, // <= FOUND
106:             credit: amountToCompensate
107:         });

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L16-L16)']
```solidity
16: import {RepayParams} from "@src/libraries/fixed/actions/Repay.sol"; // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L36-L36)']
```solidity
36: import {Repay, RepayParams} from "@src/libraries/fixed/actions/Repay.sol"; // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L24-L24)']
```solidity
24: import {RepayVariableParams} from "@src/libraries/variable/actions/RepayVariable.sol"; // <= FOUND

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L48-L48)']
```solidity
48: import {RepayVariable, RepayVariableParams} from "@src/libraries/variable/actions/RepayVariable.sol"; // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L14-L14)']
```solidity
14: import {RiskLibrary} from "@src/libraries/fixed/RiskLibrary.sol"; // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L18-L18)']
```solidity
18: import {UpdateConfig, UpdateConfigParams} from "@src/libraries/general/actions/UpdateConfig.sol"; // <= FOUND

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L16-L16)']
```solidity
16: import {UpdateConfig} from "@src/libraries/general/actions/UpdateConfig.sol"; // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L10-L10)']
```solidity
10: import {User} from "@src/libraries/fixed/UserLibrary.sol"; // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L19-L19)']
```solidity
19: import {UserLibrary} from "@src/libraries/fixed/UserLibrary.sol"; // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L10-L10)']
```solidity
10: import {VariableLibrary} from "@src/libraries/variable/VariableLibrary.sol"; // <= FOUND

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/interfaces/ISize.sol#L20-L20)']
```solidity
20: import {WithdrawParams} from "@src/libraries/general/actions/Withdraw.sol"; // <= FOUND

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L38-L38)']
```solidity
38: import {Withdraw, WithdrawParams} from "@src/libraries/general/actions/Withdraw.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L5-L5)']
```solidity
5: import {YieldCurve, YieldCurveLibrary} from "@src/libraries/fixed/YieldCurveLibrary.sol"; // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L47-L47)']
```solidity
40:             
41:             
42: 
43:             
44:             
45: 
46:             
47:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity); // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L5-L5)']
```solidity
5: import {YieldCurve} from "@src/libraries/fixed/YieldCurveLibrary.sol"; // <= FOUND

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L41-L41)']
```solidity
40:             
41:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity); // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L34-L34)']
```solidity
34:         return YieldCurveLibrary.getRatePerMaturityByDueDate(self.curveRelativeTime, marketBorrowRateFeed, dueDate); // <= FOUND

```


</details>

## [NonCritical-87] Consider validating all user inputs

### Resolution 
Validating user inputs in external and public functions is a critical security practice in smart contract development. This approach prevents malicious or erroneous data from compromising contract integrity or behavior. By checking inputs against expected formats, ranges, or conditions before processing, contracts can avoid common vulnerabilities like reentrancy, overflow/underflow, and unauthorized access. 

Num of instances: 87

### Findings 


<details><summary>Click to show findings</summary>

['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L48-L51)']
```solidity
48:     function chargeRepayFeeInCollateral(
49:         State storage state, // <= FOUND
50:         DebtPosition storage debtPosition, // <= FOUND
51:         uint256 repayAmount, // <= FOUND
52:         bool isEarlyRepay
53:     ) public returns (uint256 repayFee) 

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L69-L69)']
```solidity
69:     function chargeEarlyRepayFeeInCollateral(State storage state, DebtPosition storage debtPosition) // <= FOUND
70:         external
71:         returns (uint256)
72:     

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L76-L76)']
```solidity
76:     function chargeRepayFeeInCollateral(State storage state, DebtPosition storage debtPosition, uint256 repayAmount) // <= FOUND
77:         external
78:         returns (uint256)
79:     

```
['[83](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L83-L89)']
```solidity
83:     function createDebtAndCreditPositions(
84:         State storage state, // <= FOUND
85:         address lender, // <= FOUND
86:         address borrower, // <= FOUND
87:         uint256 issuanceValue, // <= FOUND
88:         uint256 faceValue, // <= FOUND
89:         uint256 dueDate // <= FOUND
90:     ) external returns (DebtPosition memory debtPosition, CreditPosition memory creditPosition) 

```
['[117](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L117-L117)']
```solidity
117:     function createCreditPosition(State storage state, uint256 exitCreditPositionId, address lender, uint256 credit) // <= FOUND
118:         external
119:         returns (CreditPosition memory creditPosition)
120:     

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L18-L18)']
```solidity
18:     function validateBorrowAsLimitOrder(State storage state, BorrowAsLimitOrderParams calldata params) external view  // <= FOUND

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L37-L37)']
```solidity
37:     function executeBorrowAsLimitOrder(State storage state, BorrowAsLimitOrderParams calldata params) external  // <= FOUND

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L41-L41)']
```solidity
41:     function validateBorrowAsMarketOrder(State storage state, BorrowAsMarketOrderParams memory params) external view  // <= FOUND

```
['[100](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L100-L100)']
```solidity
100:     function executeBorrowAsMarketOrder(State storage state, BorrowAsMarketOrderParams memory params) external  // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L19-L19)']
```solidity
19:     function validateBorrowVariable(State storage, BorrowVariableParams calldata params) external pure  // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L34-L34)']
```solidity
34:     function executeBorrowVariable(State storage state, BorrowVariableParams calldata params) public  // <= FOUND

```
['[84](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L84-L84)']
```solidity
84:     function executeBorrowerExit(State storage state, BorrowerExitParams calldata params) external  // <= FOUND

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L32-L32)']
```solidity
32:     function validateVariablePoolHasEnoughLiquidity(State storage state) public view  // <= FOUND

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L25-L25)']
```solidity
25:     function validateClaim(State storage state, ClaimParams calldata params) external view  // <= FOUND

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L39-L39)']
```solidity
39:     function executeClaim(State storage state, ClaimParams calldata params) external  // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L15-L15)']
```solidity
15:     function depositUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) external  // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L21-L21)']
```solidity
21:     function withdrawUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) // <= FOUND
22:         external
23:     

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L31-L31)']
```solidity
31:     function validateCompensate(State storage state, CompensateParams calldata params) external view  // <= FOUND

```
['[78](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L78-L78)']
```solidity
78:     function executeCompensate(State storage state, CompensateParams calldata params) external  // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L27-L27)']
```solidity
27:     function validateDeposit(State storage state, DepositParams calldata params) external view  // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L53-L53)']
```solidity
53:     function executeDeposit(State storage state, DepositParams calldata params) public  // <= FOUND

```
['[169](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L169-L171)']
```solidity
169:     function validateInitialize(
170:         State storage, // <= FOUND
171:         address owner, // <= FOUND
172:         InitializeFeeConfigParams memory f,
173:         InitializeRiskConfigParams memory r,
174:         InitializeOracleParams memory o,
175:         InitializeDataParams memory d
176:     ) external view 

```
['[242](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L242-L243)']
```solidity
242:     function executeInitialize(
243:         State storage state, // <= FOUND
244:         InitializeFeeConfigParams memory f,
245:         InitializeRiskConfigParams memory r,
246:         InitializeOracleParams memory o,
247:         InitializeDataParams memory d
248:     ) external 

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L22-L22)']
```solidity
22:     function validateLendAsLimitOrder(State storage state, LendAsLimitOrderParams calldata params) external view  // <= FOUND

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L44-L44)']
```solidity
44:     function executeLendAsLimitOrder(State storage state, LendAsLimitOrderParams calldata params) external  // <= FOUND

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L37-L37)']
```solidity
37:     function validateLendAsMarketOrder(State storage state, LendAsMarketOrderParams calldata params) external view  // <= FOUND

```
['[89](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L89-L89)']
```solidity
89:     function executeLendAsMarketOrder(State storage state, LendAsMarketOrderParams memory params) external  // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L31-L31)']
```solidity
31:     function validateLiquidate(State storage state, LiquidateParams calldata params) external view  // <= FOUND

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L50-L53)']
```solidity
50:     function validateMinimumCollateralProfit(
51:         State storage, // <= FOUND
52:         LiquidateParams calldata params, // <= FOUND
53:         uint256 liquidatorProfitCollateralToken // <= FOUND
54:     ) external pure 

```
['[119](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L119-L119)']
```solidity
119:     function executeLiquidate(State storage state, LiquidateParams calldata params) // <= FOUND
120:         external
121:         returns (uint256 liquidatorProfitCollateralToken)
122:     

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L19-L19)']
```solidity
19:     function validateLiquidateVariable(State storage, LiquidateVariableParams calldata params) external pure  // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L34-L34)']
```solidity
34:     function executeLiquidateVariable(State storage state, LiquidateVariableParams calldata params) public  // <= FOUND

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L79-L82)']
```solidity
79:     function validateMinimumCollateralProfit(
80:         State storage state, // <= FOUND
81:         LiquidateWithReplacementParams calldata params, // <= FOUND
82:         uint256 liquidatorProfitCollateralToken // <= FOUND
83:     ) external pure 

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L94-L96)']
```solidity
94:     function executeLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params) // <= FOUND
95:         external
96:         returns (uint256, uint256) // <= FOUND
97:     

```
['[60](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L60-L60)']
```solidity
60:     function getDebtPositionIdByCreditPositionId(State storage state, uint256 creditPositionId) // <= FOUND
61:         public
62:         view
63:         returns (uint256)
64:     

```
['[68](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L68-L68)']
```solidity
68:     function getDebtPosition(State storage state, uint256 debtPositionId) public view returns (DebtPosition storage)  // <= FOUND

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L76-L79)']
```solidity
76:     function getCreditPosition(State storage state, uint256 creditPositionId) // <= FOUND
77:         public
78:         view
79:         returns (CreditPosition storage) // <= FOUND
80:     

```
['[88](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L88-L91)']
```solidity
88:     function getDebtPositionByCreditPositionId(State storage state, uint256 creditPositionId) // <= FOUND
89:         public
90:         view
91:         returns (DebtPosition storage) // <= FOUND
92:     

```
['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L101-L101)']
```solidity
101:     function getLoanStatus(State storage state, uint256 positionId) public view returns (LoanStatus)  // <= FOUND

```
['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L128-L128)']
```solidity
128:     function getDebtPositionAssignedCollateral(State storage state, DebtPosition memory debtPosition) // <= FOUND
129:         public
130:         view
131:         returns (uint256)
132:     

```
['[149](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L149-L149)']
```solidity
149:     function getCreditPositionProRataAssignedCollateral(State storage state, CreditPosition memory creditPosition) // <= FOUND
150:         public
151:         view
152:         returns (uint256)
153:     

```
['[167](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L167-L167)']
```solidity
167:     function updateRepayFee(DebtPosition storage self, uint256 _repayAmount, uint256 _repayFee) external  // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L28-L28)']
```solidity
28:     function setStaleRateInterval(uint64 _staleRateInterval) external onlyOwner  // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L34-L34)']
```solidity
34:     function setMarketBorrowRate(uint128 _marketBorrowRate) external onlyOwner  // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L23-L23)']
```solidity
23:     function mint(address to, uint256 amount) external virtual onlyOwner  // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L27-L27)']
```solidity
27:     function burn(address from, uint256 amount) external virtual onlyOwner  // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L31-L31)']
```solidity
31:     function transferFrom(address from, address to, uint256 value) public virtual override onlyOwner returns (bool)  // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L36-L36)']
```solidity
36:     function transfer(address to, uint256 value) public virtual override onlyOwner returns (bool)  // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L45-L45)']
```solidity
45:     function approve(address, uint256) public virtual override returns (bool)  // <= FOUND

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L25-L25)']
```solidity
25:     function validateRepay(State storage state, RepayParams calldata params) external view  // <= FOUND

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L48-L48)']
```solidity
48:     function executeRepay(State storage state, RepayParams calldata params) external  // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L18-L18)']
```solidity
18:     function validateRepayVariable(State storage, RepayVariableParams calldata params) external pure  // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L28-L28)']
```solidity
28:     function executeRepayVariable(State storage state, RepayVariableParams calldata params) public  // <= FOUND

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L30-L30)']
```solidity
30:     function collateralRatio(State storage state, address account) public view returns (uint256)  // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L43-L43)']
```solidity
43:     function isCreditPositionSelfLiquidatable(State storage state, uint256 creditPositionId) // <= FOUND
44:         public
45:         view
46:         returns (bool)
47:     

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L56-L56)']
```solidity
56:     function isDebtPositionLiquidatable(State storage state, uint256 debtPositionId) public view returns (bool)  // <= FOUND

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L69-L69)']
```solidity
69:     function isUserLiquidatable(State storage state, address account) public view returns (bool)  // <= FOUND

```
['[73](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L73-L73)']
```solidity
73:     function validateUserIsNotLiquidatable(State storage state, address account) external view  // <= FOUND

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L79-L79)']
```solidity
79:     function validateUserIsNotBelowopeningLimitBorrowCR(State storage state, address account) external view  // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L27-L27)']
```solidity
27:     function validateSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external view  // <= FOUND

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L52-L52)']
```solidity
52:     function executeSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external  // <= FOUND

```
['[95](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L95-L96)']
```solidity
95:     function initialize(
96:         address owner, // <= FOUND
97:         InitializeFeeConfigParams calldata f,
98:         InitializeRiskConfigParams calldata r,
99:         InitializeOracleParams calldata o,
100:         InitializeDataParams calldata d
101:     ) external initializer 

```
['[237](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L237-L237)']
```solidity
237:     function variablePoolAllowlisted(address account) external view override(ISize) whenNotPaused returns (bool)  // <= FOUND

```
['[158](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L158-L158)']
```solidity
158:     function repayFee(uint256 issuanceValue, uint256 startDate, uint256 dueDate, uint256 repayFeeAPR) // <= FOUND
159:         external
160:         pure
161:         returns (uint256)
162:     

```
['[173](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L173-L173)']
```solidity
173:     function getBorrowOfferAPR(address borrower, uint256 dueDate) external view returns (uint256)  // <= FOUND

```
['[186](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L186-L186)']
```solidity
186:     function getLoanOfferAPR(address lender, uint256 dueDate) external view returns (uint256)  // <= FOUND

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L32-L32)']
```solidity
32:     function feeConfigParams(State storage state) public view returns (InitializeFeeConfigParams memory)  // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L42-L42)']
```solidity
42:     function riskConfigParams(State storage state) public view returns (InitializeRiskConfigParams memory)  // <= FOUND

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L57-L57)']
```solidity
57:     function oracleParams(State storage state) public view returns (InitializeOracleParams memory)  // <= FOUND

```
['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L64-L64)']
```solidity
64:     function dataParams(State storage state) public view returns (InitializeDataParams memory)  // <= FOUND

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L72-L72)']
```solidity
72:     function validateUpdateConfig(State storage, UpdateConfigParams calldata) external pure  // <= FOUND

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L76-L76)']
```solidity
76:     function executeUpdateConfig(State storage state, UpdateConfigParams calldata params) external  // <= FOUND

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L25-L25)']
```solidity
25:     function getVaultFixed(State storage state, address user) public returns (Vault)  // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L43-L43)']
```solidity
43:     function getVaultVariable(State storage state, address user) public returns (Vault)  // <= FOUND

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L44-L49)']
```solidity
44:     function depositUnderlyingTokenToVariablePool(
45:         State storage state, // <= FOUND
46:         IERC20Metadata underlyingToken,
47:         address from, // <= FOUND
48:         address to, // <= FOUND
49:         uint256 amount, // <= FOUND
50:         bool variable,
51:         bool setUseReserveAsCollateral
52:     ) external 

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L79-L84)']
```solidity
79:     function withdrawUnderlyingTokenFromVariablePool(
80:         State storage state, // <= FOUND
81:         IAToken aToken,
82:         address from, // <= FOUND
83:         address to, // <= FOUND
84:         uint256 amount, // <= FOUND
85:         bool variable
86:     ) external 

```
['[106](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L106-L106)']
```solidity
106:     function borrowVariableLoan(State storage state, address from, address to, uint256 amount) external  // <= FOUND

```
['[144](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L144-L144)']
```solidity
144:     function repayVariableLoan(State storage state, address from, uint256 amount) external  // <= FOUND

```
['[164](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L164-L164)']
```solidity
164:     function liquidateVariableLoan(State storage state, address from, address borrower, uint256 amount) external  // <= FOUND

```
['[205](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L205-L205)']
```solidity
205:     function transferBorrowATokenFixed(State storage state, address from, address to, uint256 amount) public  // <= FOUND

```
['[225](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L225-L225)']
```solidity
225:     function aTokenBalanceOf(State storage state, IAToken aToken, address account, bool variable) // <= FOUND
226:         public
227:         view
228:         returns (uint256)
229:     

```
['[237](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L237-L237)']
```solidity
237:     function variableDebtTokenBalanceOf(State storage state, address account) public view returns (uint256)  // <= FOUND

```
['[248](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L248-L248)']
```solidity
248:     function borrowATokenLiquidityIndex(State storage state) public view returns (uint256)  // <= FOUND

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L33-L33)']
```solidity
33:     function proxy(address target, bytes memory data, uint256 value) // <= FOUND
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData)
37:     

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L25-L25)']
```solidity
25:     function validateWithdraw(State storage state, WithdrawParams calldata params) external view  // <= FOUND

```
['[51](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L51-L51)']
```solidity
51:     function executeWithdraw(State storage state, WithdrawParams calldata params) public  // <= FOUND

```
['[89](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L89-L92)']
```solidity
89:     function getRatePerMaturityByDueDate(
90:         YieldCurve memory curveRelativeTime,
91:         IMarketBorrowRateFeed marketBorrowRateFeed, // <= FOUND
92:         uint256 dueDate // <= FOUND
93:     ) external view returns (uint256) 

```


</details>

## [NonCritical-88] Constructor with array parameters has no empty array checks

### Resolution 
Failing to validate for empty array inputs in constructors can lead to vulnerabilities or logical errors in smart contracts. Constructors often initialize key contract settings, and arrays may represent crucial data like access controls, initial states, or configuration parameters. Without empty array checks, a contract might be deployed in an unintended state, lacking necessary data for its operations or security measures. 

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L16-L16)']
```solidity
16:     constructor(address owner_, string memory name_, string memory symbol_, uint8 decimals_)
17:         Ownable(owner_)
18:         ERC20(name_, symbol_)
19:     {
20:         _decimals = decimals_;
21:     }

```


</details>

## [NonCritical-89] Consider using AccessControlDefaultAdminRules rather than AccessControl

### Resolution 
Using `AccessControlDefaultAdminRules` over `AccessControl` in Solidity contracts provides a predefined set of rules for administrative privileges, simplifying the management of roles and permissions. It offers a structured approach to defining who can grant or revoke roles, enhancing security and governance within contracts by standardizing access controls and reducing the risk of misconfiguration.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L56-L60)']
```solidity
56: contract Size is
57:     ISize,
58:     SizeView,
59:     Initializable,
60:     AccessControlUpgradeable, // <= FOUND
61:     PausableUpgradeable,
62:     MulticallUpgradeable,
63:     UUPSUpgradeable
64: 

```


</details>

## [NonCritical-90] Consider using named returns

### Resolution 
Using named returns in Solidity functions enhances code readability and clarity. By explicitly naming return variables in the function signature, developers can document what each return value represents, making the code easier to understand and maintain. This practice can also slightly optimize gas usage by avoiding extra variable declarations.

Num of instances: 28

### Findings 


<details><summary>Click to show findings</summary>

['[90](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L90-L90)']
```solidity
83:     function createDebtAndCreditPositions(
84:         State storage state,
85:         address lender,
86:         address borrower,
87:         uint256 issuanceValue,
88:         uint256 faceValue,
89:         uint256 dueDate
90:     ) external returns (DebtPosition memory debtPosition, CreditPosition memory creditPosition)  // <= FOUND

```
['[113](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L113-L113)']
```solidity
111:     function _borrowFromCredit(State storage state, BorrowAsMarketOrderParams memory params)
112:         internal
113:         returns (uint256 amountOutLeft) // <= FOUND
114:     

```
['[102](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L102-L102)']
```solidity
98:     function _executeLiquidateOverdue(
99:         State storage state,
100:         LiquidateParams calldata params,
101:         DebtPosition memory debtPositionCopy
102:     ) private returns (uint256 liquidatorProfitCollateralToken)  // <= FOUND

```
['[96](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L96-L96)']
```solidity
94:     function executeLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params)
95:         external
96:         returns (uint256, uint256) // <= FOUND
97:     

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L79-L79)']
```solidity
76:     function getCreditPosition(State storage state, uint256 creditPositionId)
77:         public
78:         view
79:         returns (CreditPosition storage) // <= FOUND
80:     

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L57-L57)']
```solidity
57:     function binarySearch(uint256[] memory array, uint256 value) internal pure returns (uint256 low, uint256 high)  // <= FOUND

```
['[221](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L221-L221)']
```solidity
216:     function liquidateWithReplacement(LiquidateWithReplacementParams calldata params)
217:         external
218:         override(ISize)
219:         whenNotPaused
220:         onlyRole(KEEPER_ROLE)
221:         returns (uint256 liquidatorProfitCollateralAsset, uint256 liquidatorProfitBorrowAsset) // <= FOUND
222:     

```
['[103](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L103-L103)']
```solidity
103:     function riskConfig() external view returns (InitializeRiskConfigParams memory)  // <= FOUND

```
['[111](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L111-L111)']
```solidity
111:     function data() external view returns (DataView memory)  // <= FOUND

```
['[146](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L146-L146)']
```solidity
146:     function getDebtPosition(uint256 debtPositionId) external view returns (DebtPosition memory)  // <= FOUND

```
['[166](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L166-L166)']
```solidity
166:     function getPositionsCount() external view returns (uint256, uint256)  // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L42-L42)']
```solidity
42:     function riskConfigParams(State storage state) public view returns (InitializeRiskConfigParams memory)  // <= FOUND

```
['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L64-L64)']
```solidity
64:     function dataParams(State storage state) public view returns (InitializeDataParams memory)  // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L24-L24)']
```solidity
24:     function proxy(address target, bytes memory data) public onlyOwner returns (bytes memory returnData)  // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L49-L49)']
```solidity
46:     function proxy(address[] memory targets, bytes[] memory datas)
47:         public
48:         onlyOwner
49:         returns (bytes[] memory returnDatas) // <= FOUND
50:     

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L53-L53)']
```solidity
48:     function chargeRepayFeeInCollateral(
49:         State storage state,
50:         DebtPosition storage debtPosition,
51:         uint256 repayAmount,
52:         bool isEarlyRepay
53:     ) public returns (uint256 repayFee)  // <= FOUND

```
['[119](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L119-L119)']
```solidity
117:     function createCreditPosition(State storage state, uint256 exitCreditPositionId, address lender, uint256 credit)
118:         external
119:         returns (CreditPosition memory creditPosition) // <= FOUND
120:     

```
['[66](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L66-L66)']
```solidity
62:     function _executeLiquidateTakeCollateral(
63:         State storage state,
64:         DebtPosition memory debtPositionCopy,
65:         bool splitCollateralRemainder
66:     ) private returns (uint256 liquidatorProfitCollateralToken)  // <= FOUND

```
['[121](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L121-L121)']
```solidity
119:     function executeLiquidate(State storage state, LiquidateParams calldata params)
120:         external
121:         returns (uint256 liquidatorProfitCollateralToken) // <= FOUND
122:     

```
['[91](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L91-L91)']
```solidity
88:     function getDebtPositionByCreditPositionId(State storage state, uint256 creditPositionId)
89:         public
90:         view
91:         returns (DebtPosition storage) // <= FOUND
92:     

```
['[202](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L202-L202)']
```solidity
198:     function liquidate(LiquidateParams calldata params)
199:         external
200:         override(ISize)
201:         whenNotPaused
202:         returns (uint256 liquidatorProfitCollateralAsset) // <= FOUND
203:     

```
['[99](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L99-L99)']
```solidity
99:     function feeConfig() external view returns (InitializeFeeConfigParams memory)  // <= FOUND

```
['[107](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L107-L107)']
```solidity
107:     function oracle() external view returns (InitializeOracleParams memory)  // <= FOUND

```
['[125](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L125-L125)']
```solidity
125:     function getUserView(address user) external view returns (UserView memory)  // <= FOUND

```
['[150](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L150-L150)']
```solidity
150:     function getCreditPosition(uint256 creditPositionId) external view returns (CreditPosition memory)  // <= FOUND

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L57-L57)']
```solidity
57:     function oracleParams(State storage state) public view returns (InitializeOracleParams memory)  // <= FOUND

```
['[264](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L264-L264)']
```solidity
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken) // <= FOUND
265:     

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L36-L36)']
```solidity
33:     function proxy(address target, bytes memory data, uint256 value)
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData) // <= FOUND
37:     

```


</details>

## [NonCritical-91] Errors should have parameters

### Resolution 
In Solidity, custom errors with parameters offer a gas-efficient way to convey detailed information about issues encountered during contract execution. Unlike revert messages, which are strings consuming more gas, custom errors defined with parameters allow developers to specify types and details of errors succinctly. This method enhances debugging, provides clearer insights into contract failures, and improves the developer's and end-user's understanding of what went wrong, all while optimizing for gas usage and maintaining contract efficiency.

Num of instances: 10

### Findings 


<details><summary>Click to show findings</summary>

['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L9-L9)']
```solidity
9:     error NULL_ADDRESS(); // <= FOUND

```
['[10](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L10-L10)']
```solidity
10:     error NULL_AMOUNT(); // <= FOUND

```
['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L11-L11)']
```solidity
11:     error NULL_MAX_DUE_DATE(); // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L12-L12)']
```solidity
12:     error NULL_ARRAY(); // <= FOUND

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L13-L13)']
```solidity
13:     error NULL_OFFER(); // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L14-L14)']
```solidity
14:     error MATURITIES_NOT_STRICTLY_INCREASING(); // <= FOUND

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L16-L16)']
```solidity
16:     error ARRAY_LENGTHS_MISMATCH(); // <= FOUND

```
['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L76-L76)']
```solidity
76:     error NULL_STALE_PRICE(); // <= FOUND

```
['[77](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L77-L77)']
```solidity
77:     error NULL_STALE_RATE(); // <= FOUND

```
['[89](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L89-L89)']
```solidity
89:     error NOT_SUPPORTED(); // <= FOUND

```


</details>

## [NonCritical-92] Avoid using 'owner' or '_owner' as a parameter name

### Resolution 
Using 'owner' or '_owner' as a parameter name in functions, especially in contracts inheriting from or interacting with OpenZeppelin's `Ownable` contract, can lead to confusion and potential bugs. These contracts often have a state variable named `owner`, managed by the `Ownable` pattern for access control. Using the same name for function parameters may obscure the contract's `owner` state variable, complicating code readability and maintenance. Prefer alternative descriptive names for parameters to maintain clarity and prevent conflicts with established ownership patterns.

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L59-L59)']
```solidity
59:     function validateOwner(address owner) internal pure  // <= FOUND

```
['[171](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L171-L171)']
```solidity
169:     function validateInitialize(
170:         State storage,
171:         address owner, // <= FOUND
172:         InitializeFeeConfigParams memory f,
173:         InitializeRiskConfigParams memory r,
174:         InitializeOracleParams memory o,
175:         InitializeDataParams memory d
176:     ) external view 

```
['[96](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L96-L96)']
```solidity
95:     function initialize(
96:         address owner, // <= FOUND
97:         InitializeFeeConfigParams calldata f,
98:         InitializeRiskConfigParams calldata r,
99:         InitializeOracleParams calldata o,
100:         InitializeDataParams calldata d
101:     ) external initializer 

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L20-L20)']
```solidity
20:     function initialize(address owner) external initializer  // <= FOUND

```


</details>

## [NonCritical-93] Catch return of decimals as uint8

### Resolution 
Catching the return value of the `decimals()` function as `uint8` is a common practice in ERC20 token contracts, especially those adhering to the OpenZeppelin (OZ) standards. This function specifies the token's divisibility by indicating how many decimal places are used for its smallest unit. The `uint8` data type is chosen for its efficiency, as it sufficiently supports the range of typical decimal values (most ERC20 tokens use 18 decimals, mirroring Ethereum's native currency, Ether). This approach balances the need for precision in token transactions with the goal of minimizing storage and computational costs on the blockchain. Developers working with ERC20 tokens must ensure proper handling of this return type to maintain compatibility and ensure accurate calculations of token amounts in smart contracts and decentralized applications.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L33-L33)']
```solidity
33:         uint256 debtWad = ConversionLibrary.amountToWad(debt, state.data.underlyingBorrowToken.decimals()); // <= FOUND

```


</details>

## [NonCritical-94] Consider migrating from Ownable to AccessControl

### Resolution 
Migrating from `Ownable` to `AccessControl` in smart contract development represents a shift towards a more flexible and granular permissioning system. `Ownable` is straightforward, designating a single account with the authority to perform administrative actions, making it suitable for simpler use cases. In contrast, `AccessControl` enables the definition of multiple roles, each with its own set of permissions, allowing for complex governance structures within contracts. This approach supports a broader range of use cases, from simple ownership models to intricate permissioning schemes involving multiple stakeholders. Developers adopting `AccessControl` can fine-tune access at a granular level, enhancing the contract's security and adaptability. This migration is indicative of evolving best practices in smart contract design, emphasizing modularity, security, and flexibility.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20  // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L12-L12)']
```solidity
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step  // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable  // <= FOUND

```


</details>

## [NonCritical-95] Avoid arithmetic directly within array indices

### Resolution 
Avoiding arithmetic directly within array indices, like `test[i + 2]`, is recommended to prevent errors such as index out of bounds or incorrect data access. This practice enhances code readability and maintainability. Instead, calculate the index beforehand, store it in a variable, and then use that variable to access the array element. This approach reduces mistakes, especially in complex loops or when handling dynamic data, ensuring that each access is clear and verifiable. It's about keeping code clean and understandable, minimizing potential bugs.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L40-L40)']
```solidity
40:             if (self.maturities[i - 1] > lastMaturity) { // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L43-L43)']
```solidity
43:             lastMaturity = self.maturities[i - 1]; // <= FOUND

```


</details>

## [NonCritical-96] Function control structures do not follow the Solidity Style Guide

### Resolution 
When defining function declarations, the opening brace should be on the same line as the end of the declaration and preceded by only a single space.

Num of instances: 23

### Findings 


<details><summary>Click to show findings</summary>

['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L32-L32)']
```solidity
28:     function debtTokenAmountToCollateralTokenAmount(State storage state, uint256 debtTokenAmount)
29:         internal
30:         view
31:         returns (uint256 collateralTokenAmount)
32:     { // <= FOUND

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L72-L72)']
```solidity
69:     function chargeEarlyRepayFeeInCollateral(State storage state, DebtPosition storage debtPosition)
70:         external
71:         returns (uint256)
72:     { // <= FOUND

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L79-L79)']
```solidity
76:     function chargeRepayFeeInCollateral(State storage state, DebtPosition storage debtPosition, uint256 repayAmount)
77:         external
78:         returns (uint256)
79:     { // <= FOUND

```
['[120](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L120-L120)']
```solidity
117:     function createCreditPosition(State storage state, uint256 exitCreditPositionId, address lender, uint256 credit)
118:         external
119:         returns (CreditPosition memory creditPosition)
120:     { // <= FOUND

```
['[114](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L114-L114)']
```solidity
111:     function _borrowFromCredit(State storage state, BorrowAsMarketOrderParams memory params)
112:         internal
113:         returns (uint256 amountOutLeft)
114:     { // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L23-L23)']
```solidity
21:     function withdrawUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount)
22:         external
23:     { // <= FOUND

```
['[122](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L122-L122)']
```solidity
119:     function executeLiquidate(State storage state, LiquidateParams calldata params)
120:         external
121:         returns (uint256 liquidatorProfitCollateralToken)
122:     { // <= FOUND

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L38-L38)']
```solidity
35:     function validateLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params)
36:         external
37:         view
38:     { // <= FOUND

```
['[97](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L97-L97)']
```solidity
94:     function executeLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params)
95:         external
96:         returns (uint256, uint256)
97:     { // <= FOUND

```
['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L64-L64)']
```solidity
60:     function getDebtPositionIdByCreditPositionId(State storage state, uint256 creditPositionId)
61:         public
62:         view
63:         returns (uint256)
64:     { // <= FOUND

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L80-L80)']
```solidity
76:     function getCreditPosition(State storage state, uint256 creditPositionId)
77:         public
78:         view
79:         returns (CreditPosition storage)
80:     { // <= FOUND

```
['[92](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L92-L92)']
```solidity
88:     function getDebtPositionByCreditPositionId(State storage state, uint256 creditPositionId)
89:         public
90:         view
91:         returns (DebtPosition storage)
92:     { // <= FOUND

```
['[132](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L132-L132)']
```solidity
128:     function getDebtPositionAssignedCollateral(State storage state, DebtPosition memory debtPosition)
129:         public
130:         view
131:         returns (uint256)
132:     { // <= FOUND

```
['[153](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L153-L153)']
```solidity
149:     function getCreditPositionProRataAssignedCollateral(State storage state, CreditPosition memory creditPosition)
150:         public
151:         view
152:         returns (uint256)
153:     { // <= FOUND

```
['[178](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L178-L178)']
```solidity
174:     function repayFee(uint256 issuanceValue, uint256 startDate, uint256 dueDate, uint256 repayFeeAPR)
175:         internal
176:         pure
177:         returns (uint256)
178:     { // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L47-L47)']
```solidity
43:     function isCreditPositionSelfLiquidatable(State storage state, uint256 creditPositionId)
44:         public
45:         view
46:         returns (bool)
47:     { // <= FOUND

```
['[203](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L203-L203)']
```solidity
198:     function liquidate(LiquidateParams calldata params)
199:         external
200:         override(ISize)
201:         whenNotPaused
202:         returns (uint256 liquidatorProfitCollateralAsset)
203:     { // <= FOUND

```
['[222](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L222-L222)']
```solidity
216:     function liquidateWithReplacement(LiquidateWithReplacementParams calldata params)
217:         external
218:         override(ISize)
219:         whenNotPaused
220:         onlyRole(KEEPER_ROLE)
221:         returns (uint256 liquidatorProfitCollateralAsset, uint256 liquidatorProfitBorrowAsset)
222:     { // <= FOUND

```
['[162](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L162-L162)']
```solidity
158:     function repayFee(uint256 issuanceValue, uint256 startDate, uint256 dueDate, uint256 repayFeeAPR)
159:         external
160:         pure
161:         returns (uint256)
162:     { // <= FOUND

```
['[229](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L229-L229)']
```solidity
225:     function aTokenBalanceOf(State storage state, IAToken aToken, address account, bool variable)
226:         public
227:         view
228:         returns (uint256)
229:     { // <= FOUND

```
['[265](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L265-L265)']
```solidity
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken)
265:     { // <= FOUND

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L37-L37)']
```solidity
33:     function proxy(address target, bytes memory data, uint256 value)
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData)
37:     { // <= FOUND

```
['[50](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L50-L50)']
```solidity
46:     function proxy(address[] memory targets, bytes[] memory datas)
47:         public
48:         onlyOwner
49:         returns (bytes[] memory returnDatas)
50:     { // <= FOUND

```


</details>

## [NonCritical-97] ERC777 tokens can introduce reentrancy risks

### Resolution 
ERC777 is an advanced token standard that introduces hooks, allowing operators to execute additional logic during transfers. While this feature offers greater flexibility, it also opens up the possibility of reentrancy attacks. Specifically, when tokens are sent, the receiving contract's `tokensReceived` hook gets called, and this external call can execute arbitrary code. An attacker can exploit this feature to re-enter the original function, potentially leading to double-spending or other types of financial manipulation.

To mitigate reentrancy risks with ERC777, it's crucial to adopt established security measures, such as utilizing reentrancy guards or following the check-effects-interactions pattern. Some developers opt to stick with the simpler ERC20 standard, which does not have these hooks, to minimize this risk. If you do choose to use ERC777, extreme caution and thorough auditing are advised to secure against potential reentrancy vulnerabilities.

Num of instances: 8

### Findings 


<details><summary>Click to show findings</summary>

['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L48-L64)']
```solidity
48:     function chargeRepayFeeInCollateral(
49:         State storage state,
50:         DebtPosition storage debtPosition,
51:         uint256 repayAmount,
52:         bool isEarlyRepay
53:     ) public returns (uint256 repayFee) {
54:         repayFee = Math.mulDivDown(debtPosition.repayFee, repayAmount, debtPosition.faceValue);
55:         uint256 repayFeeCollateral;
56: 
57:         if (isEarlyRepay) {
58:             uint256 earlyRepayFee = debtPosition.earlyRepayFee();
59:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, earlyRepayFee);
60:         } else {
61:             repayFeeCollateral = debtTokenAmountToCollateralTokenAmount(state, repayFee);
62:         }
63: 
64:         state.data.collateralToken.transferFrom(debtPosition.borrower, state.feeConfig.feeRecipient, repayFeeCollateral); // <= FOUND
65: 
66:         state.data.debtToken.burn(debtPosition.borrower, repayFee);
67:     }

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L15-L17)']
```solidity
15:     function depositUnderlyingCollateralToken(State storage state, address from, address to, uint256 amount) external { // <= FOUND
16:         IERC20Metadata underlyingCollateralToken = IERC20Metadata(state.data.underlyingCollateralToken);
17:         underlyingCollateralToken.transferFrom(from, address(this), amount); // <= FOUND
18:         state.data.collateralToken.mint(to, amount);
19:     }

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L62-L95)']
```solidity
62:     function _executeLiquidateTakeCollateral(
63:         State storage state,
64:         DebtPosition memory debtPositionCopy,
65:         bool splitCollateralRemainder
66:     ) private returns (uint256 liquidatorProfitCollateralToken) {
67:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
68:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPositionCopy.faceValue);
69: 
70:         
71:         if (assignedCollateral > debtInCollateralToken) {
72:             liquidatorProfitCollateralToken = debtInCollateralToken;
73: 
74:             if (splitCollateralRemainder) {
75:                 
76:                 uint256 collateralRemainder = assignedCollateral - debtInCollateralToken;
77: 
78:                 uint256 collateralRemainderToLiquidator =
79:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitLiquidatorPercent, PERCENT);
80:                 uint256 collateralRemainderToProtocol =
81:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitProtocolPercent, PERCENT);
82: 
83:                 liquidatorProfitCollateralToken += collateralRemainderToLiquidator;
84:                 state.data.collateralToken.transferFrom( // <= FOUND
85:                     debtPositionCopy.borrower, state.feeConfig.feeRecipient, collateralRemainderToProtocol
86:                 );
87:             }
88:             
89:         } else {
90:             
91:             liquidatorProfitCollateralToken = assignedCollateral;
92:         }
93: 
94:         state.transferBorrowATokenFixed(msg.sender, address(this), debtPositionCopy.faceValue);
95:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken); // <= FOUND
96:     }

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L98-L112)']
```solidity
98:     function _executeLiquidateOverdue(
99:         State storage state,
100:         LiquidateParams calldata params,
101:         DebtPosition memory debtPositionCopy
102:     ) private returns (uint256 liquidatorProfitCollateralToken) {
103:         
104:         try state.moveDebtPositionToVariablePool(debtPositionCopy) returns (uint256 _liquidatorProfitCollateralToken) {
105:             emit Events.LiquidateOverdueMoveToVariablePool(params.debtPositionId);
106:             liquidatorProfitCollateralToken = _liquidatorProfitCollateralToken;
107:             
108:         } catch {
109:             emit Events.LiquidateOverdueNoSplitRemainder(params.debtPositionId);
110:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, false)
111:                 + state.feeConfig.collateralOverdueTransferFee;
112:             state.data.collateralToken.transferFrom( // <= FOUND
113:                 debtPositionCopy.borrower, msg.sender, state.feeConfig.collateralOverdueTransferFee
114:             );
115:         }
116:     }

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L31-L31)']
```solidity
31:     function transferFrom(address from, address to, uint256 value) public virtual override onlyOwner returns (bool) { // <= FOUND
32:         _transfer(from, to, value);
33:         return true;
34:     }

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L52-L65)']
```solidity
52:     function executeSelfLiquidate(State storage state, SelfLiquidateParams calldata params) external { // <= FOUND
53:         emit Events.SelfLiquidate(params.creditPositionId);
54: 
55:         CreditPosition storage creditPosition = state.data.creditPositions[params.creditPositionId];
56:         DebtPosition storage debtPosition = state.getDebtPositionByCreditPositionId(params.creditPositionId);
57: 
58:         uint256 credit = creditPosition.credit;
59:         uint256 repayFee = state.chargeRepayFeeInCollateral(debtPosition, credit);
60:         uint256 assignedCollateral = state.getCreditPositionProRataAssignedCollateral(creditPosition);
61:         debtPosition.updateRepayFee(credit, repayFee);
62:         creditPosition.credit = 0;
63: 
64:         state.data.debtToken.burn(debtPosition.borrower, credit);
65:         state.data.collateralToken.transferFrom(debtPosition.borrower, msg.sender, assignedCollateral); // <= FOUND
66:     }

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L44-L53)']
```solidity
44:     function depositUnderlyingTokenToVariablePool(
45:         State storage state,
46:         IERC20Metadata underlyingToken,
47:         address from,
48:         address to,
49:         uint256 amount,
50:         bool variable,
51:         bool setUseReserveAsCollateral
52:     ) external {
53:         underlyingToken.safeTransferFrom(from, address(this), amount); // <= FOUND
54: 
55:         Vault vaultTo = variable ? state.getVaultVariable(to) : state.getVaultFixed(to);
56: 
57:         underlyingToken.forceApprove(address(state.data.variablePool), amount);
58:         state.data.variablePool.supply(address(underlyingToken), amount, address(vaultTo), 0);
59: 
60:         
61:         if (setUseReserveAsCollateral) {
62:             
63:             vaultTo.proxy(
64:                 address(state.data.variablePool),
65:                 abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(underlyingToken), true))
66:             );
67:         }
68:     }

```
['[262](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L262-L270)']
```solidity
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken)
265:     {
266:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
267: 
268:         
269:         liquidatorProfitCollateralToken = state.feeConfig.collateralOverdueTransferFee;
270:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken); // <= FOUND
271: 
272:         address from = debtPositionCopy.borrower;
273:         address to = address(this);
274:         uint256 collateralBalance = assignedCollateral - liquidatorProfitCollateralToken;
275:         uint256 borrowATokenBalance = debtPositionCopy.faceValue;
276: 
277:         
278:         Vault vaultFrom = state.getVaultVariable(from);
279:         Vault vaultTo = state.getVaultFixed(to);
280: 
281:         
282:         state.withdrawUnderlyingCollateralToken(from, address(this), collateralBalance);
283: 
284:         
285:         state.data.underlyingCollateralToken.forceApprove(address(state.data.variablePool), collateralBalance);
286:         state.data.variablePool.supply(
287:             address(state.data.underlyingCollateralToken), collateralBalance, address(vaultFrom), 0
288:         );
289: 
290:         address[] memory targets = new address[](3);
291:         bytes[] memory data = new bytes[](3);
292: 
293:         
294:         targets[0] = address(state.data.variablePool);
295:         data[0] =
296:             abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(state.data.underlyingCollateralToken), true));
297: 
298:         
299:         targets[1] = address(state.data.variablePool);
300:         data[1] = abi.encodeCall(
301:             IPool.borrow,
302:             (
303:                 address(state.data.underlyingBorrowToken),
304:                 borrowATokenBalance,
305:                 uint256(DataTypes.InterestRateMode.VARIABLE),
306:                 0,
307:                 address(vaultFrom)
308:             )
309:         );
310: 
311:         
312:         targets[2] = address(state.data.underlyingBorrowToken);
313:         data[2] = abi.encodeCall(IERC20.transfer, (address(this), borrowATokenBalance));
314: 
315:         
316:         vaultFrom.proxy(targets, data);
317: 
318:         
319:         state.data.underlyingBorrowToken.forceApprove(address(state.data.variablePool), borrowATokenBalance);

```


</details>

## [Gas-1] Public functions not used internally can be marked as external to save gas

### Resolution 
Public functions that aren't used internally in Solidity contracts should be made external to optimize gas usage and improve contract efficiency. External functions can only be called from outside the contract, and their arguments are directly read from the calldata, which is more gas-efficient than loading them into memory, as is the case for public functions. By using external visibility, developers can reduce gas consumption for external calls and ensure that the contract operates more cost-effectively for users. Moreover, setting the appropriate visibility level for functions also enhances code readability and maintainability, promoting a more secure and well-structured contract design.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L64-L64)']
```solidity
64:     function dataParams(State storage state) public view returns (InitializeDataParams memory) 

```


</details>

## [Gas-2] Usage of smaller uint/int types causes overhead

### Resolution 
When using a smaller int/uint type it first needs to be converted to it's 258 bit counterpart to be operated, this increases the gass cost and thus should be avoided. However it does make sense to use smaller int/uint values within structs provided you pack the struct properly.

Num of instances: 15

### Findings 


<details><summary>Click to show findings</summary>

['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L8-L8)']
```solidity
8:     function amountToWad(uint256 amount, uint8 decimals) internal pure returns (uint256) { // <= FOUND
9:         return amount * 10 ** (18 - decimals);
10:     }

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L12-L12)']
```solidity
12:     function wadToAmountDown(uint256 wad, uint8 decimals) internal pure returns (uint256) { // <= FOUND
13:         
14:         return wad / 10 ** (18 - decimals);
15:     }

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L65-L65)']
```solidity
65:     function _scalePrice(uint256 _price, uint8 _priceDecimals, uint8 _decimals) internal pure returns (uint256) { // <= FOUND
66:         if (_priceDecimals < _decimals) {
67:             return _price * (10 ** uint256(_decimals - _priceDecimals));
68:         } else if (_priceDecimals > _decimals) {
69:             return _price / (10 ** uint256(_priceDecimals - _decimals));
70:         } else {
71:             return _price;
72:         }
73:     }

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L13-L13)']
```solidity
13: uint8 internal immutable _decimals; // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L21-L21)']
```solidity
21: uint8 public immutable baseDecimals; // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L23-L23)']
```solidity
23: uint8 public immutable quoteDecimals; // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L24-L24)']
```solidity
24: uint8 public immutable decimals; // <= FOUND

```
['[73](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L73-L73)']
```solidity
73: error INVALID_DECIMALS(uint8 decimals); // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L28-L29)']
```solidity
28:     function setStaleRateInterval(uint64 _staleRateInterval) external onlyOwner { // <= FOUND
29:         uint64 oldStaleRateInterval = staleRateInterval; // <= FOUND
30:         staleRateInterval = _staleRateInterval;
31:         emit StaleRateIntervalUpdated(oldStaleRateInterval, _staleRateInterval);
32:     }

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L14-L14)']
```solidity
14: uint64 internal marketBorrowRateUpdatedAt; // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L15-L15)']
```solidity
15: uint64 internal staleRateInterval; // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L34-L35)']
```solidity
34:     function setMarketBorrowRate(uint128 _marketBorrowRate) external onlyOwner { // <= FOUND
35:         uint128 oldMarketBorrowRate = marketBorrowRate; // <= FOUND
36:         marketBorrowRate = _marketBorrowRate;
37:         marketBorrowRateUpdatedAt = uint64(block.timestamp);
38:         emit MarketBorrowRateUpdated(oldMarketBorrowRate, _marketBorrowRate);
39:     }

```
['[75](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L75-L75)']
```solidity
62:     function getRatePerMaturityByDueDate(
63:         uint256 maturity,
64:         int256 apr,
65:         uint256 marketRateMultiplier,
66:         IMarketBorrowRateFeed marketBorrowRateFeed
67:     ) internal view returns (uint256) {
68:         
69: 
70:         int256 ratePerMaturity = Math.linearAPRToRatePerMaturity(apr, maturity);
71: 
72:         if (marketRateMultiplier == 0) {
73:             return SafeCast.toUint256(ratePerMaturity);
74:         } else {
75:             uint128 marketRateCompound = marketBorrowRateFeed.getMarketBorrowRate(); // <= FOUND
76:             uint256 marketRateLinear = Math.compoundAPRToRatePerMaturity(marketRateCompound, maturity);
77:             return SafeCast.toUint256(
78:                 ratePerMaturity + SafeCast.toInt256(Math.mulDivDown(marketRateLinear, marketRateMultiplier, PERCENT))
79:             );
80:         }
81:     }

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L13-L13)']
```solidity
13: uint128 internal marketBorrowRate; // <= FOUND

```
['[78](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L78-L78)']
```solidity
78: error STALE_RATE(uint128 updatedAt); // <= FOUND

```


</details>

## [Gas-3] Use != 0 instead of > 0

### Resolution 
Replace spotted instances with != 0 for uints as this uses less gas

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L36-L36)']
```solidity
36:         if (debt > 0) { // <= FOUND

```
['[160](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L160-L160)']
```solidity
160:         if (debtPositionFaceValue > 0) { // <= FOUND

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L59-L59)']
```solidity
59:             if (amount > 0) { // <= FOUND

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L39-L39)']
```solidity
39:         for (uint256 i = self.maturities.length; i > 0; i--) { // <= FOUND

```


</details>

## [Gas-4] Integer increments by one can be unchecked to save on gas fees

### Resolution 
Using unchecked increments in Solidity can save on gas fees by bypassing built-in overflow checks, thus optimizing gas usage, but requires careful assessment of potential risks and edge cases to avoid unintended consequences.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[102](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L102-L110)']
```solidity
83:     function createDebtAndCreditPositions(
84:         State storage state,
85:         address lender,
86:         address borrower,
87:         uint256 issuanceValue,
88:         uint256 faceValue,
89:         uint256 dueDate
90:     ) external returns (DebtPosition memory debtPosition, CreditPosition memory creditPosition) {
91:         debtPosition = DebtPosition({
92:             lender: lender,
93:             borrower: borrower,
94:             issuanceValue: issuanceValue,
95:             faceValue: faceValue,
96:             repayFee: LoanLibrary.repayFee(issuanceValue, block.timestamp, dueDate, state.feeConfig.repayFeeAPR),
97:             startDate: block.timestamp,
98:             dueDate: dueDate,
99:             liquidityIndexAtRepayment: 0
100:         });
101: 
102:         uint256 debtPositionId = state.data.nextDebtPositionId++; // <= FOUND
103:         state.data.debtPositions[debtPositionId] = debtPosition;
104: 
105:         emit Events.CreateDebtPosition(debtPositionId, lender, borrower, issuanceValue, faceValue, dueDate);
106: 
107:         creditPosition =
108:             CreditPosition({lender: lender, credit: debtPosition.faceValue, debtPositionId: debtPositionId});
109: 
110:         uint256 creditPositionId = state.data.nextCreditPositionId++; // <= FOUND
111:         state.data.creditPositions[creditPositionId] = creditPosition;
112:         state.validateMinimumCreditOpening(creditPosition.credit);
113: 
114:         emit Events.CreateCreditPosition(creditPositionId, lender, RESERVED_ID, debtPositionId, creditPosition.credit);
115:     }

```
['[126](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L126-L126)']
```solidity
117:     function createCreditPosition(State storage state, uint256 exitCreditPositionId, address lender, uint256 credit)
118:         external
119:         returns (CreditPosition memory creditPosition)
120:     {
121:         uint256 debtPositionId = state.getDebtPositionIdByCreditPositionId(exitCreditPositionId);
122:         CreditPosition storage exitPosition = state.data.creditPositions[exitCreditPositionId];
123: 
124:         creditPosition = CreditPosition({lender: lender, credit: credit, debtPositionId: debtPositionId});
125: 
126:         uint256 creditPositionId = state.data.nextCreditPositionId++; // <= FOUND
127:         state.data.creditPositions[creditPositionId] = creditPosition;
128: 
129:         exitPosition.credit -= credit;
130:         state.validateMinimumCredit(exitPosition.credit);
131:         state.validateMinimumCreditOpening(creditPosition.credit);
132: 
133:         emit Events.CreateCreditPosition(creditPositionId, lender, exitCreditPositionId, debtPositionId, credit);
134:     }

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L85-L85)']
```solidity
41:     function validateBorrowAsMarketOrder(State storage state, BorrowAsMarketOrderParams memory params) external view {
42:         User memory lenderUser = state.data.users[params.lender];
43:         LoanOffer memory loanOffer = lenderUser.loanOffer;
44: 
45:         
46:         
47: 
48:         
49:         if (loanOffer.isNull()) {
50:             revert Errors.INVALID_LOAN_OFFER(params.lender);
51:         }
52: 
53:         
54:         if (params.amount == 0) {
55:             revert Errors.NULL_AMOUNT();
56:         }
57: 
58:         
59:         if (params.dueDate < block.timestamp) {
60:             revert Errors.PAST_DUE_DATE(params.dueDate);
61:         }
62:         if (params.dueDate > loanOffer.maxDueDate) {
63:             revert Errors.DUE_DATE_GREATER_THAN_MAX_DUE_DATE(params.dueDate, loanOffer.maxDueDate);
64:         }
65: 
66:         
67:         if (params.deadline < block.timestamp) {
68:             revert Errors.PAST_DEADLINE(params.deadline);
69:         }
70: 
71:         
72:         uint256 ratePerMaturity =
73:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
74:         uint256 maturity = params.dueDate - block.timestamp;
75:         if (Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity) > params.maxAPR) {
76:             revert Errors.APR_GREATER_THAN_MAX_APR(
77:                 Math.ratePerMaturityToLinearAPR(ratePerMaturity, maturity), params.maxAPR
78:             );
79:         }
80: 
81:         
82:         
83: 
84:         
85:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) { // <= FOUND
86:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
87: 
88:             CreditPosition memory creditPosition = state.getCreditPosition(creditPositionId);
89:             DebtPosition memory debtPosition = state.getDebtPositionByCreditPositionId(creditPositionId);
90: 
91:             if (msg.sender != creditPosition.lender) {
92:                 revert Errors.BORROWER_IS_NOT_LENDER(msg.sender, creditPosition.lender);
93:             }
94:             if (params.dueDate < debtPosition.dueDate) {
95:                 revert Errors.DUE_DATE_LOWER_THAN_DEBT_POSITION_DUE_DATE(params.dueDate, debtPosition.dueDate);
96:             }
97:         }
98:     }

```
['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L128-L128)']
```solidity
111:     function _borrowFromCredit(State storage state, BorrowAsMarketOrderParams memory params)
112:         internal
113:         returns (uint256 amountOutLeft)
114:     {
115:         
116:         
117: 
118:         User storage lenderUser = state.data.users[params.lender];
119: 
120:         LoanOffer storage loanOffer = lenderUser.loanOffer;
121: 
122:         uint256 ratePerMaturity =
123:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
124: 
125:         amountOutLeft =
126:             params.exactAmountIn ? Math.mulDivDown(params.amount, PERCENT, PERCENT + ratePerMaturity) : params.amount;
127: 
128:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) { // <= FOUND
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) {
135:                 deltaAmountIn = creditPosition.credit;
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity);
137:             }
138: 
139:             
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) {
141:                 continue;
142:             }
143:             
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             
149:             state.createCreditPosition({
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee
157:             );
158:             amountOutLeft -= deltaAmountOut;
159:         }
160:     }

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L57-L57)']
```solidity
46:     function proxy(address[] memory targets, bytes[] memory datas)
47:         public
48:         onlyOwner
49:         returns (bytes[] memory returnDatas)
50:     {
51:         if (targets.length != datas.length) {
52:             revert Errors.ARRAY_LENGTHS_MISMATCH();
53:         }
54: 
55:         returnDatas = new bytes[](datas.length);
56:         bool success;
57:         for (uint256 i = 0; i < targets.length; i++) { // <= FOUND
58:             if (targets[i] == address(0)) {
59:                 revert Errors.NULL_ADDRESS();
60:             }
61:             
62:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]);
63:             Address.verifyCallResult(success, returnDatas[i]);
64:         }
65:     }

```


</details>

## [Gas-5] Default int values are manually reset

### Resolution 
Using .delete is better than resetting a Solidity variable to its default value manually because it frees up storage space on the Ethereum blockchain, resulting in gas cost savings.

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L62-L62)']
```solidity
62:         creditPosition.credit = 0; // <= FOUND

```
['[120](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L120-L120)']
```solidity
120:         debtPosition.liquidityIndexAtRepayment = 0; // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L58-L58)']
```solidity
58:         low = 0; // <= FOUND

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L85-L89)']
```solidity
85:         
86:         
87: 
88:         
89:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) { // <= FOUND

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L85-L85)']
```solidity
85:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) { // <= FOUND

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L57-L57)']
```solidity
57:         for (uint256 i = 0; i < targets.length; i++) { // <= FOUND

```


</details>

## [Gas-6] Use assembly to check for the zero address

### Resolution 

Using assembly for address comparisons in Solidity can save gas because it allows for more direct access to the Ethereum Virtual Machine (EVM), reducing the overhead of higher-level operations. Solidity's high-level abstraction simplifies coding but can introduce additional gas costs. Using assembly for simple operations like address comparisons can be more gas-efficient.

Num of instances: 13

### Findings 


<details><summary>Click to show findings</summary>

['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L19-L24)']
```solidity
19:     function validateBorrowVariable(State storage, BorrowVariableParams calldata params) external pure {
20:         
21:         
22: 
23:         
24:         if (params.to == address(0)) { // <= FOUND
25:             revert Errors.NULL_ADDRESS();
26:         }
27: 
28:         
29:         if (params.amount == 0) {
30:             revert Errors.NULL_AMOUNT();
31:         }
32:     }

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L27-L45)']
```solidity
27:     function validateDeposit(State storage state, DepositParams calldata params) external view {
28:         
29:         
30: 
31:         
32:         if (
33:             params.token != address(state.data.underlyingCollateralToken)
34:                 && params.token != address(state.data.underlyingBorrowToken)
35:         ) {
36:             revert Errors.INVALID_TOKEN(params.token);
37:         }
38: 
39:         
40:         if (params.amount == 0) {
41:             revert Errors.NULL_AMOUNT();
42:         }
43: 
44:         
45:         if (params.to == address(0)) { // <= FOUND
46:             revert Errors.NULL_ADDRESS();
47:         }
48: 
49:         
50:         
51:     }

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L59-L60)']
```solidity
59:     function validateOwner(address owner) internal pure {
60:         if (owner == address(0)) { // <= FOUND
61:             revert Errors.NULL_ADDRESS();
62:         }
63:     }

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L65-L79)']
```solidity
65:     function validateInitializeFeeConfigParams(InitializeFeeConfigParams memory f) internal pure {
66:         
67:         
68: 
69:         
70:         
71: 
72:         
73:         
74: 
75:         
76:         
77: 
78:         
79:         if (f.feeRecipient == address(0)) { // <= FOUND
80:             revert Errors.NULL_ADDRESS();
81:         }
82:     }

```
['[138](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L138-L146)']
```solidity
138:     function validateInitializeOracleParams(InitializeOracleParams memory o) internal view {
139:         
140:         if (o.priceFeed == address(0)) { // <= FOUND
141:             revert Errors.NULL_ADDRESS();
142:         }
143:         IPriceFeed(o.priceFeed).getPrice();
144: 
145:         
146:         if (o.marketBorrowRateFeed == address(0)) { // <= FOUND
147:             revert Errors.NULL_ADDRESS();
148:         }
149:         IMarketBorrowRateFeed(o.marketBorrowRateFeed).getMarketBorrowRate();
150:     }

```
['[152](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L152-L164)']
```solidity
152:     function validateInitializeDataParams(InitializeDataParams memory d) internal pure {
153:         
154:         if (d.underlyingCollateralToken == address(0)) { // <= FOUND
155:             revert Errors.NULL_ADDRESS();
156:         }
157: 
158:         
159:         if (d.underlyingBorrowToken == address(0)) { // <= FOUND
160:             revert Errors.NULL_ADDRESS();
161:         }
162: 
163:         
164:         if (d.variablePool == address(0)) { // <= FOUND
165:             revert Errors.NULL_ADDRESS();
166:         }
167:     }

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L19-L24)']
```solidity
19:     function validateLiquidateVariable(State storage, LiquidateVariableParams calldata params) external pure {
20:         
21:         
22: 
23:         
24:         if (params.borrower == address(0)) { // <= FOUND
25:             revert Errors.NULL_ADDRESS();
26:         }
27: 
28:         
29:         if (params.amount == 0) {
30:             revert Errors.NULL_AMOUNT();
31:         }
32:     }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L25-L26)']
```solidity
25:     function getVaultFixed(State storage state, address user) public returns (Vault) {
26:         if (address(state.data.users[user].vaultFixed) != address(0)) { // <= FOUND
27:             return state.data.users[user].vaultFixed;
28:         }
29:         Vault vault = Vault(payable(Clones.clone(address(state.data.vaultImplementation))));
30:         emit Events.CreateVault(user, address(vault), false);
31:         vault.initialize(address(this));
32:         state.data.users[user].vaultFixed = vault;
33:         state.data.variablePoolAllowlisted[address(vault)] = true;
34:         return vault;
35:     }

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L43-L44)']
```solidity
43:     function getVaultVariable(State storage state, address user) public returns (Vault) {
44:         if (address(state.data.users[user].vaultVariable) != address(0)) { // <= FOUND
45:             return state.data.users[user].vaultVariable;
46:         }
47:         Vault vault = Vault(payable(Clones.clone(address(state.data.vaultImplementation))));
48:         emit Events.CreateVault(user, address(vault), true);
49:         vault.initialize(address(this));
50:         state.data.users[user].vaultVariable = vault;
51:         state.data.variablePoolAllowlisted[address(vault)] = true;
52:         return vault;
53:     }

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L24-L25)']
```solidity
24:     function proxy(address target, bytes memory data) public onlyOwner returns (bytes memory returnData) {
25:         if (target == address(0)) { // <= FOUND
26:             revert Errors.NULL_ADDRESS();
27:         }
28:         bool success;
29:         (success, returnData) = address(target).call(data);
30:         Address.verifyCallResult(success, returnData);
31:     }

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L33-L38)']
```solidity
33:     function proxy(address target, bytes memory data, uint256 value)
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData)
37:     {
38:         if (target == address(0)) { // <= FOUND
39:             revert Errors.NULL_ADDRESS();
40:         }
41:         bool success;
42:         (success, returnData) = address(target).call{value: value}(data);
43:         Address.verifyCallResult(success, returnData);
44:     }

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L46-L58)']
```solidity
46:     function proxy(address[] memory targets, bytes[] memory datas)
47:         public
48:         onlyOwner
49:         returns (bytes[] memory returnDatas)
50:     {
51:         if (targets.length != datas.length) {
52:             revert Errors.ARRAY_LENGTHS_MISMATCH();
53:         }
54: 
55:         returnDatas = new bytes[](datas.length);
56:         bool success;
57:         for (uint256 i = 0; i < targets.length; i++) {
58:             if (targets[i] == address(0)) { // <= FOUND
59:                 revert Errors.NULL_ADDRESS();
60:             }
61:             
62:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]);
63:             Address.verifyCallResult(success, returnDatas[i]);
64:         }
65:     }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L25-L43)']
```solidity
25:     function validateWithdraw(State storage state, WithdrawParams calldata params) external view {
26:         
27:         
28: 
29:         
30:         if (
31:             params.token != address(state.data.underlyingCollateralToken)
32:                 && params.token != address(state.data.underlyingBorrowToken)
33:         ) {
34:             revert Errors.INVALID_TOKEN(params.token);
35:         }
36: 
37:         
38:         if (params.amount == 0) {
39:             revert Errors.NULL_AMOUNT();
40:         }
41: 
42:         
43:         if (params.to == address(0)) { // <= FOUND
44:             revert Errors.NULL_ADDRESS();
45:         }
46: 
47:         
48:         
49:     }

```


</details>

## [Gas-7] Divisions which do not divide by -X cannot overflow or underflow so such operations can be unchecked to save gas

### Resolution 
Make such found divisions are unchecked when ensured it is safe to do so

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L14-L14)']
```solidity
12:     function wadToAmountDown(uint256 wad, uint8 decimals) internal pure returns (uint256) {
13:         
14:         return wad / 10 ** (18 - decimals); // <= FOUND
15:     }

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L19-L19)']
```solidity
17:     function rayToWadDown(uint256 ray) internal pure returns (uint256) {
18:         
19:         return ray / 1e9; // <= FOUND
20:     }

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L65-L65)']
```solidity
57:     function binarySearch(uint256[] memory array, uint256 value) internal pure returns (uint256 low, uint256 high) {
58:         low = 0;
59:         high = array.length - 1;
60:         if (value < array[low] || value > array[high]) {
61:             
62:             return (type(uint256).max, type(uint256).max);
63:         }
64:         while (low <= high) {
65:             uint256 mid = (low + high) / 2; // <= FOUND
66:             if (array[mid] == value) {
67:                 return (mid, mid);
68:             } else if (array[mid] < value) {
69:                 low = mid + 1;
70:             } else {
71:                 high = mid - 1;
72:             }
73:         }
74:         return (high, low);
75:     }

```


</details>

## [Gas-8] State variables which are not modified within functions should be set as constants or immutable for values set at deployment

### Resolution 
Set state variables listed below as constant or immutable for values set at deployment. Ensure it is safe to do so

Num of instances: 56

### Findings 


<details><summary>Click to show findings</summary>

['[8](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L8-L8)']
```solidity
8: error USER_IS_LIQUIDATABLE(address account, uint256 cr); // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L15-L15)']
```solidity
15: error MATURITY_BELOW_MINIMUM_MATURITY(uint256 maturity, uint256 minimumMaturity); // <= FOUND

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L17-L17)']
```solidity
17: error INVALID_TOKEN(address token); // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L18-L18)']
```solidity
18: error INVALID_KEY(bytes32 key); // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L19-L19)']
```solidity
19: error INVALID_COLLATERAL_RATIO(uint256 cr); // <= FOUND

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L20-L20)']
```solidity
20: error INVALID_COLLATERAL_PERCENTAGE_PREMIUM(uint256 percentage); // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L21-L21)']
```solidity
21: error INVALID_COLLATERAL_PERCENTAGE_PREMIUM_SUM(uint256 sum); // <= FOUND

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L22-L22)']
```solidity
22: error INVALID_LIQUIDATION_COLLATERAL_RATIO(uint256 crOpening, uint256 crLiquidation); // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L23-L23)']
```solidity
23: error PAST_DUE_DATE(uint256 dueDate); // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L24-L24)']
```solidity
24: error PAST_DEADLINE(uint256 deadline); // <= FOUND

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L25-L25)']
```solidity
25: error PAST_MAX_DUE_DATE(uint256 maxDueDate); // <= FOUND

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L26-L26)']
```solidity
26: error APR_LOWER_THAN_MIN_APR(uint256 apr, uint256 minAPR); // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L27-L27)']
```solidity
27: error APR_GREATER_THAN_MAX_APR(uint256 apr, uint256 maxAPR); // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L28-L28)']
```solidity
28: error DUE_DATE_LOWER_THAN_DEBT_POSITION_DUE_DATE(uint256 dueDate, uint256 debtPositionDueDate); // <= FOUND

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L29-L29)']
```solidity
29: error DUE_DATE_NOT_COMPATIBLE(uint256 debtPositionIdToRepay, uint256 creditPositionIdToCompensate); // <= FOUND

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L30-L30)']
```solidity
30: error DUE_DATE_GREATER_THAN_MAX_DUE_DATE(uint256 dueDate, uint256 maxDueDate); // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L31-L31)']
```solidity
31: error MATURITY_OUT_OF_RANGE(uint256 maturity, uint256 minMaturity, uint256 maxMaturity); // <= FOUND

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L32-L32)']
```solidity
32: error INVALID_POSITION_ID(uint256 positionId); // <= FOUND

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L35-L35)']
```solidity
35: error INVALID_LENDER(address account); // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L36-L36)']
```solidity
36: error INVALID_LOAN_OFFER(address lender); // <= FOUND

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L37-L37)']
```solidity
37: error INVALID_BORROW_OFFER(address borrower); // <= FOUND

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L39-L39)']
```solidity
39: error BORROWER_IS_NOT_LENDER(address borrower, address lender); // <= FOUND

```
['[40](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L40-L40)']
```solidity
40: error COMPENSATOR_IS_NOT_BORROWER(address compensator, address borrower); // <= FOUND

```
['[41](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L41-L41)']
```solidity
41: error LIQUIDATOR_IS_NOT_LENDER(address liquidator, address lender); // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L42-L42)']
```solidity
42: error EXITER_IS_NOT_BORROWER(address exiter, address borrower); // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L43-L43)']
```solidity
43: error REPAYER_IS_NOT_BORROWER(address repayer, address borrower); // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L45-L45)']
```solidity
45: error NOT_ENOUGH_ATOKEN_BALANCE(address token, address account, bool variable, uint256 balance, uint256 required); // <= FOUND

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L46-L46)']
```solidity
46: error NOT_ENOUGH_BORROW_ATOKEN_LIQUIDITY(uint256 liquidity, uint256 required); // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L47-L47)']
```solidity
47: error CREDIT_LOWER_THAN_MINIMUM_CREDIT(uint256 faceValue, uint256 minimumCreditBorrowAToken); // <= FOUND

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L48-L48)']
```solidity
48: error CREDIT_LOWER_THAN_MINIMUM_CREDIT_OPENING(uint256 faceValue, uint256 minimumCreditBorrowAToken); // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L49-L49)']
```solidity
49: error CREDIT_LOWER_THAN_AMOUNT_TO_COMPENSATE(uint256 credit, uint256 amountToCompensate); // <= FOUND

```
['[51](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L51-L51)']
```solidity
51: error ONLY_DEBT_POSITION_CAN_BE_REPAID(uint256 positionId); // <= FOUND

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L52-L52)']
```solidity
52: error ONLY_DEBT_POSITION_CAN_BE_EXITED(uint256 positionId); // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L53-L53)']
```solidity
53: error ONLY_DEBT_POSITION_CAN_BE_LIQUIDATED(uint256 positionId); // <= FOUND

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L54-L54)']
```solidity
54: error ONLY_CREDIT_POSITION_CAN_BE_CLAIMED(uint256 positionId); // <= FOUND

```
['[55](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L55-L55)']
```solidity
55: error ONLY_CREDIT_POSITION_CAN_BE_COMPENSATED(uint256 positionId); // <= FOUND

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L56-L56)']
```solidity
56: error ONLY_CREDIT_POSITION_CAN_BE_SELF_LIQUIDATED(uint256 positionId); // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L58-L58)']
```solidity
58: error CREDIT_POSITION_ALREADY_CLAIMED(uint256 positionId); // <= FOUND

```
['[60](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L60-L60)']
```solidity
60: error LOAN_ALREADY_REPAID(uint256 positionId); // <= FOUND

```
['[61](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L61-L61)']
```solidity
61: error LOAN_NOT_REPAID(uint256 positionId); // <= FOUND

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L62-L62)']
```solidity
62: error LOAN_NOT_ACTIVE(uint256 positionId); // <= FOUND

```
['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L64-L64)']
```solidity
64: error NOT_LIQUIDATABLE(address account); // <= FOUND

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L65-L65)']
```solidity
65: error LOAN_NOT_LIQUIDATABLE(uint256 debtPositionId, uint256 cr, LoanStatus status); // <= FOUND

```
['[66](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L66-L66)']
```solidity
66: error LOAN_NOT_SELF_LIQUIDATABLE(uint256 creditPositionId, uint256 cr, LoanStatus status); // <= FOUND

```
[]
```solidity
error LIQUIDATE_PROFIT_BELOW_MINIMUM_COLLATERAL_PROFIT(         uint256 liquidatorProfitCollateralToken, uint256 minimumCollateralProfit     ); // <= FOUND

```
['[70](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L70-L70)']
```solidity
70: error CR_BELOW_OPENING_LIMIT_BORROW_CR(address account, uint256 collateralRatio, uint256 riskCollateralRatio); // <= FOUND

```
['[71](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L71-L71)']
```solidity
71: error LIQUIDATION_NOT_AT_LOSS(uint256 positionId, uint256 assignedCollateral, uint256 debtCollateral); // <= FOUND

```
['[73](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L73-L73)']
```solidity
73: error INVALID_DECIMALS(uint8 decimals); // <= FOUND

```
['[74](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L74-L74)']
```solidity
74: error INVALID_PRICE(address aggregator, int256 price); // <= FOUND

```
['[75](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L75-L75)']
```solidity
75: error STALE_PRICE(address aggregator, uint256 updatedAt); // <= FOUND

```
['[78](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L78-L78)']
```solidity
78: error STALE_RATE(uint128 updatedAt); // <= FOUND

```
['[80](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L80-L80)']
```solidity
80: error INVALID_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(uint256 moveToVariablePoolHFThreshold); // <= FOUND

```
[]
```solidity
error HEALTH_FACTOR_BELOW_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(         address account, uint256 healthFactor, uint256 moveToVariablePoolHFThreshold     ); // <= FOUND

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L85-L85)']
```solidity
85: error COLLATERAL_TOKEN_CAP_EXCEEDED(uint256 cap, uint256 amount); // <= FOUND

```
['[86](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L86-L86)']
```solidity
86: error BORROW_ATOKEN_CAP_EXCEEDED(uint256 cap, uint256 amount); // <= FOUND

```
['[87](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L87-L87)']
```solidity
87: error DEBT_TOKEN_CAP_EXCEEDED(uint256 cap, uint256 amount); // <= FOUND

```


</details>

## [Gas-9] Divisions of powers of 2 can be replaced by a right shift operation to save gas

### Resolution 
Replace such found divisions with right shift operations when ensured it is safe to do so. NOTE: This only applies to uint variables!

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L11-L11)']
```solidity
11: uint256 constant CREDIT_POSITION_ID_START = type(uint256).max / 2; // <= FOUND

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L65-L65)']
```solidity
65:             uint256 mid = (low + high) / 2; // <= FOUND

```


</details>

## [Gas-10] Structs can be packed into fewer storage slots

### Resolution 
In Solidity, each storage slot has a size of 32 bytes. If a struct contains multiple uint values, it's efficient to pack these into as few storage slots as possible to optimize gas usage. The EVM (Ethereum Virtual Machine) charges gas for each storage operation, so minimizing the number of slots used can result in substantial gas savings. This can be achieved by ordering struct fields according to their size or by using smaller data types where possible. However, developers must balance these optimizations with the need for code clarity and the precision requirements of their application. Always ensure that data packing does not compromise the functionality or security of the contract.

Num of instances: 15

### Findings 


<details><summary>Click to show findings</summary>

['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L21-L28)']
```solidity
21: struct BorrowAsMarketOrderParams {
22:     address lender;
23:     uint256 amount; // <= FOUND
24:     uint256 dueDate; // <= FOUND
25:     uint256 deadline; // <= FOUND
26:     uint256 maxAPR; // <= FOUND
27:     bool exactAmountIn;
28:     uint256[] receivableCreditPositionIds; // <= FOUND
29: }

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L20-L24)']
```solidity
20: struct BorrowerExitParams {
21:     uint256 debtPositionId; // <= FOUND
22:     address borrowerToExitTo;
23:     uint256 deadline; // <= FOUND
24:     uint256 minAPR; // <= FOUND
25: }

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L17-L20)']
```solidity
17: struct CompensateParams {
18:     uint256 creditPositionWithDebtToRepayId; // <= FOUND
19:     uint256 creditPositionToCompensateId; // <= FOUND
20:     uint256 amount; // <= FOUND
21: }

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L22-L26)']
```solidity
22: struct InitializeFeeConfigParams {
23:     uint256 repayFeeAPR; // <= FOUND
24:     uint256 earlyLenderExitFee; // <= FOUND
25:     uint256 earlyBorrowerExitFee; // <= FOUND
26:     uint256 collateralOverdueTransferFee; // <= FOUND
27:     address feeRecipient;
28: }

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L30-L40)']
```solidity
30: struct InitializeRiskConfigParams {
31:     uint256 crOpening; // <= FOUND
32:     uint256 crLiquidation; // <= FOUND
33:     uint256 minimumCreditBorrowAToken; // <= FOUND
34:     uint256 collateralSplitLiquidatorPercent; // <= FOUND
35:     uint256 collateralSplitProtocolPercent; // <= FOUND
36:     uint256 collateralTokenCap; // <= FOUND
37:     uint256 borrowATokenCap; // <= FOUND
38:     uint256 debtTokenCap; // <= FOUND
39:     uint256 moveToVariablePoolHFThreshold; // <= FOUND
40:     uint256 minimumMaturity; // <= FOUND
41: }

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L19-L24)']
```solidity
19: struct LendAsMarketOrderParams {
20:     address borrower;
21:     uint256 dueDate; // <= FOUND
22:     uint256 amount; // <= FOUND
23:     uint256 deadline; // <= FOUND
24:     uint256 minAPR; // <= FOUND
25:     bool exactAmountIn;
26: }

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L19-L21)']
```solidity
19: struct LiquidateParams {
20:     uint256 debtPositionId; // <= FOUND
21:     uint256 minimumCollateralProfit; // <= FOUND
22: }

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L19-L24)']
```solidity
19: struct LiquidateWithReplacementParams {
20:     uint256 debtPositionId; // <= FOUND
21:     address borrower;
22:     uint256 minimumCollateralProfit; // <= FOUND
23:     uint256 deadline; // <= FOUND
24:     uint256 minAPR; // <= FOUND
25: }

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L14-L22)']
```solidity
14: struct DebtPosition {
15:     address lender;
16:     address borrower;
17:     uint256 issuanceValue;  // <= FOUND
18:     uint256 faceValue;  // <= FOUND
19:     uint256 repayFee;  // <= FOUND
20:     uint256 startDate;  // <= FOUND
21:     uint256 dueDate; // <= FOUND
22:     uint256 liquidityIndexAtRepayment;  // <= FOUND
23: }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L25-L28)']
```solidity
25: struct CreditPosition {
26:     address lender;
27:     uint256 credit; // <= FOUND
28:     uint256 debtPositionId; // <= FOUND
29: }

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L17-L21)']
```solidity
17: struct FeeConfig {
18:     uint256 repayFeeAPR;  // <= FOUND
19:     uint256 earlyLenderExitFee;  // <= FOUND
20:     uint256 earlyBorrowerExitFee;  // <= FOUND
21:     uint256 collateralOverdueTransferFee;  // <= FOUND
22:     address feeRecipient; 
23: }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L25-L35)']
```solidity
25: struct RiskConfig {
26:     uint256 crOpening;  // <= FOUND
27:     uint256 crLiquidation;  // <= FOUND
28:     uint256 minimumCreditBorrowAToken;  // <= FOUND
29:     uint256 collateralSplitLiquidatorPercent;  // <= FOUND
30:     uint256 collateralSplitProtocolPercent;  // <= FOUND
31:     uint256 collateralTokenCap;  // <= FOUND
32:     uint256 borrowATokenCap;  // <= FOUND
33:     uint256 debtTokenCap;  // <= FOUND
34:     uint256 moveToVariablePoolHFThreshold;  // <= FOUND
35:     uint256 minimumMaturity;  // <= FOUND
36: }

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L36-L44)']
```solidity
36: struct UserView {
37:     User user;
38:     address account;
39:     uint256 collateralTokenBalanceFixed; // <= FOUND
40:     uint256 collateralATokenBalanceVariable; // <= FOUND
41:     uint256 borrowATokenBalanceFixed; // <= FOUND
42:     uint256 borrowATokenBalanceVariable; // <= FOUND
43:     uint256 debtBalanceFixed; // <= FOUND
44:     uint256 debtBalanceVariable; // <= FOUND
45: }

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeView.sol#L47-L49)']
```solidity
47: struct DataView {
48:     uint256 nextDebtPositionId; // <= FOUND
49:     uint256 nextCreditPositionId; // <= FOUND
50:     IERC20Metadata underlyingCollateralToken;
51:     IERC20Metadata underlyingBorrowToken;
52:     IPool variablePool;
53:     NonTransferrableToken collateralToken;
54:     IAToken collateralAToken;
55:     IAToken borrowAToken;
56:     NonTransferrableToken debtToken;
57: }

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L9-L12)']
```solidity
9: struct YieldCurve {
10:     uint256[] maturities; // <= FOUND
11:     int256[] aprs; // <= FOUND
12:     uint256[] marketRateMultipliers; // <= FOUND
13: }

```


</details>

## [Gas-11] Private functions used once can be inlined

### Resolution 
Private functions which are only called once can be inlined to save GAS.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L98-L98)']
```solidity
98:     function _executeLiquidateOverdue( // <= FOUND
99:         State storage state,
100:         LiquidateParams calldata params,
101:         DebtPosition memory debtPositionCopy
102:     ) private returns (uint256 liquidatorProfitCollateralToken) 

```


</details>

## [Gas-12] Use bitmap to save gas

### Resolution 
Bitmaps in Solidity are essentially a way of representing a set of boolean values within an integer type variable such as `uint256`. Each bit in the integer represents a true or false value (1 or 0), thus allowing efficient storage of multiple boolean values.

Bitmaps can save gas in the Ethereum network because they condense a lot of information into a small amount of storage. In Ethereum, storage is one of the most significant costs in terms of gas usage. By reducing the amount of storage space needed, you can potentially save on gas fees.

Here's a quick comparison:

If you were to represent 256 different boolean values in the traditional way, you would have to declare 256 different `bool` variables. Given that each `bool` occupies a storage slot and each storage slot costs 20,000 gas to initialize, you would end up paying a considerable amount of gas.

On the other hand, if you were to use a bitmap, you could store these 256 boolean values within a single `uint256` variable. In other words, you'd only pay for a single storage slot, resulting in significant gas savings.

However, it's important to note that while bitmaps can provide gas efficiencies, they do add complexity to the code, making it harder to read and maintain. Also, using bitmaps is efficient only when dealing with a large number of boolean variables that are frequently changed or accessed together. 

In contrast, the straightforward counterpart to bitmaps would be using arrays or mappings to store boolean values, with each `bool` value occupying its own storage slot. This approach is simpler and more readable but could potentially be more expensive in terms of gas usage.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L33-L33)']
```solidity
33:         state.data.variablePoolAllowlisted[address(vault)] = true; // <= FOUND

```


</details>

## [Gas-13] Use assembly to emit events

### Resolution 
With the use of inline assembly in Solidity, we can take advantage of low-level features like scratch space and the free memory pointer, offering more gas-efficient ways of emitting events. The scratch space is a certain area of memory where we can temporarily store data, and the free memory pointer indicates the next available memory slot. Using these, we can efficiently assemble event data without incurring additional memory expansion costs. However, safety is paramount: to avoid overwriting or leakage, we must cache the free memory pointer before use and restore it afterward, ensuring that it points to the correct memory location post-operation.

Num of instances: 29

### Findings 


<details><summary>Click to show findings</summary>

['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L105-L105)']
```solidity
105:         emit Events.CreateDebtPosition(debtPositionId, lender, borrower, issuanceValue, faceValue, dueDate); // <= FOUND

```
['[114](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L114-L114)']
```solidity
114:         emit Events.CreateCreditPosition(creditPositionId, lender, RESERVED_ID, debtPositionId, creditPosition.credit); // <= FOUND

```
['[133](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L133-L133)']
```solidity
133:         emit Events.CreateCreditPosition(creditPositionId, lender, exitCreditPositionId, debtPositionId, credit); // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L42-L42)']
```solidity
42:         emit Events.BorrowAsLimitOrder(params.curveRelativeTime); // <= FOUND

```
['[101](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L101-L101)']
```solidity
101:         emit Events.BorrowAsMarketOrder( // <= FOUND
102:             params.lender, params.amount, params.dueDate, params.exactAmountIn, params.receivableCreditPositionIds
103:         );

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L36-L36)']
```solidity
36:         emit Events.BorrowVariable(params.to, params.amount); // <= FOUND

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L85-L85)']
```solidity
85:         emit Events.BorrowerExit(params.debtPositionId, params.borrowerToExitTo); // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L49-L49)']
```solidity
49:         emit Events.Claim(params.creditPositionId); // <= FOUND

```
['[79](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L79-L79)']
```solidity
79:         emit Events.Compensate( // <= FOUND
80:             params.creditPositionWithDebtToRepayId, params.creditPositionToCompensateId, params.amount
81:         );

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L69-L69)']
```solidity
69:         emit Events.Deposit(params.token, params.to, params.variable, params.amount); // <= FOUND

```
['[253](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L253-L253)']
```solidity
253:         emit Events.Initialize(f, r, o, d); // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L47-L47)']
```solidity
47:         emit Events.LendAsLimitOrder(params.maxDueDate, params.curveRelativeTime); // <= FOUND

```
['[90](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L90-L90)']
```solidity
90:         emit Events.LendAsMarketOrder(params.borrower, params.dueDate, params.amount, params.exactAmountIn); // <= FOUND

```
['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L105-L105)']
```solidity
105:             emit Events.LiquidateOverdueMoveToVariablePool(params.debtPositionId); // <= FOUND

```
['[109](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L109-L109)']
```solidity
109:             emit Events.LiquidateOverdueNoSplitRemainder(params.debtPositionId); // <= FOUND

```
['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L128-L128)']
```solidity
128:         emit Events.Liquidate(params.debtPositionId, params.minimumCollateralProfit, collateralRatio, loanStatus); // <= FOUND

```
['[135](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L135-L135)']
```solidity
135:             emit Events.LiquidateUserLiquidatableProfitably(params.debtPositionId); // <= FOUND

```
['[139](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L139-L139)']
```solidity
139:             emit Events.LiquidateUserLiquidatableUnprofitably(params.debtPositionId); // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L36-L36)']
```solidity
36:         emit Events.LiquidateVariable(params.borrower, params.amount); // <= FOUND

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L98-L98)']
```solidity
98:         emit Events.LiquidateWithReplacement(params.debtPositionId, params.borrower, params.minimumCollateralProfit); // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L31-L31)']
```solidity
31:         emit StaleRateIntervalUpdated(oldStaleRateInterval, _staleRateInterval); // <= FOUND

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L38-L38)']
```solidity
38:         emit MarketBorrowRateUpdated(oldMarketBorrowRate, _marketBorrowRate); // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L58-L58)']
```solidity
58:         emit Events.Repay(params.debtPositionId); // <= FOUND

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L30-L30)']
```solidity
30:         emit Events.RepayVariable(params.amount); // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L53-L53)']
```solidity
53:         emit Events.SelfLiquidate(params.creditPositionId); // <= FOUND

```
['[119](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L119-L119)']
```solidity
119:         emit Events.UpdateConfig(params.key, params.value); // <= FOUND

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L30-L30)']
```solidity
30:         emit Events.CreateVault(user, address(vault), false); // <= FOUND

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L48-L48)']
```solidity
48:         emit Events.CreateVault(user, address(vault), true); // <= FOUND

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L69-L69)']
```solidity
69:         emit Events.Withdraw(params.token, params.to, params.variable, amount); // <= FOUND

```


</details>

## [Gas-14] Shorten the array rather than copying to a new one

### Resolution 
Leveraging inline assembly in Solidity provides the ability to directly manipulate the length slot of an array, thereby altering its length without the need to copy the elements to a new array of the desired size. This technique is more gas-efficient as it avoids the computational expense associated with array duplication. However, this method circumvents the type-checking and safety mechanisms of high-level Solidity and should be used judiciously. Always ensure that the array doesn't contain vital data beyond the revised length, as this data will become unreachable yet still consume storage space.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[112](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L112-L112)']
```solidity
112:         address[] memory targets = new address[](2); // <= FOUND

```
['[169](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L169-L169)']
```solidity
169:         address[] memory targets = new address[](3); // <= FOUND

```


</details>

## [Gas-15] Use solady library where possible to save gas

### Resolution 
The following OpenZeppelin imports have a Solady equivalent, as such they can be used to save GAS as Solady modules have been specifically designed to be as GAS efficient as possible

Num of instances: 7

### Findings 


<details><summary>Click to show findings</summary>

['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L4-L4)']
```solidity
4: import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol"; // <= FOUND

```
['[6](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L6-L6)']
```solidity
6: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L4-L4)']
```solidity
4: import {OwnableUpgradeable} from "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol"; // <= FOUND

```
['[4](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L4-L4)']
```solidity
4: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L5-L5)']
```solidity
5: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"; // <= FOUND

```
['[5](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L5-L5)']
```solidity
5: import {ERC20} from "@openzeppelin/contracts/token/ERC20/ERC20.sol"; // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L9-L9)']
```solidity
9: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol"; // <= FOUND

```


</details>

## [Gas-16] Counting down in for statements is more gas efficient

### Resolution 
Looping downwards in Solidity is more gas efficient due to how the EVM compares variables. In a 'for' loop that counts down, the end condition is usually to compare with zero, which is cheaper than comparing with another number. As such, restructure your loops to count downwards where possible.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L128-L128)']
```solidity
128:        for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) { // <= FOUND
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) {
135:                 deltaAmountIn = creditPosition.credit;
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity);
137:             }
138: 
139:             
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) {
141:                 continue;
142:             }
143:             
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             
149:             state.createCreditPosition({
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee
157:             );
158:             amountOutLeft -= deltaAmountOut;
159:         }

```


</details>

## [Gas-17] Struct variables can be packed into fewer storage slots by truncating timestamp bytes

### Resolution 
Struct uint variables in Solidity are typically stored in 32-byte storage slots. When dealing with timestamps, which generally fit into a smaller byte size, it can be beneficial to truncate these bytes and pack them with other variables. This reduces the number of required storage slots, saving both storage space and associated gas costs. For example, a timestamp generally fits into a uint32, so it can be combined with other small variables within a single storage slot. When designing a contract, carefully structuring struct variables to utilize truncation and packing can lead to a more efficient and cost-effective implementation.

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L21-L25)']
```solidity
21: struct BorrowAsMarketOrderParams { // <= FOUND
22:     address lender;
23:     uint256 amount;
24:     uint256 dueDate;
25:     uint256 deadline; // <= FOUND
26:     uint256 maxAPR;
27:     bool exactAmountIn;
28:     uint256[] receivableCreditPositionIds;
29: }

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L20-L23)']
```solidity
20: struct BorrowerExitParams { // <= FOUND
21:     uint256 debtPositionId;
22:     address borrowerToExitTo;
23:     uint256 deadline; // <= FOUND
24:     uint256 minAPR;
25: }

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L19-L23)']
```solidity
19: struct LendAsMarketOrderParams { // <= FOUND
20:     address borrower;
21:     uint256 dueDate;
22:     uint256 amount;
23:     uint256 deadline; // <= FOUND
24:     uint256 minAPR;
25:     bool exactAmountIn;
26: }

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L19-L23)']
```solidity
19: struct LiquidateWithReplacementParams { // <= FOUND
20:     uint256 debtPositionId;
21:     address borrower;
22:     uint256 minimumCollateralProfit;
23:     uint256 deadline; // <= FOUND
24:     uint256 minAPR;
25: }

```


</details>

## [Gas-18] Using private rather than public for constants and immutables, saves gas

### Resolution 
Using private visibility for constants and immutables in Solidity instead of public can save gas. This is because private elements are not included in the contract's ABI, reducing the deployment and interaction costs. To achieve better efficiency, it is recommended to use private visibility when external access is not needed.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[87](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L87-L87)']
```solidity
87: bytes32 public constant KEEPER_ROLE = "KEEPER_ROLE"; // <= FOUND

```
['[88](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L88-L88)']
```solidity
88: bytes32 public constant PAUSER_ROLE = "PAUSER_ROLE"; // <= FOUND

```


</details>

## [Gas-19] Mark Functions That Revert For Normal Users As payable

### Resolution 
In Solidity, marking functions as `payable` allows them to accept Ether. If a function is known to revert for regular users (non-admin or specific roles) but needs to be accessible to others, marking it as `payable` can be beneficial. This ensures that even if a regular user accidentally sends Ether to the function, the Ether won't be trapped, as the function reverts, returning the funds. This can save gas by avoiding unnecessary failure handling in the function itself. Resolution: Carefully assess the roles and access patterns, and mark functions that should revert for regular users as `payable` to handle accidental Ether transfers.

Num of instances: 14

### Findings 


<details><summary>Click to show findings</summary>

['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L28-L28)']
```solidity
28:     function setStaleRateInterval(uint64 _staleRateInterval) external onlyOwner {
29:         uint64 oldStaleRateInterval = staleRateInterval;
30:         staleRateInterval = _staleRateInterval;
31:         emit StaleRateIntervalUpdated(oldStaleRateInterval, _staleRateInterval);
32:     }

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L34-L34)']
```solidity
34:     function setMarketBorrowRate(uint128 _marketBorrowRate) external onlyOwner {
35:         uint128 oldMarketBorrowRate = marketBorrowRate;
36:         marketBorrowRate = _marketBorrowRate;
37:         marketBorrowRateUpdatedAt = uint64(block.timestamp);
38:         emit MarketBorrowRateUpdated(oldMarketBorrowRate, _marketBorrowRate);
39:     }

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L23-L23)']
```solidity
23:     function mint(address to, uint256 amount) external virtual onlyOwner {
24:         _mint(to, amount);
25:     }

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L27-L27)']
```solidity
27:     function burn(address from, uint256 amount) external virtual onlyOwner {
28:         _burn(from, amount);
29:     }

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L31-L31)']
```solidity
31:     function transferFrom(address from, address to, uint256 value) public virtual override onlyOwner returns (bool) {
32:         _transfer(from, to, value);
33:         return true;
34:     }

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L36-L36)']
```solidity
36:     function transfer(address to, uint256 value) public virtual override onlyOwner returns (bool) {
37:         _transfer(msg.sender, to, value);
38:         return true;
39:     }

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L24-L24)']
```solidity
24:     function proxy(address target, bytes memory data) public onlyOwner returns (bytes memory returnData) {
25:         if (target == address(0)) {
26:             revert Errors.NULL_ADDRESS();
27:         }
28:         bool success;
29:         (success, returnData) = address(target).call(data);
30:         Address.verifyCallResult(success, returnData);
31:     }

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L33-L33)']
```solidity
33:     function proxy(address target, bytes memory data, uint256 value)
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData)
37:     {
38:         if (target == address(0)) {
39:             revert Errors.NULL_ADDRESS();
40:         }
41:         bool success;
42:         (success, returnData) = address(target).call{value: value}(data);
43:         Address.verifyCallResult(success, returnData);
44:     }

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L46-L46)']
```solidity
46:     function proxy(address[] memory targets, bytes[] memory datas)
47:         public
48:         onlyOwner
49:         returns (bytes[] memory returnDatas)
50:     {
51:         if (targets.length != datas.length) {
52:             revert Errors.ARRAY_LENGTHS_MISMATCH();
53:         }
54: 
55:         returnDatas = new bytes[](datas.length);
56:         bool success;
57:         for (uint256 i = 0; i < targets.length; i++) {
58:             if (targets[i] == address(0)) {
59:                 revert Errors.NULL_ADDRESS();
60:             }
61:             
62:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]);
63:             Address.verifyCallResult(success, returnDatas[i]);
64:         }
65:     }

```
['[116](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L116-L116)']
```solidity
116:     function _authorizeUpgrade(address newImplementation) internal override onlyRole(DEFAULT_ADMIN_ROLE) {}

```
['[118](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L118-L118)']
```solidity
118:     function updateConfig(UpdateConfigParams calldata params) external onlyRole(DEFAULT_ADMIN_ROLE) {
119:         state.validateUpdateConfig(params);
120:         state.executeUpdateConfig(params);
121:     }

```
['[123](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L123-L123)']
```solidity
123:     function pause() public onlyRole(PAUSER_ROLE) {
124:         _pause();
125:     }

```
['[127](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L127-L127)']
```solidity
127:     function unpause() public onlyRole(PAUSER_ROLE) {
128:         _unpause();
129:     }

```
['[216](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L216-L216)']
```solidity
216:     function liquidateWithReplacement(LiquidateWithReplacementParams calldata params)
217:         external
218:         override(ISize)
219:         whenNotPaused
220:         onlyRole(KEEPER_ROLE)
221:         returns (uint256 liquidatorProfitCollateralAsset, uint256 liquidatorProfitBorrowAsset)
222:     {
223:         state.validateLiquidateWithReplacement(params);
224:         (liquidatorProfitCollateralAsset, liquidatorProfitBorrowAsset) = state.executeLiquidateWithReplacement(params);
225:         state.validateUserIsNotBelowopeningLimitBorrowCR(params.borrower);
226:         state.validateMinimumCollateralProfit(params, liquidatorProfitCollateralAsset);
227:     }

```


</details>

## [Gas-20] Function names can be optimized

### Resolution 
Function names in Solidity contracts can be optimized to save gas during both deployment and execution. Method IDs are the first four bytes of the keccak256 hash of the function signature, and having two leading zero bytes can save 128 gas each during deployment. Additionally, renaming functions to have lower method IDs can save 22 gas per call, per sorted position shifted. This optimization leverages the way EVM handles data storage, making the execution more efficient. While these savings might seem minor, they can add up in contracts with numerous calls, contributing to more economical and efficient code.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L12-L12)']
```solidity
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step  // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20  // <= FOUND

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L56-L64)']
```solidity
56: contract Size is // <= FOUND
57:     ISize, // <= FOUND
58:     SizeView, // <= FOUND
59:     Initializable, // <= FOUND
60:     AccessControlUpgradeable, // <= FOUND
61:     PausableUpgradeable, // <= FOUND
62:     MulticallUpgradeable, // <= FOUND
63:     UUPSUpgradeable // <= FOUND
64:  // <= FOUND

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L17-L17)']
```solidity
17: contract VariablePoolPriceFeed is IPriceFeed  // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable  // <= FOUND

```


</details>

## [Gas-21] Lack of unchecked in loops

### Resolution 
In Solidity, the `unchecked` block allows arithmetic operations to not revert on overflow. Without using `unchecked` in loops, extra gas is consumed due to overflow checks. If it's certain that overflows won't occur within the loop, using `unchecked` can make the loop more gas-efficient by skipping unnecessary checks.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L128-L128)']
```solidity
128:        for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) {
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) {
135:                 deltaAmountIn = creditPosition.credit;
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity);
137:             }
138: 
139:             
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) {
141:                 continue;
142:             }
143:             
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             
149:             state.createCreditPosition({
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee
157:             );
158:             amountOutLeft -= deltaAmountOut;
159:         }

```


</details>

## [Gas-22] Consider not using libraries when implementing simple functionality.

### Resolution 
When implementing certain functionalities in a smart contract, using libraries can sometimes incur additional costs compared to including the functionality directly within the contract. Libraries in Solidity are essentially contracts that get deployed separately and then linked to the main contract, so there's an overhead cost associated with calling them. If the functionality is relatively simple, this overhead can outweigh the benefits of code reuse and modularity provided by libraries. Thus, in such cases, implementing the functionality directly within the contract could be more gas-efficient. However, this approach should be balanced against considerations of code readability, maintainability, and the potential for code reuse.

Num of instances: 31

### Findings 


<details><summary>Click to show findings</summary>

['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L16-L16)']
```solidity
16: library AccountingLibrary  // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L15-L15)']
```solidity
15: library BorrowAsLimitOrder  // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L31-L31)']
```solidity
31: library BorrowAsMarketOrder  // <= FOUND

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L16-L16)']
```solidity
16: library BorrowVariable  // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L27-L27)']
```solidity
27: library BorrowerExit  // <= FOUND

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CapsLibrary.sol#L9-L9)']
```solidity
9: library CapsLibrary  // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L19-L19)']
```solidity
19: library Claim  // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L12-L12)']
```solidity
12: library CollateralLibrary  // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L23-L23)']
```solidity
23: library Compensate  // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L7-L7)']
```solidity
7: library ConversionLibrary  // <= FOUND

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L22-L22)']
```solidity
22: library Deposit  // <= FOUND

```
['[7](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L7-L7)']
```solidity
7: library Errors  // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L15-L15)']
```solidity
15: library Events  // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L58-L58)']
```solidity
58: library Initialize  // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L18-L18)']
```solidity
18: library LendAsLimitOrder  // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L28-L28)']
```solidity
28: library LendAsMarketOrder  // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L24-L24)']
```solidity
24: library Liquidate  // <= FOUND

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L16-L16)']
```solidity
16: library LiquidateVariable  // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L27-L27)']
```solidity
27: library LiquidateWithReplacement  // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L45-L45)']
```solidity
45: library LoanLibrary  // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L12-L12)']
```solidity
12: library Math  // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L18-L18)']
```solidity
18: library OfferLibrary  // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L18-L18)']
```solidity
18: library Repay  // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L15-L15)']
```solidity
15: library RepayVariable  // <= FOUND

```
['[13](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L13-L13)']
```solidity
13: library RiskLibrary  // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L19-L19)']
```solidity
19: library SelfLiquidate  // <= FOUND

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L29-L29)']
```solidity
29: library UpdateConfig  // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L18-L18)']
```solidity
18: library UserLibrary  // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L24-L24)']
```solidity
24: library VariableLibrary  // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L21-L21)']
```solidity
21: library Withdraw  // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L21-L21)']
```solidity
21: library YieldCurveLibrary  // <= FOUND

```


</details>

## [Gas-23] Using bools for storage incurs overhead

### Resolution 
Using boolean variables (`bool`) for storage in Solidity can incur overhead due to the way data is packed in Ethereum's storage layout. A `bool` takes a full storage slot, even though it represents only a true or false value. This leads to inefficient usage of storage space and potentially higher gas costs. To resolve this issue, developers can use bit fields or uint8/uint256 to pack multiple boolean values into a single storage slot. By employing such optimization techniques, it's possible to save on storage space and reduce gas costs, making the contract more efficient.

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L25-L25)']
```solidity
25:     bool exactAmountIn; // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L18-L18)']
```solidity
18:     bool variable; // <= FOUND

```
['[55](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L55-L55)']
```solidity
55:             bool setUseReserveAsCollateral = params.token == address(state.data.underlyingCollateralToken); // <= FOUND

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L28-L28)']
```solidity
28:         bool success; // <= FOUND

```


</details>

## [Gas-24] Where a value is casted more than once, consider caching the result to save gas

### Resolution 
Casting values multiple times in Solidity can be gas-inefficient. When a value undergoes repeated type conversions, the EVM must execute additional operations for each cast, consuming more gas than necessary. To optimize for gas efficiency, cache the result of the initial cast in a local variable and reuse it, rather than performing multiple casts. This not only conserves gas but also enhances code readability, reducing potential error points. For example, instead of repeatedly casting an `address` to `uint256`, cast once, store the result in a local variable, and reference that variable in subsequent operations.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L44-L65)']
```solidity
44:     function depositUnderlyingTokenToVariablePool(
45:         State storage state,
46:         IERC20Metadata underlyingToken,
47:         address from,
48:         address to,
49:         uint256 amount,
50:         bool variable,
51:         bool setUseReserveAsCollateral
52:     ) external {
53:         underlyingToken.safeTransferFrom(from, address(this), amount);
54: 
55:         Vault vaultTo = variable ? state.getVaultVariable(to) : state.getVaultFixed(to);
56: 
57:         underlyingToken.forceApprove(address(state.data.variablePool), amount);
58:         state.data.variablePool.supply(address(underlyingToken), amount, address(vaultTo), 0); // <= FOUND
59: 
60:         
61:         if (setUseReserveAsCollateral) {
62:             
63:             vaultTo.proxy(
64:                 address(state.data.variablePool),
65:                 abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(underlyingToken), true)) // <= FOUND
66:             );
67:         }
68:     }

```


</details>

## [Gas-25] Use assembly to validate msg.sender

### Resolution 
Utilizing assembly for validating `msg.sender` can potentially save gas as it allows for more direct and efficient access to Ethereumâ€™s EVM opcodes, bypassing some of the overhead introduced by Solidityâ€™s higher-level abstractions. However, this practice requires deep expertise in EVM, as incorrect implementation can introduce critical vulnerabilities. It is a trade-off between gas efficiency and code safety.

Num of instances: 8

### Findings 


<details><summary>Click to show findings</summary>

['[92](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L92-L92)']
```solidity
92:                 revert Errors.BORROWER_IS_NOT_LENDER(msg.sender, creditPosition.lender); // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L53-L53)']
```solidity
53:             revert Errors.EXITER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower); // <= FOUND

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L59-L63)']
```solidity
59:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
60:                 address(state.data.borrowAToken),
61:                 msg.sender, // <= FOUND
62:                 false,
63:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false), // <= FOUND
64:                 issuanceValue + state.feeConfig.earlyBorrowerExitFee
65:             );

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Compensate.sol#L69-L69)']
```solidity
69:             revert Errors.COMPENSATOR_IS_NOT_BORROWER(msg.sender, debtPositionToRepay.borrower); // <= FOUND

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L63-L67)']
```solidity
63:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
64:                 address(state.data.borrowAToken),
65:                 msg.sender, // <= FOUND
66:                 false,
67:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false), // <= FOUND
68:                 amountIn
69:             );

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L35-L35)']
```solidity
35:             revert Errors.REPAYER_IS_NOT_BORROWER(msg.sender, debtPosition.borrower); // <= FOUND

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L38-L42)']
```solidity
38:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE( // <= FOUND
39:                 address(state.data.borrowAToken),
40:                 msg.sender, // <= FOUND
41:                 false,
42:                 state.aTokenBalanceOf(state.data.borrowAToken, msg.sender, false), // <= FOUND
43:                 debtPosition.faceValue
44:             );

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L48-L48)']
```solidity
48:             revert Errors.LIQUIDATOR_IS_NOT_LENDER(msg.sender, creditPosition.lender); // <= FOUND

```


</details>

## [Gas-26] Unnecessary casting as variable is already of the same type

### Resolution 
Unnecessary casting of a variable to the same type is redundant and can contribute to gas inefficiency and code clutter. This situation commonly arises when developers, perhaps due to oversight or misunderstanding, explicitly cast a variable to its existing type. For example, casting a `uint256` variable to `uint256` again does not change its type or value but adds unnecessary operations to the code.

**Resolution**: Developers should scrutinize their code to identify and remove any unnecessary type casting. Utilizing linters or static analysis tools can aid in detecting such redundancies. Ensuring that the code is clean and efficient not only saves gas but also enhances readability and maintainability.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L24-L29)']
```solidity
24:     function proxy(address target, bytes memory data) public onlyOwner returns (bytes memory returnData) {
25:         if (target == address(0)) {
26:             revert Errors.NULL_ADDRESS();
27:         }
28:         bool success;
29:         (success, returnData) = address(target).call(data); // <= FOUND
30:         Address.verifyCallResult(success, returnData);
31:     }

```
['[33](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L33-L42)']
```solidity
33:     function proxy(address target, bytes memory data, uint256 value)
34:         public
35:         onlyOwner
36:         returns (bytes memory returnData)
37:     {
38:         if (target == address(0)) {
39:             revert Errors.NULL_ADDRESS();
40:         }
41:         bool success;
42:         (success, returnData) = address(target).call{value: value}(data); // <= FOUND
43:         Address.verifyCallResult(success, returnData);
44:     }

```


</details>

## [Gas-27] Consider Using Solady's Gas Optimized Lib for Math

### Resolution 
In instances where many similar mathematical operations are performed, consider using Solday's math lib to benefit from the gas saving it can introduce.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L34-L34)']
```solidity
34:         return x * y / z; // <= FOUND

```


</details>

## [Gas-28] Using nested if to save gas

### Resolution 
Using nested `if` statements instead of logical AND (`&&`) operators can potentially save gas in Solidity contracts. When a series of conditions are connected with `&&`, all conditions must be evaluated even if the first one fails. In contrast, nested `if` statements allow for short-circuiting; if the first condition fails, the rest are skipped, saving gas. This approach is more gas-efficient, especially when dealing with complex or gas-intensive conditions. However, it's crucial to balance gas savings with code readability and maintainability, ensuring that the code remains clear and easy to understand.

Num of instances: 13

### Findings 


<details><summary>Click to show findings</summary>

['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L34-L34)']
```solidity
32:         if (
33:             params.token != address(state.data.underlyingCollateralToken)
34:                 && params.token != address(state.data.underlyingBorrowToken) // <= FOUND
35:         ) {
36:             revert Errors.INVALID_TOKEN(params.token);
37:         }

```
['[134](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L134-L134)']
```solidity
134:         if (PERCENT <= collateralRatio && collateralRatio < state.riskConfig.crLiquidation) { // <= FOUND
135:             emit Events.LiquidateUserLiquidatableProfitably(params.debtPositionId);
136:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, true);
137:             
138:         }

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L19-L19)']
```solidity
19:        if (0 < credit && credit < state.riskConfig.minimumCreditBorrowAToken) { // <= FOUND
20:             revert Errors.CREDIT_LOWER_THAN_MINIMUM_CREDIT(credit, state.riskConfig.minimumCreditBorrowAToken);
21:         }

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L38-L38)']
```solidity
32:         
33:         
34: 
35:         
36:         if (
37:             params.token != address(state.data.underlyingCollateralToken)
38:                 && params.token != address(state.data.underlyingBorrowToken) // <= FOUND
39:         ) {

```
['[135](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L135-L135)']
```solidity
134:         
135:         if (PERCENT <= collateralRatio && collateralRatio < state.riskConfig.crLiquidation) { // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L49-L49)']
```solidity
49:         return positionId >= DEBT_POSITION_ID_START && positionId < state.data.nextDebtPositionId; // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L53-L53)']
```solidity
53:         return positionId >= CREDIT_POSITION_ID_START && positionId < state.data.nextCreditPositionId; // <= FOUND

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L22-L22)']
```solidity
22:         return self.maxDueDate == 0 && self.curveRelativeTime.isNull(); // <= FOUND

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/OfferLibrary.sol#L26-L26)']
```solidity
26:         return self.openingLimitBorrowCR == 0 && self.curveRelativeTime.isNull(); // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L19-L19)']
```solidity
19:         if (0 < credit && credit < state.riskConfig.minimumCreditBorrowAToken) { // <= FOUND

```
['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L54-L54)']
```solidity
52:         
53:         return state.isCreditPositionId(creditPositionId)
54:             && (isUserLiquidatable(state, debtPosition.borrower) && status != LoanStatus.REPAID); // <= FOUND

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L63-L64)']
```solidity
60:         
61:         return state.isDebtPositionId(debtPositionId)
62:         
63:         && ( // <= FOUND
64:             (isUserLiquidatable(state, debtPosition.borrower) && status != LoanStatus.REPAID) // <= FOUND
65:             
66:             || status == LoanStatus.OVERDUE
67:         );

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L23-L23)']
```solidity
23:         return self.maturities.length == 0 && self.aprs.length == 0 && self.marketRateMultipliers.length == 0; // <= FOUND

```


</details>

## [Gas-29] Optimize Deployment Size by Fine-tuning IPFS Hash

### Resolution 
Optimizing the deployment size of a smart contract is vital to minimize gas costs, and one way to achieve this is by fine-tuning the IPFS hash appended by the Solidity compiler as metadata. This metadata, consisting of 53 bytes, increases the gas required for contract deployment by approximately 10,600 gas due to bytecode costs, and additionally, up to 848 gas due to calldata costs, depending on the proportion of zero and non-zero bytes. Utilize the --no-cbor-metadata compiler flag to prevent the compiler from appending metadata. However, this approach has a drawback as it can complicate the contract verification process on block explorers like Etherscan, potentially reducing transparency.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L12-L12)']
```solidity
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step  // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20  // <= FOUND

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L56-L56)']
```solidity
56: contract Size is // <= FOUND
57:     ISize,
58:     SizeView,
59:     Initializable,
60:     AccessControlUpgradeable,
61:     PausableUpgradeable,
62:     MulticallUpgradeable,
63:     UUPSUpgradeable
64: 

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L17-L17)']
```solidity
17: contract VariablePoolPriceFeed is IPriceFeed  // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable  // <= FOUND

```


</details>

## [Gas-30] Avoid Unnecessary Public Variables

### Resolution 
Public state variables in Solidity automatically generate getter functions, increasing contract size and potentially leading to higher deployment and interaction costs. To optimize gas usage and contract efficiency, minimize the use of public variables unless external access is necessary. Instead, use internal or private visibility combined with explicit getter functions when required. This practice not only reduces contract size but also provides better control over data access and manipulation, enhancing security and readability. Prioritize lean, efficient contracts to ensure cost-effectiveness and better performance on the blockchain.

Num of instances: 8

### Findings 


<details><summary>Click to show findings</summary>

['[87](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L87-L87)']
```solidity
87: bytes32 public constant KEEPER_ROLE = "KEEPER_ROLE"; // <= FOUND

```
['[88](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L88-L88)']
```solidity
88: bytes32 public constant PAUSER_ROLE = "PAUSER_ROLE"; // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L19-L19)']
```solidity
19: IAaveOracle public immutable aaveOracle; // <= FOUND

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L20-L20)']
```solidity
20: address public immutable base; // <= FOUND

```
['[21](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L21-L21)']
```solidity
21: uint8 public immutable baseDecimals; // <= FOUND

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L22-L22)']
```solidity
22: address public immutable quote; // <= FOUND

```
['[23](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L23-L23)']
```solidity
23: uint8 public immutable quoteDecimals; // <= FOUND

```
['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L24-L24)']
```solidity
24: uint8 public immutable decimals; // <= FOUND

```


</details>

## [Gas-31] Consider splitting complex if statements into multiple steps

### Resolution 
Splitting complex checks into multiple steps in smart contracts can enhance readability and potentially save gas. Complex conditions often require more computational power, increasing gas costs. By breaking down these conditions into simpler, individual checks, some computations can be avoided, especially if earlier checks fail, leveraging short-circuit evaluation in logical operations. This approach not only makes the code easier to understand and maintain but can also lead to more efficient execution, as unnecessary computations are minimized. Structuring contracts to evaluate conditions in a step-by-step manner can lead to significant gas savings and improved contract performance.

Num of instances: 11

### Findings 


<details><summary>Click to show findings</summary>

['[54](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L54-L54)']
```solidity
54:         if (params.variable || params.token == address(state.data.underlyingBorrowToken)) { // <= FOUND

```
['[60](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L60-L60)']
```solidity
60:         if (value < array[low] || value > array[high]) { // <= FOUND

```
['[35](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L35-L35)']
```solidity
35:         if (_aaveOracle == address(0) || _base == address(0) || _quote == address(0)) { // <= FOUND

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L39-L39)']
```solidity
39:         if (_decimals == 0 || _decimals > 18) { // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L43-L43)']
```solidity
43:         if (_baseDecimals == 0 || _baseDecimals > 18 || _quoteDecimals == 0 || _quoteDecimals > 18) { // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L27-L27)']
```solidity
27:         if (self.maturities.length == 0 || self.aprs.length == 0 || self.marketRateMultipliers.length == 0) { // <= FOUND

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L30-L30)']
```solidity
30:         if (self.maturities.length != self.aprs.length || self.maturities.length != self.marketRateMultipliers.length) { // <= FOUND

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L98-L98)']
```solidity
98:         if (maturity < curveRelativeTime.maturities[0] || maturity > curveRelativeTime.maturities[length - 1]) { // <= FOUND

```
['[32](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L32-L38)']
```solidity
32:         
33:         
34: 
35:         
36:         if ( // <= FOUND
37:             params.token != address(state.data.underlyingCollateralToken)
38:                 && params.token != address(state.data.underlyingBorrowToken) // <= FOUND
39:         ) {

```
['[134](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L134-L135)']
```solidity
134:         
135:         if (PERCENT <= collateralRatio && collateralRatio < state.riskConfig.crLiquidation) { // <= FOUND

```
['[19](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L19-L19)']
```solidity
19:         if (0 < credit && credit < state.riskConfig.minimumCreditBorrowAToken) { // <= FOUND

```


</details>

## [Gas-32] Caching global variables is more expensive than using the actual variable

### Resolution 
In Solidity, caching global or state variables in local variables can be more costly than directly using the state variables. Each assignment to a local variable consumes gas for memory allocation. Accessing state variables directly avoids this overhead, especially if they are only read once, thereby saving gas.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[273](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L273-L273)']
```solidity
273:         address to = address(this); // <= FOUND

```


</details>

## [Gas-33] Low level call can be optimized with assembly

### Resolution 
Optimizing low-level calls using assembly in Solidity can be beneficial, particularly when dealing with function return data. Typically, even if return data from a low-level call is not used, Solidity still allocates memory to store it, which incurs gas costs. By using assembly, developers can bypass the automatic memory allocation for unused return data. This manual optimization involves handling the call at the assembly level and deliberately choosing not to store the return data in memory when it's not needed.

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L42-L42)']
```solidity
42:         (success, returnData) = address(target).call{value: value}(data); // <= FOUND

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L29-L29)']
```solidity
29:         (success, returnData) = address(target).call(data); // <= FOUND

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L63-L63)']
```solidity
62:             
63:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]); // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L42-L42)']
```solidity
42:         (success, returnData) = address(target).call{value: value}(data); // <= FOUND

```
['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L29-L29)']
```solidity
29:         (success, returnData) = address(target).call(data); // <= FOUND

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L62-L63)']
```solidity
62:             
63:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]); // <= FOUND

```


</details>

## [Gas-34] Use s.x = s.x + y instead of s.x += y for memory structs (same for -= etc)

### Resolution 
In Solidity, optimizing gas usage is crucial, particularly for frequently executed operations. For memory structs, using explicit assignment (e.g., `s.x = s.x + y`) instead of shorthand operations (e.g., `s.x += y`) can result in a minor gas saving, around 100 gas. This difference arises from the way the Solidity compiler optimizes bytecode. While such savings might seem small, they can add up in contracts with high transaction volume. This optimization applies to other compound assignment operators like `-=` and `*=` as well. It's a subtle efficiency gain that developers can leverage, especially in complex contracts where every gas unit counts.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L62-L95)']
```solidity
62:     function _executeLiquidateTakeCollateral(
63:         State storage state,
64:         DebtPosition memory debtPositionCopy,
65:         bool splitCollateralRemainder
66:     ) private returns (uint256 liquidatorProfitCollateralToken) {
67:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
68:         uint256 debtInCollateralToken = state.debtTokenAmountToCollateralTokenAmount(debtPositionCopy.faceValue); // <= FOUND
69: 
70:         
71:         if (assignedCollateral > debtInCollateralToken) {
72:             liquidatorProfitCollateralToken = debtInCollateralToken;
73: 
74:             if (splitCollateralRemainder) {
75:                 
76:                 uint256 collateralRemainder = assignedCollateral - debtInCollateralToken;
77: 
78:                 uint256 collateralRemainderToLiquidator =
79:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitLiquidatorPercent, PERCENT);
80:                 uint256 collateralRemainderToProtocol =
81:                     Math.mulDivDown(collateralRemainder, state.riskConfig.collateralSplitProtocolPercent, PERCENT);
82: 
83:                 liquidatorProfitCollateralToken += collateralRemainderToLiquidator; // <= FOUND
84:                 state.data.collateralToken.transferFrom(
85:                     debtPositionCopy.borrower, state.feeConfig.feeRecipient, collateralRemainderToProtocol // <= FOUND
86:                 );
87:             }
88:             
89:         } else {
90:             
91:             liquidatorProfitCollateralToken = assignedCollateral;
92:         }
93: 
94:         state.transferBorrowATokenFixed(msg.sender, address(this), debtPositionCopy.faceValue); // <= FOUND
95:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken); // <= FOUND
96:     }

```
['[111](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L111-L158)']
```solidity
111:     function _borrowFromCredit(State storage state, BorrowAsMarketOrderParams memory params)
112:         internal
113:         returns (uint256 amountOutLeft)
114:     {
115:         
116:         
117: 
118:         User storage lenderUser = state.data.users[params.lender];
119: 
120:         LoanOffer storage loanOffer = lenderUser.loanOffer;
121: 
122:         uint256 ratePerMaturity =
123:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate);
124: 
125:         amountOutLeft =
126:             params.exactAmountIn ? Math.mulDivDown(params.amount, PERCENT, PERCENT + ratePerMaturity) : params.amount;
127: 
128:         for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) {
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) { // <= FOUND
135:                 deltaAmountIn = creditPosition.credit; // <= FOUND
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity); // <= FOUND
137:             }
138: 
139:             
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) {
141:                 continue;
142:             }
143:             
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             
149:             state.createCreditPosition({
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee
157:             );
158:             amountOutLeft -= deltaAmountOut; // <= FOUND
159:         }
160:     }

```


</details>

## [Gas-35] Time state variables can be truncated to uint32

### Resolution 
Truncating time-related state variables to `uint32` can be a practical optimization in Solidity contracts. Since `uint32` can represent dates far into the future (over 100 years from now), it's often sufficient for time tracking purposes. This approach reduces the storage space required, thereby saving gas costs associated with larger data types like `uint256`. This form of optimization is especially beneficial in scenarios where space efficiency is a priority and the range of `uint32` meets the application's temporal needs.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[24](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L24-L24)']
```solidity
24: error PAST_DEADLINE(uint256 deadline); // <= FOUND

```


</details>

## [Gas-36] Constants are cheaper than Enums

### Resolution 
Using constants instead of enums in Solidity can lead to gas savings. Constants, particularly for primitive data types like `uint` or `bool`, are directly substituted by the Solidity compiler at compile time, effectively hardcoding their values into the bytecode. This means that accessing a constant does not incur any runtime gas costs, as no storage or memory access is needed. In contrast, enums, while useful for readability and ensuring valid value ranges, are stored in contract storage or memory, incurring gas costs for reads and writes. For scenarios where an enum's value range aligns with a simple constant (like true/false or small integer ranges), substituting with constants can be a more gas-efficient choice.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L37-L37)']
```solidity
37: enum LoanStatus { // <= FOUND
38:     ACTIVE, 
39:     OVERDUE, 
40:     REPAID 
41: 
42: }

```


</details>

## [Gas-37] ++X costs slightly less gas than X++ (same with --)

### Resolution 
Move the ++/-- action to the left of the variable

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[102](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L102-L102)']
```solidity
102:         uint256 debtPositionId = state.data.nextDebtPositionId++; // <= FOUND

```
['[110](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L110-L110)']
```solidity
110:         uint256 creditPositionId = state.data.nextCreditPositionId++; // <= FOUND

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L57-L57)']
```solidity
57:         for (uint256 i = 0; i < targets.length; i++) { // <= FOUND

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L39-L39)']
```solidity
39:         for (uint256 i = self.maturities.length; i > 0; i--) { // <= FOUND

```


</details>

## [Gas-38] Variables that can be set to immutable

### Resolution 
The variables are not typically expected to change during the lifespan of the project, as such it makes sense to save gas and set these variables to immutable.

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[73](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L73-L73)']
```solidity
73: error INVALID_DECIMALS(uint8 decimals); // <= FOUND

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L14-L14)']
```solidity
14: error MATURITIES_NOT_STRICTLY_INCREASING(); // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L15-L15)']
```solidity
15: error MATURITY_BELOW_MINIMUM_MATURITY(uint256 maturity, uint256 minimumMaturity); // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L31-L31)']
```solidity
31: error MATURITY_OUT_OF_RANGE(uint256 maturity, uint256 minMaturity, uint256 maxMaturity); // <= FOUND

```


</details>

## [Gas-39] Variable declared within iteration

### Resolution 
Please elaborate and generalise the following with detail and  feel free to use your own knowledge and lmit ur words to 100 words please: 

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L128-L129)']
```solidity
128:        for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) { // <= FOUND
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i]; // <= FOUND
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) {
135:                 deltaAmountIn = creditPosition.credit;
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity);
137:             }
138: 
139:             
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) {
141:                 continue;
142:             }
143:             
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             
149:             state.createCreditPosition({
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee
157:             );
158:             amountOutLeft -= deltaAmountOut;
159:         }

```
['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L64-L65)']
```solidity
64:         while (low <= high) { // <= FOUND
65:             uint256 mid = (low + high) / 2; // <= FOUND
66:             if (array[mid] == value) {
67:                 return (mid, mid);
68:             }

```


</details>

## [Gas-40] Calling .length in a for loop wastes gas

### Resolution 
Rather than calling .length for an array in a for loop declaration, it is far more gas efficient to cache this length before and use that instead. This will prevent the array length from being called every loop iteration

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L85-L85)']
```solidity
85: for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i)  // <= FOUND

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L85-L85)']
```solidity
85: for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i)  // <= FOUND

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L57-L57)']
```solidity
57: for (uint256 i = 0; i < targets.length; i++)  // <= FOUND

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L39-L39)']
```solidity
39: for (uint256 i = self.maturities.length; i > 0; i--)  // <= FOUND

```


</details>

## [Gas-41] Internal functions only used once can be inlined to save gas

### Resolution 
If a internal function is only used once it doesn't make sense to modularise it unless the function which does call the function would be overly long and complex otherwise

Num of instances: 12

### Findings 


<details><summary>Click to show findings</summary>

['[111](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L111-L111)']
```solidity
111:     function _borrowFromCredit(State storage state, BorrowAsMarketOrderParams memory params) // <= FOUND
112:         internal
113:         returns (uint256 amountOutLeft)
114:     

```
['[164](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L164-L164)']
```solidity
164:     function _borrowGeneratingDebt(State storage state, BorrowAsMarketOrderParams memory params) internal  // <= FOUND

```
['[59](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L59-L59)']
```solidity
59:     function validateOwner(address owner) internal pure  // <= FOUND

```
['[152](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L152-L152)']
```solidity
152:     function validateInitializeDataParams(InitializeDataParams memory d) internal pure  // <= FOUND

```
['[184](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L184-L184)']
```solidity
184:     function executeInitializeFeeConfig(State storage state, InitializeFeeConfigParams memory f) internal  // <= FOUND

```
['[195](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L195-L195)']
```solidity
195:     function executeInitializeRiskConfig(State storage state, InitializeRiskConfigParams memory r) internal  // <= FOUND

```
['[212](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L212-L212)']
```solidity
212:     function executeInitializeOracle(State storage state, InitializeOracleParams memory o) internal  // <= FOUND

```
['[217](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L217-L217)']
```solidity
217:     function executeInitializeData(State storage state, InitializeDataParams memory d) internal  // <= FOUND

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L37-L37)']
```solidity
37:     function powWadWad(uint256 wad1, uint256 wad2) internal pure returns (uint256)  // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L49-L49)']
```solidity
49:     function linearAPRToRatePerMaturity(int256 rate, uint256 maturity) internal pure returns (int256)  // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L53-L53)']
```solidity
53:     function compoundAPRToRatePerMaturity(uint256 rate, uint256 maturity) internal pure returns (uint256)  // <= FOUND

```
['[57](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L57-L57)']
```solidity
57:     function binarySearch(uint256[] memory array, uint256 value) internal pure returns (uint256 low, uint256 high)  // <= FOUND

```


</details>

## [Gas-42] Constructors can be marked as payable to save deployment gas

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L20-L20)']
```solidity
20:     constructor(address _owner, uint64 _staleRateInterval) Ownable(_owner) {
21:         if (_staleRateInterval == 0) {
22:             revert Errors.NULL_STALE_RATE();
23:         }
24: 
25:         staleRateInterval = _staleRateInterval;
26:     }

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L16-L16)']
```solidity
16:     constructor(address owner_, string memory name_, string memory symbol_, uint8 decimals_)
17:         Ownable(owner_)
18:         ERC20(name_, symbol_)
19:     {
20:         _decimals = decimals_;
21:     }

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L16-L16)']
```solidity
16:     constructor() {
17:         _disableInitializers();
18:     }

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L27-L27)']
```solidity
27:     constructor(
28:         address _aaveOracle,
29:         address _base,
30:         uint8 _baseDecimals,
31:         address _quote,
32:         uint8 _quoteDecimals,
33:         uint8 _decimals
34:     ) {
35:         if (_aaveOracle == address(0) || _base == address(0) || _quote == address(0)) {
36:             revert Errors.NULL_ADDRESS();
37:         }
38: 
39:         if (_decimals == 0 || _decimals > 18) {
40:             revert Errors.INVALID_DECIMALS(_decimals);
41:         }
42: 
43:         if (_baseDecimals == 0 || _baseDecimals > 18 || _quoteDecimals == 0 || _quoteDecimals > 18) {
44:             revert Errors.INVALID_DECIMALS(_baseDecimals);
45:         }
46: 
47:         aaveOracle = IAaveOracle(_aaveOracle);
48:         base = _base;
49:         baseDecimals = _baseDecimals;
50:         quote = _quote;
51:         quoteDecimals = _quoteDecimals;
52:         decimals = _decimals;
53:     }

```
['[16](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L16-L16)']
```solidity
16:     constructor() {
17:         _disableInitializers();
18:     }

```


</details>

## [Gas-43] Merge events to save gas

### Resolution 
Consolidating multiple event emissions into a single event in Solidity can result in significant gas savings. Each event emission in Ethereum involves a gas cost, specifically for the topics logged with the event. By merging sequential events into a singular event, you can save on the Glogtopic cost, which is incurred for each topic of each event. This approach can save around 375 gas per additional topic. This strategy is particularly beneficial in functions where multiple related events are emitted in sequence. However, it's crucial to balance gas optimization with the clarity and utility of the event data for off-chain consumers.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[83](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L83-L114)']
```solidity
83:     function createDebtAndCreditPositions(
84:         State storage state,
85:         address lender,
86:         address borrower,
87:         uint256 issuanceValue,
88:         uint256 faceValue,
89:         uint256 dueDate
90:     ) external returns (DebtPosition memory debtPosition, CreditPosition memory creditPosition) {
91:         debtPosition = DebtPosition({
92:             lender: lender,
93:             borrower: borrower,
94:             issuanceValue: issuanceValue,
95:             faceValue: faceValue,
96:             repayFee: LoanLibrary.repayFee(issuanceValue, block.timestamp, dueDate, state.feeConfig.repayFeeAPR),
97:             startDate: block.timestamp,
98:             dueDate: dueDate,
99:             liquidityIndexAtRepayment: 0
100:         });
101: 
102:         uint256 debtPositionId = state.data.nextDebtPositionId++;
103:         state.data.debtPositions[debtPositionId] = debtPosition;
104: 
105:         emit Events.CreateDebtPosition(debtPositionId, lender, borrower, issuanceValue, faceValue, dueDate); // <= FOUND
106: 
107:         creditPosition =
108:             CreditPosition({lender: lender, credit: debtPosition.faceValue, debtPositionId: debtPositionId});
109: 
110:         uint256 creditPositionId = state.data.nextCreditPositionId++;
111:         state.data.creditPositions[creditPositionId] = creditPosition;
112:         state.validateMinimumCreditOpening(creditPosition.credit);
113: 
114:         emit Events.CreateCreditPosition(creditPositionId, lender, RESERVED_ID, debtPositionId, creditPosition.credit); // <= FOUND
115:     }

```
['[98](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L98-L109)']
```solidity
98:     function _executeLiquidateOverdue(
99:         State storage state,
100:         LiquidateParams calldata params,
101:         DebtPosition memory debtPositionCopy
102:     ) private returns (uint256 liquidatorProfitCollateralToken) {
103:         
104:         try state.moveDebtPositionToVariablePool(debtPositionCopy) returns (uint256 _liquidatorProfitCollateralToken) {
105:             emit Events.LiquidateOverdueMoveToVariablePool(params.debtPositionId); // <= FOUND
106:             liquidatorProfitCollateralToken = _liquidatorProfitCollateralToken;
107:             
108:         } catch {
109:             emit Events.LiquidateOverdueNoSplitRemainder(params.debtPositionId); // <= FOUND
110:             liquidatorProfitCollateralToken = _executeLiquidateTakeCollateral(state, debtPositionCopy, false)
111:                 + state.feeConfig.collateralOverdueTransferFee;
112:             state.data.collateralToken.transferFrom(
113:                 debtPositionCopy.borrower, msg.sender, state.feeConfig.collateralOverdueTransferFee
114:             );
115:         }
116:     }

```


</details>

## [Gas-44] Use assembly scratch space to build calldata for external calls

### Resolution 
Using Solidity's assembly scratch space for constructing calldata in external calls with one or two arguments can be a gas-efficient approach. This method leverages the designated memory area (the first 64 bytes of memory) for temporary data storage during assembly operations. By directly writing arguments into this scratch space, it eliminates the need for additional memory allocation typically required for calldata preparation. This technique can lead to notable gas savings, especially in high-frequency or gas-sensitive operations. However, it requires careful implementation to avoid data corruption and should be used with a thorough understanding of low-level EVM operations and memory handling. Proper testing and validation are crucial when employing such optimizations.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[29](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L29-L29)']
```solidity
29:         (success, returnData) = address(target).call(data); // <= FOUND

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L62-L63)']
```solidity
62:             
63:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]); // <= FOUND

```


</details>

## [Gas-45] Use assembly scratch space to build calldata for event emits

### Resolution 
Utilizing Solidity's assembly scratch space to build calldata for emitting events with just one or two arguments can optimize gas usage. The scratch space, a designated area in the first 64 bytes of memory, is ideal for temporary storage during assembly-level operations. By directly writing the event arguments into this area, developers can bypass the standard memory allocation process required for event emission. This approach results in gas savings, particularly for contracts where events are frequently emitted. However, such low-level optimization requires a deep understanding of Ethereum Virtual Machine (EVM) mechanics and careful coding to prevent data mishandling. Rigorous testing is essential to ensure the integrity and correct functionality of the contract.

Num of instances: 16

### Findings 


<details><summary>Click to show findings</summary>

['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L42-L42)']
```solidity
42:         emit Events.BorrowAsLimitOrder(params.curveRelativeTime); // <= FOUND

```
['[49](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L49-L49)']
```solidity
49:         emit Events.Claim(params.creditPositionId); // <= FOUND

```
['[105](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L105-L105)']
```solidity
105:             emit Events.LiquidateOverdueMoveToVariablePool(params.debtPositionId); // <= FOUND

```
['[109](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L109-L109)']
```solidity
109:             emit Events.LiquidateOverdueNoSplitRemainder(params.debtPositionId); // <= FOUND

```
['[135](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L135-L135)']
```solidity
135:             emit Events.LiquidateUserLiquidatableProfitably(params.debtPositionId); // <= FOUND

```
['[139](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L139-L139)']
```solidity
139:             emit Events.LiquidateUserLiquidatableUnprofitably(params.debtPositionId); // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L58-L58)']
```solidity
58:         emit Events.Repay(params.debtPositionId); // <= FOUND

```
['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/RepayVariable.sol#L30-L30)']
```solidity
30:         emit Events.RepayVariable(params.amount); // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/SelfLiquidate.sol#L53-L53)']
```solidity
53:         emit Events.SelfLiquidate(params.creditPositionId); // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/BorrowVariable.sol#L36-L36)']
```solidity
36:         emit Events.BorrowVariable(params.to, params.amount); // <= FOUND

```
['[85](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowerExit.sol#L85-L85)']
```solidity
85:         emit Events.BorrowerExit(params.debtPositionId, params.borrowerToExitTo); // <= FOUND

```
['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L47-L47)']
```solidity
47:         emit Events.LendAsLimitOrder(params.maxDueDate, params.curveRelativeTime); // <= FOUND

```
['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/actions/LiquidateVariable.sol#L36-L36)']
```solidity
36:         emit Events.LiquidateVariable(params.borrower, params.amount); // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L31-L31)']
```solidity
31:         emit StaleRateIntervalUpdated(oldStaleRateInterval, _staleRateInterval); // <= FOUND

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L38-L38)']
```solidity
38:         emit MarketBorrowRateUpdated(oldMarketBorrowRate, _marketBorrowRate); // <= FOUND

```
['[119](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L119-L119)']
```solidity
119:         emit Events.UpdateConfig(params.key, params.value); // <= FOUND

```


</details>

## [Gas-46] Consider using solady's "FixedPointMathLib"

### Resolution 
Using Solady's "FixedPointMathLib" for multiplication or division operations in Solidity can lead to significant gas savings. This library is designed to optimize fixed-point arithmetic operations, which are common in financial calculations involving tokens or currencies. By implementing more efficient algorithms and assembly optimizations, "FixedPointMathLib" minimizes the computational resources required for these operations. For contracts that frequently perform such calculations, integrating this library can reduce transaction costs, thereby enhancing overall performance and cost-effectiveness. However, developers must ensure compatibility with their existing codebase and thoroughly test for accuracy and expected behavior to avoid any unintended consequences.

Num of instances: 10

### Findings 


<details><summary>Click to show findings</summary>

['[36](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L36-L36)']
```solidity
35:         collateralTokenAmount = Math.mulDivUp(
36:             debtTokenAmountWad, 10 ** state.oracle.priceFeed.decimals(), state.oracle.priceFeed.getPrice() // <= FOUND
37:         );

```
['[9](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L9-L9)']
```solidity
9:         return amount * 10 ** (18 - decimals); // <= FOUND

```
['[15](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L15-L15)']
```solidity
14:         
15:         return wad / 10 ** (18 - decimals); // <= FOUND

```
['[60](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L60-L60)']
```solidity
58:         return Math.mulDivDown(
59:             _scalePrice(basePrice, baseDecimals, decimals),
60:             10 ** decimals, // <= FOUND
61:             _scalePrice(quotePrice, quoteDecimals, decimals)
62:         );

```
['[67](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L67-L67)']
```solidity
67:             return _price * (10 ** uint256(_decimals - _priceDecimals)); // <= FOUND

```
['[69](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L69-L69)']
```solidity
69:             return _price / (10 ** uint256(_priceDecimals - _decimals)); // <= FOUND

```
['[20](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L20-L20)']
```solidity
19:         
20:         return ray / 1e9; // <= FOUND

```
['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L11-L11)']
```solidity
11: uint256 constant CREDIT_POSITION_ID_START = type(uint256).max / 2; // <= FOUND

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L34-L34)']
```solidity
34:         return x * y / z; // <= FOUND

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L65-L65)']
```solidity
65:             uint256 mid = (low + high) / 2; // <= FOUND

```


</details>

## [Gas-47] Same cast is done multiple times

### Resolution 
Repeatedly casting the same variable to the same type within a function is redundant and can be optimized for better gas efficiency and code readability. Each unnecessary cast operation, while minor, adds to the gas cost and clutters the code. To optimize, the best practice is to perform the cast once and store the result in a temporary variable, which can then be used wherever needed in the function.

Num of instances: 9

### Findings 


<details><summary>Click to show findings</summary>

['[76](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L76-L110)']
```solidity
76:     function executeUpdateConfig(State storage state, UpdateConfigParams calldata params) external {
77:         if (params.key == "crOpening") {
78:             state.riskConfig.crOpening = params.value;
79:         } else if (params.key == "crLiquidation") {
80:             state.riskConfig.crLiquidation = params.value;
81:         } else if (params.key == "minimumCreditBorrowAToken") {
82:             state.riskConfig.minimumCreditBorrowAToken = params.value;
83:         } else if (params.key == "collateralSplitLiquidatorPercent") {
84:             state.riskConfig.collateralSplitLiquidatorPercent = params.value;
85:         } else if (params.key == "collateralSplitProtocolPercent") {
86:             state.riskConfig.collateralSplitProtocolPercent = params.value;
87:         } else if (params.key == "collateralTokenCap") {
88:             state.riskConfig.collateralTokenCap = params.value;
89:         } else if (params.key == "borrowATokenCap") {
90:             state.riskConfig.borrowATokenCap = params.value;
91:         } else if (params.key == "debtTokenCap") {
92:             state.riskConfig.debtTokenCap = params.value;
93:         } else if (params.key == "moveToVariablePoolHFThreshold") {
94:             state.riskConfig.moveToVariablePoolHFThreshold = params.value;
95:         } else if (params.key == "minimumMaturity") {
96:             state.riskConfig.minimumMaturity = params.value;
97:         } else if (params.key == "repayFeeAPR") {
98:             state.feeConfig.repayFeeAPR = params.value;
99:         } else if (params.key == "earlyLenderExitFee") {
100:             state.feeConfig.earlyLenderExitFee = params.value;
101:         } else if (params.key == "earlyBorrowerExitFee") {
102:             state.feeConfig.earlyBorrowerExitFee = params.value;
103:         } else if (params.key == "collateralOverdueTransferFee") {
104:             state.feeConfig.collateralOverdueTransferFee = params.value;
105:         } else if (params.key == "feeRecipient") {
106:             state.feeConfig.feeRecipient = address(uint160(params.value)); // <= FOUND 'address(uint160(params.value)'
107:         } else if (params.key == "priceFeed") {
108:             state.oracle.priceFeed = IPriceFeed(address(uint160(params.value))); // <= FOUND 'address(uint160(params.value)'
109:         } else if (params.key == "marketBorrowRateFeed") {
110:             state.oracle.marketBorrowRateFeed = IMarketBorrowRateFeed(address(uint160(params.value))); // <= FOUND 'address(uint160(params.value)'
111:         } else {
112:             revert Errors.INVALID_KEY(params.key);
113:         }
114: 
115:         Initialize.validateInitializeFeeConfigParams(feeConfigParams(state));
116:         Initialize.validateInitializeRiskConfigParams(riskConfigParams(state));
117:         Initialize.validateInitializeOracleParams(oracleParams(state));
118: 
119:         emit Events.UpdateConfig(params.key, params.value);
120:     }

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L25-L33)']
```solidity
25:     function getVaultFixed(State storage state, address user) public returns (Vault) {
26:         if (address(state.data.users[user].vaultFixed) != address(0)) {
27:             return state.data.users[user].vaultFixed;
28:         }
29:         Vault vault = Vault(payable(Clones.clone(address(state.data.vaultImplementation))));
30:         emit Events.CreateVault(user, address(vault), false); // <= FOUND 'address(vault)'
31:         vault.initialize(address(this));
32:         state.data.users[user].vaultFixed = vault;
33:         state.data.variablePoolAllowlisted[address(vault)] = true; // <= FOUND 'address(vault)'
34:         return vault;
35:     }

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L43-L51)']
```solidity
43:     function getVaultVariable(State storage state, address user) public returns (Vault) {
44:         if (address(state.data.users[user].vaultVariable) != address(0)) {
45:             return state.data.users[user].vaultVariable;
46:         }
47:         Vault vault = Vault(payable(Clones.clone(address(state.data.vaultImplementation))));
48:         emit Events.CreateVault(user, address(vault), true); // <= FOUND 'address(vault)'
49:         vault.initialize(address(this));
50:         state.data.users[user].vaultVariable = vault;
51:         state.data.variablePoolAllowlisted[address(vault)] = true; // <= FOUND 'address(vault)'
52:         return vault;
53:     }

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L44-L64)']
```solidity
44:     function depositUnderlyingTokenToVariablePool(
45:         State storage state,
46:         IERC20Metadata underlyingToken,
47:         address from,
48:         address to,
49:         uint256 amount,
50:         bool variable,
51:         bool setUseReserveAsCollateral
52:     ) external {
53:         underlyingToken.safeTransferFrom(from, address(this), amount);
54: 
55:         Vault vaultTo = variable ? state.getVaultVariable(to) : state.getVaultFixed(to);
56: 
57:         underlyingToken.forceApprove(address(state.data.variablePool), amount); // <= FOUND 'address(state.data.variablePool)'
58:         state.data.variablePool.supply(address(underlyingToken), amount, address(vaultTo), 0);
59: 
60:         
61:         if (setUseReserveAsCollateral) {
62:             
63:             vaultTo.proxy(
64:                 address(state.data.variablePool), // <= FOUND 'address(state.data.variablePool)'
65:                 abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(underlyingToken), true))
66:             );
67:         }
68:     }

```
['[106](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L106-L136)']
```solidity
106:     function borrowVariableLoan(State storage state, address from, address to, uint256 amount) external {
107:         IERC20Metadata underlyingBorrowToken = IERC20Metadata(state.data.underlyingBorrowToken);
108: 
109:         Vault vaultFrom = state.getVaultVariable(from);
110:         Vault vaultTo = state.getVaultVariable(to);
111: 
112:         address[] memory targets = new address[](2);
113:         bytes[] memory data = new bytes[](2);
114: 
115:         
116:         targets[0] = address(state.data.variablePool); // <= FOUND 'address(state.data.variablePool)'
117:         data[0] = abi.encodeCall(
118:             IPool.borrow,
119:             (
120:                 address(underlyingBorrowToken),
121:                 amount,
122:                 uint256(DataTypes.InterestRateMode.VARIABLE),
123:                 0,
124:                 address(vaultFrom)
125:             )
126:         );
127: 
128:         
129:         targets[1] = address(state.data.underlyingBorrowToken); // <= FOUND 'address(state.data.underlyingBorrowToken)'
130:         data[1] = abi.encodeCall(IERC20.transfer, (address(this), amount));
131: 
132:         
133:         vaultFrom.proxy(targets, data);
134: 
135:         
136:         underlyingBorrowToken.forceApprove(address(state.data.variablePool), amount); // <= FOUND 'address(state.data.variablePool)'
137:         state.data.variablePool.supply(address(underlyingBorrowToken), amount, address(vaultTo), 0);
138:     }

```
['[164](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L164-L187)']
```solidity
164:     function liquidateVariableLoan(State storage state, address from, address borrower, uint256 amount) external {
165:         
166:         Vault vaultFrom = state.getVaultVariable(from);
167:         Vault vaultTo = state.getVaultVariable(borrower);
168: 
169:         address[] memory targets = new address[](3);
170:         bytes[] memory data = new bytes[](3);
171: 
172:         
173:         targets[0] = address(state.data.variablePool); // <= FOUND 'address(state.data.variablePool)'
174:         data[0] =
175:             abi.encodeCall(IPool.withdraw, (address(state.data.underlyingBorrowToken), amount, address(vaultFrom))); // <= FOUND 'address(state.data.underlyingBorrowToken)'
176: 
177:         
178:         targets[1] = address(state.data.underlyingBorrowToken); // <= FOUND 'address(state.data.underlyingBorrowToken)'
179:         data[1] = abi.encodeCall(IERC20.approve, (address(state.data.variablePool), amount)); // <= FOUND 'address(state.data.variablePool)'
180: 
181:         
182:         targets[2] = address(state.data.variablePool); // <= FOUND 'address(state.data.variablePool)'
183:         data[2] = abi.encodeCall(
184:             IPool.liquidationCall,
185:             (
186:                 address(state.data.underlyingCollateralToken), // <= FOUND 'address(state.data.underlyingCollateralToken)'
187:                 address(state.data.underlyingBorrowToken), // <= FOUND 'address(state.data.underlyingBorrowToken)'
188:                 address(vaultTo),
189:                 amount,
190:                 true
191:             )
192:         );
193: 
194:         
195:         vaultFrom.proxy(targets, data);
196:     }

```
['[205](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L205-L217)']
```solidity
205:     function transferBorrowATokenFixed(State storage state, address from, address to, uint256 amount) public {
206:         IAToken borrowAToken = state.data.borrowAToken;
207:         if (aTokenBalanceOf(state, borrowAToken, from, false) < amount) {
208:             revert Errors.NOT_ENOUGH_ATOKEN_BALANCE(
209:                 address(borrowAToken), from, false, aTokenBalanceOf(state, borrowAToken, from, false), amount // <= FOUND 'address(borrowAToken)'
210:             );
211:         }
212: 
213:         Vault vaultFrom = state.getVaultFixed(from);
214:         Vault vaultTo = state.getVaultFixed(to);
215: 
216:         
217:         vaultFrom.proxy(address(borrowAToken), abi.encodeCall(IERC20.transfer, (address(vaultTo), amount))); // <= FOUND 'address(borrowAToken)'
218:     }

```
['[262](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L262-L321)']
```solidity
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken)
265:     {
266:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
267: 
268:         
269:         liquidatorProfitCollateralToken = state.feeConfig.collateralOverdueTransferFee;
270:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken);
271: 
272:         address from = debtPositionCopy.borrower;
273:         address to = address(this);
274:         uint256 collateralBalance = assignedCollateral - liquidatorProfitCollateralToken;
275:         uint256 borrowATokenBalance = debtPositionCopy.faceValue;
276: 
277:         
278:         Vault vaultFrom = state.getVaultVariable(from);
279:         Vault vaultTo = state.getVaultFixed(to);
280: 
281:         
282:         state.withdrawUnderlyingCollateralToken(from, address(this), collateralBalance);
283: 
284:         
285:         state.data.underlyingCollateralToken.forceApprove(address(state.data.variablePool), collateralBalance); // <= FOUND 'address(state.data.variablePool)'
286:         state.data.variablePool.supply(
287:             address(state.data.underlyingCollateralToken), collateralBalance, address(vaultFrom), 0 // <= FOUND 'address(state.data.underlyingCollateralToken)'
288:         );
289: 
290:         address[] memory targets = new address[](3);
291:         bytes[] memory data = new bytes[](3);
292: 
293:         
294:         targets[0] = address(state.data.variablePool); // <= FOUND 'address(state.data.variablePool)'
295:         data[0] =
296:             abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(state.data.underlyingCollateralToken), true)); // <= FOUND 'address(state.data.underlyingCollateralToken)'
297: 
298:         
299:         targets[1] = address(state.data.variablePool); // <= FOUND 'address(state.data.variablePool)'
300:         data[1] = abi.encodeCall(
301:             IPool.borrow,
302:             (
303:                 address(state.data.underlyingBorrowToken), // <= FOUND 'address(state.data.underlyingBorrowToken)'
304:                 borrowATokenBalance,
305:                 uint256(DataTypes.InterestRateMode.VARIABLE),
306:                 0,
307:                 address(vaultFrom)
308:             )
309:         );
310: 
311:         
312:         targets[2] = address(state.data.underlyingBorrowToken); // <= FOUND 'address(state.data.underlyingBorrowToken)'
313:         data[2] = abi.encodeCall(IERC20.transfer, (address(this), borrowATokenBalance));
314: 
315:         
316:         vaultFrom.proxy(targets, data);
317: 
318:         
319:         state.data.underlyingBorrowToken.forceApprove(address(state.data.variablePool), borrowATokenBalance); // <= FOUND 'address(state.data.variablePool)'
320:         state.data.variablePool.supply(
321:             address(state.data.underlyingBorrowToken), borrowATokenBalance, address(vaultTo), 0 // <= FOUND 'address(state.data.underlyingBorrowToken)'
322:         );
323: 
324:         
325:         (,,,,, uint256 healthFactor) = state.data.variablePool.getUserAccountData(address(vaultFrom));
326:         if (healthFactor < state.riskConfig.moveToVariablePoolHFThreshold) {
327:             revert Errors.HEALTH_FACTOR_BELOW_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(
328:                 address(vaultFrom), healthFactor, state.riskConfig.moveToVariablePoolHFThreshold
329:             );
330:         }
331:     }

```
['[51](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Withdraw.sol#L51-L54)']
```solidity
51:     function executeWithdraw(State storage state, WithdrawParams calldata params) public {
52:         uint256 amount;
53:         if (params.variable || params.token == address(state.data.underlyingBorrowToken)) { // <= FOUND 'address(state.data.underlyingBorrowToken)'
54:             IAToken aToken = params.token == address(state.data.underlyingBorrowToken) // <= FOUND 'address(state.data.underlyingBorrowToken)'
55:                 ? state.data.borrowAToken
56:                 : state.data.collateralAToken;
57: 
58:             amount = Math.min(params.amount, state.aTokenBalanceOf(aToken, msg.sender, params.variable));
59:             if (amount > 0) {
60:                 state.withdrawUnderlyingTokenFromVariablePool(aToken, msg.sender, params.to, amount, params.variable);
61:             }
62:         } else {
63:             amount = Math.min(params.amount, state.data.collateralToken.balanceOf(msg.sender));
64:             if (amount > 0) {
65:                 state.withdrawUnderlyingCollateralToken(msg.sender, params.to, amount);
66:             }
67:         }
68: 
69:         emit Events.Withdraw(params.token, params.to, params.variable, amount);
70:     }

```


</details>

## [Gas-48] Assigning to structs can be more efficient

### Resolution 
Rather defining the struct in a single line, it is more efficient to declare an empty struct and then assign each struct element individually. This can net quite a large gas saving of 130 per instance.

Num of instances: 9

### Findings 


<details><summary>Click to show findings</summary>

['[83](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L83-L114)']
```solidity
83:     function createDebtAndCreditPositions(
84:         State storage state, // <= FOUND
85:         address lender, // <= FOUND
86:         address borrower, // <= FOUND
87:         uint256 issuanceValue, // <= FOUND
88:         uint256 faceValue, // <= FOUND
89:         uint256 dueDate // <= FOUND
90:     ) external returns (DebtPosition memory debtPosition, CreditPosition memory creditPosition) {
91:         debtPosition = DebtPosition({ // <= FOUND
92:             lender: lender, // <= FOUND
93:             borrower: borrower, // <= FOUND
94:             issuanceValue: issuanceValue, // <= FOUND
95:             faceValue: faceValue, // <= FOUND
96:             repayFee: LoanLibrary.repayFee(issuanceValue, block.timestamp, dueDate, state.feeConfig.repayFeeAPR), // <= FOUND
97:             startDate: block.timestamp, // <= FOUND
98:             dueDate: dueDate, // <= FOUND
99:             liquidityIndexAtRepayment: 0 // <= FOUND
100:         }); // <= FOUND
101: 
102:         uint256 debtPositionId = state.data.nextDebtPositionId++; // <= FOUND
103:         state.data.debtPositions[debtPositionId] = debtPosition; // <= FOUND
104: 
105:         emit Events.CreateDebtPosition(debtPositionId, lender, borrower, issuanceValue, faceValue, dueDate); // <= FOUND
106: 
107:         creditPosition = // <= FOUND
108:             CreditPosition({lender: lender, credit: debtPosition.faceValue, debtPositionId: debtPositionId}); // <= FOUND
109: 
110:         uint256 creditPositionId = state.data.nextCreditPositionId++; // <= FOUND
111:         state.data.creditPositions[creditPositionId] = creditPosition; // <= FOUND
112:         state.validateMinimumCreditOpening(creditPosition.credit); // <= FOUND
113: 
114:         emit Events.CreateCreditPosition(creditPositionId, lender, RESERVED_ID, debtPositionId, creditPosition.credit); // <= FOUND
115:     }

```
['[117](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L117-L133)']
```solidity
117:     function createCreditPosition(State storage state, uint256 exitCreditPositionId, address lender, uint256 credit)
118:         external // <= FOUND
119:         returns (CreditPosition memory creditPosition) // <= FOUND
120:     {
121:         uint256 debtPositionId = state.getDebtPositionIdByCreditPositionId(exitCreditPositionId); // <= FOUND
122:         CreditPosition storage exitPosition = state.data.creditPositions[exitCreditPositionId]; // <= FOUND
123: 
124:         creditPosition = CreditPosition({lender: lender, credit: credit, debtPositionId: debtPositionId}); // <= FOUND
125: 
126:         uint256 creditPositionId = state.data.nextCreditPositionId++; // <= FOUND
127:         state.data.creditPositions[creditPositionId] = creditPosition; // <= FOUND
128: 
129:         exitPosition.credit -= credit; // <= FOUND
130:         state.validateMinimumCredit(exitPosition.credit); // <= FOUND
131:         state.validateMinimumCreditOpening(creditPosition.credit); // <= FOUND
132: 
133:         emit Events.CreateCreditPosition(creditPositionId, lender, exitCreditPositionId, debtPositionId, credit); // <= FOUND
134:     }

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L18-L34)']
```solidity
18:     function validateBorrowAsLimitOrder(State storage state, BorrowAsLimitOrderParams calldata params) external view { // <= FOUND
19:         BorrowOffer memory borrowOffer = BorrowOffer({ // <= FOUND
20:             openingLimitBorrowCR: params.openingLimitBorrowCR, // <= FOUND
21:             curveRelativeTime: params.curveRelativeTime // <= FOUND
22:         }); // <= FOUND
23: 
24:          // <= FOUND
25:         if (!borrowOffer.isNull()) { // <= FOUND
26:              // <= FOUND
27:              // <= FOUND
28: 
29:              // <= FOUND
30:              // <= FOUND
31: 
32:              // <= FOUND
33:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity); // <= FOUND
34:         } // <= FOUND
35:     }

```
['[37](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsLimitOrder.sol#L37-L42)']
```solidity
37:     function executeBorrowAsLimitOrder(State storage state, BorrowAsLimitOrderParams calldata params) external { // <= FOUND
38:         state.data.users[msg.sender].borrowOffer = BorrowOffer({ // <= FOUND
39:             openingLimitBorrowCR: params.openingLimitBorrowCR, // <= FOUND
40:             curveRelativeTime: params.curveRelativeTime // <= FOUND
41:         }); // <= FOUND
42:         emit Events.BorrowAsLimitOrder(params.curveRelativeTime); // <= FOUND
43:     }

```
['[164](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L164-L188)']
```solidity
164:     function _borrowGeneratingDebt(State storage state, BorrowAsMarketOrderParams memory params) internal { // <= FOUND
165:         if (params.amount == 0) { // <= FOUND
166:             return; // <= FOUND
167:         } // <= FOUND
168: 
169:         User storage lenderUser = state.data.users[params.lender]; // <= FOUND
170: 
171:         LoanOffer storage loanOffer = lenderUser.loanOffer; // <= FOUND
172: 
173:         uint256 ratePerMaturity = // <= FOUND
174:             loanOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate); // <= FOUND
175:         uint256 issuanceValue = params.amount; // <= FOUND
176:         uint256 faceValue = Math.mulDivUp(issuanceValue, PERCENT + ratePerMaturity, PERCENT); // <= FOUND
177: 
178:          // <= FOUND
179:         (DebtPosition memory debtPosition,) = state.createDebtAndCreditPositions({ // <= FOUND
180:             lender: params.lender, // <= FOUND
181:             borrower: msg.sender, // <= FOUND
182:             issuanceValue: issuanceValue, // <= FOUND
183:             faceValue: faceValue, // <= FOUND
184:             dueDate: params.dueDate // <= FOUND
185:         }); // <= FOUND
186: 
187:         state.data.debtToken.mint(msg.sender, debtPosition.getDebt()); // <= FOUND
188:         state.transferBorrowATokenFixed(params.lender, msg.sender, issuanceValue); // <= FOUND
189:     }

```
['[22](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L22-L41)']
```solidity
22:     function validateLendAsLimitOrder(State storage state, LendAsLimitOrderParams calldata params) external view { // <= FOUND
23:         LoanOffer memory loanOffer = // <= FOUND
24:             LoanOffer({maxDueDate: params.maxDueDate, curveRelativeTime: params.curveRelativeTime}); // <= FOUND
25: 
26:          // <= FOUND
27:         if (!loanOffer.isNull()) { // <= FOUND
28:              // <= FOUND
29:              // <= FOUND
30: 
31:              // <= FOUND
32:             if (params.maxDueDate == 0) { // <= FOUND
33:                 revert Errors.NULL_MAX_DUE_DATE(); // <= FOUND
34:             } // <= FOUND
35:             if (params.maxDueDate < block.timestamp) { // <= FOUND
36:                 revert Errors.PAST_MAX_DUE_DATE(params.maxDueDate); // <= FOUND
37:             } // <= FOUND
38: 
39:              // <= FOUND
40:             YieldCurveLibrary.validateYieldCurve(params.curveRelativeTime, state.riskConfig.minimumMaturity); // <= FOUND
41:         } // <= FOUND
42:     }

```
['[44](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsLimitOrder.sol#L44-L47)']
```solidity
44:     function executeLendAsLimitOrder(State storage state, LendAsLimitOrderParams calldata params) external { // <= FOUND
45:         state.data.users[msg.sender].loanOffer = // <= FOUND
46:             LoanOffer({maxDueDate: params.maxDueDate, curveRelativeTime: params.curveRelativeTime}); // <= FOUND
47:         emit Events.LendAsLimitOrder(params.maxDueDate, params.curveRelativeTime); // <= FOUND
48:     }

```
['[89](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L89-L113)']
```solidity
89:     function executeLendAsMarketOrder(State storage state, LendAsMarketOrderParams memory params) external { // <= FOUND
90:         emit Events.LendAsMarketOrder(params.borrower, params.dueDate, params.amount, params.exactAmountIn); // <= FOUND
91: 
92:         BorrowOffer storage borrowOffer = state.data.users[params.borrower].borrowOffer; // <= FOUND
93: 
94:         uint256 ratePerMaturity = // <= FOUND
95:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, params.dueDate); // <= FOUND
96:         uint256 issuanceValue; // <= FOUND
97:         if (params.exactAmountIn) { // <= FOUND
98:             issuanceValue = params.amount; // <= FOUND
99:         } else { // <= FOUND
100:             issuanceValue = Math.mulDivUp(params.amount, PERCENT, PERCENT + ratePerMaturity); // <= FOUND
101:         } // <= FOUND
102:         uint256 faceValue = Math.mulDivDown(issuanceValue, PERCENT + ratePerMaturity, PERCENT); // <= FOUND
103: 
104:          // <= FOUND
105:         (DebtPosition memory debtPosition,) = state.createDebtAndCreditPositions({ // <= FOUND
106:             lender: msg.sender, // <= FOUND
107:             borrower: params.borrower, // <= FOUND
108:             issuanceValue: issuanceValue, // <= FOUND
109:             faceValue: faceValue, // <= FOUND
110:             dueDate: params.dueDate // <= FOUND
111:         }); // <= FOUND
112:         state.data.debtToken.mint(params.borrower, debtPosition.getDebt()); // <= FOUND
113:         state.transferBorrowATokenFixed(msg.sender, params.borrower, issuanceValue); // <= FOUND
114:     }

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L94-L128)']
```solidity
94:     function executeLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params)
95:         external // <= FOUND
96:         returns (uint256, uint256) // <= FOUND
97:     {
98:         emit Events.LiquidateWithReplacement(params.debtPositionId, params.borrower, params.minimumCollateralProfit); // <= FOUND
99: 
100:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId); // <= FOUND
101:         DebtPosition memory debtPositionCopy = debtPosition; // <= FOUND
102:         BorrowOffer storage borrowOffer = state.data.users[params.borrower].borrowOffer; // <= FOUND
103: 
104:         uint256 liquidatorProfitCollateralAsset = state.executeLiquidate( // <= FOUND
105:             LiquidateParams({ // <= FOUND
106:                 debtPositionId: params.debtPositionId, // <= FOUND
107:                 minimumCollateralProfit: params.minimumCollateralProfit // <= FOUND
108:             }) // <= FOUND
109:         ); // <= FOUND
110: 
111:         uint256 ratePerMaturity = // <= FOUND
112:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, debtPositionCopy.dueDate); // <= FOUND
113:         uint256 issuanceValue = Math.mulDivDown(debtPositionCopy.faceValue, PERCENT, PERCENT + ratePerMaturity); // <= FOUND
114:         uint256 liquidatorProfitBorrowAsset = debtPositionCopy.faceValue - issuanceValue; // <= FOUND
115: 
116:         debtPosition.borrower = params.borrower; // <= FOUND
117:         debtPosition.startDate = block.timestamp; // <= FOUND
118:         debtPosition.issuanceValue = issuanceValue; // <= FOUND
119:         debtPosition.faceValue = debtPositionCopy.faceValue; // <= FOUND
120:         debtPosition.liquidityIndexAtRepayment = 0; // <= FOUND
121:         debtPosition.repayFee = // <= FOUND
122:             LoanLibrary.repayFee(issuanceValue, block.timestamp, debtPosition.dueDate, state.feeConfig.repayFeeAPR); // <= FOUND
123: 
124:         state.data.debtToken.mint(params.borrower, debtPositionCopy.getDebt()); // <= FOUND
125:         state.transferBorrowATokenFixed(address(this), params.borrower, issuanceValue); // <= FOUND
126:         state.transferBorrowATokenFixed(address(this), state.feeConfig.feeRecipient, liquidatorProfitBorrowAsset); // <= FOUND
127: 
128:         return (liquidatorProfitCollateralAsset, liquidatorProfitBorrowAsset); // <= FOUND
129:     }

```


</details>

## [Gas-49] Cache address(this) when used more than once

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[217](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L217-L236)']
```solidity
217:     function executeInitializeData(State storage state, InitializeDataParams memory d) internal {
218:         state.data.nextDebtPositionId = DEBT_POSITION_ID_START;
219:         state.data.nextCreditPositionId = CREDIT_POSITION_ID_START;
220: 
221:         state.data.underlyingCollateralToken = IERC20Metadata(d.underlyingCollateralToken);
222:         state.data.underlyingBorrowToken = IERC20Metadata(d.underlyingBorrowToken);
223:         state.data.variablePool = IPool(d.variablePool);
224: 
225:         state.data.collateralToken = new NonTransferrableToken(
226:             address(this), // <= FOUND
227:             string.concat("Size Fixed ", IERC20Metadata(state.data.underlyingCollateralToken).name()),
228:             string.concat("sz", IERC20Metadata(state.data.underlyingCollateralToken).symbol()),
229:             IERC20Metadata(state.data.underlyingCollateralToken).decimals()
230:         );
231:         state.data.borrowAToken =
232:             IAToken(state.data.variablePool.getReserveData(address(state.data.underlyingBorrowToken)).aTokenAddress);
233:         state.data.collateralAToken =
234:             IAToken(state.data.variablePool.getReserveData(address(state.data.underlyingCollateralToken)).aTokenAddress);
235:         state.data.debtToken = new NonTransferrableToken(
236:             address(this), "Size Fixed Debt", "szDebt", IERC20Metadata(state.data.underlyingBorrowToken).decimals() // <= FOUND
237:         );
238: 
239:         state.data.vaultImplementation = new Vault();
240:     }

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L94-L126)']
```solidity
94:     function executeLiquidateWithReplacement(State storage state, LiquidateWithReplacementParams calldata params)
95:         external
96:         returns (uint256, uint256)
97:     {
98:         emit Events.LiquidateWithReplacement(params.debtPositionId, params.borrower, params.minimumCollateralProfit);
99: 
100:         DebtPosition storage debtPosition = state.getDebtPosition(params.debtPositionId);
101:         DebtPosition memory debtPositionCopy = debtPosition;
102:         BorrowOffer storage borrowOffer = state.data.users[params.borrower].borrowOffer;
103: 
104:         uint256 liquidatorProfitCollateralAsset = state.executeLiquidate(
105:             LiquidateParams({
106:                 debtPositionId: params.debtPositionId,
107:                 minimumCollateralProfit: params.minimumCollateralProfit
108:             })
109:         );
110: 
111:         uint256 ratePerMaturity =
112:             borrowOffer.getRatePerMaturityByDueDate(state.oracle.marketBorrowRateFeed, debtPositionCopy.dueDate);
113:         uint256 issuanceValue = Math.mulDivDown(debtPositionCopy.faceValue, PERCENT, PERCENT + ratePerMaturity);
114:         uint256 liquidatorProfitBorrowAsset = debtPositionCopy.faceValue - issuanceValue;
115: 
116:         debtPosition.borrower = params.borrower;
117:         debtPosition.startDate = block.timestamp;
118:         debtPosition.issuanceValue = issuanceValue;
119:         debtPosition.faceValue = debtPositionCopy.faceValue;
120:         debtPosition.liquidityIndexAtRepayment = 0;
121:         debtPosition.repayFee =
122:             LoanLibrary.repayFee(issuanceValue, block.timestamp, debtPosition.dueDate, state.feeConfig.repayFeeAPR);
123: 
124:         state.data.debtToken.mint(params.borrower, debtPositionCopy.getDebt());
125:         state.transferBorrowATokenFixed(address(this), params.borrower, issuanceValue); // <= FOUND
126:         state.transferBorrowATokenFixed(address(this), state.feeConfig.feeRecipient, liquidatorProfitBorrowAsset); // <= FOUND
127: 
128:         return (liquidatorProfitCollateralAsset, liquidatorProfitBorrowAsset);
129:     }

```
['[262](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L262-L313)']
```solidity
262:     function moveDebtPositionToVariablePool(State storage state, DebtPosition memory debtPositionCopy)
263:         external
264:         returns (uint256 liquidatorProfitCollateralToken)
265:     {
266:         uint256 assignedCollateral = state.getDebtPositionAssignedCollateral(debtPositionCopy);
267: 
268:         
269:         liquidatorProfitCollateralToken = state.feeConfig.collateralOverdueTransferFee;
270:         state.data.collateralToken.transferFrom(debtPositionCopy.borrower, msg.sender, liquidatorProfitCollateralToken);
271: 
272:         address from = debtPositionCopy.borrower;
273:         address to = address(this); // <= FOUND
274:         uint256 collateralBalance = assignedCollateral - liquidatorProfitCollateralToken;
275:         uint256 borrowATokenBalance = debtPositionCopy.faceValue;
276: 
277:         
278:         Vault vaultFrom = state.getVaultVariable(from);
279:         Vault vaultTo = state.getVaultFixed(to);
280: 
281:         
282:         state.withdrawUnderlyingCollateralToken(from, address(this), collateralBalance); // <= FOUND
283: 
284:         
285:         state.data.underlyingCollateralToken.forceApprove(address(state.data.variablePool), collateralBalance);
286:         state.data.variablePool.supply(
287:             address(state.data.underlyingCollateralToken), collateralBalance, address(vaultFrom), 0
288:         );
289: 
290:         address[] memory targets = new address[](3);
291:         bytes[] memory data = new bytes[](3);
292: 
293:         
294:         targets[0] = address(state.data.variablePool);
295:         data[0] =
296:             abi.encodeCall(IPool.setUserUseReserveAsCollateral, (address(state.data.underlyingCollateralToken), true));
297: 
298:         
299:         targets[1] = address(state.data.variablePool);
300:         data[1] = abi.encodeCall(
301:             IPool.borrow,
302:             (
303:                 address(state.data.underlyingBorrowToken),
304:                 borrowATokenBalance,
305:                 uint256(DataTypes.InterestRateMode.VARIABLE),
306:                 0,
307:                 address(vaultFrom)
308:             )
309:         );
310: 
311:         
312:         targets[2] = address(state.data.underlyingBorrowToken);
313:         data[2] = abi.encodeCall(IERC20.transfer, (address(this), borrowATokenBalance)); // <= FOUND
314: 
315:         
316:         vaultFrom.proxy(targets, data);
317: 
318:         
319:         state.data.underlyingBorrowToken.forceApprove(address(state.data.variablePool), borrowATokenBalance);
320:         state.data.variablePool.supply(
321:             address(state.data.underlyingBorrowToken), borrowATokenBalance, address(vaultTo), 0
322:         );
323: 
324:         
325:         (,,,,, uint256 healthFactor) = state.data.variablePool.getUserAccountData(address(vaultFrom));
326:         if (healthFactor < state.riskConfig.moveToVariablePoolHFThreshold) {
327:             revert Errors.HEALTH_FACTOR_BELOW_MOVE_TO_VARIABLE_POOL_HF_THRESHOLD(
328:                 address(vaultFrom), healthFactor, state.riskConfig.moveToVariablePoolHFThreshold
329:             );
330:         }
331:     }

```


</details>

## [Gas-50] Internal functions never used once can be removed

### Resolution 
Internal functions which are never used use unnecessary gas and should be safely removed.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L12-L12)']
```solidity
12:     function wadToAmountDown(uint256 wad, uint8 decimals) internal pure returns (uint256)  // <= FOUND

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/ConversionLibrary.sol#L17-L17)']
```solidity
17:     function rayToWadDown(uint256 ray) internal pure returns (uint256)  // <= FOUND

```


</details>

## [Gas-51] Empty functions should be removed to save gas

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L72-L72)']
```solidity
72:     function validateUpdateConfig(State storage, UpdateConfigParams calldata) external pure {
73:         
74:     }

```


</details>

## [Gas-52] Only emit event in setter function if the state variable was changed

### Resolution 
Emitting events in setter functions of smart contracts only when state variables change saves gas. This is because emitting events consumes gas, and unnecessary events, where no actual state change occurs, lead to wasteful consumption.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L28-L31)']
```solidity
28:     function setStaleRateInterval(uint64 _staleRateInterval) external onlyOwner { // <= FOUND
29:         uint64 oldStaleRateInterval = staleRateInterval;
30:         staleRateInterval = _staleRateInterval;
31:         emit StaleRateIntervalUpdated(oldStaleRateInterval, _staleRateInterval); // <= FOUND
32:     }

```
['[34](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L34-L38)']
```solidity
34:     function setMarketBorrowRate(uint128 _marketBorrowRate) external onlyOwner { // <= FOUND
35:         uint128 oldMarketBorrowRate = marketBorrowRate;
36:         marketBorrowRate = _marketBorrowRate;
37:         marketBorrowRateUpdatedAt = uint64(block.timestamp);
38:         emit MarketBorrowRateUpdated(oldMarketBorrowRate, _marketBorrowRate); // <= FOUND
39:     }

```


</details>

## [Gas-53] It is a waste of GAS to emit variable literals

### Resolution 
Emitting variable literals (true, false, 'hello', 1 etc...) in events is inefficient, as it consumes extra gas without providing added value. These literals are fixed values that can be accessed or hardcoded elsewhere in the smart contract or application, making their inclusion in events redundant and an unnecessary drain on resources during transaction execution.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[30](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L30-L30)']
```solidity
30:         emit Events.CreateVault(user, address(vault), false); // <= FOUND

```
['[48](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L48-L48)']
```solidity
48:         emit Events.CreateVault(user, address(vault), true); // <= FOUND

```


</details>

## [Gas-54] Use OZ Array.unsafeAccess() to avoid repeated array length checks

### Resolution 
The OpenZeppelin Array.unsafeAccess() method is a optimization strategy for Solidity, aimed at reducing gas costs by bypassing automatic length checks on storage array accesses. In Solidity, every access to an array element involves a hidden gas cost due to a length check, ensuring that accesses do not exceed the array bounds. However, if a developer has already verified the array's bounds earlier in the function or knows through logic that the access is safe, directly accessing the array elements without redundant length checks can save gas. This approach requires careful consideration to avoid out-of-bounds errors, as it trades off safety checks for efficiency.

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[86](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L86-L86)']
```solidity
86:             uint256 creditPositionId = params.receivableCreditPositionIds[i]; // <= FOUND

```
['[58](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L58-L58)']
```solidity
58:             if (targets[i] == address(0)) { // <= FOUND

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L62-L63)']
```solidity
62:             
63:             (success, returnDatas[i]) = address(targets[i]).call(datas[i]); // <= FOUND

```
['[63](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L63-L63)']
```solidity
63:             Address.verifyCallResult(success, returnDatas[i]); // <= FOUND

```


</details>

## [Gas-55] State variable read in a loop

### Resolution 
Reading a state variable inside a loop in a smart contract can unnecessarily increase gas consumption, as each read operation from the blockchain state is costly. This inefficiency becomes pronounced in loops with many iterations. To optimize gas usage, it's advisable to read the state variable once before the loop starts, store its value in a local (memory) variable, and then use this local variable within the loop. This approach minimizes the number of state read operations, thereby reducing the gas cost associated with executing the contract function, making the smart contract more efficient and cost-effective to run.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[156](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L156-L156)']
```solidity
128:        for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) {
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) {
135:                 deltaAmountIn = creditPosition.credit;
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity);
137:             }
138: 
139:             
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) {
141:                 continue;
142:             }
143:             
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             
149:             state.createCreditPosition({
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee // <= FOUND
157:             );
158:             amountOutLeft -= deltaAmountOut;
159:         }

```


</details>

## [Gas-56] Use uint256(1)/uint256(2) instead of true/false to save gas for changes

### Resolution 
In Solidity, the use of `uint256` values instead of boolean for certain state variables can result in gas savings. This is due to how Ethereum's storage optimization works: changing a variable from `0` to a non-zero value (like flipping `false` to `true`) incurs a higher gas cost compared to modifying an already non-zero value. By using `uint256` with values `1` and `2` instead of `true` and `false`, you avoid the higher cost associated with the `0` to non-zero change, since `1` and `2` are both non-zero. This approach is notably used in OpenZeppelin's `ReentrancyGuard` as a gas optimization technique. However, this should be applied where it makes sense and where gas optimization is critical, as it can decrease code readability.

Num of instances: 16

### Findings 


<details><summary>Click to show findings</summary>

['[60](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/AccountingLibrary.sol#L60-L60)']
```solidity
48:     
56:     function chargeRepayFeeInCollateral(
57:         State storage state,
58:         DebtPosition storage debtPosition,
59:         uint256 repayAmount,
60:         bool isEarlyRepay // <= FOUND
61:     ) public returns (uint256 repayFee) {

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LendAsMarketOrder.sol#L25-L25)']
```solidity
25:     bool exactAmountIn; // <= FOUND

```
['[18](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L18-L18)']
```solidity
18:     bool variable; // <= FOUND

```
['[55](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Deposit.sol#L55-L55)']
```solidity
55:             bool setUseReserveAsCollateral = params.token == address(state.data.underlyingCollateralToken); // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Errors.sol#L45-L45)']
```solidity
45:     error NOT_ENOUGH_ATOKEN_BALANCE(address token, address account, bool variable, uint256 balance, uint256 required); // <= FOUND

```
['[25](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L25-L25)']
```solidity
25:     event CreateVault(address indexed user, address indexed vault, bool indexed variable); // <= FOUND

```
['[26](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L26-L26)']
```solidity
26:     event Deposit(address indexed token, address indexed to, bool indexed variable, uint256 amount); // <= FOUND

```
['[27](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L27-L27)']
```solidity
27:     event Withdraw(address indexed token, address indexed to, bool indexed variable, uint256 amount); // <= FOUND

```
['[43](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L43-L43)']
```solidity
37:     
39:     event BorrowAsMarketOrder(
40:         address indexed lender,
41:         uint256 indexed amount,
42:         uint256 indexed dueDate,
43:         bool exactAmountIn, // <= FOUND
44:         uint256[] receivableCreditPositionIds
45:     );

```
['[46](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Events.sol#L46-L46)']
```solidity
45:     event LendAsMarketOrder(
46:         address indexed borrower, uint256 indexed dueDate, uint256 indexed amount, bool exactAmountIn // <= FOUND
47:     );

```
['[65](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L65-L65)']
```solidity
62:     function _executeLiquidateTakeCollateral(
63:         State storage state,
64:         DebtPosition memory debtPositionCopy,
65:         bool splitCollateralRemainder // <= FOUND
66:     ) private returns (uint256 liquidatorProfitCollateralToken) {

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L62-L63)']
```solidity
44:     
56:     function depositUnderlyingTokenToVariablePool(
57:         State storage state,
58:         IERC20Metadata underlyingToken,
59:         address from,
60:         address to,
61:         uint256 amount,
62:         bool variable, // <= FOUND
63:         bool setUseReserveAsCollateral // <= FOUND
64:     ) external {

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L94-L94)']
```solidity
79:     
88:     function withdrawUnderlyingTokenFromVariablePool(
89:         State storage state,
90:         IAToken aToken,
91:         address from,
92:         address to,
93:         uint256 amount,
94:         bool variable // <= FOUND
95:     ) external {

```
['[230](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L230-L230)']
```solidity
225:     
230:     function aTokenBalanceOf(State storage state, IAToken aToken, address account, bool variable) // <= FOUND
231:         public
232:         view
233:         returns (uint256)
234:     {

```
['[28](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L28-L28)']
```solidity
28:         bool success; // <= FOUND

```
['[45](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/SizeStorage.sol#L45-L45)']
```solidity
45:     mapping(address => bool) variablePoolAllowlisted;  // <= FOUND

```


</details>

## [Gas-57] Enable IR-based code generation

### Resolution 
Enabling Intermediate Representation (IR)-based code generation in Solidity, via the --via-ir compiler flag or setting {"viaIR": true} in the configuration, activates an advanced optimization phase. This approach allows the compiler to perform more sophisticated optimizations across multiple functions, potentially leading to significant gas savings. IR-based compilation can optimize contract bytecode more efficiently, making smart contracts cheaper to deploy and execute by reducing the gas required for transactions

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/MarketBorrowRateFeed.sol#L12-L12)']
```solidity
12: contract MarketBorrowRateFeed is IMarketBorrowRateFeed, Ownable2Step { // <= FOUND
13:     uint128 internal marketBorrowRate;
14:     uint64 internal marketBorrowRateUpdatedAt;
15:     uint64 internal staleRateInterval;
16: 
27: }

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L12-L12)']
```solidity
12: contract NonTransferrableToken is Ownable, ERC20 { // <= FOUND
13:     uint8 internal immutable _decimals;
14: 
31: }

```
['[56](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L56-L56)']
```solidity
56: contract Size is // <= FOUND
57:     ISize,
58:     SizeView,
59:     Initializable,
60:     AccessControlUpgradeable,
61:     PausableUpgradeable,
62:     MulticallUpgradeable,
63:     UUPSUpgradeable
64: {
65:     
66:     using Initialize for State;
67:     using UpdateConfig for State;
68:     using Deposit for State;
69:     using Withdraw for State;
70:     using BorrowAsMarketOrder for State;
71:     using BorrowAsLimitOrder for State;
72:     using LendAsMarketOrder for State;
73:     using LendAsLimitOrder for State;
74:     using BorrowerExit for State;
75:     using Repay for State;
76:     using Claim for State;
77:     using Liquidate for State;
78:     using SelfLiquidate for State;
79:     using LiquidateWithReplacement for State;
80:     using Compensate for State;
81:     using RiskLibrary for State;
82:     using CapsLibrary for State;
83:     using BorrowVariable for State;
84:     using RepayVariable for State;
85:     using LiquidateVariable for State;
86: 
87:     bytes32 public constant KEEPER_ROLE = "KEEPER_ROLE";
88:     bytes32 public constant PAUSER_ROLE = "PAUSER_ROLE";
89: 
154: }

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/oracle/VariablePoolPriceFeed.sol#L17-L17)']
```solidity
17: contract VariablePoolPriceFeed is IPriceFeed { // <= FOUND
18:     
19:     IAaveOracle public immutable aaveOracle;
20:     address public immutable base;
21:     uint8 public immutable baseDecimals;
22:     address public immutable quote;
23:     uint8 public immutable quoteDecimals;
24:     uint8 public immutable decimals;
25:     
32: }

```
['[14](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/proxy/Vault.sol#L14-L14)']
```solidity
14: contract Vault is Initializable, OwnableUpgradeable { // <= FOUND
15:     
27: }

```


</details>

## [Gas-58] Consider pre-calculating the address of address(this) to save gas

### Resolution 
Consider saving the address(this) value within a constant using foundry's script.sol or solady's LibRlp.sol to save gas

Num of instances: 14

### Findings 


<details><summary>Click to show findings</summary>

['[47](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Claim.sol#L47-L47)']
```solidity
47:         state.transferBorrowATokenFixed(address(this), creditPosition.lender, claimAmount); // <= FOUND

```
['[17](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/CollateralLibrary.sol#L17-L17)']
```solidity
17:         underlyingCollateralToken.transferFrom(from, address(this), amount); // <= FOUND

```
['[226](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L226-L226)']
```solidity
225:         state.data.collateralToken = new NonTransferrableToken(
226:             address(this), // <= FOUND
227:             string.concat("Size Fixed ", IERC20Metadata(state.data.underlyingCollateralToken).name()),
228:             string.concat("sz", IERC20Metadata(state.data.underlyingCollateralToken).symbol()),
229:             IERC20Metadata(state.data.underlyingCollateralToken).decimals()
230:         );

```
['[236](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/Initialize.sol#L236-L236)']
```solidity
235:         state.data.debtToken = new NonTransferrableToken(
236:             address(this), "Size Fixed Debt", "szDebt", IERC20Metadata(state.data.underlyingBorrowToken).decimals() // <= FOUND
237:         );

```
['[94](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Liquidate.sol#L94-L94)']
```solidity
94:         state.transferBorrowATokenFixed(msg.sender, address(this), debtPositionCopy.faceValue); // <= FOUND

```
['[125](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L125-L125)']
```solidity
125:         state.transferBorrowATokenFixed(address(this), params.borrower, issuanceValue); // <= FOUND

```
['[126](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/LiquidateWithReplacement.sol#L126-L126)']
```solidity
126:         state.transferBorrowATokenFixed(address(this), state.feeConfig.feeRecipient, liquidatorProfitBorrowAsset); // <= FOUND

```
['[52](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/Repay.sol#L52-L52)']
```solidity
52:         state.transferBorrowATokenFixed(msg.sender, address(this), faceValue); // <= FOUND

```
['[31](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/UserLibrary.sol#L31-L31)']
```solidity
31:         vault.initialize(address(this)); // <= FOUND

```
['[53](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L53-L53)']
```solidity
53:         underlyingToken.safeTransferFrom(from, address(this), amount); // <= FOUND

```
['[130](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L130-L130)']
```solidity
130:         data[1] = abi.encodeCall(IERC20.transfer, (address(this), amount)); // <= FOUND

```
['[273](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L273-L273)']
```solidity
273:         address to = address(this); // <= FOUND

```
['[283](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L283-L283)']
```solidity
282:         
283:         state.withdrawUnderlyingCollateralToken(from, address(this), collateralBalance); // <= FOUND

```
['[313](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/variable/VariableLibrary.sol#L313-L313)']
```solidity
313:         data[2] = abi.encodeCall(IERC20.transfer, (address(this), borrowATokenBalance)); // <= FOUND

```


</details>

## [Gas-59] Public functions not called internally

### Resolution 
Public functions that aren't used internally in Solidity contracts should be made external to optimize gas usage and improve contract efficiency. External functions can only be called from outside the contract, and their arguments are directly read from the calldata, which is more gas-efficient than loading them into memory, as is the case for public functions. By using external visibility, developers can reduce gas consumption for external calls and ensure that the contract operates more cost-effectively for users. Moreover, setting the appropriate visibility level for functions also enhances code readability and maintainability, promoting a more secure and well-structured contract design.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[64](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L64-L64)']
```solidity
64:     function dataParams(State storage state) public view returns (InitializeDataParams memory) 

```


</details>

## [Gas-60] do-while is cheaper than for-loops when the initial check can be skipped

### Resolution 
In smart contract optimization, do-while loops can outperform for-loops cost-wise when the initial iteration's condition check is unnecessary. By deferring the condition check to the loop's end, do-while ensures the loop body executes at least once, saving gas when initial conditions are already met, a crucial aspect for Web3 auditors focusing on efficiency. These however should be used carefully as if an input array has a length of 0, the while loop shouldn't run, as such this should only ne utilized if it is known for a fact the contents of the iteration will be run at least once.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[128](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/actions/BorrowAsMarketOrder.sol#L128-L140)']
```solidity
128:        for (uint256 i = 0; i < params.receivableCreditPositionIds.length; ++i) { // <= FOUND
129:             uint256 creditPositionId = params.receivableCreditPositionIds[i];
130:             CreditPosition memory creditPosition = state.data.creditPositions[creditPositionId];
131: 
132:             uint256 deltaAmountIn = Math.mulDivUp(amountOutLeft, PERCENT + ratePerMaturity, PERCENT);
133:             uint256 deltaAmountOut = amountOutLeft;
134:             if (deltaAmountIn > creditPosition.credit) { // <= FOUND
135:                 deltaAmountIn = creditPosition.credit;
136:                 deltaAmountOut = Math.mulDivDown(creditPosition.credit, PERCENT, PERCENT + ratePerMaturity);
137:             }
138: 
139:             
140:             if (deltaAmountIn < state.riskConfig.minimumCreditBorrowAToken) { // <= FOUND
141:                 continue;
142:             }
143:             
144:             if (deltaAmountOut == 0) {
145:                 break;
146:             }
147: 
148:             
149:             state.createCreditPosition({
150:                 exitCreditPositionId: creditPositionId,
151:                 lender: params.lender,
152:                 credit: deltaAmountIn
153:             });
154:             state.transferBorrowATokenFixed(params.lender, msg.sender, deltaAmountOut);
155:             state.transferBorrowATokenFixed(
156:                 msg.sender, state.feeConfig.feeRecipient, state.feeConfig.earlyLenderExitFee
157:             );
158:             amountOutLeft -= deltaAmountOut;
159:         }

```


</details>

## [Gas-61] Empty blocks should be removed or emit something

### Resolution 
Empty code blocks (i.e., {}) in a Solidity contract can be harmful as they can lead to ambiguity, misinterpretation, and unintended behavior. When developers encounter empty code blocks, it may be unclear whether the absence of code is intentional or the result of an oversight. This uncertainty can cause confusion during development, testing, and debugging, increasing the likelihood of introducing errors or vulnerabilities. Moreover, empty code blocks may give a false impression of implemented functionality or security measures, creating a misleading sense of assurance. To ensure clarity and maintainability, it is essential to avoid empty code blocks and explicitly document the intended behavior or any intentional omissions.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[116](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/Size.sol#L116-L116)']
```solidity
116:     function _authorizeUpgrade(address newImplementation) internal override onlyRole(DEFAULT_ADMIN_ROLE) {}

```
['[72](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/general/actions/UpdateConfig.sol#L72-L72)']
```solidity
72:     function validateUpdateConfig(State storage, UpdateConfigParams calldata) external pure {
73:         
74:     }

```


</details>

## [Gas-62] Use constants instead of type(uint<n>).max

### Resolution 
In smart contract development, utilizing constants for known maximum or minimum values, rather than computing `type(uint<n>).max` or assuming `0` for `.min`, can significantly reduce gas costs. Constants require less runtime computation and storage, optimizing contract efficiencyâ€”a crucial strategy for developers aiming for cost-effective and performant code.

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[11](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L11-L11)']
```solidity
11: uint256 constant CREDIT_POSITION_ID_START = type(uint256).max / 2; // <= FOUND

```
['[12](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/LoanLibrary.sol#L12-L12)']
```solidity
12: uint256 constant RESERVED_ID = type(uint256).max; // <= FOUND

```
['[62](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/Math.sol#L62-L62)']
```solidity
62:             return (type(uint256).max, type(uint256).max); // <= FOUND

```
['[42](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/token/NonTransferrableToken.sol#L42-L42)']
```solidity
42:         return spender == owner() ? type(uint256).max : 0; // <= FOUND

```
['[39](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/RiskLibrary.sol#L39-L39)']
```solidity
39:             return type(uint256).max; // <= FOUND

```
['[38](https://github.com/SizeLending/size-v2-solidity/tree/ce022d37b586a8ee5208c14a73c21edfb0efa4ad/src/libraries/fixed/YieldCurveLibrary.sol#L38-L38)']
```solidity
38:         uint256 lastMaturity = type(uint256).max; // <= FOUND

```


</details>
